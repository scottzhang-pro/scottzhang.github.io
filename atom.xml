<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Scott&#39;s Blog</title>
  
  <subtitle>å­¦åˆ™ä¸å›º, çŸ¥åˆ™ä¸æƒ‘</subtitle>
  <link href="https://scottzhang.pro/atom.xml" rel="self"/>
  
  <link href="https://scottzhang.pro/"/>
  <updated>2022-06-27T13:19:14.024Z</updated>
  <id>https://scottzhang.pro/</id>
  
  <author>
    <name>Scott</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•é¢˜:Nå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <link href="https://scottzhang.pro/article/b217f3dd.html"/>
    <id>https://scottzhang.pro/article/b217f3dd.html</id>
    <published>2022-06-27T13:07:42.000Z</published>
    <updated>2022-06-27T13:19:14.024Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç»™å®šä¸€ä¸ªæ ‘ï¼ˆéäºŒå‰æ ‘ï¼‰, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ï¼ˆæ ‘ä½¿ç”¨keyä¸ºå­çº§ï¼Œvalueä¸ºçˆ¶çº§çš„å­—å…¸ç»“æ„å­˜å‚¨ã€‚</p></blockquote><span id="more"></span><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p><p><img src="https://s2.loli.net/2022/06/27/wsz6JFT2ondHSNy.png" /></p><p>tree å®šä¹‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tree = &#123;<span class="number">1</span>:<span class="literal">None</span>, <span class="number">2</span>:<span class="number">1</span>, <span class="number">3</span>:<span class="number">1</span>,<span class="number">4</span>:<span class="number">2</span>,<span class="number">5</span>:<span class="number">2</span>,<span class="number">6</span>:<span class="number">2</span>,<span class="number">7</span>:<span class="number">3</span>,<span class="number">8</span>:<span class="number">3</span>,<span class="number">9</span>:<span class="number">4</span>,<span class="number">10</span>:<span class="number">4</span>,<span class="number">11</span>:<span class="number">7</span>&#125;</span><br><span class="line"><span class="comment"># è¾“å…¥</span></span><br><span class="line">p = <span class="number">5</span></span><br><span class="line">q = <span class="number">1</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š1</span></span><br><span class="line"><span class="comment"># è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å…¥ï¼š</span></span><br><span class="line">p = <span class="number">9</span></span><br><span class="line">q = <span class="number">6</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š2</span></span><br><span class="line"><span class="comment"># è§£é‡Šï¼š9 çš„ç¥–å…ˆæ˜¯4ï¼Œä¸æ˜¯6çš„ç¥–å…ˆï¼Œå¾€ä¸Šèµ°ï¼Œ2åˆ™æ˜¯</span></span><br></pre></td></tr></table></figure><p>é€’å½’è§£æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_common_ancestor</span>(<span class="params">tree, p, q</span>):</span></span><br><span class="line">    <span class="comment"># if it&#x27;s a empty tree, or givin nodes not in dict</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> tree <span class="keyword">or</span> p <span class="keyword">not</span> <span class="keyword">in</span> tree <span class="keyword">or</span> q <span class="keyword">not</span> <span class="keyword">in</span> tree: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># root node</span></span><br><span class="line">    root = [k <span class="keyword">for</span> k,v <span class="keyword">in</span> tree.items() <span class="keyword">if</span> v <span class="keyword">is</span> <span class="literal">None</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if any givin nodes is root node</span></span><br><span class="line">    <span class="keyword">if</span> tree.get(p) <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> tree.get(q) <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">    <span class="comment"># recursive helper function</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recursive</span>(<span class="params">tree, rp, rq</span>):</span></span><br><span class="line">        <span class="keyword">if</span> rp == tree.get(rq): <span class="keyword">return</span> rp  <span class="comment"># p is children of q</span></span><br><span class="line">        <span class="keyword">if</span> rq == tree.get(rp): <span class="keyword">return</span> rq  <span class="comment"># q is children of p</span></span><br><span class="line">        <span class="keyword">if</span> rq == p: <span class="keyword">return</span> p              <span class="comment"># q move up, equal p then p</span></span><br><span class="line">        <span class="keyword">if</span> rp == q: <span class="keyword">return</span> q              <span class="comment"># p move up, equal q then q</span></span><br><span class="line">        <span class="keyword">if</span> tree.get(rp) == tree.get(rq):  <span class="comment"># p,q moved to root</span></span><br><span class="line">            <span class="keyword">return</span> tree.get(rp)</span><br><span class="line">        <span class="keyword">return</span> recursive(tree, tree.get(rp), tree.get(rq))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> recursive(tree, p, q)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ç»™å®šä¸€ä¸ªæ ‘ï¼ˆéäºŒå‰æ ‘ï¼‰, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ï¼ˆæ ‘ä½¿ç”¨keyä¸ºå­çº§ï¼Œvalueä¸ºçˆ¶çº§çš„å­—å…¸ç»“æ„å­˜å‚¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="Nå‰æ•°" scheme="https://scottzhang.pro/tags/N%E5%8F%89%E6%95%B0/"/>
    
    <category term="é€’å½’" scheme="https://scottzhang.pro/tags/%E9%80%92%E5%BD%92/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜:äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <link href="https://scottzhang.pro/article/5914e90d.html"/>
    <id>https://scottzhang.pro/article/5914e90d.html</id>
    <published>2022-06-18T07:35:47.000Z</published>
    <updated>2022-06-27T13:17:29.774Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-search-tree/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p></blockquote><span id="more"></span><p>äºŒå‰æœç´¢æ ‘çš„å®šä¹‰ï¼š</p><ul><li>è‹¥å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›</li><li>è‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›</li><li>å®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ã€‚</li></ul><p>åœ¨æ­¤é¢˜ç›®ä¸­ï¼Œä¼šæä¾› p, q 2ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å…¬å…±ç¥–å…ˆã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œæ ¹èŠ‚ç‚¹è‚¯å®šæ˜¯æ‰€æœ‰èŠ‚ç‚¹çš„ç¥–å…ˆï¼Œå…¶æ¬¡æ ¹æ®äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§ï¼Œå½“æˆ‘ä»¬å°† p å’Œ q åˆ†åˆ«ä¸æ ¹èŠ‚ç‚¹åšå¯¹æ¯”çš„æ—¶å€™ï¼Œå¯ä»¥æ’é™¤æ‰ä¸€åŠçš„å€¼ï¼Œå› ä¸ºå·¦è¾¹çš„èŠ‚ç‚¹è‚¯å®šå°äºå³è¾¹çš„èŠ‚ç‚¹ï¼Œå½“ p å¤§äºæ ¹èŠ‚ç‚¹ï¼Œé‚£æˆ‘ä»¬éœ€è¦æ‰¾çš„é‚£ä¸ªå…¬å…±ç¥–å…ˆè‚¯å®šåœ¨å³åŠéƒ¨åˆ†å­æ ‘ã€‚</p><p>è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µéœ€è¦è€ƒè™‘ï¼Œé‚£å°±æ˜¯ p æˆ–è€… q äºæ ¹èŠ‚ç‚¹æ˜¯ç›¸ç­‰çš„ï¼Œè¿™æ—¶å€™å…¬å…±ç¥–å…ˆå…¶å®å°±æ˜¯æ ¹èŠ‚ç‚¹äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span>(<span class="params">self, root: <span class="string">&#x27;TreeNode&#x27;</span>, p: <span class="string">&#x27;TreeNode&#x27;</span>, q: <span class="string">&#x27;TreeNode&#x27;</span></span>) -&gt; &#x27;TreeNode&#x27;:</span></span><br><span class="line">        cur = root</span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            <span class="comment"># å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½åœ¨å·¦è¾¹ï¼Œå°†å½“å‰æŒ‡é’ˆå¾€å·¦è¾¹ç§»åŠ¨</span></span><br><span class="line">            <span class="keyword">if</span> p.val &lt; root.val <span class="keyword">and</span> q.val &lt; root.val:</span><br><span class="line">                cur = cur.left</span><br><span class="line">            <span class="comment"># å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½åœ¨å³è¾¹ï¼Œå°†å½“å‰æŒ‡é’ˆå¾€å³è¾¹ç§»åŠ¨</span></span><br><span class="line">            <span class="keyword">elif</span> p.val &gt; root.val <span class="keyword">and</span> q.val &gt; root.val:</span><br><span class="line">                cur = cur.right</span><br><span class="line">            <span class="comment"># ä¸¤ç§æƒ…å†µéƒ½ä¸æ˜¯ï¼Œåˆ™è¯´æ˜ä¸¤ä¸ªèŠ‚ç‚¹åˆ†å‰ï¼Œå½“å‰èŠ‚ç‚¹å³ä¸ºç»“æœ</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> cur</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-search-tree/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="äºŒå‰æ ‘" scheme="https://scottzhang.pro/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
    <category term="äºŒå‰æœç´¢æ ‘" scheme="https://scottzhang.pro/tags/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜:äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <link href="https://scottzhang.pro/article/465ce338.html"/>
    <id>https://scottzhang.pro/article/465ce338.html</id>
    <published>2022-06-18T07:19:52.000Z</published>
    <updated>2022-06-27T13:18:40.559Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p></blockquote><span id="more"></span><p>å¯¹äºæ ‘çš„éå†ï¼š</p><ul><li>ä½¿ç”¨é€’å½’æ˜¯ä¸€ç§é«˜æ•ˆã€ç®€ä¾¿çš„æ–¹å¼ï¼Œä¸è¦æ€•ä½¿ç”¨é€’å½’ã€‚</li><li>å¯¹äºäºŒå‰æ ‘çš„é€’å½’åˆåˆ†ä¸ºä¸‰ç§ä¸åŒçš„å½¢å¼ï¼Œåˆ†åˆ«æ˜¯å‰åºã€ä¸­åºã€ååºã€‚</li><li>å¦‚æœé¢è¯•è¦æ±‚ä¸ä½¿ç”¨é€’å½’ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¾ªç¯è§£æ³•ã€‚</li></ul><p>å„ç§é¡ºåºçš„èŠ‚ç‚¹éå†é¡ºåºï¼š</p><ul><li>å‰åºï¼šæ ¹å·¦å³</li><li>ä¸­åºï¼šå·¦æ ¹å³</li><li>ååºï¼šå·¦å³æ ¹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span>(<span class="params">self, root: TreeNode, p: TreeNode, q: TreeNode</span>) -&gt; TreeNode:</span></span><br><span class="line">        <span class="comment"># å¦‚æœ root ä¸ºç©ºæˆ–è€…</span></span><br><span class="line">        <span class="comment"># å¦‚æœ p å’Œ q ä¸­æŸä¸€ä¸ªç­‰äº rootï¼ˆå…¶æœ¬èº«ä¸ºæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰</span></span><br><span class="line">        <span class="comment"># ç›´æ¥è¿”å› root ä¸ºç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root <span class="keyword">or</span> root == p <span class="keyword">or</span> root == q:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿›è¡Œå…ˆåºéå†ï¼Œæ ¹å·¦å³</span></span><br><span class="line">        left = self.lowestCommonAncestor(root.left, p, q)</span><br><span class="line">        right = self.lowestCommonAncestor(root.right, p, q)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> left:</span><br><span class="line">            <span class="keyword">return</span> right</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> right:</span><br><span class="line">            <span class="keyword">return</span> left</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="äºŒå‰æ ‘" scheme="https://scottzhang.pro/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>Python Asyncio å¹¶å‘ç¼–ç¨‹</title>
    <link href="https://scottzhang.pro/article/8fe84c4f.html"/>
    <id>https://scottzhang.pro/article/8fe84c4f.html</id>
    <published>2022-05-17T05:19:57.000Z</published>
    <updated>2022-05-19T14:24:06.619Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€ä¸ª Python å†…ç½®çš„å¼‚æ­¥IOå¹¶å‘ç¼–ç¨‹æ¨¡å—ã€‚</p></blockquote><span id="more"></span><p>asyncio åŒ…å«ä¸åŒç³»ç»Ÿä¸‹å®ç°çš„äº‹ä»¶å¾ªç¯ï¼Œå¦‚ Windows ä¸‹çš„ Selectï¼ŒLinux ä¸‹çš„ epoll.</p><p>å®ƒè¿˜å¯¹ TCP UDP ç­‰ä¼ è¾“åè®®åšäº†æŠ½è±¡ï¼Œæ”¯æŒSSLã€å­è¿›ç¨‹ã€å»¶æ—¶è°ƒç”¨ã€‚</p><p>æ¨¡ä»¿ futures æ¨¡å—ä½†é€‚ç”¨äºäº‹ä»¶å¾ªç¯ä½¿ç”¨çš„ future ç±»ã€‚ æ¨¡ä»¿ threading æ¨¡å—ä¸­çš„åŒæ­¥åŸè¯­ï¼Œå¯ä»¥åœ¨å•çº¿ç¨‹å†…çš„åç¨‹ä¹‹é—´ã€‚</p><p>åŸºäº yield from çš„åè®®å’Œä»»åŠ¡ï¼Œè®©ä½ å¯ä»¥ç”¨é¡ºåºçš„æ–¹å¼ç¼–å†™å¹¶å‘ä»£ç ã€‚</p><p>å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå°†äº§ç”Ÿé˜»å¡IOçš„è°ƒç”¨æ—¶ï¼Œæœ‰æ¥å£å¯ä»¥æŠŠè¿™ä¸ªäº‹ä»¶è½¬ç§»åˆ°çº¿ç¨‹æ± ã€‚</p><p>å®ƒä¸»è¦çš„åŠŸèƒ½æ˜¯ä¸ºäº†åšåç¨‹è°ƒåº¦ï¼Œä½†ä¹Ÿå¯ä»¥è®©æˆ‘ä»¬æŠŠå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹èåˆè¿›æ¥ã€‚</p><h1 id="asyncio-ä»‹ç»">Asyncio ä»‹ç»</h1><p>Python ç”¨äºè§£å†³å¼‚æ­¥ I/O ç¼–ç¨‹çš„ä¸€æ•´å¥—è§£å†³æ–¹æ¡ˆï¼Œå…¶åº”ç”¨æœ‰:</p><ul><li>Tornado</li><li>Gevent</li><li>Twisted (scrapy, Django channels)</li></ul><p>Tornado åº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨åç¨‹å’Œäº‹ä»¶å¾ªç¯çš„æ–¹å¼å®Œæˆé«˜å¹¶å‘ï¼Œå¦å¤–å®ƒè¿˜å®ç°äº† Web æœåŠ¡å™¨ã€‚</p><p>å¯¹äº django æˆ–è€… flask æ˜¯ä¸æä¾› web æœåŠ¡å™¨çš„ï¼Œä¸ä¼šå»åšå¾ˆå¤š socket ç¼–ç çš„äº‹æƒ…ï¼Œåªæ˜¯å®Œæˆäº†åŸºæœ¬çš„åŠŸèƒ½è®©ä½ å¯ä»¥è°ƒè¯•åº”ç”¨ã€‚</p><p>æ‰€ä»¥ django å’Œ flaskï¼Œä»–ä»¬è¿˜éœ€è¦ä¸€ä¸ªå®ç°é«˜å¹¶å‘ socket æ¥å£çš„æ¡†æ¶ï¼Œå¦‚ uwsgi, gunicornï¼Œå¯èƒ½å†åŠ ä¸€ä¸ª nginxã€‚</p><p>å‚è€ƒ: <a href="https://www.v2ex.com/t/766445">ç†è§£ asyncio æ¥æ„å»ºé«˜æ€§èƒ½ Python ç½‘ç»œç¨‹åº</a></p><blockquote><p>Tornado ä¸èƒ½ç®€å•çš„ä½¿ç”¨å¹³æ—¶ä½¿ç”¨çš„é˜»å¡æ•°æ®åº“é©±åŠ¨ã€‚</p></blockquote><h1 id="åŸºæœ¬ä½¿ç”¨ä¸äº‹ä»¶å¾ªç¯">åŸºæœ¬ä½¿ç”¨ä¸äº‹ä»¶å¾ªç¯</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">table</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep started&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep finished&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(get_data(<span class="string">&quot;test_db&quot;</span>))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â¯ python async_play.py</span><br><span class="line">sleep started</span><br><span class="line">sleep finished</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ªå‡½æ•°çš„å†™æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">table</span>):</span></span><br><span class="line">    <span class="comment"># æ­£ç¡®å†™æ³•</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># å¦‚æœæˆ‘ä»¬ä¸å°å¿ƒå°† sleep æ¢æˆäº† time, åˆ™ä¼šæŠ¥é”™ TypeError</span></span><br><span class="line">    <span class="comment"># å› ä¸º awaitåé¢å¿…é¡»è·Ÿä¸€ä¸ª awaitable çš„å¯¹è±¡ï¼Œè¿™é‡Œè¿”å› None æ˜¾ç„¶ä¸æ˜¯</span></span><br><span class="line">    <span class="keyword">await</span> time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># å¦‚æœä¸åŠ  await, å°±ä¼šå˜æˆé¡ºåºçš„æ‰§è¡Œè¿‡ç¨‹äº†</span></span><br><span class="line">    <span class="comment"># å›  time.sleep() æ˜¯åŒæ­¥çš„æ“ä½œï¼Œè€Œ asyncio.sleep() åˆ™ä¼š</span></span><br><span class="line">    <span class="comment"># ç«‹å³è¿”å›ä¸€ä¸ª future å¯¹è±¡</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œ time.sleep æ˜¯ä¸æ”¯æŒ asyncio çš„ï¼Œéœ€è¦å°†å…¶æ¢æˆ asyncio.sleepã€‚åŒç†ï¼Œå¯¹äºæˆ‘ä»¬å…¶ä»–çš„ I/O æ“ä½œï¼Œæ¯”å¦‚å’Œæ•°æ®åº“äº¤äº’ï¼Œè¯·æ±‚ç½‘é¡µï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªæ”¯æŒ asyncio çš„æ¡†æ¶ï¼Œæ‰å¯ä»¥é…åˆä¸€èµ·å·¥ä½œã€‚</p><p>ä¸‹é¢æ¥çœ‹ä¸€æ®µå®Œæ•´çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">table</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep started&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep finished&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    tasks = [get_data(<span class="string">&quot;test_db&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.time()-start_time)</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®©æˆ‘ä»¬ç»™è¿™æ®µä»£ç åŠ ä¸Šå›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚åœ¨æ•°æ®åº“æ•°æ®æ‹¿åˆ°ä¹‹åï¼Œå°±å»è°ƒç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">table</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep started&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep finished&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback_send_email</span>(<span class="params">url, future</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;send email to bobby&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŸºæœ¬ä¸Šç­‰ä»·äºä¸‹é¢çš„ create_task</span></span><br><span class="line">    <span class="comment"># get_future = asyncio.ensure_future(get_data(&quot;test_db&quot;))</span></span><br><span class="line">    task = loop.create_task(get_data(<span class="string">&quot;test_db&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># partial å°†ä½ çš„å‡½æ•°åŒ…è£…æˆä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¯ä»¥å°†å‚æ•°æ”¾è¿›å»</span></span><br><span class="line">    <span class="comment"># è¦ä½¿ç”¨å®ƒï¼Œéœ€è¦ç¡®ä¿å°†ä½ çš„å‡½æ•°è¦ä¼ å…¥çš„å‚æ•°æ”¾åœ¨å‰é¢</span></span><br><span class="line">    task.add_done_callback(</span><br><span class="line">        partial(callback_send_email, <span class="string">&quot;test_db&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">    loop.run_until_complete(task)</span><br><span class="line">    <span class="built_in">print</span>(task.result())</span><br></pre></td></tr></table></figure><p>å¦å¤– asyncio è¿˜æ”¯æŒ wait å’Œ gather å‡½æ•°ï¼Œå¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">table</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep started&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sleep finished&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    tasks = [get_data(<span class="string">&quot;test_db1&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    <span class="comment"># loop.run_until_complete(asyncio.gather(*tasks))</span></span><br><span class="line">    <span class="comment"># print(time.time()-start_time)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># gatherå’Œwaitçš„åŒºåˆ«</span></span><br><span class="line">    <span class="comment"># gatheræ›´åŠ high-level</span></span><br><span class="line">    group1 = [get_data(<span class="string">&quot;test_db2&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">    group2 = [get_data(<span class="string">&quot;test_db1&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">    group1 = asyncio.gather(*group1)</span><br><span class="line">    group2 = asyncio.gather(*group2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># gather æ”¯æŒæ‰¹é‡å–æ¶ˆ</span></span><br><span class="line">    group2.cancel()</span><br><span class="line">    loop.run_until_complete(asyncio.gather(group1, group2))</span><br><span class="line">    <span class="built_in">print</span>(time.time() - start_time)</span><br></pre></td></tr></table></figure><h1 id="task-å–æ¶ˆå’Œå­åç¨‹è°ƒç”¨åŸç†">Task å–æ¶ˆå’Œå­åç¨‹è°ƒç”¨åŸç†</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># run_forever å›ä¸€ç›´è¿è¡Œ</span></span><br><span class="line">loop.run_forever()</span><br><span class="line"><span class="comment"># ä¼šåœ¨è¿è¡Œåˆ°æŒ‡å®šçš„åç¨‹ååœæ­¢ï¼Œè¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</span></span><br><span class="line">loop.run_until_complete()</span><br></pre></td></tr></table></figure><p>åœ¨ <code>run_until_complete</code> å†…éƒ¨ï¼Œä¼šå°†ä¼ é€’è¿›æ¥æŒ‡å®šçš„ future å¯¹è±¡å¢åŠ ä¸€ä¸ª <code>add_done_callback</code> æ–¹æ³•ã€‚</p><p>åœ¨æŒ‡å®šçš„ future æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°±ä¼šè°ƒç”¨ <code>_run_until_complete_cb</code> æ–¹æ³•ï¼Œè€Œ <code>_run_until_complete_cb</code> å†…éƒ¨å°±ä¼šè°ƒç”¨ loop å³äº‹ä»¶å¾ªç¯ çš„ stopã€‚</p><p>åœ¨ç†è§£äº†ä¸Šé¢è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å°±çŸ¥é“å¦‚ä½•å»å¯åŠ¨ä¸€ä¸ªæ°¸ä¸åœæ­¢çš„å‡½æ•°ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å»åœæ­¢å®ƒå‘¢ï¼Ÿ</p><p>loop å®é™…ä¸Šï¼Œä¼šè¢«æ”¾åˆ° futureä¸­ï¼Œ(future ä¸­ä¹Ÿæœ‰ loop ğŸ˜…)ï¼Œå®ƒå†…éƒ¨çš„å®ç°æ¯”è¾ƒç»•ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­æ¥çœ‹å¦‚ä½•å–æ¶ˆ loop çš„è¿è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">sleep_times</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;waiting&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(sleep_times)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;done after &#123;&#125;s&quot;</span>.<span class="built_in">format</span>(sleep_times))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    task1 = get_html(<span class="number">2</span>)</span><br><span class="line">    task2 = get_html(<span class="number">3</span>)</span><br><span class="line">    task3 = get_html(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    tasks = [task1, task2, task3]</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># è¿™é‡Œæ˜¯å¦‚ä½•åç»­åˆ°ä¸Šé¢ loop ä¸­çš„æ‰€æœ‰ task çš„ï¼Ÿå®ƒå®Œå…¨éƒ½æ²¡æœ‰è®¿é—® loop</span></span><br><span class="line">        <span class="comment"># å› ä¸ºåœ¨å•çº¿ç¨‹ä¸­ï¼Œå¾ˆå¤šå˜é‡éƒ½æ˜¯å…±äº«çš„ï¼Œå½“ç›´æ¥è°ƒç”¨ asyncio.Task.all_tasks()</span></span><br><span class="line">        <span class="comment"># çš„æ—¶å€™ï¼Œå®ƒå†…éƒ¨ä¼šå»ç›´æ¥æ‹¿ loopï¼Œè‹¥æ²¡æœ‰åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„</span></span><br><span class="line">        all_tasks = asyncio.Task.all_tasks()</span><br><span class="line">        <span class="keyword">for</span> task <span class="keyword">in</span> all_tasks:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;cancel task&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(task.cancel())</span><br><span class="line">        <span class="comment"># stop åªæ˜¯æ ‡è®° stoping ä¸º True</span></span><br><span class="line">        <span class="comment"># close åˆ™ä¼šæ¸…ç©º readyï¼Œschedule é˜Ÿåˆ—æ¸…ç©ºï¼Œå…³é—­è¿›ç¨‹å’Œçº¿ç¨‹æ± </span></span><br><span class="line">        <span class="comment"># stop åä¸€å®šè¦è°ƒç”¨ run_forever æ–¹æ³•æ‰ä¸ä¼šæŠ¥é”™</span></span><br><span class="line">        loop.stop()</span><br><span class="line">        loop.run_forever()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        loop.close()</span><br></pre></td></tr></table></figure><h1 id="åç¨‹åµŒå¥—åç¨‹">åç¨‹åµŒå¥—åç¨‹</h1><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªä¾‹å­ï¼ˆæœ€æ–°æ–‡æ¡£å·²è¢«ç§»é™¤ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">compute</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Compute %s + %s ...&quot;</span> % (x, y))</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1.0</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">print_sum</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    result = <span class="keyword">await</span> compute(x, y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%s + %s = %s&quot;</span> % (x, y, result))</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(print_sum(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure><p>ä»¥åŠå®ƒçš„ä¸€ä¸ªæ—¶é—´é¡ºåºå›¾ï¼š</p><p><img src="https://s2.loli.net/2022/05/18/9motcaCPZ58rFGi.png" /></p><h1 id="asyncio-å…¶ä»–å‡½æ•°">asyncio å…¶ä»–å‡½æ•°</h1><p>è¿™é‡Œçš„å…¶ä»–å‡½æ•°æŒ‡çš„æ˜¯ï¼Œåœ¨è¿›è¡Œ task ç®¡ç†çš„æ—¶å€™ï¼Œä½ å¸Œæœ›ä¸€äº› task å¯ä»¥å°½å¿«æˆ–è€…é©¬ä¸Šè¿è¡Œã€‚</p><p>å…ˆå®šä¹‰ call back å’Œ stop å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">sleep_times, loop</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å›è°ƒå‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success time &#123;&#125;&quot;</span>.<span class="built_in">format</span>(loop.time()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stoploop</span>(<span class="params">loop</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœæ­¢loop&quot;&quot;&quot;</span></span><br><span class="line">    loop.stop()</span><br></pre></td></tr></table></figure><h2 id="call_soon">call_soon</h2><p>æŒ‡å®šé©¬ä¸Šï¼ˆåœ¨é˜Ÿåˆ—ä¸­ï¼‰è¿è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.call_soon(callback, <span class="number">4</span>, loop)</span><br><span class="line">    loop.call_soon(stoploop, loop)</span><br><span class="line">    loop.run_forever()</span><br></pre></td></tr></table></figure><h2 id="call_later">call_later</h2><p>æŒ‡å®šä¸€ä¸ªæ—¶é—´åè¿è¡Œ, å¤šä¸ªæ—¶é—´ä¼šæ’åºï¼Œæ¯” call_soon æ…¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    now = loop.time()</span><br><span class="line">    loop.call_later(<span class="number">2</span>, callback, <span class="number">2</span> )</span><br><span class="line">    loop.call_later(<span class="number">1</span>, callback, <span class="number">1</span>)</span><br><span class="line">    loop.call_later(<span class="number">3</span>, callback, <span class="number">3</span>)</span><br><span class="line">    <span class="comment"># è¿™ä¸ª call_soon ä¼šå…ˆè¿è¡Œ</span></span><br><span class="line">    loop.call_soon(callback, <span class="number">4</span>)</span><br><span class="line">    loop.run_forever()</span><br></pre></td></tr></table></figure><h2 id="call_at">call_at</h2><p>æŒ‡å®šä¸€ä¸ªç¡®åˆ‡çš„æ—¶é—´ï¼ˆå¦‚å½“å‰æ—¶é—´åŠ å¤šå°‘ç§’ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    now = loop.time()</span><br><span class="line">    loop.call_at(now+<span class="number">2</span>, callback, <span class="number">2</span>, loop)</span><br><span class="line">    loop.call_at(now+<span class="number">1</span>, callback, <span class="number">1</span>, loop)</span><br><span class="line">    loop.call_at(now+<span class="number">3</span>, callback, <span class="number">3</span>, loop)</span><br><span class="line">    loop.run_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="call_soon_threadsafe">call_soon_threadsafe</h2><p>çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ callabck ä¸­çš„å˜é‡ï¼Œå¯èƒ½åœ¨å…¶ä»–çš„æ–¹æ³•ä¸­ä¼šæ”¹åŠ¨ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä½¿ç”¨ call_soon_threadsafe æ‰æ¯”è¾ƒå®‰å…¨ã€‚</p><h1 id="çº¿ç¨‹æ± ä¸-asyncio">çº¿ç¨‹æ± ä¸ asyncio</h1><p>asyncio ä¸ºä»€ä¹ˆè¦å’Œçº¿ç¨‹æ± ç»“åˆå‘¢ï¼Ÿasyncio æˆ‘ä»¬è¯´è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ IO æ¡†æ¶ï¼Œå®ƒå…¶å®æ”¯æŒå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„ï¼Œä¹ŸåŒ…æ‹¬åç¨‹ã€‚</p><p>æˆ‘ä»¬è¦å°†ä¸€ä¸ªé˜»å¡çš„æ¥å£ï¼ˆæ¯”å¦‚è®¿é—®DBï¼‰å’Œ asyncio ç»“åˆèµ·æ¥çš„è¯ï¼Œè¦æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>åƒä¸Šé¢çš„æƒ…å†µï¼Œéƒ½æ˜¯éœ€è¦ç‰¹å®šçš„å‡½æ•°çš„ï¼ˆå¦‚ asyncio.sleepï¼‰ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨å¤šçº¿ç¨‹ï¼šåœ¨åç¨‹ä¸­é›†æˆé˜»å¡io</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># é€šè¿‡socketè¯·æ±‚html</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    executor = ThreadPoolExecutor(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        url = <span class="string">&quot;http://shop.projectsedu.com/goods/&#123;&#125;/&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">        task = loop.run_in_executor(executor, get_url, url)</span><br><span class="line">        tasks.append(task)</span><br><span class="line"></span><br><span class="line">    loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;last time:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(time.time()-start_time))</span><br></pre></td></tr></table></figure><h1 id="asyncio-æ¨¡æ‹Ÿ-http-è¯·æ±‚">asyncio æ¨¡æ‹Ÿ http è¯·æ±‚</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># asyncio æ²¡æœ‰æä¾›httpåè®®çš„æ¥å£ aiohttp</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># é€šè¿‡socketè¯·æ±‚html</span></span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    host = url.netloc</span><br><span class="line">    path = url.path</span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        path = <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å»ºç«‹socketè¿æ¥ï¼Œæ¯”è¾ƒè´¹äº‹ï¼Œä½¿ç”¨ await</span></span><br><span class="line">    <span class="comment"># asyncio.open_connection ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ³¨å†Œ</span></span><br><span class="line">    reader, writer = <span class="keyword">await</span> asyncio.open_connection(host,<span class="number">80</span>)</span><br><span class="line">    writer.write(<span class="string">&quot;GET &#123;&#125; HTTP/1.1\r\nHost:&#123;&#125;\r\nConnection:close\r\n\r\n&quot;</span>.<span class="built_in">format</span>(path, host).encode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šè¿‡ async for è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="comment"># reader å†…éƒ¨å®ç°äº† anext é­”æ³•æ–¹æ³•</span></span><br><span class="line">    all_lines = []</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> raw_line <span class="keyword">in</span> reader:</span><br><span class="line">        data = raw_line.decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">        all_lines.append(data)</span><br><span class="line">    html = <span class="string">&quot;\n&quot;</span>.join(all_lines)</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        url = <span class="string">&quot;http://shop.projectsedu.com/goods/&#123;&#125;/&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">        tasks.append(</span><br><span class="line">            <span class="comment"># append æ˜¯ futrue</span></span><br><span class="line">             asyncio.ensure_future(get_url(url))</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> asyncio.as_completed(tasks):</span><br><span class="line">        result = <span class="keyword">await</span> task</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(main())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;last time:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(time.time()-start_time))</span><br></pre></td></tr></table></figure><h1 id="future-å’Œ-task">Future å’Œ Task</h1><p>æˆ‘ä»¬çŸ¥é“ Future æ˜¯ä¸€ä¸ªä»»åŠ¡ç»“æœå®¹å™¨ï¼ŒAsyncio ä¹Ÿæœ‰è‡ªå·±çš„ Futureï¼Œå®ƒå’Œçº¿ç¨‹æ± ä¸­çš„ Future å‡ ä¹æ˜¯ä¸€è‡´çš„ã€‚</p><p>å½“ç»“æœå®¹å™¨å®Œæˆåï¼Œå°±ä¼šå»è¿è¡Œ callbackã€‚</p><p>Task æ˜¯ Future çš„å­ç±»ã€‚æ˜¯åç¨‹å’Œ Future ä¹‹é—´çš„æ¡¥æ¢ã€‚</p><h1 id="asyncio-åŒæ­¥å’Œé€šä¿¡">asyncio åŒæ­¥å’Œé€šä¿¡</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å•çº¿ç¨‹æ¨¡å¼ä¸‹æ˜¯ä¸éœ€è¦é”çš„ï¼Œä¸‹é¢çš„ä»£ç æ‰“å° total æœ€ç»ˆä¸º0.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        total += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">desc</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        total -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> asyncio</span><br><span class="line">    tasks = [add(), desc()]</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">    <span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ª Python å†…ç½®çš„å¼‚æ­¥IOå¹¶å‘ç¼–ç¨‹æ¨¡å—ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="asyncio" scheme="https://scottzhang.pro/tags/asyncio/"/>
    
  </entry>
  
  <entry>
    <title>Docker éƒ¨ç½² Dash åº”ç”¨</title>
    <link href="https://scottzhang.pro/article/49672c93.html"/>
    <id>https://scottzhang.pro/article/49672c93.html</id>
    <published>2022-05-17T04:54:26.000Z</published>
    <updated>2022-05-17T05:04:10.156Z</updated>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>.<span class="number">3</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app/dash_app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up Oracle</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash">    /opt/oracle</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y libaio1 wget unzip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/dash_app/oracle_configs/instantclient-basic-linux.x64-12.2.0.1.0.zip . \</span></span><br><span class="line"><span class="bash">    &amp;&amp; unzip instantclient-basic-linux.x64-12.2.0.1.0.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -f instantclient-basic-linux.x64-12.2.0.1.0.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">cd</span> /opt/oracle/instantclient* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -f *jdbc* *occi* *mysql* *README *jar uidrvci genezi adrci \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> /opt/oracle/instantclient* &gt; /etc/ld.so.conf.d/oracle-instantclient.conf \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ldconfig \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p /opt/oracle/instantclient_12_2/network/admin \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/dash_app/oracle_configs/tnsnames.ora /opt/oracle/instantclient_12_2/network/admin/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/dash_app/oracle_configs/sqlnet.ora /opt/oracle/instantclient_12_2/network/admin/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set work dir</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="string">&quot;/app/dash_app&quot;</span></span></span><br><span class="line"><span class="comment"># Install python packages</span></span><br><span class="line"><span class="comment"># RUN pip install -r /app/dash_app/requirements.txt -i https://mirrors.aliyun.com/pypi/simple/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r /app/dash_app/requirements.txt</span></span><br><span class="line"><span class="comment"># Expose port</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8050</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;gunicorn&quot;</span>,<span class="string">&quot;run:server&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;./gunicorn.conf.py&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>Dash åº”ç”¨è¿˜éœ€è¦ä¸€ä¸ª WSGI æœåŠ¡ï¼Œè¿™é‡Œä½¿ç”¨ gunicornï¼Œå®ƒéœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>gunicorn.conf.py</code> ï¼Œå…¶æ–‡ä»¶å†…å®¹å‚è€ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">workers = <span class="number">5</span></span><br><span class="line">workers_class = <span class="string">&quot;gevent&quot;</span></span><br><span class="line">bind = <span class="string">&quot;0.0.0.0:8050&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;

&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://scottzhang.pro/categories/Docker/"/>
    
    
    <category term="Dash" scheme="https://scottzhang.pro/tags/Dash/"/>
    
  </entry>
  
  <entry>
    <title>Docker éƒ¨ç½² Streamlit åº”ç”¨</title>
    <link href="https://scottzhang.pro/article/fc2204a7.html"/>
    <id>https://scottzhang.pro/article/fc2204a7.html</id>
    <published>2022-05-17T04:46:17.000Z</published>
    <updated>2022-05-17T05:04:10.156Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨ Docker éƒ¨ç½² Streamlit å¹¶è®¾ç½® Oracle æ•°æ®åº“è¿æ¥ã€‚</p></blockquote><span id="more"></span><p>Streamlit çš„éƒ¨ç½²å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦æ‹‰å– Python åŸºç¡€åŒ…ï¼Œè£…å¥½ä½ éœ€è¦çš„åŒ…å³å¯ã€‚</p><p>æˆ‘çš„ dockerfile ä¸­ï¼Œå› ä¸ºè¿˜éœ€è¦è®© strealit è¿æ¥ oracle, æ‰€ä»¥æœ‰ set up Oracle çš„æ­¥éª¤ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>.<span class="number">13</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> MAINTAINER=<span class="string">&quot;scottzhang.pro&quot;</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app/streamlit_app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up Oracle</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash">    /opt/oracle</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y libaio1 wget unzip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/streamlit_app/instantclient/oracle_configs/instantclient-basic-linux.x64-12.2.0.1.0.zip . \</span></span><br><span class="line"><span class="bash">    &amp;&amp; unzip instantclient-basic-linux.x64-12.2.0.1.0.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -f instantclient-basic-linux.x64-12.2.0.1.0.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">cd</span> /opt/oracle/instantclient* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -f *jdbc* *occi* *mysql* *README *jar uidrvci genezi adrci \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> /opt/oracle/instantclient* &gt; /etc/ld.so.conf.d/oracle-instantclient.conf \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ldconfig \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p /opt/oracle/instantclient_12_2/network/admin \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/streamlit_app/instantclient/oracle_configs/tnsnames.ora /opt/oracle/instantclient_12_2/network/admin/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /app/streamlit_app/instantclient/oracle_configs/sqlnet.ora /opt/oracle/instantclient_12_2/network/admin/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set work dir</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="string">&quot;/app/streamlit_app&quot;</span></span></span><br><span class="line"><span class="comment"># Install python packages</span></span><br><span class="line"><span class="comment"># RUN pip install -r /app/streamlit_app/requirements.txt -i https://mirrors.aliyun.com/pypi/simple/</span></span><br><span class="line"><span class="comment"># query_helper and fc_auto is a package I developed, that is used as a Git submodule</span></span><br><span class="line"><span class="comment"># when i pull all code to local (include this docker file), these submodules also will download to local</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r /app/streamlit_app/requirements.txt \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip install -e query_helper \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip install -e fc_auto</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose port</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;streamlit&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;main.py&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æœ€åå°† streamlit æš´éœ²åœ¨ 80 ç«¯å£ï¼Œå°±å¯ä»¥è®¿é—®äº†ã€‚</p><p>Enjoy!</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨ Docker éƒ¨ç½² Streamlit å¹¶è®¾ç½® Oracle æ•°æ®åº“è¿æ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://scottzhang.pro/categories/Docker/"/>
    
    
    <category term="Streamlit" scheme="https://scottzhang.pro/tags/Streamlit/"/>
    
  </entry>
  
  <entry>
    <title>Python æµ‹è¯•é©±åŠ¨å¼€å‘ä»‹ç»</title>
    <link href="https://scottzhang.pro/article/52faaad0.html"/>
    <id>https://scottzhang.pro/article/52faaad0.html</id>
    <published>2022-05-17T03:59:30.000Z</published>
    <updated>2022-05-17T04:00:54.128Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»‹ç»äº† Python ä¸­å„ç§æµ‹è¯•æ–¹æ³•ä¸åœºæ™¯ã€‚</p></blockquote><span id="more"></span><h1 id="test-runner">Test runner</h1><p>ä¸€ä¸ªç‰¹åˆ«è®¾è®¡çš„åº”ç”¨ï¼Œç”¨æ¥è·‘æµ‹è¯•ï¼Œæ£€æŸ¥è¾“å‡ºï¼Œè°ƒè¯•å’Œè¯Šæ–­ä½ çš„ä»£ç ã€‚</p><p>Python æœ‰å‡ ç§æµ‹è¯•å·¥å…·:</p><ul><li>unittest</li><li>nose or nose2</li><li>pytest</li></ul><h2 id="unittest">unittest</h2><p>unittest è¦æ±‚ï¼š</p><ol type="1"><li>æŠŠä½ çš„æµ‹è¯•ä»£ç å†™è¿› class æˆ–è€…æ–¹æ³•</li><li>åœ¨ unittest.TestClass ç±»ä¸­ä½¿ç”¨ä¸€ç³»åˆ—ç‰¹æ®Šæ–­è¨€</li></ol><p>ä¸€ä¸ªç®€å•çš„æµ‹è¯•ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSum</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sum</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="built_in">sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), <span class="number">6</span>, <span class="string">&quot;Should be 6&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sum_tuple</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="built_in">sum</span>((<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)), <span class="number">6</span>, <span class="string">&quot;Should be 6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><h2 id="nose">nose</h2><p>nose å…¼å®¹å…¶ä»–æµ‹è¯•æ¡†æ¶å†™çš„ä»£ç ï¼Œnose ä¼šåœ¨ä½ çš„ç›®å½•å¯»æ‰¾æ‰€æœ‰ <code>py</code> æ–‡ä»¶å’Œæµ‹è¯•ç”¨ä¾‹è¿›è¡Œæµ‹è¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip install nose2</span><br><span class="line">$ python -m nose2</span><br></pre></td></tr></table></figure><h2 id="pytest">pytest</h2><p>ä¹Ÿæ”¯æŒ unittersï¼Œå®ƒçš„æµ‹è¯•ç”¨ä¾‹æ˜¯ä»¥ <code>test_</code> å¼€å¤´çš„ä¸€äº›å‡½æ•°ã€‚ pytest çš„ä¼˜ç‚¹æ˜¯ï¼š</p><ul><li>æ”¯æŒå†…ç½®çš„ <code>assert</code> å‘½ä»¤</li><li>å¯ä»¥ filter æµ‹è¯•ç”¨ä¾‹</li><li>æ”¯æŒä»ä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•é‡æ–°å¼€å§‹</li><li>ç”Ÿæ€ç³»ç»Ÿä¸°å¯Œï¼Œæ”¯æŒå¾ˆå¤šæ’ä»¶</li></ul><p>ä¸€ä¸ª pytest çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def test_sum():</span><br><span class="line">    assert sum([1, 2, 3]) == 6, &quot;Should be 6&quot;</span><br><span class="line"></span><br><span class="line">def test_sum_tuple():</span><br><span class="line">    assert sum((1, 2, 2)) == 6, &quot;Should be 6&quot; </span><br></pre></td></tr></table></figure><h1 id="ç¼–å†™æµ‹è¯•">ç¼–å†™æµ‹è¯•</h1><p>ä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡¹ç›®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ my_sum/</span><br><span class="line">â”‚   â””â”€â”€ __init__.py</span><br><span class="line">|</span><br><span class="line">â””â”€â”€ test.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __init__.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg</span>):</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> arg:</span><br><span class="line">        total += val</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">    </span><br><span class="line"><span class="comment"># test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> my_sum <span class="keyword">import</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSum</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_list_int</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Test that it can sum a list of integers</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">        result = <span class="built_in">sum</span>(data)</span><br><span class="line">        self.assertEqual(result, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><p>æ–­è¨€æ˜¯ä½ çš„æµ‹è¯•æ¡ä»¶ï¼Œæ¯”å¦‚ä½ é¢„æœŸï¼Œå¯ä»¥é€šè¿‡ <code>.assert*()</code> ç¼–å†™ä½ çš„æ–­è¨€ï¼Œæ¯”å¦‚ <code>.assertEqual(a, b)</code>ï¼Œå®ƒå’Œ <code>a==b</code> å…¶å®æ˜¯ç›¸ç­‰çš„ã€‚</p><p>ç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰ï¼š</p><ul><li>assertTrue(x)</li><li>assertFalse(x)</li><li>assertIs(a, b)</li></ul><h1 id="æ‰§è¡Œæµ‹è¯•">æ‰§è¡Œæµ‹è¯•</h1><p>ä¸€èˆ¬é€šè¿‡æ‰§è¡Œ <code>test.py</code> æ–‡ä»¶æ¥æµ‹è¯•ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½ ä¼šè°ƒç”¨ <code>unittest.main()</code> å‡½æ•°ã€‚</p><p>æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„ <code>python -m unittest test</code> æ¥æ‰§è¡Œæµ‹è¯•ã€‚</p><p>é€šè¿‡ <code>python -m unittest -v test</code> æ¥æ‰§è¡Œæµ‹è¯•å¹¶è¾“å‡ºæ¯ä¸€ä¸ªæµ‹è¯•çš„å†…å®¹ã€‚</p><p>é€šè¿‡ <code>python -m unittest discover</code> è®©å…¶è‡ªåŠ¨å‘ç°ç›®å‰ç›®å½•æˆçš„ <code>test*.py</code> æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œæ­¤å‘½åè¿˜æ”¯æŒå­åŒ…çš„è·¯å¾„: <code>python -m unittest discover -s tests -t src</code>, å…¶ä¸­ src æ˜¯å­ç›®å½•åã€‚</p><p>åœ¨ PyCharm ä¸­ï¼Œä½ å¯ä»¥æ‰§è¡Œ Run 'Unittests in ..' æ¥æ‰§è¡Œæµ‹è¯•ï¼Œåœ¨ VS Code ä¸­ï¼Œè¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œè¾“å…¥ test å³å¯ä»¥çœ‹åˆ°ç›¸å…³æŒ‡ä»¤ã€‚</p><h1 id="web-æ¡†æ¶æµ‹è¯•">Web æ¡†æ¶æµ‹è¯•</h1><blockquote><p>Django, Flask</p></blockquote><p>è¿™ç±»æµ‹è¯•å¾ˆä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒä»¬å†…ç½®äº†ä¸€äº›è¯¸å¦‚è·¯ç”±ã€è§†å›¾ã€æ¨¡å‹ç­‰å¿…è¦çš„æ¨¡å—ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™éœ€è¦å¯¼å…¥ï¼Œè¿™å°±å¥½åƒä½ è¦æµ‹è¯•ä¸€è¾†è½¦ï¼Œåˆ™éœ€è¦å…ˆå°†ç”µè„‘å‡†å¤‡å¥½ã€‚</p><p>ä½†è¿™ç±»æ¡†æ¶ä¹Ÿæä¾›äº†æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚ Django åœ¨ä½ æ‰§è¡Œ <code>startapp</code> çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»º <code>test.py</code> æ–‡ä»¶ã€‚</p><p>å¦‚æœä½ çš„ Django é¡¹ç›®ä¸­æ²¡æœ‰çš„è¯ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºï¼Œä¸å‰é¢çš„ä¾‹å­ä¸ä¸€æ ·çš„æ˜¯ï¼Œä½ éœ€è¦å°†ä½ çš„æµ‹è¯•ç±»ç»§æ‰¿è‡ª <code>django.test.TestCase</code>,è€Œä¸æ˜¯ <code>unittest.TestCase</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="comment"># Your test methods</span></span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ¢æˆ <code>python manage.py test</code>.</p><p>å¦‚æœä½ æœ‰å¤šä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª test æ–‡ä»¶å¤¹ï¼Œå°†ä½ çš„æµ‹è¯•æ–‡ä»¶åæ›´æ”¹ä¸º test_*.pyï¼Œdjango ä¼šè‡ªåŠ¨å‘ç°å¹¶æ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚</p><blockquote><p>æ›´å¤š Django æµ‹è¯•çš„å†…å®¹å¯ä»¥å‚è€ƒ<a href="https://docs.djangoproject.com/en/2.1/topics/testing/overview/">è¿™é‡Œ</a></p></blockquote><p>å¯¹äº Flask åˆ™åˆæœ‰ä¸€äº›ä¸åŒï¼Œéœ€è¦è®¾ç½®åº”ç”¨çš„æ¨¡å¼ä¸º test, ç„¶åä½ å¯ä»¥æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªæµ‹è¯•å®¢æˆ·ç«¯ï¼Œæ ¹æ®è·¯ç”±å»åšä¸€äº›æµ‹è¯•ã€‚</p><p>å®ä¾‹åŒ–çš„é…ç½®éƒ½åœ¨ setup æ–¹æ³•ä¸­ï¼Œå‚è€ƒä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> my_app</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        my_app.app.testing = <span class="literal">True</span></span><br><span class="line">        self.app = my_app.app.test_client()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_home</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = self.app.get(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        <span class="comment"># Make your assertions</span></span><br></pre></td></tr></table></figure><p>é…ç½®å¥½åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-m unittest discover</code> è¿›è¡Œæµ‹è¯•ã€‚</p><blockquote><p>æ›´å¤š Flask æµ‹è¯•çš„å†…å®¹å¯ä»¥å‚è€ƒ <a href="https://flask.palletsprojects.com/en/0.12.x/testing/">Flask Documentation Website</a></p></blockquote><h1 id="é«˜çº§æµ‹è¯•åœºæ™¯">é«˜çº§æµ‹è¯•åœºæ™¯</h1><p>åŸºæœ¬çš„æµ‹è¯•æ­¥éª¤ï¼š</p><ol type="1"><li>åˆ›å»ºä½ çš„è¾“å…¥</li><li>æ‰§è¡Œä»£ç ï¼Œæ•æ‰è¾“å‡º</li><li>å¯¹æ¯”è¾“å‡ºå’Œé¢„æœŸçš„ç»“æœ</li></ol><p>è¿™é‡Œè¾“å…¥åˆå« fixtureï¼Œ ä¸€èˆ¬åˆ›å»ºåå¯ä»¥é‡å¤ä½¿ç”¨ã€‚</p><p>å¦‚æœä½ è·‘ä¸€ä¸ªæµ‹è¯•å¤šæ¬¡ï¼Œä½†ä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼Œå¹¶é¢„æœŸç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿™å« parameterizationã€‚</p><h1 id="é›†æˆæµ‹è¯•">é›†æˆæµ‹è¯•</h1><p>é›†æˆæµ‹è¯•ï¼Œé¡¾åæ€ä¹‰ï¼Œä¼šé›†æˆå¤šä¸ªæµ‹è¯•ç”¨æ¥æ£€æŸ¥å…¶æ¯ä¸ªæ¨¡å—æ˜¯å¦éƒ½å·¥ä½œï¼Œå®ƒä¼šç«™åœ¨ç”¨æˆ·çš„è§’åº¦å»æµ‹è¯•ä½ çš„è½¯ä»¶ã€‚</p><p>é€šå¸¸é›†æˆæµ‹è¯•çš„ä»£ç ä¼šå’Œå•å…ƒæµ‹è¯•çš„åˆ†å¼€ï¼Œå› ä¸ºé›†æˆæµ‹è¯•éœ€è¦è·‘æ›´å¤šçš„æ¨¡å—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ my_app/</span><br><span class="line">â”‚   â””â”€â”€ __init__.py</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ tests/</span><br><span class="line">    |</span><br><span class="line">    â”œâ”€â”€ unit/</span><br><span class="line">    |   â”œâ”€â”€ __init__.py</span><br><span class="line">    |   â””â”€â”€ test_sum.py</span><br><span class="line">    |</span><br><span class="line">    â””â”€â”€ integration/</span><br><span class="line">        â”œâ”€â”€ __init__.py</span><br><span class="line">        â””â”€â”€ test_integration.py</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ unitters, ä½ å¯ä»¥é€šè¿‡ -s æ¥æŒ‡å®šåªåŒ…å«æŸä¸ªéƒ¨åˆ†çš„ä»£ç æ¥è¿›è¡Œæµ‹è¯•ã€‚</p><p><code>python -m unittest discover -s tests/integration</code></p><p>å¦‚æœä½ çš„æµ‹è¯•ä¾èµ–ä¸€äº›æ–‡ä»¶ï¼Œå¯ä»¥æ–°å»ºfixturesæ–‡ä»¶å¤¹ï¼Œå°†æ•°æ®æ”¾åˆ°é‡Œé¢ã€‚</p><h1 id="ç¯å¢ƒæµ‹è¯•">ç¯å¢ƒæµ‹è¯•</h1><p>ä½ æƒ³çŸ¥é“ä½ çš„ä»£ç æ”¾åœ¨ä¸åŒç‰ˆæœ¬çš„ python ä¸­æ˜¯å¦å·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨ Tox.</p><p>Tox ä½¿ç”¨éœ€è¦é…ç½®ï¼Œå®ƒæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢åŒ…æ‹¬ï¼š</p><ul><li>æµ‹è¯•éœ€è¦æ‰§è¡Œçš„ä»£ç </li><li>æ‰§è¡Œæµ‹è¯•éœ€è¦çš„åŒ…</li><li>ç›®æ ‡ç¯å¢ƒç‰ˆæœ¬</li></ul><p>ä½ å¯ä»¥æ‰§è¡Œ <code>tox-quickstart</code> æ¥å¯åŠ¨å¿«é€Ÿé…ç½®è„šæœ¬ï¼Œå›ç­”é—®é¢˜å³å¯ç”Ÿæˆ <code>tox.ini</code> é…ç½®æ–‡ä»¶ã€‚</p><h1 id="è‡ªåŠ¨æµ‹è¯•">è‡ªåŠ¨æµ‹è¯•</h1><p>è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œåˆè¢«ç§°ä¸º CI/CD å·¥å…·ï¼Œæ„æ€æ˜¯ æŒç»­é›†æˆæŒç»­éƒ¨ç½²(Continuous Integration/Continuous Deployment)ã€‚</p><p>Travis CI æ˜¯åœ¨ Python ä¸‹ä¸é”™çš„ CI å·¥å…·ï¼Œå¹¶ä¸”å¯¹äºæ‰€æœ‰ Githubï¼ŒGitLab ä¸Šå¼€æºçš„é¡¹ç›®éƒ½å…è´¹ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª <code>.travis.yml</code> é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">python</span></span><br><span class="line"><span class="attr">python:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;2.7&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">-r</span> <span class="string">requirements.txt</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">python</span> <span class="string">-m</span> <span class="string">unittest</span> <span class="string">discover</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®ä¼šæµ‹è¯•ä»£ç åœ¨ python 2.7, 3.7 ä¸­æ˜¯å¦å·¥ä½œï¼Œå®‰è£…ä½ é…ç½®æ–‡ä»¶ä¸­çš„åŒ…ï¼Œå¹¶æ‰§è¡Œæ‰€æœ‰è‡ªåŠ¨å‘ç°çš„å•å…ƒæµ‹è¯•ã€‚</p><p>å½“ä½ é…ç½®å¥½ä¹‹åï¼ŒTravis CI ä¼šåœ¨ä½ æ¯æ¬¡ push åè‡ªåŠ¨æµ‹è¯•ä½ çš„ä»£ç ã€‚</p><h1 id="å…¶ä»–æµ‹è¯•ç›¸å…³å†…å®¹">å…¶ä»–æµ‹è¯•ç›¸å…³å†…å®¹</h1><ul><li>ä½¿ç”¨ Lintersï¼Œ æ¯”å¦‚ flake8</li><li>ä¿æŒå¹²å‡€çš„æµ‹è¯•ä»£ç ï¼Œéµå¾ª DRY( Donâ€™t Repeat Yourself) åŸåˆ™</li><li>ä½¿ç”¨ timeit æˆ–æ˜¯ pytest-benchmark æ¨¡å—ï¼ŒæŸ¥çœ‹æµ‹è¯•æ€§èƒ½</li><li>ä½¿ç”¨ bandit æµ‹è¯•ä½ çš„åŒ…çš„å®‰å…¨é—®é¢˜.</li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»‹ç»äº† Python ä¸­å„ç§æµ‹è¯•æ–¹æ³•ä¸åœºæ™¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="unittest" scheme="https://scottzhang.pro/tags/unittest/"/>
    
  </entry>
  
  <entry>
    <title>Oracle åŸºæœ¬ä¿¡æ¯é€ŸæŸ¥</title>
    <link href="https://scottzhang.pro/article/96143e16.html"/>
    <id>https://scottzhang.pro/article/96143e16.html</id>
    <published>2022-05-17T03:55:06.000Z</published>
    <updated>2022-05-17T03:56:08.692Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€äº›å…³äº Oracle åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢çš„å¸¸ç”¨ sqlã€‚</p></blockquote><span id="more"></span><h2 id="æ•°æ®åº“ä¿¡æ¯">æ•°æ®åº“ä¿¡æ¯</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v$version;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å½“å‰æ•°æ®åº“å</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> v$database;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å½“å‰æ•°æ®åº“å®ä¾‹å</span></span><br><span class="line"><span class="keyword">select</span> instance_name <span class="keyword">from</span> v$instance;</span><br></pre></td></tr></table></figure><h2 id="è¡¨ç©ºé—´">è¡¨ç©ºé—´</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¡¨ç©ºé—´ä¿¡æ¯</span></span><br><span class="line"><span class="comment">-- å‚è€ƒ: https://techgoeasy.com/how-to-check-tablespace-in-oracle-database/</span></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨ç©ºé—´</span></span><br><span class="line"><span class="keyword">SELECT</span> TABLESPACE_NAME &quot;TABLESPACE&quot;, EXTENT_MANAGEMENT,FORCE_LOGGING,</span><br><span class="line">BLOCK_SIZE,</span><br><span class="line">SEGMENT_SPACE_MANAGEMENT</span><br><span class="line"><span class="keyword">FROM</span> DBA_TABLESPACES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨ç©ºé—´æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">FILE_NAME, </span><br><span class="line">BLOCKS, </span><br><span class="line">TABLESPACE_NAME</span><br><span class="line"><span class="keyword">FROM</span> DBA_DATA_FILES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥è¡¨ç©ºé—´æ–‡ä»¶å¤§å°ï¼Œè¾“å…¥è¡¨ç©ºé—´åå­—</span></span><br><span class="line"><span class="comment">-- ç»“æœä¸º MB</span></span><br><span class="line"><span class="keyword">Select</span> (<span class="built_in">sum</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>) Space_allocated</span><br><span class="line"><span class="keyword">from</span> dba_data_files</span><br><span class="line"><span class="keyword">where</span> tablespace_name<span class="operator">=</span><span class="built_in">upper</span>(<span class="string">&#x27;&amp;tname&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="schema-ä¸ç”¨æˆ·">Schema ä¸ç”¨æˆ·</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Schema ä¸ç”¨æˆ·çš„åŒºåˆ«</span></span><br><span class="line"><span class="comment">-- A schema is a collection of database objects (used by a user.). </span></span><br><span class="line"><span class="comment">-- Schema objects are the logical structures that directly refer to the databaseâ€™s data.</span></span><br><span class="line"><span class="comment">-- A user is a name defined in the database that can connect to and access objects. </span></span><br><span class="line"><span class="comment">-- Schemas and users help database administrators manage database security.</span></span><br><span class="line"><span class="comment">-- ä¸€ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªç¼ºçœçš„schemaï¼Œå…¶schemaåå°±ç­‰äºç”¨æˆ·åï¼Œå½“ç„¶ä¸€ä¸ªç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„schemaã€‚</span></span><br><span class="line"><span class="comment">-- æŸ¥ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ schema</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.dba_users;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_users; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_users; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹ç”¨æˆ·æˆ–è§’è‰²ç³»ç»Ÿæƒé™</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_sys_privs; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_sys_privs; (æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æƒé™)</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.cnblogs.com/hellojesson/p/3398268.html">å¦‚ä½•æŸ¥è¯¢Oracleä¸­æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</a></p></blockquote><h1 id="æŸ¥ç´¢å¼•">æŸ¥ç´¢å¼•</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- user index</span></span><br><span class="line"><span class="keyword">select</span> INDEX_NAME, TABLE_OWNER, TABLE_NAME, UNIQUENESS <span class="keyword">from</span> USER_INDEXES</span><br><span class="line"></span><br><span class="line"><span class="comment">-- all index</span></span><br><span class="line"><span class="keyword">select</span> INDEX_NAME, TABLE_OWNER, TABLE_NAME, UNIQUENESS <span class="keyword">from</span> ALL_INDEXES</span><br><span class="line"></span><br><span class="line"><span class="comment">-- all index filter by table name</span></span><br><span class="line"><span class="keyword">select</span> INDEX_NAME, TABLE_OWNER, TABLE_NAME, UNIQUENESS <span class="keyword">from</span> ALL_INDEXES</span><br><span class="line"><span class="keyword">where</span> table_owner <span class="keyword">like</span> <span class="string">&#x27;%DC%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- all index group by table owner</span></span><br><span class="line"><span class="keyword">select</span> table_owner, <span class="built_in">COUNT</span>(TABLE_OWNER) <span class="keyword">from</span> ALL_INDEXES</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> table_owner;</span><br></pre></td></tr></table></figure><h1 id="è¡¨ä¸è§†å›¾">è¡¨ä¸è§†å›¾</h1><h2 id="æœ‰å“ªäº›è¡¨å’Œè§†å›¾">æœ‰å“ªäº›è¡¨å’Œè§†å›¾</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- list all user&#x27;s table</span></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> all_tables <span class="keyword">order</span> <span class="keyword">by</span> table_name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- list all views</span></span><br><span class="line"><span class="keyword">select</span> view_name <span class="keyword">from</span> all_views <span class="keyword">where</span> view_name <span class="keyword">like</span> <span class="string">&#x27;GRA%&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> view_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- check table length</span></span><br><span class="line"><span class="keyword">select</span> table_name, num_rows <span class="keyword">from</span> all_tables;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create table from another view or table</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> prs7.t_gra_stores_mapping_dc <span class="keyword">as</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> prs4.GRA_STORE_MAPPING_INFO_DC);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥è¡¨å ç”¨ç©ºé—´">æ£€æŸ¥è¡¨å ç”¨ç©ºé—´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">segment_name,</span><br><span class="line">sum(bytes)/1024/1024/1024 GB </span><br><span class="line">from user_segments </span><br><span class="line">where segment_type=&#x27;TABLE&#x27; and segment_name=upper(&#x27;&amp;TABLE_NAME&#x27;) group by segment_name;</span><br></pre></td></tr></table></figure><h1 id="æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’">æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">explain plan <span class="keyword">for</span></span><br><span class="line"><span class="keyword">select</span> a, b, c</span><br><span class="line"><span class="keyword">from</span> table_name</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">TABLE</span>(dbms_xplan.display);</span><br></pre></td></tr></table></figure><h1 id="oracle-æ–‡æ¡£é˜…è¯»">Oracle æ–‡æ¡£é˜…è¯»</h1><ul><li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/cncpt/introduction-to-oracle-database.html#GUID-A42A6EF0-20F8-4F4B-AFF7-09C100AE581E">Introduction to Oracle Database</a></li><li><a href="https://oracle-base.com/articles/misc/naming-conventions#EntitiesTables">Oracle Naming Conventions</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸€äº›å…³äº Oracle åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢çš„å¸¸ç”¨ sqlã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://scottzhang.pro/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="oracle" scheme="https://scottzhang.pro/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Pandas æ•°æ®å¤„ç†æŠ€å·§</title>
    <link href="https://scottzhang.pro/article/23f82ff0.html"/>
    <id>https://scottzhang.pro/article/23f82ff0.html</id>
    <published>2022-05-17T03:31:37.000Z</published>
    <updated>2022-05-17T03:45:44.694Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€äº›æ•°æ®å¤„ç†å°æŠ€å·§ï¼Œä¸æˆä½“ç³»ã€‚</p></blockquote><span id="more"></span><h3 id="äº†è§£æ–‡ä»¶">äº†è§£æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment"># csv, excel, txt, etc...</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">sndata = pd.read_csv(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ•°æ®ç»“æ„å’Œç±»å‹</span></span><br><span class="line">sndata.dtypes</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹index</span></span><br><span class="line">sndata.index</span><br><span class="line">&gt; indexæ˜¯å¯ä»¥å®šä¹‰çš„ï¼Œé»˜è®¤æ˜¯<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,ä¹Ÿå¯ä»¥æ˜¯a,b,c</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹åˆ—å</span></span><br><span class="line">sndata.columns</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹ç¼ºå¤±çš„æ•°æ®</span></span><br><span class="line">sndata.isnull()</span><br><span class="line"></span><br><span class="line"><span class="comment">## è½¬æ¢æˆDataFrame</span></span><br><span class="line">pd.DataFrame(sndata)</span><br><span class="line">&gt; The resulting DataFrame will have its index assigned automatically <span class="keyword">as</span> <span class="keyword">with</span> Series, <span class="keyword">and</span></span><br><span class="line">the columns are placed <span class="keyword">in</span> <span class="built_in">sorted</span> order:</span><br><span class="line"></span><br><span class="line"><span class="comment">## å»é‡å¤</span></span><br><span class="line">sndata.duplicated([<span class="string">&#x27;MonitorFA&#x27;</span>])</span><br><span class="line">sndata[sndata.duplicated([<span class="string">&#x27;ComputerSN&#x27;</span>],keep = <span class="literal">False</span>)]</span><br><span class="line">Drop_duplicateså½“ä¸­çš„å‚æ•°keep=<span class="literal">False</span>ï¼Œæ„ä¸ºé‡å¤é¡¹å…¨éƒ¨åˆ é™¤ï¼Œå®ƒè¿˜æœ‰keep=<span class="string">&quot;first&quot;</span>ä¸keep=<span class="string">&quot;last&quot;</span>ï¼Œåˆ†åˆ«å¯¹åº”åœ¨æœ‰å¤šé¡¹é‡å¤æ—¶ï¼Œä¿ç•™ç¬¬ä¸€é¡¹ï¼ˆæˆ–æœ€åä¸€é¡¹ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ‰¾å‡ºä¸¤ä¸ªè¡¨ä¸ä¸€æ ·çš„åœ°æ–¹</span></span><br><span class="line">c=a.append(b)</span><br><span class="line">c.drop_duplicates(keep=<span class="literal">False</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">c.reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment">## åˆ é™¤ NA</span></span><br><span class="line">df.dropna(axis=â€˜columnsâ€™,how=â€˜<span class="built_in">all</span>â€™)</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ–‡ä»¶æ˜¯å¦æœ‰-header">æ£€æµ‹æ–‡ä»¶æ˜¯å¦æœ‰ Header</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">path = <span class="string">r&#x27;C:\Users\scott\Documents\Test_Data\distribution\myfile.csv&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    dialect = csv.Sniffer().has_header(csvfile.read(<span class="number">1024</span>))</span><br><span class="line"><span class="built_in">print</span>(dialect)</span><br></pre></td></tr></table></figure><h3 id="å¤§æ•°æ®é›†å¤„ç†">å¤§æ•°æ®é›†å¤„ç†</h3><ol type="1"><li>å›æ”¶åƒåœ¾</li><li>æå‰è®¾ç½®å¥½ dtype</li><li>é€‰æ‹©æœ‰é™çš„è¡Œï¼Œåˆ—</li><li>ä½¿ç”¨ chunk åˆ†æ‰¹å¯¼å…¥ã€å¤„ç†</li><li>Tips æŸ¥çœ‹å†…å­˜æ¶ˆè€—: <code>train.memory_usage(deep=True) * 1e-6</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import some file</span></span><br><span class="line">temp = pd.read_csv(<span class="string">&#x27;../input/train_sample.csv&#x27;</span>)</span><br><span class="line"><span class="comment">#do something to the file</span></span><br><span class="line">temp[<span class="string">&#x27;os&#x27;</span>] = temp[<span class="string">&#x27;os&#x27;</span>].astype(<span class="string">&#x27;str&#x27;</span>)</span><br><span class="line"><span class="comment">#delete when no longer needed</span></span><br><span class="line"><span class="keyword">del</span> temp</span><br><span class="line"><span class="comment">#collect residual garbage</span></span><br><span class="line">gc.collect()</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼šhttps://www.kaggle.com/rohanrao/tutorial-on-reading-large-datasets#Large-datasets</p><h3 id="tidy-data-åŸåˆ™">Tidy Data åŸåˆ™</h3><ol type="1"><li>Columns represent separate variables</li><li>Raws represent individual observations</li><li>Observational units from tables</li></ol><h3 id="cut-æ–¹æ³•">Cut æ–¹æ³•</h3><p>ç”¨äºæ£€æµ‹æ•°æ®çš„åˆ†ç±»ï¼Œæ¯”å¦‚19,20,35 å¯¹åº”äººå‘˜å¹´é¾„çš„åˆ†å±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">pd.cut(a,b)</span><br><span class="line"></span><br><span class="line">a: data</span><br><span class="line">b:category info</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´æ—¥æœŸå¤„ç†">æ—¶é—´æ—¥æœŸå¤„ç†</h3><blockquote><p>å†…å®¹å¤ªå¤šï¼Œåªè®°å½•äº†ä¸ªäººçš„ç¬”è®°ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶é—´åˆ‡ç‰‡</span></span><br><span class="line">ts = pd.to_datetime(<span class="string">&#x27;///&#x27;</span>)</span><br><span class="line">ufo.loc([ufo.time &gt;= ts],:)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜ŸæœŸã€å¹´ã€ç­‰è®¡ç®—</span></span><br><span class="line">ufo.time.dt.dayofyear.head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€æ–°æ—¶é—´ã€è®¡ç®—</span></span><br><span class="line">ufo.time.<span class="built_in">max</span>() - ufo.time.<span class="built_in">min</span>() </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥æœŸè½¬æ¢æ—¶é—´æ®µ</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> calendar <span class="keyword">import</span> monthrange</span><br><span class="line"></span><br><span class="line">start = datetime.strptime(<span class="string">&#x27;20201402&#x27;</span>,<span class="string">&#x27;%Y14%m&#x27;</span>)</span><br><span class="line">_,days = monthrange(start.year, start.month)</span><br><span class="line">end_str = <span class="string">f&#x27;<span class="subst">&#123;start.year&#125;</span>-<span class="subst">&#123;start.month&#125;</span>-<span class="subst">&#123;days&#125;</span>&#x27;</span></span><br><span class="line">end = datetime.strptime(end_str,<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="category-datatype">Category Datatype</h3><ul><li>object é€šå¸¸æ˜¯ stringï¼Œè¿™ä¸ªobjectæŒ‡å‘æœ¬æ¥çš„python çš„listæˆ–è€…dictå¯¹è±¡</li><li>memory usage xxx+ KB, +çš„æ„æ€æ˜¯æœ€å°‘éœ€è¦è¿™ä¹ˆå¤šç©ºé—´å»å­˜å‚¨è¿™äº›å¼•ç”¨</li><li>drinks.info(memory_usage='deep') ï¼š æŸ¥çœ‹çœŸå®çš„ç©ºé—´éœ€æ±‚</li><li>æ¯ä¸€åˆ—éœ€è¦çš„ç©ºé—´: drinks.memory_usage(deep=True)</li></ul><h3 id="append-å’Œ-concat">append å’Œ concat</h3><p>å¯¹äºSeriesï¼š</p><ul><li>appendä¼šå°†indexç›´æ¥åŠ ä¸Šå»ï¼Œç´¢å¼•è¿˜æ˜¯ä»¥å‰çš„ï¼Œå¦‚æœæŒ‰ç…§ç´¢å¼•å»é€‰æ‹©ï¼Œå¯èƒ½ä¼šè¿”å›å¤šä¸ªæ•°æ®, æœ€å¥½åœ¨ append ååŠ ä¸Š resetindex</li><li>concaté»˜è®¤ä¼šé‡è®¾ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ignore_indexä¿ç•™ç´¢å¼•</li></ul><p>å¯¹äºDataFrameï¼š</p><ul><li>appendï¼šå¦‚æœåˆ—åå­—ä¸€æ ·ï¼Œç›´æ¥åœ¨åé¢æ·»åŠ ï¼Œå¦‚æœä¸ä¸€æ ·ï¼Œå¢åŠ ç›¸åº”çš„åˆ—ï¼Œå¡«å……ç©ºå€¼ã€‚</li><li>concatï¼šæŒ‡å®šaxis=0ï¼Œåˆ™æ•ˆæœå’Œappendä¸€æ ·ï¼Œaxis=1ï¼Œä¼šåˆå¹¶å€¼ä¸€æ ·çš„è¡Œ</li></ul><p>appendå’Œconcatæ“ä½œä¸­ indexçš„å˜åŒ–:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># concatç›´æ¥å°†ä¸¤ä»½æ•°æ®åˆå¹¶åˆ°ä¸€èµ·</span></span><br><span class="line"><span class="comment"># å¦‚æœä½ çš„ä¸¤ä»½æ•°æ®åˆ†åˆ«æ˜¯13å¹´å’Œ14å¹´çš„ï¼Œä½ æƒ³è¦æ·»åŠ ç´¢å¼•å°†å…¶åˆ†å¼€ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</span></span><br><span class="line">rain1314 = pd.concat([rain2013, rain2014], keys=[<span class="number">2013</span>, <span class="number">2014</span>], axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ ·æ˜¯ä»¥rowåæ¥åˆ†ç±»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨columnåæ¥åˆ†ç±»ï¼š</span></span><br><span class="line">rain1314 = pd.concat([rain2013, rain2014], keys=[<span class="number">2013</span>, <span class="number">2014</span>], axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶ä¸¤ä¸ªdataframeä¸ä»…å¯ä»¥ä»æ•°ç»„ä¸­æ„é€ ï¼Œä¹Ÿå¯ä»¥ä»dictä¸­</span></span><br><span class="line"><span class="comment"># è¿™æ ·å°±ä¸å¿…åæœŸæŒ‡å®škeyçš„å€¼äº†ï¼š</span></span><br><span class="line">rain_dict = &#123;<span class="number">2013</span>: rain2013, <span class="number">2014</span>: rain2014&#125; </span><br><span class="line">rain1314 = pd.concat(rain_dict, axis=<span class="string">&#x27;columns&#x27;</span>) </span><br></pre></td></tr></table></figure><p>å¯¹äº join:</p><ul><li>inner join, æŠŠä¸åŒè¡¨ä¸­ï¼Œç´¢å¼•åå­—ä¸€æ ·çš„è¡Œçš„åˆ—åˆå¹¶ï¼Œå¦‚æœæŸäº›åˆ—æ²¡æœ‰çš„ï¼Œåˆ™è¿‡æ»¤æ‰è¿™ä¸€è¡Œã€‚</li><li>outer join, æŠŠä¸¤ä¸ªè¡¨åˆå¹¶ï¼Œæ‰€æœ‰ç´¢å¼•éƒ½åˆå¹¶ï¼Œå¦‚æœæŸäº›åˆ—æ²¡æœ‰å€¼çš„ï¼Œå¡«å……å€¼ä¸ºnanaxis = 1æˆ–è€…0, å¯¹åˆ—æˆ–è€…è¡Œæ“ä½œ</li></ul><h3 id="merge">Merge</h3><p>mergeé»˜è®¤æŒ‡å®šçš„åˆ—æ¥åˆå¹¶ä¸¤ä¸ªè¡¨çš„å…¶ä»–åˆ—ï¼Œé»˜è®¤æ ¹æ® indexã€‚</p><p>å¦‚æœç±»ä¼¼å¤šç´¢å¼•çš„ä¸¤ä¸ªè¡¨ï¼Œç´¢å¼•éƒ¨åˆ†çš„å€¼æ— æ³•ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‡å®šæ ¹æ®å“ªä¸€åˆ—æ¥mergeï¼Œå¦‚æœåªæŒ‡å®šäº†ä¸€åˆ—ï¼Œé‚£ä¹ˆè‚¯å®šä¼šæœ‰ä¸¤ä¸ªè¡¨éƒ½å¯¹åº”åŒä¸€åˆ—æ•°æ®çš„æƒ…å†µå‡ºç°ï¼Œå¯ä»¥ç”¨suffixeså‚æ•°ï¼Œæ¥å¯¹è¿™äº›åˆ—è¿›è¡ŒåŒºåˆ†ï¼ˆä¸€èˆ¬æ˜¯æ ¹æ®è¡¨åï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šå¤šä¸ªåˆ—æ¥mergeã€‚</p><p>ä¸€èˆ¬é»˜è®¤ä¼šä½¿ç”¨indexå»mergeï¼Œä½†æ›´å¤šçš„æ˜¯ä½¿ç”¨leftonå’Œrightonå‚æ•°æ¥æŒ‡å®šå·¦å³ä¸¤ä¸ªè¡¨ä¸­çš„åˆ—æ¥mergeã€‚</p><h3 id="ä»å¤šæ ‡ç­¾ä¸­åˆ‡åˆ†å€¼">ä»å¤šæ ‡ç­¾ä¸­åˆ‡åˆ†å€¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.IndexSlice</span><br><span class="line">slice_2_8 = february.loc[<span class="string">&#x27;2015-2-2&#x27;</span>:<span class="string">&#x27;2015-2-8&#x27;</span>, idx[:, <span class="string">&#x27;Company&#x27;</span>]]</span><br></pre></td></tr></table></figure><h3 id="å¤šåˆ—æ“ä½œ">å¤šåˆ—æ“ä½œ</h3><p>ä»å¤šåˆ—åˆ›å»ºæ—¥æœŸ</p><p><img src="https://s2.loli.net/2022/05/17/mxKPnu3bCTiINlq.png" /></p><p>æ‰¹é‡è½¬æ¢åˆ—çš„æ•°æ®ç±»å‹</p><p><img src="https://s2.loli.net/2022/05/17/6aNR4GMCXSbZiWg.png" /></p><p>æ‰¹é‡å¯¹åˆ—ä½¿ç”¨èšåˆå‡½æ•°</p><p><img src="https://s2.loli.net/2022/05/17/LauhgMiFtOXPjrU.png" /></p><p>æ‰¹é‡é‡å‘½ååˆ—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.rename(columns = &#123;<span class="string">&#x27;oldname&#x27;</span>:<span class="string">&#x27;new_name&#x27;</span>&#125;,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é¿å…èµ‹å€¼å‡ºç°-warning">é¿å…èµ‹å€¼å‡ºç° warning</h3><p><img src="https://s2.loli.net/2022/05/17/GTyqipAekfHo2wP.png" /></p><h3 id="å…³é—­ç§‘å­¦è®°æ•°æ³•">å…³é—­ç§‘å­¦è®°æ•°æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://stackoverflow.com/questions/21137150/format-suppress-scientific-notation-from-python-pandas-aggregation-results</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.float_format&#x27;</span>, <span class="keyword">lambda</span> x: <span class="string">&#x27;%.3f&#x27;</span> % x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®åƒåˆ†ç¬¦</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.float_format&#x27;</span>, <span class="keyword">lambda</span> x:<span class="string">&#x27;&#123;:,.0f&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br></pre></td></tr></table></figure><h3 id="by-è¡Œä¿®æ”¹å€¼">By è¡Œä¿®æ”¹å€¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://stackoverflow.com/questions/23330654/update-a-dataframe-in-pandas-while-iterating-row-by-row</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> df.itertuples():</span><br><span class="line">    <span class="keyword">if</span> &lt;something&gt;:</span><br><span class="line">        df.at[row.Index, <span class="string">&#x27;ifor&#x27;</span>] = x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        df.at[row.Index, <span class="string">&#x27;ifor&#x27;</span>] = x</span><br><span class="line">df.loc[row.Index, <span class="string">&#x27;ifor&#x27;</span>] = x</span><br></pre></td></tr></table></figure><h3 id="pd.iterrows-çš„é™åˆ¶">pd.iterrows çš„é™åˆ¶</h3><blockquote><p>pd.DataFrame.iterrows you are iterating through rows as Series. But these are not the Series that the data frame is storing and so they are new Series that are created for you while you iterate.</p></blockquote><p>Refer <a href="https://stackoverflow.com/questions/23330654/update-a-dataframe-in-pandas-while-iterating-row-by-row">this</a></p><h3 id="pd.xs-æ–¹æ³•">pd.xs æ–¹æ³•</h3><p>å¤šä¸ª index å–å€¼ï¼Œä½†ä¸èƒ½ç”¨æ¥è®¾ç½®å€¼ï¼Œé»˜è®¤å®ƒè¿”å›åŸæ•°æ®ä¸­çš„ä¸€ä»½ copyã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># by default, returns a new dataframe with a copy of the data</span></span><br><span class="line">df.xs(<span class="string">&#x27;C&#x27;</span>) </span><br></pre></td></tr></table></figure><p>Refer <a href="https://stackoverflow.com/questions/13842088/set-value-for-particular-cell-in-pandas-dataframe-using-index">this</a></p><h3 id="ç†è§£-pandas-çš„-axis">ç†è§£ Pandas çš„ Axis</h3><p>å¯¹äº Dataframe</p><ul><li>â€œaxis 0â€ represents rows direction and â€œaxis 1â€ represents columns direction</li><li>å¯ä»¥ä½¿ç”¨ â€œindexâ€ ä¸ â€œrowâ€ ä»£è¡¨ 0ï¼› â€œcolumnâ€ ä»£è¡¨ 1</li><li>Sum åº”ç”¨åˆ° â€œaxis 0â€ï¼Œæ„å‘³ç€ sum æ¯åˆ—çš„ç»“æœ</li><li>Sum åº”ç”¨åˆ° â€œaxis 1â€ï¼Œæ„å‘³ç€ sum æ¯è¡Œçš„ç»“æœ</li></ul><p><img src="https://s2.loli.net/2022/05/17/MPx9yEOuhASFN2C.png" /></p><blockquote><p>dropna å¯ä»¥é»˜è®¤æ˜¯ä¸¢å¼ƒæœ‰ na å€¼çš„è¡Œï¼Œå¦‚æœä½ éœ€è¦ä¸¢å¼ƒæœ‰ na å€¼çš„åˆ—ï¼Œå°† axis è®¾ç½®ä¸º 1 å³å¯ã€‚</p></blockquote><p>å¯¹äº Series</p><blockquote><p>Series and DataFrame share the same direction for â€œaxis 0â€</p></blockquote><p><img src="https://s2.loli.net/2022/05/17/u7imoNkQeMXAsaB.png" /></p><h3 id="æé«˜-dataframe-éå†é€Ÿåº¦">æé«˜ Dataframe éå†é€Ÿåº¦</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For å¾ªç¯ï¼Œiloc è®¿é—® df : 2.65 ç§’</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop_with_for</span>(<span class="params">df</span>):</span></span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df)):</span><br><span class="line">        temp += df[<span class="string">&#x27;A&#x27;</span>].iloc[index] + df[<span class="string">&#x27;B&#x27;</span>].iloc[index]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># For å¾ªç¯ï¼Œdf.iterrows è®¿é—® dfï¼š12.4 ç§’, ä¼šèŠ±è´¹å¤§é‡æ—¶é—´åœ¨</span></span><br><span class="line"><span class="comment"># åˆ›å»º series å¯¹è±¡ï¼ˆä¸”ä¸ä¼šä¿ç•™ dtypeï¼Œå¦‚æœéœ€è¦å»ºè®®ä½¿ç”¨ itertuplesï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop_with_iterrows</span>(<span class="params">df</span>):</span></span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">            temp += row.A + row.B</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"><span class="comment"># For å¾ªç¯ï¼Œdf.itertuples è®¿é—® dfï¼š136 æ¯«ç§’ï¼Œç»ˆäºæ¥åˆ°æ¯«ç§’çº§åˆ«</span></span><br><span class="line"><span class="comment"># ä½†å®ƒè¿˜æ˜¯ä¼šåˆ›å»º namedtuple</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop_with_itertuples</span>(<span class="params">df</span>):</span></span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> row_tuple <span class="keyword">in</span> df.itertuples():</span><br><span class="line">        temp += row_tuple.A + row_tuple.B</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ï¼Œé¿å…åˆ›å»º nameduple,ä½¿ç”¨ zip å‡½æ•°</span></span><br><span class="line"><span class="comment"># For å¾ªç¯ï¼Œzip å‡½æ•°è®¿é—®ï¼Œ30 æ¯«ç§’ï¼Œè¿™é‡Œçš„æ”¹è¿›æ¥è‡ªäºé¿å…åˆ›å»º namedtuple</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop_with_zip</span>(<span class="params">df</span>):</span></span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(df[<span class="string">&#x27;A&#x27;</span>], df[<span class="string">&#x27;B&#x27;</span>]):</span><br><span class="line">        temp += a + b</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ pandas è‡ªå¸¦çš„ apply å‡½æ•°</span></span><br><span class="line"><span class="comment"># 3.28 ç§’ï¼Œçœ‹èµ·æ¥å’Œæ™®é€šçš„ for å¾ªç¯å·®ä¸å¤š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">using_apply</span>(<span class="params">df</span>):</span></span><br><span class="line">    <span class="keyword">return</span> df.apply(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;A&#x27;</span>] + x[<span class="string">&#x27;B&#x27;</span>], axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ pandas è‡ªå¸¦çš„ add å‡½æ•°</span></span><br><span class="line"><span class="comment"># 849 Âµsï¼Œpandas è‡ªå¸¦çš„è¿™ç§å‡½æ•°è¿è¡Œæ•ˆç‡éå¸¸é«˜</span></span><br><span class="line"><span class="comment"># å¦‚æœä½ çš„æ“ä½œå¯ä»¥åˆ†è§£æˆè¿™ç§å°±ä¼˜å…ˆä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">using_add</span>(<span class="params">df</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (df[<span class="string">&#x27;A&#x27;</span>]+df[<span class="string">&#x27;B&#x27;</span>]).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä½ è¿˜æ˜¯å¾ˆåœ¨ä¹æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨ numpy</span></span><br><span class="line"><span class="comment"># å°†æ•°æ®è½¬åŒ–æˆ numpy çš„ array</span></span><br><span class="line"><span class="comment"># 186 Âµsï¼Œæå‡å…«å€</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">using_numpy_builtin</span>(<span class="params">df</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (df[<span class="string">&#x27;A&#x27;</span>].values + df[<span class="string">&#x27;B&#x27;</span>].values).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸åŒå¤§å°çš„æ•°æ®ï¼Œå¯¹ç»“æœä¼šæœ‰å½±å“ï¼Œå¦‚æœæ˜¯å¤§æ•°æ®é›†ï¼Œç»“æœå·®è·ä¼šéå¸¸æ˜æ˜¾ï¼Œé™„å›¾ï¼š</span></span><br><span class="line"><span class="comment"># iterrows æ˜¯æ•ˆç‡æœ€å·®çš„,å…¶æ¬¡æ˜¯ applyï¼Œå’Œ æ™®é€šçš„ for å¾ªç¯ï¼Œä¸¤è€…å·®ä¸å¤š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä¸€å®šè¦ç”¨ apply æ€ä¹ˆåŠå‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"># å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ç¬¬äºŒç§æ–¹å¼, * here is to unpack all values in list </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">using_apply</span>(<span class="params">df</span>):</span></span><br><span class="line">    <span class="keyword">return</span> df.apply(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;A&#x27;</span>] + x[<span class="string">&#x27;B&#x27;</span>] + x[<span class="string">&#x27;C&#x27;</span>] + x[<span class="string">&#x27;D&#x27;</span>], axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">using_apply_unpack</span>(<span class="params">df</span>):</span></span><br><span class="line">    <span class="keyword">return</span> df[[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]].apply(<span class="keyword">lambda</span> x: <span class="built_in">sum</span>([*x]), axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€Ÿåº¦æµ‹è¯•å¯¹æ¯”ï¼š</p><p><img src="https://s2.loli.net/2022/05/17/4Ej1WL9nxTOyXPC.png" /></p><h3 id="æµ‹è¯•ä½ ä»£ç çš„é€Ÿåº¦">æµ‹è¯•ä½ ä»£ç çš„é€Ÿåº¦</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python è‡ªå¸¦</span></span><br><span class="line">%timeit using_numpy_builtin(df)</span><br><span class="line"><span class="comment"># notebook è‡ªå¸¦</span></span><br><span class="line">%prun -l <span class="number">4</span> loop_with_iterrows(df)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-pd.wide_to_long">ä½¿ç”¨ pd.wide_to_long</h3><p>wide_to_long allows us to set stub names that can group columns.</p><p>Remember that wide_to_long() function takes the main arguments: i to set the unique row index, j to set the new variable name, and stubnames to extract the start of the wide columns.</p><p>needed to specify the separating elements. When you didn't do that, pandas didn't recognize the column names and returned an empty DataFrame.</p><p>Also, wide_to_long() always assumes that suffixes are numeric, so don't forget to specify if they are not!</p><h3 id="ä½¿ç”¨-pd.apply">ä½¿ç”¨ pd.apply</h3><p>åˆ›å»ºåˆ— <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;Discounted_Price&#x27;</span>] = df.apply(</span><br><span class="line">    <span class="keyword">lambda</span> row: row.Cost - (row.Cost * <span class="number">0.1</span>),</span><br><span class="line">    axis = <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Print the DataFrame after addition of new column</span></span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure></p><p>å¯¹æ¯” map</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p=pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment"># apply è¿”å› dataframeï¼Œå¢åŠ ä¸¤åˆ—</span></span><br><span class="line">a = p.apply(<span class="keyword">lambda</span> x: pd.Series([x,x+<span class="number">1</span>,x+<span class="number">2</span>]))</span><br><span class="line"><span class="comment"># mapï¼Œè¿”å›3ä¸ª Series</span></span><br><span class="line">a,b,c = p.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: pd.Series([x,x+<span class="number">1</span>,x+<span class="number">2</span>]))</span><br></pre></td></tr></table></figure><h3 id="pivot-å’Œ-pivottable">Pivot å’Œ Pivottable</h3><p>When the .pivot() method finds two rows with the same index and column, but different values for the values, it doesn't know how to handle it.</p><h3 id="dataframe-å¢åŠ æ€»å’Œgrand-total">Dataframe å¢åŠ æ€»å’Œï¼ˆGrand Totalï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://stackoverflow.com/questions/21752399/pandas-dataframe-total-row</span></span><br><span class="line">df.loc[<span class="string">&#x27;Column_Total&#x27;</span>]= df.<span class="built_in">sum</span>(numeric_only=<span class="literal">True</span>, axis=<span class="number">0</span>)</span><br><span class="line">df.loc[:,<span class="string">&#x27;Row_Total&#x27;</span>] = df.<span class="built_in">sum</span>(numeric_only=<span class="literal">True</span>, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="pandas-æ±‚ä¼—æ•°">Pandas æ±‚ä¼—æ•°</h3><p>ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ï¼Œæ€§èƒ½å·®å¼‚ä¸å¤§ï¼š</p><p><img src="https://s2.loli.net/2022/05/17/uz2aefXxApK1VvO.png" /></p><h3 id="æ ¹æ®æ¡ä»¶å¯¹åˆ—èµ‹å€¼">æ ¹æ®æ¡ä»¶å¯¹åˆ—èµ‹å€¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Numpy Where æ–¹æ³•</span></span><br><span class="line">df[<span class="string">&#x27;hasimage&#x27;</span>] = np.where(df[<span class="string">&#x27;photos&#x27;</span>]!= <span class="string">&#x27;[]&#x27;</span>, <span class="literal">True</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Numpy Select æ–¹æ³•</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># read data</span></span><br><span class="line">all_ = pd.read_excel(<span class="string">&#x27;./scott.xlsx&#x27;</span>,sheet_name=<span class="string">&#x27;ALL&#x27;</span>)</span><br><span class="line">enc_ = pd.read_excel(<span class="string">&#x27;./scott.xlsx&#x27;</span>,sheet_name=<span class="string">&#x27;ENC&#x27;</span>)</span><br><span class="line">result = pd.read_excel(<span class="string">&#x27;./scott.xlsx&#x27;</span>,sheet_name=<span class="string">&#x27;result&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># enc store list unique array</span></span><br><span class="line">enc_store_list = enc_.STORECODE.unique()</span><br><span class="line"></span><br><span class="line">conditions = [</span><br><span class="line">    all_.STORECODE.isin(enc_store_list),</span><br><span class="line">    ~all_.STORECODE.isin(enc_store_list)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># PVAL_OLD values</span></span><br><span class="line">pval_new_values = [</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    all_[conditions[<span class="number">1</span>]].PVAL.values</span><br><span class="line">]</span><br><span class="line">pvol_new_values = [</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    all_[conditions[<span class="number">1</span>]].PVOL.values</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">all_[<span class="string">&#x27;PVOL_NEW&#x27;</span>] = np.select(conditions,pvol_new_values)</span><br><span class="line">all_[<span class="string">&#x27;PVAL_NEW&#x27;</span>] = np.select(conditions,pval_new_values)</span><br><span class="line"></span><br><span class="line">all_.rename(columns=&#123;<span class="string">&#x27;PVOL&#x27;</span>:<span class="string">&#x27;PVOL_OLD&#x27;</span>,<span class="string">&#x27;PVAL&#x27;</span>:<span class="string">&#x27;PVAL_OLD&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¤šè¿›ç¨‹æé«˜æ•°æ®å¤„ç†é€Ÿåº¦">ä½¿ç”¨å¤šè¿›ç¨‹æé«˜æ•°æ®å¤„ç†é€Ÿåº¦</h3><p>æˆ‘ä»¬çŸ¥é“ Python å› ä¸º GIL çš„å…³ç³»ï¼Œå¯¹äº CPU å¯†é›†æ“ä½œæ— æ³•æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æ¥æ‰“ç ´è¿™ä¸ªé™åˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æœ‰ä»¥ä¸‹ä»£ç </span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span>  Pool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_features</span>(<span class="params">df</span>):</span></span><br><span class="line">    df[<span class="string">&#x27;question_text&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> x:<span class="built_in">str</span>(x))</span><br><span class="line">    df[<span class="string">&quot;lower_question_text&quot;</span>] = df[<span class="string">&quot;question_text&quot;</span>].apply(<span class="keyword">lambda</span> x: x.lower())</span><br><span class="line">    df[<span class="string">&#x27;total_length&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="built_in">len</span>)</span><br><span class="line">    df[<span class="string">&#x27;capitals&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> c <span class="keyword">in</span> comment <span class="keyword">if</span> c.isupper()))</span><br><span class="line">    df[<span class="string">&#x27;caps_vs_length&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: <span class="built_in">float</span>(row[<span class="string">&#x27;capitals&#x27;</span>])/<span class="built_in">float</span>(row[<span class="string">&#x27;total_length&#x27;</span>]),</span><br><span class="line">                                axis=<span class="number">1</span>)</span><br><span class="line">    df[<span class="string">&#x27;num_words&#x27;</span>] = df.question_text.<span class="built_in">str</span>.count(<span class="string">&#x27;\S+&#x27;</span>)</span><br><span class="line">    df[<span class="string">&#x27;num_unique_words&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">len</span>(<span class="built_in">set</span>(w <span class="keyword">for</span> w <span class="keyword">in</span> comment.split())))</span><br><span class="line">    df[<span class="string">&#x27;words_vs_unique&#x27;</span>] = df[<span class="string">&#x27;num_unique_words&#x27;</span>] / df[<span class="string">&#x27;num_words&#x27;</span>] </span><br><span class="line">    df[<span class="string">&#x27;num_exclamation_marks&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: comment.count(<span class="string">&#x27;!&#x27;</span>))</span><br><span class="line">    df[<span class="string">&#x27;num_question_marks&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: comment.count(<span class="string">&#x27;?&#x27;</span>))</span><br><span class="line">    df[<span class="string">&#x27;num_punctuation&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">sum</span>(comment.count(w) <span class="keyword">for</span> w <span class="keyword">in</span> <span class="string">&#x27;.,;:&#x27;</span>))</span><br><span class="line">    df[<span class="string">&#x27;num_symbols&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">sum</span>(comment.count(w) <span class="keyword">for</span> w <span class="keyword">in</span> <span class="string">&#x27;*&amp;$%&#x27;</span>))</span><br><span class="line">    df[<span class="string">&#x27;num_smilies&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">sum</span>(comment.count(w) <span class="keyword">for</span> w <span class="keyword">in</span> (<span class="string">&#x27;:-)&#x27;</span>, <span class="string">&#x27;:)&#x27;</span>, <span class="string">&#x27;;-)&#x27;</span>, <span class="string">&#x27;;)&#x27;</span>)))</span><br><span class="line">    df[<span class="string">&#x27;num_sad&#x27;</span>] = df[<span class="string">&#x27;question_text&#x27;</span>].apply(<span class="keyword">lambda</span> comment: <span class="built_in">sum</span>(comment.count(w) <span class="keyword">for</span> w <span class="keyword">in</span> (<span class="string">&#x27;:-&lt;&#x27;</span>, <span class="string">&#x27;:()&#x27;</span>, <span class="string">&#x27;;-()&#x27;</span>, <span class="string">&#x27;;(&#x27;</span>)))</span><br><span class="line">    df[<span class="string">&quot;mean_word_len&quot;</span>] = df[<span class="string">&quot;question_text&quot;</span>].apply(<span class="keyword">lambda</span> x: np.mean([<span class="built_in">len</span>(w) <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">str</span>(x).split()]))</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parallelize_dataframe</span>(<span class="params">df, func, n_cores=<span class="number">4</span></span>):</span></span><br><span class="line">    df_split = np.array_split(df, n_cores)</span><br><span class="line">    pool = Pool(n_cores)</span><br><span class="line">    df = pd.concat(pool.<span class="built_in">map</span>(func, df_split))</span><br><span class="line">    <span class="comment"># å¯¹Poolå¯¹è±¡è°ƒç”¨join()æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨join()ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨close()ï¼Œè°ƒç”¨close()ä¹‹åå°±ä¸èƒ½ç»§ç»­æ·»åŠ æ–°çš„Processäº†</span></span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">train = parallelize_dataframe(train_df, add_features)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³äºå¤šè¿›ç¨‹ï¼Œå¯ä»¥<a href="https://scottzhang.pro/article/4300f84b.html">ç‚¹å‡»</a>äº†è§£æ›´å¤šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸€äº›æ•°æ®å¤„ç†å°æŠ€å·§ï¼Œä¸æˆä½“ç³»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Pandas ç³»åˆ—" scheme="https://scottzhang.pro/categories/Pandas-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Pandas" scheme="https://scottzhang.pro/tags/Pandas/"/>
    
  </entry>
  
  <entry>
    <title>Pandas åŸºç¡€æ“ä½œ</title>
    <link href="https://scottzhang.pro/article/706b7b04.html"/>
    <id>https://scottzhang.pro/article/706b7b04.html</id>
    <published>2022-05-17T01:59:34.000Z</published>
    <updated>2022-05-17T03:45:39.165Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»‹ç»äº† Pandas ä¸­çš„ Indexï¼ŒSeries, Dataframe åŠå…¶åŸºæœ¬æ“ä½œã€‚</p></blockquote><span id="more"></span><h1 id="æ¦‚å¿µä»‹ç»">æ¦‚å¿µä»‹ç»</h1><h2 id="index">Index</h2><p>Index å¯¹è±¡ä¸»è¦ä¿å­˜äº†å…³äºè½´çš„ä¿¡æ¯ï¼Œindex å¯¹è±¡ç±»ä¼¼æ•°ç»„ï¼Œå¯ä»¥è¢«åˆ‡ç‰‡ï¼Œå¯ä»¥æ ¹æ®ä¸‹æ ‡è®¿é—®ï¼Œä½†æ˜¯ä¸å¯ä»¥è¢«ä¿®æ”¹;</p><p>å¯ä»¥é€šè¿‡ pd.Index æ„é€  index å¯¹è±¡ï¼Œindex å¯¹è±¡å¯ä»¥æ‹¥æœ‰é‡å¤çš„å€¼ã€‚</p><p>index æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•:</p><p><img src="https://i.loli.net/2021/03/22/fca94zqHgxJ7Ey8.jpg" /></p><h2 id="series">Series</h2><p>Series å¯ä»¥ç›´æ¥ä»æ•°ç»„åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š indexï¼Œåˆ™ä¼šé»˜è®¤åˆ†é…æ•°å­—ä½œä¸º indexï¼Œä¹Ÿå¯ä»¥æŒ‡å®š indexï¼Œä½†è¦æ±‚å…¶é•¿åº¦ä¸ values ä¸€è‡´ã€‚</p><p>å½“æŒ‡å®šäº† index åï¼Œå¯ç›´æ¥é€šè¿‡ index çš„åå­—è®¿é—® valueï¼Œæ¯”å¦‚ <code>obj['a']</code> æˆ–è€… <code>obj[['a','b','c']]</code>ï¼Œå¯ä»¥é€šè¿‡ <code>obj[obj &gt; 0]</code> çš„æ–¹å¼ filterå…¶å…ƒç´ ï¼Œæˆ–è€…è¿›è¡Œè¿ç®—ï¼š<code>'a' in obj</code>ï¼Œ <code>obj * 2</code>;</p><p>å¯ä»¥é€šè¿‡ dict åˆå§‹åŒ– Seriesï¼Œç»“æœçš„é¡ºåºä¸å’Œ dict ä¸­çš„ key æ’åºåçš„ä¸€æ ·ï¼Œå¦‚æœåƒè‡ªå®šä¹‰é¡ºåºï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­å•ç‹¬æŒ‡å®š indexï¼Œéœ€è¦ä¿è¯ä¼ å…¥çš„ index åœ¨ dict ä¸­çš„ key ä¸­å­˜åœ¨ï¼Œå¦åˆ™ä¼šå°†å€¼è®¾ä¸ºç©ºã€‚</p><p>å¤šä¸ª Series åœ¨å‚ä¸è®¡ç®—çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å¯¹é½ indexï¼Œæœ‰ç‚¹ç±»ä¼¼ database ä¸­çš„ joinã€‚</p><p>Series å¯¹è±¡æœ¬èº«å’Œå®ƒçš„index éƒ½æœ‰ä¸€ä¸ªå« name çš„å±æ€§, index å¯ä»¥è¢«å…¶å®ƒçš„å€¼æ›¿ä»£ã€‚</p><h2 id="dataframe">DataFrame</h2><p>å¯ä»¥ç†è§£ä¸º dict ä¸­ value ä¸º Seriesï¼Œæ„é€  dataframe çš„æ–¹å¼ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ dictï¼ŒDataFrame çš„ index ä¹Ÿå’Œ Series ä¸€æ ·ï¼Œä¼šè‡ªåŠ¨æŒ‡å®šï¼Œcolumn çš„é¡ºåºä¹Ÿä¼šé‡æ–°æ’åºï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šæŒ‡å®šåˆ—çš„é¡ºåºï¼Œå°±åƒ Series ä¸€æ ·: <code>pd.DataFrame(data, columns=[...])</code>ï¼Œå¦‚æœä½ ä¼ çš„ columns æ•°ç»„ä¸­ï¼Œæœ‰ data ä¸­æ²¡æœ‰çš„å€¼ï¼Œåˆ™ä¼šå°†è¯¥åˆ—æ·»åŠ åˆ° DataFrame ä¸­ï¼Œå€¼å…¨éƒ¨ç½®ç©ºã€‚</p><p>DataFrame ä¸­çš„åˆ—ï¼Œå¯ä»¥é€šè¿‡ <code>df['a']</code> æˆ–è€… <code>df.a</code> ä¸¤ç§æ–¹å¼è®¿é—®ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ª Seriesï¼Œç¬¬ä¸€ç§æ–¹å¼åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œç¬¬äºŒç§æ–¹å¼åˆ™éœ€è¦ column name æ»¡è¶³ python å¯¹äºå˜é‡åå­—çš„è¦æ±‚ã€‚ä» DataFrame æ‹¿åˆ°çš„ Seriesï¼Œå°†ä¼šæ‹¥æœ‰å’Œ DataFrame ä¸€æ ·çš„ indexï¼Œå®ƒçš„ name å±æ€§ä¹Ÿå·²ç»è¢«è‡ªåŠ¨è®¾å®šã€‚</p><p>DaFrame ä¸­çš„è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½ç½®å’Œåå­—è®¿é—®ï¼Œä¾‹å¦‚ loc æ–¹æ³•ï¼ˆä¹‹åä»‹ç»ï¼‰ã€‚</p><p>ç»™ Column èµ‹çš„å€¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ–è€… Series å¯¹è±¡ã€‚å¦‚æœæ˜¯æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦è¦ä¸ dataframe ä¸€è‡´ï¼›å¦‚æœæ˜¯ Seriesï¼Œå°†æŒ‰ç…§ index label èµ‹å€¼ç»™ DataFrame; ç»™ä¸å­˜åœ¨çš„ column èµ‹å€¼ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ column (åªå¯ä»¥é€šè¿‡ ['column'] çš„æ–¹å¼åˆ›å»º);</p><p>åˆ é™¤åˆ—ï¼Œé€šè¿‡ <code>del df['col']</code> æ“ä½œï¼Œä½†è¿™ç§å†™æ³•ä¸é¼“åŠ±ï¼Œå¯ä»¥é€šè¿‡ <code>df.drop(columns=['B', 'C'])</code>ã€‚</p><p>DataFrame çš„ column å’Œ index éƒ½å¯ä»¥æœ‰ name, <code>df.index.name = 'idx'</code>, <code>df.columns.name = 'col'</code>, df.values ä¼šè¿”å›ä¸€ä¸ª DataFrame çš„å€¼çš„äºŒç»´æ•°ç»„ã€‚</p><h1 id="essential-functionality">Essential Functionality</h1><h2 id="reindexing">Reindexing</h2><p>reindex æ˜¯ pandas é‡Œå®ç°æ•°æ®å¯¹é½çš„åŸºæœ¬æ–¹æ³•, æ²¿ç€æŒ‡å®šè½´ï¼Œè®©ç°æœ‰æ•°æ®åŒ¹é…ä¸€ç»„æ–°æ ‡ç­¾ï¼Œå¹¶é‡æ–°æ’åºã€‚</p><p>å¯ä»¥åœ¨æ— æ•°æ®ä½†æœ‰æ ‡ç­¾çš„ä½ç½®æ’å…¥ç¼ºå¤±å€¼ã€‚</p><p>ç¼–å†™æ³¨é‡æ€§èƒ½çš„ä»£ç æ—¶ï¼Œæœ€å¥½èŠ±äº›æ—¶é—´æ·±å…¥ç†è§£ reindexï¼šé¢„å¯¹é½æ•°æ®åï¼Œæ“ä½œä¼šæ›´å¿«ã€‚ä¸¤ä¸ªæœªå¯¹é½çš„ DataFrame ç›¸åŠ ï¼Œåå°æ“ä½œä¼šæ‰§è¡Œ reindexã€‚</p><p>æå–ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªå…·æœ‰ç›¸åŒæ ‡ç­¾çš„å¯¹è±¡ reindex è¯¥å¯¹è±¡çš„è½´ã€‚è¿™ç§æ“ä½œçš„è¯­æ³•è™½ç„¶ç®€å•ï¼Œä½†æœªå…æœ‰äº›å•°å—¦ã€‚è¿™æ—¶ï¼Œæœ€å¥½ç”¨ reindex_like() æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æ—¢æœ‰æ•ˆï¼Œåˆç®€å•çš„æ–¹å¼ã€‚</p><p>align() æ–¹æ³•æ˜¯å¯¹é½ä¸¤ä¸ªå¯¹è±¡æœ€å¿«çš„æ–¹å¼ï¼Œè¯¥æ–¹æ³•æ”¯æŒ join å‚æ•°,æ¯”å¦‚ä½ æƒ³è¦æ ¹æ® df2çš„åˆ—çš„é¡ºåºæ’åº df1 çš„åˆ—é¡ºåº <code>df1.align(df2, join='left'), axis=1</code>ã€‚</p><p>å¯ä»¥ç›´æ¥è°ƒç”¨ Series <code>s.rename(str.upper)</code> æ¥æ“ä½œ index ä¸Šçš„ string æ ¼å¼; ä¹Ÿå¯ä»¥æ“ä½œ df çš„ index å’Œ columns, <code>df.rename(&#123;'one': 'foo', 'two': 'bar'&#125;, axis='columns')</code>ã€‚</p><p>reindexï¼Œffill ä¸ bfillï¼Œåœ¨ reindex æ—¶å€™äº§ç”Ÿçš„å€¼ç”¨å‰ã€åçš„å€¼å»å–ä»£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">219</span>]: rng = pd.date_range(<span class="string">&#x27;1/3/2000&#x27;</span>, periods=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">220</span>]: ts = pd.Series(np.random.randn(<span class="number">8</span>), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">221</span>]: ts2 = ts[[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">In [<span class="number">222</span>]: ts</span><br><span class="line">Out[<span class="number">222</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.400528</span></span><br><span class="line"><span class="number">2000</span>-01-05   -<span class="number">0.015083</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">1.414806</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.118428</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>   -<span class="number">0.936077</span></span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">223</span>]: ts2</span><br><span class="line">Out[<span class="number">223</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">224</span>]: ts2.reindex(ts.index)</span><br><span class="line">Out[<span class="number">224</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04         NaN</span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07         NaN</span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>         NaN</span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">225</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line">Out[<span class="number">225</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">226</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;bfill&#x27;</span>)</span><br><span class="line">Out[<span class="number">226</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>         NaN</span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">227</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;nearest&#x27;</span>)</span><br><span class="line">Out[<span class="number">227</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åšæ³•äº¦å¯é€šè¿‡ <code>ts2.reindex(ts.index).fillna(method='ffill')</code> å®ç°, å¦‚æœç´¢å¼•ä¸æ˜¯æŒ‰é€’å¢æˆ–é€’å‡æ’åºï¼Œreindex() ä¼šè§¦å‘ ValueError é”™è¯¯ã€‚fillna() ä¸ interpolate() åˆ™ä¸æ£€æŸ¥ç´¢å¼•çš„æ’åºã€‚limit ä¸ tolerance å‚æ•°å¯ä»¥æ§åˆ¶ reindex çš„å¡«å……æ“ä½œã€‚limit é™å®šäº†è¿ç»­åŒ¹é…çš„æœ€å¤§æ•°é‡:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">229</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>, limit=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">229</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>tolerance é™å®šäº†ç´¢å¼•ä¸ç´¢å¼•å™¨å€¼ä¹‹é—´çš„æœ€å¤§è·ç¦»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">230</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>, tolerance=<span class="string">&#x27;1 day&#x27;</span>)</span><br><span class="line">Out[<span class="number">230</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><blockquote><p>ç´¢å¼•ä¸º DatetimeIndexã€TimedeltaIndex æˆ– PeriodIndex æ—¶ï¼Œtolerance ä¼šå°½å¯èƒ½å°†è¿™äº›ç´¢å¼•å¼ºåˆ¶è½¬æ¢ä¸º Timedeltaï¼Œè¿™é‡Œè¦æ±‚ç”¨æˆ·ç”¨æ°å½“çš„å­—ç¬¦ä¸²è®¾å®š tolerance å‚æ•°ã€‚</p></blockquote><h2 id="dropping-entries-from-an-axis">Dropping Entries from an Axis</h2><p>å¦‚æœæœ‰äº† indexï¼Œå¯ä»¥ç›´æ¥ index åå­—åˆ é™¤æŸè¡Œ <code>new_obj = obj.drop('c')</code>, æˆ–è€…åŒæ—¶åˆ é™¤å¤šè¡Œ <code>data.drop(['Colorado', 'Ohio'])</code>,<code>axis=1</code> åˆ é™¤åˆ—ï¼Œ0 åˆ é™¤è¡Œã€‚</p><h1 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h1><h2 id="indexing-value">Indexing value</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ä¸­æ‹¬å·</span></span><br><span class="line">df[<span class="string">&quot;eggs&quot;</span>][<span class="string">&#x27;May&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åˆ—å</span></span><br><span class="line">df.eggs[<span class="string">&#x27;May&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ loc</span></span><br><span class="line">df.loc[<span class="string">&#x27;May&#x27;</span>, <span class="string">&#x27;eggs&#x27;</span>]</span><br><span class="line">df.loc[<span class="string">&#x27;May&#x27;</span>][<span class="string">&#x27;eggs&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ iloc</span></span><br><span class="line">df.iloc[<span class="number">4</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure><h2 id="slicing-dataframes">Slicing DataFrames</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eggs åˆ—ä¸­çš„æŸäº›å€¼</span></span><br><span class="line">df[<span class="string">&#x27;eggs&#x27;</span>][<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># eggs åˆ—ä¸­çš„æŸä¸ªå€¼</span></span><br><span class="line">df[<span class="string">&#x27;eggs&#x27;</span>][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸäº›åˆ—ä¸­çš„æ‰€æœ‰è¡Œ</span></span><br><span class="line">df.loc[:, <span class="string">&#x27;eggs&#x27;</span>:<span class="string">&#x27;salt&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸäº›è¡Œä¸­æ‰€æœ‰åˆ—</span></span><br><span class="line">df.loc[<span class="string">&#x27;Jan&#x27;</span>:<span class="string">&#x27;Feb&#x27;</span>, :]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸäº›è¡Œä¸­æŸäº›åˆ—</span></span><br><span class="line">df.loc[<span class="string">&#x27;Jan&#x27;</span>:<span class="string">&#x27;Mar&#x27;</span>, <span class="string">&#x27;eggs&#x27;</span>:<span class="string">&#x27;salt&#x27;</span>]</span><br><span class="line">df.loc[<span class="string">&#x27;Jan&#x27;</span>:<span class="string">&#x27;Mar&#x27;</span>, [<span class="string">&#x27;eggs&#x27;</span>, <span class="string">&#x27;salt&#x27;</span>]]  <span class="comment"># ä½¿ç”¨åˆ—è¡¨åˆ é€‰è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ iloc é€‰æ‹©</span></span><br><span class="line">df.iloc[<span class="number">2</span>:<span class="number">5</span>, <span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># df[&#x27;eggs&#x27;]  -&gt; pandas.core.series.Series</span></span><br><span class="line"><span class="comment"># df[[&#x27;eggs]] -&gt; pandas.core.frame.DataFrame</span></span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="filtering">Filtering</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df.loc[:, df.<span class="built_in">all</span>()]           <span class="comment"># æ‰€æœ‰é0å€¼</span></span><br><span class="line">df.loc[:, df.<span class="built_in">any</span>()]           <span class="comment"># 0å€¼è¡Œ</span></span><br><span class="line">df.loc[:, df.isnull().<span class="built_in">any</span>()]  <span class="comment"># ä»»ä½• na è¡Œ</span></span><br><span class="line">df.loc[:, df.notnull().<span class="built_in">any</span>()] <span class="comment"># ä»»ä½• na è¡Œ</span></span><br><span class="line">df.dropna(how=<span class="string">&#x27;any&#x27;</span>)</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="understand-dataframe-index">Understand Dataframe index</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º Series</span></span><br><span class="line">prices = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1.5</span>, <span class="number">4</span>, <span class="number">4.5</span>]</span><br><span class="line">shares = pd.Series(prices)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºSeriesï¼Œä»æ•°ç»„æŒ‡å®šç´¢å¼•å€¼</span></span><br><span class="line">days = [<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thur&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>]</span><br><span class="line">shares = pd.Series(prices, index=days)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä½¿ç”¨ä¸‹æ ‡è®¿é—®ç´¢å¼•å€¼ï¼Œä¹Ÿå¯ä»¥åˆ‡ç‰‡</span></span><br><span class="line">shares.index[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™ç´¢å¼•èµ·å</span></span><br><span class="line">shares.name = <span class="string">&quot;Share&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™ç´¢å¼•èµ‹å€¼ä¼šå‡ºé”™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šé‡ç´¢å¼•è®¿é—®ç´¢å¼•å</span></span><br><span class="line"><span class="comment"># df.index.name  -&gt; None</span></span><br><span class="line"><span class="comment"># df.index.names -&gt; [&#x27;a&#x27;, &#x27;b&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç´¢å¼•æ’åº</span></span><br><span class="line">df.sort_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç´¢å¼•çš„é¡ºåºè¿›è¡Œæ’åº</span></span><br><span class="line">df.reindex([<span class="string">&#x27;Jan&#x27;</span>, <span class="string">&#x27;Apr&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç…§å¦å¤–ä¸€ä¸ªdataframe index çš„é¡ºåºæ’åº</span></span><br><span class="line">df2 = pd.DataFrame()</span><br><span class="line">df.reindex(df2.index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šé‡ç´¢å¼•é€‰æ‹©ï¼Œä½¿ç”¨å…ƒç»„</span></span><br><span class="line">df.loc[(<span class="string">&#x27;idx1&#x27;</span>,<span class="string">&#x27;idx2&#x27;</span>), <span class="string">&#x27;col_name&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªé€‰æ‹©å•ä¸ªç´¢å¼•ï¼Œä¼šè¿”å›è¯¥ç´¢å¼•å†…éƒ¨å¾—å€¼ï¼ˆåŒ…æ‹¬å­ç´¢å¼•ï¼‰</span></span><br><span class="line">df.loc[<span class="string">&#x27;idx1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ slice å‡½æ•°ï¼Œå¯¹ç¬¬ä¸€å±‚ä¸è®¾æ¡ä»¶ï¼Œè¿”å›ç¬¬äºŒå±‚ ab ç»“æœ</span></span><br><span class="line">df.loc[<span class="built_in">slice</span>(<span class="literal">None</span>), <span class="built_in">slice</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)]</span><br></pre></td></tr></table></figure><h2 id="manipulating">Manipulating</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.eggs[df.salt &gt; <span class="number">55</span>] += <span class="number">5</span>   <span class="comment"># åŠ </span></span><br><span class="line">df.floordiv(<span class="number">12</span>)              <span class="comment"># ç±»ä¼¼ dataframe // otherï¼Œæ”¯æŒfill_value</span></span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="melt">Melt</h3><ul><li>Meltï¼šé€‚ç”¨äºåˆ—ä¸­å­˜åœ¨å€¼ï¼Œéœ€è¦æ•´ç†åˆ°è¡Œä¸­çš„æƒ…å†µ</li><li>Pivoting: ä¸Melt ç›¸åï¼Œå°†1åˆ—ä¸­å”¯ä¸€çš„å€¼æ”¾åˆ°ä¸åŒçš„åˆ—ä¸Š</li></ul><h3 id="pivot">Pivot</h3><ul><li>Pivot æ ¹æ®åˆ—å€¼ Reshape æ•°æ®ï¼Œæœ‰é‡å¤å€¼ä¼šå‡ºé”™</li><li>PivotTable æ ¹æ®åˆ—å€¼ Reshape æ•°æ®ï¼Œæœ‰é‡å¤å€¼å¯æŒ‡å®š aggregate å‡½æ•°(sum, count, etc.)</li><li>éƒ½å¯ä»¥æŒ‡å®šå¤šä¸ª index æˆ–è€… columns</li></ul><h3 id="stack-å’Œ-unstack">Stack å’Œ Unstack</h3><ul><li>UnStack å°†è¡Œä¸Šçš„å¤š index ä¸­çš„æŸä¸€ä¸ªæ”¾åˆ° column ä¸Šï¼Œéœ€è¦æŒ‡å®šå‚æ•° level= '' ï¼Œå³index ä¸­çš„æŸä¸ªå€¼ï¼›ä¼ ç»™ level çš„ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—æ¯”å¦‚ 0,1 ç­‰ï¼Œå–å†³äº index çš„å±‚æ•°</li><li>Stack å°† column ä¸Šçš„ index æ”¾åˆ°è¡Œä¸Š</li><li>å¤šç´¢å¼•ä¸­ï¼Œå¯ä½¿ç”¨ swaplevel æ–¹å¼äº¤æ¢ä¸¤ä¸ªç´¢å¼•çš„é¡ºåº</li></ul><h3 id="group-by">Group by</h3><p>Groupby ä¸€èˆ¬æœ‰å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>æ ¹æ®æŸäº›åˆ—æŒ‰å…¶å€¼åˆ†å‰²æˆä¸åŒçš„ç»„</li><li>å¯¹æ¯ä¸ªç»„ï¼ŒæŒ‡å®šå†…éƒ¨çš„æŸäº›åˆ—è¿›è¡Œæ“ä½œ</li><li>å°†è¿™äº›æ“ä½œåçš„ç»“æœç»„åˆèµ·æ¥</li></ul><p>Groupby æœ‰ä¸€äº›ç‰¹æ®Šæ“ä½œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªåˆ†å‰²ç»„çš„æ“ä½œï¼Œå¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„ Series, ä¸é™å®šäºåˆ—å</li><li>groupby çš„æ—¶å€™ï¼Œä½¿ç”¨ category ç±»å‹çš„æ•°æ®ä¼šåŠ å¿«é€Ÿåº¦</li><li>ç»„åˆç»„å†…éƒ¨çš„æ“ä½œï¼Œä¸€èˆ¬ä½¿ç”¨ mean, sum, max ç­‰ï¼Œä½†ä¹Ÿå¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šä¸ªå‡½æ•°ï¼Œå¦‚ <code>df.groupby(['a','b']).agg('a':'sum')</code>, ä¹Ÿå¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„å‡½æ•°</li></ul><p>Groupby å¯ä»¥å’Œ transformation ç»“åˆä½¿ç”¨ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zscore</span>(<span class="params">series</span>):</span></span><br><span class="line">    <span class="string">&quot;å¯¹ Series ä¸­çš„å€¼ï¼Œæ¯ä¸€ä¸ªéƒ½å‡å»å…¶å¹³å‡å€¼ï¼Œå†é™¤ä»¥æ ‡å‡†å·®&quot;</span></span><br><span class="line">   <span class="keyword">return</span> (series - series.mean()) / series.std()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥ä¼ å…¥ dataframe çš„æŸåˆ—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zscore(df[<span class="string">&#x27;mpg&#x27;</span>]).head()</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¥ group å»ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(<span class="string">&#x27;yr&#x27;</span>)[<span class="string">&#x27;mpg&#x27;</span>].transform(zscore).head()</span><br></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥çš„ï¼Œå¯ä»¥æŠŠä¸€äº›æ“ä½œç»„åˆèµ·æ¥æ”¾åˆ°ä¸€ä¸ªå‡½æ•°:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zscore_with_year_and_name</span>(<span class="params">group</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;é’ˆå¯¹æ¯ä¸€ä¸ª groupï¼Œåªå–å…¶ä¸­çš„æŸäº›åˆ—ï¼ˆmpg, year, nameï¼‰åšä¸€äº›æ“ä½œå¹¶ç»„åˆæˆæ–°çš„ dataframe</span></span><br><span class="line"><span class="string">       å¯¹äºæ“ä½œï¼šmpgï¼Œç®— zscore; yr é‡å‘½åä¸º year; name ä¸æ“ä½œ.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    df = pd.DataFrame(&#123;</span><br><span class="line">            <span class="string">&#x27;mpg&#x27;</span>: zscore(group[<span class="string">&#x27;mpg&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;year&#x27;</span>: group[<span class="string">&#x27;yr&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: group[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">&#x27;yr&#x27;</span>).apply(zscore_with_year_and_name).head()</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶å€™ä½ åˆ†ç»„æ“ä½œåï¼Œéœ€è¦å†è¿›è¡Œ filter æ“ä½œï¼Œè¿™éœ€è¦æ‹¿åˆ° groupby ä¹‹åçš„å¯¹è±¡è¿›è¡Œéå†æ“ä½œã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ groupby æ“ä½œåå¾—åˆ°çš„å¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">splitting = auto.groupby(<span class="string">&#x27;yr&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span>(splitting)</span><br><span class="line"><span class="comment"># pandas.core.groupby.DataFrameGroupBy</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span>(splitting.groups)</span><br><span class="line"><span class="comment"># dict</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(splitting.groups.keys())</span><br><span class="line"><span class="comment"># dict_keys([70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82])</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥å¯¹ group å¯¹è±¡è¿›è¡Œéå†:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> groupname, group <span class="keyword">in</span> splitting:</span><br><span class="line">   avg = group[<span class="string">&#x27;mpg&#x27;</span>].mean()</span><br><span class="line">   <span class="built_in">print</span>(group_name, avg)</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€ä¸ª group å¯¹è±¡ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹å…¶ä½¿ç”¨ loc æ“ä½œï¼Œæ‰€ä»¥åœ¨å†…éƒ¨æˆ‘ä»¬å¯ä»¥è¿›è¡Œ filter:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹ group filterï¼Œåªæ‰¾å‡º name åŒ…å« chevrolet çš„ç»„ï¼Œå–å‡ºå…¶ mpg åˆ—æ±‚ mean</span></span><br><span class="line"><span class="comment"># è¿”å›çš„æ˜¯å•ä¸ªå€¼</span></span><br><span class="line">group.loc[group[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;chevrolet&#x27;</span>), <span class="string">&#x27;mpg&#x27;</span>].mean()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»“åˆæ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ª Series</span></span><br><span class="line">chevy_means = &#123;</span><br><span class="line">    year: group.loc[group[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;chevrolet&#x27;</span>),<span class="string">&#x27;mpg&#x27;</span>].mean()</span><br><span class="line">    <span class="keyword">for</span> year, group <span class="keyword">in</span> splitting</span><br><span class="line">&#125;</span><br><span class="line">pd.Series(chevy_means)</span><br></pre></td></tr></table></figure><p>ä¸€ç»„æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥å½“ä½œ groupby çš„åˆ—ï¼Œå¦‚:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chevy ä¸€ç»„ True, Falseï¼Œå…¶å€¼åæ˜ äº†df nameåˆ—ä¸­åŒ…å« chevrolet çš„è¡Œ</span></span><br><span class="line">chevy = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;chevrolet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† chevy ä½œä¸º groupby æ¡ä»¶</span></span><br><span class="line">df.groupby([<span class="string">&#x27;yr&#x27;</span>, chevy])[<span class="string">&#x27;mpg&#x27;</span>].mean()</span><br></pre></td></tr></table></figure><h3 id="concat">Concat</h3><ul><li>Concat æ—¶å¯ä»¥æŒ‡å®š indexï¼Œå¦‚ <code>pd.concat([rain2013, rain2014], keys=[2013, 2014], axis=0)</code>ï¼Œå¦‚æœä¸¤ä¸ª df æœ¬æ¥å°±æœ‰ indexï¼Œåˆ™ä¼šäº§ç”Ÿå¤š index</li><li>index ä¹Ÿå¯ä»¥åœ¨ column ä¸Šï¼Œå¦‚ <code>pd.concat([rain2013, rain2014], keys=[2013, 2014], axis='columns')</code></li><li>å¯ä»¥å°†ä¸¤ä¸ªæ•°ç»„å·¦å³æ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå¯ä»¥ä½¿ç”¨ <code>np.hstack([B, A])</code> æˆ–è€… <code>np.concatenate([B, A], axis=1)</code></li></ul><h3 id="merge">Merge</h3><ul><li>merge æ—¶ï¼ŒæŒ‡å®š suffixis å‚æ•°æ¥åŒºåˆ†æ¥è‡ªä¸åŒ dataframe çš„åˆ—</li><li>å¯¹äºç‰¹æ®Šçš„ mergeï¼Œå¯ä»¥äº†è§£ <code>pandas.merge_asof</code> å’Œ <code>pandas.merge_ordered</code> æ–¹æ³•</li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»‹ç»äº† Pandas ä¸­çš„ Indexï¼ŒSeries, Dataframe åŠå…¶åŸºæœ¬æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Pandas ç³»åˆ—" scheme="https://scottzhang.pro/categories/Pandas-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Pandas" scheme="https://scottzhang.pro/tags/Pandas/"/>
    
  </entry>
  
  <entry>
    <title>Pandas æ•°æ®å¯¼å…¥</title>
    <link href="https://scottzhang.pro/article/973c6fd9.html"/>
    <id>https://scottzhang.pro/article/973c6fd9.html</id>
    <published>2022-05-17T01:56:08.000Z</published>
    <updated>2022-05-17T01:58:46.247Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€äº›å¸¸ç”¨æ•°æ®å¯¼å…¥çš„ä»£ç ç¤ºä¾‹ä¸æŠ€å·§ã€‚</p></blockquote><span id="more"></span><h3 id="ä»ç½‘ç»œ">ä»ç½‘ç»œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlretrieve</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import pandas</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign url of file: url</span></span><br><span class="line">url = <span class="string">&#x27;https://you_url/you_file.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Save file locally</span></span><br><span class="line">urlretrieve(url,<span class="string">&#x27;you_file.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read file into a DataFrame and print its head</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;you_file.csv&#x27;</span>, sep=<span class="string">&#x27;;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br></pre></td></tr></table></figure><h3 id="ç›´æ¥ç”¨pdè¯»å–">ç›´æ¥ç”¨PDè¯»å–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import packages</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign url of file: url</span></span><br><span class="line">url = <span class="string">&#x27;https://s3.amazonaws.com/assets.datacamp.com/production/course_1606/datasets/winequality-red.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read file into a DataFrame: df</span></span><br><span class="line">df = pd.read_csv(url,sep=<span class="string">&#x27;;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the head of the DataFrame</span></span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot first column of df</span></span><br><span class="line">pd.DataFrame.hist(df.ix[:, <span class="number">0</span>:<span class="number">1</span>])</span><br><span class="line">plt.xlabel(<span class="string">&#x27;fixed acidity (g(tartaric acid)/dm$^3$)&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;count&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œè¯»å–excelæ–‡ä»¶">ç½‘ç»œè¯»å–excelæ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign url of file: url</span></span><br><span class="line">url = <span class="string">&#x27;http://s3.amazonaws.com/assets.datacamp.com/course/importing_data_into_r/latitude.xls&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read in all sheets of Excel file: xl</span></span><br><span class="line">xl = pd.read_excel(url,sheetname = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the sheetnames to the shell</span></span><br><span class="line"><span class="built_in">print</span>(xl.keys())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the head of the first sheet (using its name, NOT its index)</span></span><br><span class="line"><span class="built_in">print</span>(xl[<span class="string">&#x27;1700&#x27;</span>].head())</span><br></pre></td></tr></table></figure><h3 id="ä»-jsonæ–‡ä»¶">ä» Jsonæ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load JSON: json_data</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a_movie.json&quot;</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    json_data = json.load(json_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print each key-value pair in json_data</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> json_data.keys():</span><br><span class="line">    <span class="built_in">print</span>(k + <span class="string">&#x27;: &#x27;</span>, json_data[k])</span><br></pre></td></tr></table></figure><h3 id="ä»-api-è¯·æ±‚-json">ä» api è¯·æ±‚ json</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign URL to variable: url</span></span><br><span class="line">url = <span class="string">&#x27;http://www.omdbapi.com/?apikey=72bc447a&amp;t=social+network&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Package the request, send the request and catch the response: r</span></span><br><span class="line">r = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode the JSON data into a dictionary: json_data</span></span><br><span class="line">json_data = r.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print each key-value pair in json_data</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> json_data.keys():</span><br><span class="line">    <span class="built_in">print</span>(k + <span class="string">&#x27;: &#x27;</span>, json_data[k])</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä»-api-å¦‚ç»´åŸºç™¾ç§‘">ä» API å¦‚:ç»´åŸºç™¾ç§‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign URL to variable: url</span></span><br><span class="line">url = <span class="string">&#x27;https://en.wikipedia.org/w/api.php?action=query&amp;prop=extracts&amp;format=json&amp;exintro=&amp;titles=pizza&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Package the request, send the request and catch the response: r</span></span><br><span class="line">r = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode the JSON data into a dictionary: json_data</span></span><br><span class="line">json_data = r.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the Wikipedia page extract</span></span><br><span class="line">pizza_extract = json_data[<span class="string">&#x27;query&#x27;</span>][<span class="string">&#x27;pages&#x27;</span>][<span class="string">&#x27;24768&#x27;</span>][<span class="string">&#x27;extract&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(pizza_extract)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä»-api-å¦‚-æ¨ç‰¹">ä» API å¦‚: æ¨ç‰¹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">import</span> tweepy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Store OAuth authentication credentials in relevant variables</span></span><br><span class="line">access_token = <span class="string">&quot;&quot;</span></span><br><span class="line">access_token_secret = <span class="string">&quot;&quot;</span></span><br><span class="line">consumer_key = <span class="string">&quot;&quot;</span></span><br><span class="line">consumer_secret = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pass OAuth details to tweepy&#x27;s OAuth handler</span></span><br><span class="line">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)</span><br><span class="line">auth.set_access_token(access_token,access_token_secret)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶å¯¼å…¥">æ¡ä»¶å¯¼å…¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·³è¿‡ç¬¬ä¸€è¡Œï¼Œè‡³éœ€è¦ç¬¬ä¸€å’Œç¬¬ä¸‰åˆ—</span></span><br><span class="line">data = np.loadtxt(file, delimiter=<span class="string">&#x27;\t&#x27;</span>, skiprows=<span class="number">1</span>, usecols=[<span class="number">0</span>,<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># delimiteråˆ†éš”ç¬¦</span></span><br><span class="line">data = np.genfromtxt(<span class="string">&#x27;titanic.csv&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>, names=<span class="literal">True</span>, dtype=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># nrowsï¼Œåªéœ€è¦å‰é¢5è¡Œï¼Œheaderåªå¯ä»¥ç­‰äºNoneï¼Œè€Œä¸æ˜¯Bool</span></span><br><span class="line">pd.read_csv(file,nrows=<span class="number">5</span>, header=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h3 id="è·å–æ–‡ä»¶åˆ—è¡¨">è·å–æ–‡ä»¶åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">wd = os.getcwd()</span><br><span class="line">os.listdir(wd)</span><br></pre></td></tr></table></figure><h3 id="ä»-excel">ä» excel</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import pandas</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign spreadsheet filename: file</span></span><br><span class="line">file = <span class="string">&#x27;battledeath.xlsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load spreadsheet: xl</span></span><br><span class="line">xl = pd.ExcelFile(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print sheet names</span></span><br><span class="line"><span class="built_in">print</span>(xl.sheet_names)</span><br></pre></td></tr></table></figure><h3 id="ä»-sas-æ–‡ä»¶">ä» SAS æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">From sas7bdat <span class="keyword">import</span> SAS7BDAT</span><br><span class="line"></span><br><span class="line">Data = pd.read_stata(<span class="string">&#x27;urbanpop.dta&#x27;</span>)</span><br><span class="line"><span class="comment"># sasæ–‡ä»¶å˜æˆdataframe</span></span><br><span class="line"><span class="keyword">with</span> SAS7BDAT(<span class="string">&#x27;sales.sas7bdat&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    df_sas = file.to_data_frame()</span><br></pre></td></tr></table></figure><h3 id="ä»-matæ–‡ä»¶">ä» matæ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import package</span></span><br><span class="line"><span class="keyword">import</span> scipy.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load MATLAB file: mat</span></span><br><span class="line">mat = scipy.io.loadmat(<span class="string">&#x27;albeck_gene_expression.mat&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the datatype type of mat</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(mat))</span><br></pre></td></tr></table></figure><h3 id="ä»æ•°æ®åº“">ä»æ•°æ®åº“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import packages</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create engine: engine</span></span><br><span class="line">engine = create_engine(<span class="string">&#x27;sqlite:///Chinook.sqlite&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Open engine connection: con</span></span><br><span class="line">con = engine.connect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Perform query: rs</span></span><br><span class="line">rs = con.execute(<span class="string">&#x27;select * from Album&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save results of the query to DataFrame: df</span></span><br><span class="line">df = pd.DataFrame(rs.fetchall())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Close connection</span></span><br><span class="line">con.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print head of DataFrame df</span></span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br><span class="line">ä»DBå¯¼å…¥æŒ‡å®šæ¡æ•°æ®ï¼Œé‡å‘½ååˆ—å:</span><br><span class="line"><span class="keyword">with</span> engine.connect() <span class="keyword">as</span> con:</span><br><span class="line">    rs = con.execute(<span class="string">&#x27;SELECT LastName, Title FROM Employee&#x27;</span>)</span><br><span class="line">    df = pd.DataFrame(rs.fetchmany(size=<span class="number">3</span>))</span><br><span class="line">    df.columns = rs.keys()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the length of the DataFrame df</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(df))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the head of the DataFrame df</span></span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æé«˜æ•°æ®å¯¼å…¥é€Ÿåº¦">æé«˜æ•°æ®å¯¼å…¥é€Ÿåº¦</h3><ul><li><a href="https://www.kaggle.com/c/home-credit-default-risk/discussion/59575">Faster data loading with Pandas</a></li><li><a href="https://medium.com/@bobhaffner/gist-to-medium-test-db3d51b8ba7b">DataFrame IO Performance with Pandas, dask, fastparquet and HDF5</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸€äº›å¸¸ç”¨æ•°æ®å¯¼å…¥çš„ä»£ç ç¤ºä¾‹ä¸æŠ€å·§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Pandas ç³»åˆ—" scheme="https://scottzhang.pro/categories/Pandas-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Pandas" scheme="https://scottzhang.pro/tags/Pandas/"/>
    
  </entry>
  
  <entry>
    <title>Pandas å®‰è£…</title>
    <link href="https://scottzhang.pro/article/6f1b3942.html"/>
    <id>https://scottzhang.pro/article/6f1b3942.html</id>
    <published>2022-05-17T00:07:25.000Z</published>
    <updated>2022-05-17T03:45:13.580Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ å®‰è£… Python ç¯å¢ƒä»¥ä½¿ç”¨ Pandasã€‚</p></blockquote><span id="more"></span><h1 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h1><h2 id="æ£€æŸ¥æ˜¯å¦å·²å®‰è£…-python">æ£€æŸ¥æ˜¯å¦å·²å®‰è£… Python</h2><p>æ£€æŸ¥ä½ çš„ Python ç‰ˆæœ¬:</p><ul><li><code>python --version</code></li><li><code>python -V</code></li></ul><p>æ£€æŸ¥ä½ çš„ Python å®‰è£…è·¯å¾„(ç”¨æˆ·):</p><ul><li><code>where.exe python</code></li></ul><p>å°æŠ€å·§: æ‰“å¼€ä½ çš„ PowerShell:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. æ•²å‡»ç”µè„‘ä¸Šçš„ Win é”®.</span><br><span class="line">2. é”®å…¥ PowerShell.</span><br><span class="line">3. æ•²å‡»å›è½¦ (Enter)é”®.</span><br></pre></td></tr></table></figure><blockquote><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ cmd.exe æˆ–è€…æ˜¯ <a href="https://www.microsoft.com/en-us/p/windows-terminal/9n0dx20hk701?activetab=pivot:overviewtab">Windows Terminal</a>.</p></blockquote><h2 id="windows-å®‰è£…-python-çš„å‡ ç§æ–¹å¼">Windows å®‰è£… Python çš„å‡ ç§æ–¹å¼</h2><ul><li>å¾®è½¯å®˜æ–¹å•†åº—, å¾®è½¯å…¬å¸æä¾›çš„,ä¸»è¦é¢å‘å­¦ç”Ÿä¸ python åˆå­¦è€…, å…¬å¸ç¯å¢ƒä¸‹æ— æ³•ä»å¾®è½¯å•†åº—ä¸‹è½½è½¯ä»¶.</li><li>Windows Subsystem for Linux (WSL), è®©ä½ åœ¨ Windows ä¸Šå¯ä»¥ç›´æ¥è¿è¡Œ Linux, å…¬å¸ç¯å¢ƒä¸‹æ— æ³•é…ç½®</li><li>Python å®Œæ•´å®‰è£…åŒ…, æ¨è.(<a href="https://www.python.org/downloads/windows/">ä¸‹è½½åœ°å€</a>)</li><li>Anaconda, ä¸€ä¸ªå¼€æºçš„Pythonå‘è¡Œç‰ˆæœ¬ï¼Œå…¶åŒ…å«äº†condaã€Pythonç­‰180å¤šä¸ªç§‘å­¦åŒ…åŠå…¶ä¾èµ–é¡¹, æ¨è.</li></ul><p>æ¨èä½¿ç”¨ Anaconda.</p><h2 id="å¦‚ä½•å®‰è£…-anaconda">å¦‚ä½•å®‰è£… Anaconda</h2><ol type="1"><li>æ‰“å¼€å®‰è£…åŒ…</li></ol><p><img src="https://docs.anaconda.com/_images/win-install-destination.png" /></p><ol start="2" type="1"><li>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</li></ol><p><img src="https://docs.anaconda.com/_images/win-install-options.png" /></p><p>å…³äºå®‰è£…é€‰é¡¹:</p><ul><li>add Anaconda3 to my PATH environment variable, ä¼šå½±å“å…¶ä»–ä¾èµ– python çš„è½¯ä»¶,æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©</li><li>Register Anaconda3 as my default Python x, æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©</li></ul><p>å…³äºå®‰è£…ç‰ˆæœ¬, 32 è¿˜æ˜¯ 64? è¿™å–å†³äºä½ æœºå™¨çš„å¤„ç†å™¨çš„é…ç½®, è®°ä½64ä½æœºå™¨å¯ä»¥å¤„ç†32ä½ç¨‹åº,åä¹‹åˆ™ä¸è¡Œ.</p><p>Anaconda <a href="https://docs.anaconda.com/anaconda/install/windows/">Windows å®˜æ–¹å®‰è£…æŒ‡å—</a></p><h2 id="å¦‚ä½•ç®¡ç†-python-è¿è¡Œç¯å¢ƒ">å¦‚ä½•ç®¡ç† Python è¿è¡Œç¯å¢ƒ</h2><h3 id="ä¸ºä»€ä¹ˆè¦ç®¡ç†ç¯å¢ƒ">ä¸ºä»€ä¹ˆè¦ç®¡ç†ç¯å¢ƒ</h3><ul><li>åœºæ™¯ 1: ä½ çš„åŒäº‹ç»™ä½ ä¸€ä»½ä»£ç , Ta åŸºäº Python 3.6 å†™çš„, Pandas 1.0.1 ç‰ˆæœ¬, ä½ çš„ç‰ˆæœ¬è¿‡ä½æˆ–è€…è¿‡é«˜å¯¼è‡´æ— æ³•è¿è¡Œ</li><li>åœºæ™¯2: ä½ çœ‹åˆ°ä¸€ä¸ªä¸é”™çš„ Python åŒ…, ä½†æ˜¯å®‰è£…å®ƒä¼šè®²ä½ ç›®å‰çš„ Pandas é™çº§, ä½†æ˜¯é™çº§åˆä¼šå½±å“ä½ å¹³æ—¶çš„å·¥ä½œç¯å¢ƒ</li><li>åœºæ™¯3: ä½ éœ€è¦éƒ¨ç½²ä½ çš„å·¥å…·,ä½ æƒ³åˆ›å»ºä¸€ä¸ªå®Œå…¨å¹²å‡€çš„ç¯å¢ƒæ¥æµ‹è¯•éƒ¨ç½²æµç¨‹, æµ‹è¯•ç¨‹åºä¾èµ–çš„åŒ…æ˜¯å¦å¯ä»¥å·¥ä½œ</li></ul><h3 id="ç®¡ç†ç¯å¢ƒçš„å·¥å…·">ç®¡ç†ç¯å¢ƒçš„å·¥å…·</h3><table><colgroup><col style="width: 20%" /><col style="width: 20%" /><col style="width: 20%" /><col style="width: 20%" /><col style="width: 20%" /></colgroup><thead><tr class="header"><th></th><th>Python Version</th><th>Dependency Management</th><th>Virtual Environment</th><th>Environment Reproducibility</th></tr></thead><tbody><tr class="odd"><td>pyenv</td><td>âœ…</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr><tr class="even"><td>venv + pip</td><td>âŒ</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr><tr class="odd"><td>venv + pip-tools</td><td>âŒ</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr class="even"><td>Poetry</td><td>âŒ</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr class="odd"><td>Pipenv</td><td>âŒ</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr class="even"><td>Docker</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr class="odd"><td>Conda</td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr></tbody></table><h3 id="ä½¿ç”¨-conda">ä½¿ç”¨ Conda</h3><p>å¯¹äºå¼€å‘è€…æ¥è¯´, ç”µè„‘ä¸Šæœ‰æ—¶å€™éœ€è¦æœ‰å¤šä¸ª python ç¯å¢ƒ, å¯ä»¥ä½¿ç”¨ Conda è¿›è¡Œæ¥ç®¡ç† Python çš„ç¯å¢ƒä¸åŒ…, Conda å¯ä»¥å¸®ä½ åˆ›å»ºã€å¤åˆ¶ã€å…‹éš†ã€ç®¡ç†ä¸€ä¸ªå…¨æ–°éš”ç¦»çš„ç¯å¢ƒ, åŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥å®‰è£…åŒ…, å®ƒæ—¢å…·æœ‰pipçš„åŒ…ç®¡ç†èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰vitualenvçš„ç¯å¢ƒç®¡ç†åŠŸèƒ½ ï¼Œå› æ­¤åœ¨åŠŸèƒ½ä¸ŠCondaå¯ä»¥çœ‹ä½œæ˜¯pip å’Œ vitualenv çš„ç»„åˆã€‚</p><p>å‚è€ƒ <a href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf">Conda CheatSheet</a></p><h2 id="å¦‚ä½•å®‰è£…-python-åŒ…">å¦‚ä½•å®‰è£… Python åŒ…</h2><h3 id="python-è£…åŒ…çš„é€‰æ‹©">Python è£…åŒ…çš„é€‰æ‹©</h3><ul><li>pip</li><li>conda</li><li>å…¶ä»–ç•¥è¿‡</li></ul><h3 id="åŒºåˆ«æ˜¯ä»€ä¹ˆ">åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h3><ul><li>åŒ…ä»“åº“ä¸åŒ, pip å¯ä»¥æ‰¾åˆ°, conda ä¸ä¸€å®šæœ‰</li><li>Pipå®‰è£…PythonåŒ…ï¼Œè€Œcondaå®‰è£…åŒ…å¯èƒ½åŒ…å«ç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„è½¯ä»¶çš„åŒ…</li><li>conda ä¼šå¸®ä½ è§£å†³åŒ…ä¹‹é—´çš„ä¾èµ–å†²çª</li><li>ä»ä½¿ç”¨è§’åº¦æ¥è¯´, conda æ¯”è¾ƒæ…¢ (å¯ä»¥è€ƒè™‘ <a href="https://mamba.readthedocs.io/en/latest/">Mamba</a>, ä¸€ä¸ªæ—¨åœ¨æ›¿ä»£ Conda çš„å·¥å…·)</li></ul><h3 id="ä½¿ç”¨-conda-1">ä½¿ç”¨ Conda</h3><ul><li>æœç´¢åŒ…: <code>conda search PACKAGENAME</code></li><li>å®‰è£…åŒ…: <code>conda install PACKAGENAME</code></li><li>æ›´æ–°åŒ…: <code>conda update PACKAGENAME</code></li><li>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…: <code>conda list</code></li><li>å¸è½½åŒ…: <code>conda remove PACKAGENAME</code></li></ul><h3 id="ä½¿ç”¨-pip">ä½¿ç”¨ Pip</h3><ul><li>æœç´¢åŒ…: <code>pip search</code>, currently disabled</li><li>å®‰è£…åŒ…: <code>pip install PACKAGENAME</code></li><li>æ›´æ–°åŒ…: <code>pip install --upgrade PACKAGENAME</code></li><li>æŸ¥çœ‹å·²å®‰è£…åŒ…: <code>pip list</code></li><li>å¸è½½åŒ…: <code>pip uninstall PACKAGENAME</code></li></ul><h3 id="åœ¨-nielseniq-è£…åŒ…">åœ¨ NielsenIQ è£…åŒ…</h3><ul><li>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› , å›½å†…å¤–ç½‘ç»å¸¸æŠ½é£,è€Œ pip å’Œ conda ä¸‹è½½åŒ…é»˜è®¤éƒ½æ˜¯ä»å›½å¤–çš„æœåŠ¡å™¨ä¸‹è½½</li><li>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,å›½å†…æœ‰ä¸€äº›é«˜ç­‰é™¢æ ¡å’ŒçŸ¥åä¼ä¸šå…è´¹æ‰˜ç®¡äº†å¾ˆå¤šåŒ…èµ„æº,åªéœ€è¦å°†ä¸‹è½½æœåŠ¡å™¨æ›´æ”¹ä¸ºå›½å†…åœ°å€å³å¯åŠ é€ŸåŒ…çš„ä¸‹è½½</li><li>å¯ä»¥ä½¿ç”¨æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™æ¥åŠ é€Ÿ, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„é•œåƒç«™<ul><li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">pip</a></li><li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">anaconda</a></li></ul></li></ul><h2 id="åœ¨å“ªé‡Œç¼–å†™ä»£ç ">åœ¨å“ªé‡Œç¼–å†™ä»£ç ?</h2><h3 id="ides-è¿˜æ˜¯ä»£ç ç¼–è¾‘å™¨">IDEs è¿˜æ˜¯ä»£ç ç¼–è¾‘å™¨?</h3><p>IDE (or Integrated Development Environment) æ˜¯ä¸€ä¸ªä¸“æ³¨äºè½¯ä»¶å¼€å‘çš„ç¨‹åº, å®ƒé€šå¸¸åŒ…å«äº†è®¸å¤šè½¯ä»¶å¼€å‘çš„å·¥å…·é›†, ä¾‹å¦‚:</p><ul><li>å¤„ç†ä»£ç çš„ç¼–è¾‘å™¨(å¦‚é«˜äº®ä»£ç , è‡ªåŠ¨è¡¥å…¨)</li><li>ç¼–è¯‘ã€æ‰§è¡Œ, debug å·¥å…·</li><li>æˆ–æœ‰ç‰ˆæœ¬æ§åˆ¶çš„å·¥å…·</li><li>å¤§éƒ¨åˆ†IDEæ”¯æŒå¤šç§è¯­è¨€, æˆ–æ˜¯æ‹¥æœ‰æ›´å¤šçš„åŠŸèƒ½(ä¹Ÿæœ‰ä¸“é—¨ä¸ºæŸç§è¯­è¨€å¼€å‘çš„IDE, å¦‚é’ˆå¯¹ Golang çš„ Goland, Python çš„ Pycharm)</li></ul><p>ä»£ç ç¼–è¾‘å™¨æˆ–è€…è¯´æ–‡æœ¬ç¼–è¾‘å™¨, å¤§éƒ¨åˆ†éƒ½æœ‰ä»£ç é«˜äº®ã€æ ¼å¼åŒ–çš„åŠŸèƒ½, ä¸€äº›ä¼˜ç§€çš„ä»£ç ç¼–è¾‘å™¨è¿˜å¯ä»¥é€šè¿‡æ’ä»¶å®ç°ç‰ˆæœ¬æ§åˆ¶ã€å¤šç§è¯­è¨€çš„æ”¯æŒ.</p><h3 id="å¸¸ç”¨-ides-å’Œä»£ç ç¼–è¾‘å™¨">å¸¸ç”¨ IDEs å’Œä»£ç ç¼–è¾‘å™¨</h3><p>IDEs: - Visual Studio, å¾®è½¯å¼€å‘çš„ IDEs, ç‰¹æ€§ä¸°å¯Œ - Eclipse + PyDev, çŸ¥å java ç¼–è¾‘å™¨ Eclipse é’ˆå¯¹ Python å‡ºçš„ç‰ˆæœ¬</p><p>ä»£ç ç¼–è¾‘å™¨: - Sublime Text, Google å·¥ç¨‹å¸ˆå¼€å‘çš„æ¢¦æƒ³ä¸­çš„ç¼–è¾‘å™¨ - Visual Studio Code - Atom, å…¨å¹³å°æ”¯æŒçš„ä»£ç ç¼–è¾‘å™¨ - GNU Emacs, Vi / Vim</p><p>é’ˆå¯¹ Python çš„ IDEs:</p><ul><li>PyCharm, æœ€ä¼˜ç§€çš„ Python IDE ä¹‹ä¸€, æœ‰ä»˜è´¹ç‰ˆå’Œç¤¾åŒºå…è´¹ç‰ˆ</li><li>Spyder, ä¸º data science å·¥ä½œæµç¨‹ä¼˜åŒ–çš„ IDE, Anaconda é™„å¸¦.</li><li>Thonny, ä¸ºåˆå­¦è€…å‡†å¤‡çš„ IDE</li></ul><h3 id="ä½¿ç”¨-vs-code">ä½¿ç”¨ VS Code</h3><ul><li>å¾®è½¯ä¸º VS Code æä¾›äº†å®˜æ–¹çš„ Python å·¥å…·åŒ…</li><li>VS Code ä¹Ÿæ”¯æŒç¼–è¾‘ Jupyter-Notebook</li><li>ä¸°å¯Œçš„æ’ä»¶ï¼Œè®©ä½ å¯ä»¥è®¸å¤šå¯å®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼Œå¦‚æ”¯æŒ Git ç‰ˆæœ¬æ§åˆ¶ã€è¿œç¨‹ç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€Debug Jupyter-Notebook çš„ä»£ç ç­‰</li></ul><h3 id="ä½¿ç”¨-jupyter-notebook-lab">ä½¿ç”¨ Jupyter Notebook &amp; Lab</h3><p>ä»‹ç»ï¼š</p><ul><li>Jupyter Notebook äº¤äº’å¼ç¬”è®°æœ¬ï¼Œæ”¯æŒè¿è¡Œ40 å¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œä»£ç åŸºäº Cell ç»„ç»‡ï¼ŒæŒ‰ Cell è¿è¡Œï¼Œæ‰€è§å³æ‰€å¾—ï¼Œä¸»è¦ç”¨æˆ·æ˜¯æ•°æ®ç§‘å­¦å®¶</li><li>Jupiter lab åœ¨ Notebook çš„åŸºç¡€ä¸Šï¼Œæ‹¥æœ‰æ›´çµæ´»çš„å¸ƒå±€ã€å¯æ‹–åŠ¨çš„ Cellã€è·¨ Notebook ä¹‹é—´çš„ç¼–è¾‘ï¼Œé›†æˆç»ˆç«¯ç­‰ä¸°å¯Œçš„åŠŸèƒ½</li></ul><p>å¯åŠ¨ï¼š</p><ul><li>ç›´æ¥é€šè¿‡åº”ç”¨ç¨‹åºä¸­çš„ jupyter notebook æ‰“å¼€ï¼Œé»˜è®¤å·¥ä½œç›®å½•æ˜¯ <code>ç”¨æˆ·ä¸»ç›®å½•/</code></li><li>è‹¥éœ€æŒ‡å®šå·¥ä½œç›®å½•ï¼Œå¯ä»¥æ‰“å¼€ Powershellï¼Œåˆ‡æ¢åˆ°ä½ çš„ç›®æ ‡å·¥ä½œç›®å½•ï¼Œå†è¾“å…¥ jupyter-notebook å¹¶å›è½¦ï¼ˆjupyter-lab åŒç†ï¼‰</li><li>è‹¥æç¤º port errorï¼Œéœ€æŒ‡å®šç«¯å£ï¼Œå¦‚ <code>jupyter-notebook --port 8889</code></li><li>Jupyter çš„å·¥ä½œç¯å¢ƒå¯ä»¥åœ¨ä½ ä½¿ç”¨ Conda åˆ›å»ºçš„ç¯å¢ƒä¸­åˆ‡æ¢</li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ å®‰è£… Python ç¯å¢ƒä»¥ä½¿ç”¨ Pandasã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Pandas ç³»åˆ—" scheme="https://scottzhang.pro/categories/Pandas-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Pandas" scheme="https://scottzhang.pro/tags/Pandas/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: ä¸¤æ•°ä¹‹å’Œä¸ä¸‰æ•°ä¹‹å’Œ</title>
    <link href="https://scottzhang.pro/article/347c867a.html"/>
    <id>https://scottzhang.pro/article/347c867a.html</id>
    <published>2022-05-16T14:51:09.000Z</published>
    <updated>2022-05-17T01:40:59.584Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/linked-list-cycle/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsÂ å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ targetÂ  çš„é‚£Â ä¸¤ä¸ªÂ æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p></blockquote><span id="more"></span><h3 id="ä¸¤æ•°ä¹‹å’Œ">ä¸¤æ•°ä¹‹å’Œ</h3><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>():</span></span><br><span class="line">    hashtable = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        <span class="keyword">if</span> target - num <span class="keyword">in</span> hashtable:</span><br><span class="line">            <span class="keyword">return</span> [hashtable[target - num], i]</span><br><span class="line">        hashtable[nums[i]] = i</span><br><span class="line">    <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure><h3 id="ä¸‰æ•°ä¹‹å’Œ">ä¸‰æ•°ä¹‹å’Œ</h3><p>ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„Â numsï¼Œåˆ¤æ–­Â numsÂ ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾—Â a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><a href="https://leetcode-cn.com/problems/3sum/solution/pai-xu-shuang-zhi-zhen-zhu-xing-jie-shi-python3-by/">ç®—æ³•æµç¨‹</a>ï¼š</p><ol type="1"><li>ç‰¹åˆ¤ï¼Œå¯¹äºæ•°ç»„é•¿åº¦ nï¼Œå¦‚æœæ•°ç»„ä¸º null æˆ–è€…æ•°ç»„é•¿åº¦å°äº 3ï¼Œè¿”å› []ã€‚</li><li>å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚</li><li>éå†æ’åºåæ•°ç»„</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- è‹¥ nums[i] &gt; 0ï¼šå› ä¸ºå·²ç»æ’åºå¥½ï¼Œæ‰€ä»¥åé¢ä¸å¯èƒ½æœ‰ä¸‰ä¸ªæ•°åŠ å’Œç­‰äº 0ï¼Œç›´æ¥è¿”å›ç»“æœã€‚</span><br><span class="line">- å¯¹äºé‡å¤å…ƒç´ ï¼šè·³è¿‡ï¼Œé¿å…å‡ºç°é‡å¤è§£</span><br><span class="line">- ä»¤å·¦æŒ‡é’ˆ L=i+1ï¼Œå³æŒ‡é’ˆ R=nâˆ’1ï¼Œå½“ L&lt;R æ—¶ï¼Œæ‰§è¡Œå¾ªç¯ï¼š</span><br><span class="line">    - å½“ nums[i]+nums[L]+nums[R]==0ï¼Œæ‰§è¡Œå¾ªç¯ï¼Œåˆ¤æ–­å·¦ç•Œå’Œå³ç•Œæ˜¯å¦å’Œä¸‹ä¸€ä½ç½®é‡å¤ï¼Œå»é™¤é‡å¤è§£ã€‚å¹¶åŒæ—¶å°† L,R ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼Œå¯»æ‰¾æ–°çš„è§£</span><br><span class="line">    - è‹¥å’Œå¤§äº 0ï¼Œè¯´æ˜ nums[R] å¤ªå¤§ï¼ŒR å·¦ç§»</span><br><span class="line">    - è‹¥å’Œå°äº 0ï¼Œè¯´æ˜ nums[L] å¤ªå°ï¼ŒL å³ç§»</span><br></pre></td></tr></table></figure><p>ç®€å•æ¼”ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[-1, 0, 1, 2, -1, -4]</span><br><span class="line">[ I, L, 1, 2, -1,  R]</span><br><span class="line">[ I, 0, L, 2, -1,  R]</span><br><span class="line">[ I, 0, L, 2,  R, -4]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">nums = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">4</span>]</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">threeSum</span>(<span class="params">nums</span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(nums)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="comment"># null, é•¿åº¦ &lt; 3, è¿”å› []</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> nums <span class="keyword">or</span> n &lt; <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="comment"># æ’åºæ–¹ä¾¿æ“ä½œ</span></span><br><span class="line">    nums.sort()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å·²ç»æ’åºå¥½ï¼Œæ‰€ä»¥åé¢ä¸å¯èƒ½æœ‰ä¸‰ä¸ªæ•°åŠ å’Œç­‰äº 0ï¼Œç›´æ¥è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(nums[i] &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="comment"># è¿ç»­ä¸¤ä¸ªé‡å¤å€¼ï¼Œå‰é¢å·²ç»å°è¯•è¿‡æ‰€æœ‰ç»„åˆï¼Œæ‰€ä»¥è·³è¿‡    </span></span><br><span class="line">        <span class="keyword">if</span>(i &gt; <span class="number">0</span> <span class="keyword">and</span> nums[i] == nums[i-<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># L ä» i+1 å¼€å§‹ï¼ŒR ä»æ•°ç»„é•¿åº¦ -1 å¼€å§‹</span></span><br><span class="line">        L = i+<span class="number">1</span></span><br><span class="line">        R = n-<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(L &lt; R):</span><br><span class="line">            <span class="keyword">if</span>(nums[i]+nums[L]+nums[R] == <span class="number">0</span>):</span><br><span class="line">                res.append([nums[i], nums[L], nums[R]])</span><br><span class="line">                <span class="keyword">while</span>(L &lt; R <span class="keyword">and</span> nums[L] == nums[L+<span class="number">1</span>]):</span><br><span class="line">                    L = L+<span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span>(L &lt; R <span class="keyword">and</span> nums[R] == nums[R-<span class="number">1</span>]):</span><br><span class="line">                    R = R-<span class="number">1</span></span><br><span class="line">                L = L+<span class="number">1</span></span><br><span class="line">                R = R-<span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span>(nums[i]+nums[L]+nums[R] &gt; <span class="number">0</span>):</span><br><span class="line">                R = R-<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                L = L+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">threeSum(nums)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/linked-list-cycle/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsÂ å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ targetÂ  çš„é‚£Â ä¸¤ä¸ªÂ æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: å­—æ¯å¼‚ä½è¯åˆ†ç»„</title>
    <link href="https://scottzhang.pro/article/2239a89.html"/>
    <id>https://scottzhang.pro/article/2239a89.html</id>
    <published>2022-05-16T14:50:37.000Z</published>
    <updated>2022-05-17T01:36:29.592Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/group-anagrams/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚Leetcode</p></blockquote><span id="more"></span><h3 id="æ€è€ƒ">æ€è€ƒ</h3><p>å­—æ¯å¼‚ä½è¯ æ˜¯ç”±é‡æ–°æ’åˆ—æºå•è¯çš„å­—æ¯å¾—åˆ°çš„ä¸€ä¸ªæ–°å•è¯ï¼Œæ‰€æœ‰æºå•è¯ä¸­çš„å­—æ¯é€šå¸¸æ°å¥½åªç”¨ä¸€æ¬¡ã€‚</p><p>ä½¿ç”¨é¢˜ç›®"æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"æ€è·¯åˆ¤æ–­å¼‚ä½è¯ã€‚</p><p>å¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œç»„åˆæ‰§è¡Œä¸Šé¢çš„åˆ¤æ–­ï¼Œ éœ€è¦å°†æ‰€æœ‰çš„å¼‚ä½è¯æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦æ„å»ºå¦å¤–ä¸€ä¸ªæ•°ç»„ã€‚</p><p>å¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªæ–°çš„å½¢å¼ï¼Œéœ€è¦å°†æ–°çš„æ”¾åˆ°è¿™ä¸ªæ•°ç»„ï¼Œæ¯”å¯¹çš„å¯¹è±¡å¯ä»¥æ˜¯ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºæ‰€æœ‰å¼‚ä½è¯ä¹‹é—´åº”è¯¥éƒ½æ˜¯ç›¸ç­‰çš„å…³ç³»ï¼Œ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ä¸ªé‡åˆ°çš„è¯è¯­ä½œä¸ºé”®å’Œå€¼ï¼Œåç»­æ‰¾åˆ°çš„æ–°çš„æ”¾åˆ°å€¼ä¸­ã€‚</p><h3 id="è§£æ³•">è§£æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">groupAnagrams</span>(<span class="params">strs: <span class="built_in">list</span></span>):</span></span><br><span class="line">    angram_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(strs)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(strs)):</span><br><span class="line">            is_angram = isAnagramCounter(strs[i], strs[j])</span><br><span class="line">            <span class="keyword">if</span> is_angram:</span><br><span class="line">                <span class="keyword">if</span> strs[i] <span class="keyword">in</span> angram_dict:</span><br><span class="line">                    angram_dict[strs[i]].append(strs[j])</span><br><span class="line">                <span class="keyword">elif</span> strs[i] <span class="keyword">in</span> angram_dict.values():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    angram_dict[strs[i]] = []</span><br><span class="line">                    angram_dict[strs[i]].append(strs[j])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> angram_dict</span><br><span class="line"></span><br><span class="line">groupAnagrams(strs)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åŒé‡å¾ªç¯å¢åŠ äº†å¾ˆå¤šå¤æ‚åº¦ï¼Œå¯ä»¥ç›´æ¥å€Ÿé‰´æ’åºçš„ä¼˜ç§€è§£æ³•ï¼Œå…¶ä¸­ tuple(sorted(w)) ä¹Ÿå¯ä»¥æ¢æˆ ''.join(sorted(w))ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®°ä½ d.get(key, []) + [w]</span></span><br><span class="line">strs = [<span class="string">&quot;eat&quot;</span>,<span class="string">&quot;tea&quot;</span>,<span class="string">&quot;tan&quot;</span>,<span class="string">&quot;ate&quot;</span>,<span class="string">&quot;nat&quot;</span>,<span class="string">&quot;bat&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">groupAnagrams</span>(<span class="params">strs</span>):</span></span><br><span class="line">    d = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">sorted</span>(strs):</span><br><span class="line">        key = <span class="built_in">tuple</span>(<span class="built_in">sorted</span>(w))</span><br><span class="line">        d[key] = d.get(key, []) + [w]</span><br><span class="line">    <span class="keyword">return</span> d.values()</span><br><span class="line"></span><br><span class="line">groupAnagrams(strs)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/group-anagrams/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚Leetcode&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
    <category term="å­—å…¸" scheme="https://scottzhang.pro/tags/%E5%AD%97%E5%85%B8/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</title>
    <link href="https://scottzhang.pro/article/f2f7dffe.html"/>
    <id>https://scottzhang.pro/article/f2f7dffe.html</id>
    <published>2022-05-16T14:50:24.000Z</published>
    <updated>2022-05-17T01:36:39.810Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode-cn.com/problems/valid-anagram/">ğŸ“Œ</a> ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚</p></blockquote><span id="more"></span><p>ç›´æ¥æ’åºï¼Œå¼‚ä½è¯çš„é¡ºåºä¸åŒå‡ºç°çš„æ¬¡æ•°ä¸€æ ·ï¼Œæ‰€ä»¥ä½¿ç”¨ sort æ–¹æ³•æ’åºåçš„å€¼åº”è¯¥ç›¸ç­‰çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isAnagramSort</span>(<span class="params">s, t</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) != <span class="built_in">len</span>(t):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    s_sorted = <span class="built_in">sorted</span>(s)</span><br><span class="line">    t_sorted = <span class="built_in">sorted</span>(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s_sorted == t_sorted:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">isAnagramSort(a, b)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ collection ä¸­çš„ Counterã€‚</p><p>Counter æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ ==, !=, &lt;, &lt;=, &gt;, &gt;=.</p><p>éœ€è¦æ³¨æ„å¯¹äºä¸ªæ•°ä¸º 0çš„ï¼Œä¸ç®—å…¥æ¯”è¾ƒçš„èŒƒå›´ï¼Œå¦‚ Counter(a=1) == Counter(a=1, b=0) è¿”å› true.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isAnagramCounter</span>(<span class="params">s: <span class="built_in">str</span>, t: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">return</span> collections.Counter(s) == collections.Counter(t)</span><br></pre></td></tr></table></figure><p>é“¾æ¥ï¼š</p><ul><li><a href="https://leetcode.com/problems/valid-anagram/">è‹±æ–‡ç«™</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/valid-anagram/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
    <category term="collections" scheme="https://scottzhang.pro/tags/collections/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: ç”¨é˜Ÿåˆ—å®ç°æ ˆ</title>
    <link href="https://scottzhang.pro/article/5a9968.html"/>
    <id>https://scottzhang.pro/article/5a9968.html</id>
    <published>2022-05-16T14:45:32.000Z</published>
    <updated>2022-05-17T01:37:20.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/implement-stack-using-queues/">ğŸ“Œ</a> è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰</p></blockquote><span id="more"></span><p>å®ç° MyStack ç±»ï¼š</p><ul><li>void push(int x) å°†å…ƒç´  x å‹å…¥æ ˆé¡¶ã€‚</li><li>int pop() ç§»é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´ ã€‚</li><li>int top() è¿”å›æ ˆé¡¶å…ƒç´ ã€‚</li><li>boolean empty() å¦‚æœæ ˆæ˜¯ç©ºçš„ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚ Â </li></ul><p>æ³¨æ„ï¼š</p><p>ä½ åªèƒ½ä½¿ç”¨é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯Â push to backã€peek/pop from frontã€size å’ŒÂ is emptyÂ è¿™äº›æ“ä½œã€‚ ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒé˜Ÿåˆ—ã€‚Â ä½ å¯ä»¥ä½¿ç”¨ list ï¼ˆåˆ—è¡¨ï¼‰æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—Â , åªè¦æ˜¯æ ‡å‡†çš„é˜Ÿåˆ—æ“ä½œå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.queue1 = []</span><br><span class="line">        self.queue2 = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.queue1.append(x)</span><br><span class="line">        self.queue2 = <span class="built_in">list</span>(<span class="built_in">reversed</span>(self.queue1))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.queue2.pop()</span><br><span class="line">        <span class="keyword">del</span> self.queue1[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.queue2[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.queue1) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mystack = MyStack()</span><br><span class="line">mystack.push(<span class="number">1</span>)</span><br><span class="line">mystack.push(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">mystack.queue2</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/implement-stack-using-queues/&quot;&gt;ğŸ“Œ&lt;/a&gt; è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
    <category term="é˜Ÿåˆ—" scheme="https://scottzhang.pro/tags/%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ€å°æ ˆé—®é¢˜</title>
    <link href="https://scottzhang.pro/article/302a7493.html"/>
    <id>https://scottzhang.pro/article/302a7493.html</id>
    <published>2022-05-16T14:45:17.000Z</published>
    <updated>2022-05-17T01:36:36.736Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/min-stack/">ğŸ“Œ</a> è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p></blockquote><span id="more"></span><p>å®ç° MinStack ç±»:</p><ul><li>MinStack() åˆå§‹åŒ–å †æ ˆå¯¹è±¡ã€‚</li><li>void push(int val) å°†å…ƒç´ valæ¨å…¥å †æ ˆã€‚</li><li>void pop() åˆ é™¤å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li><li>int top() è·å–å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li><li>int getMin() è·å–å †æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack2Arr</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;å†…éƒ¨ä½¿ç”¨äº†ä¸¤ä¸ªæ ˆï¼ˆä¸€ä¸ªè¾…åŠ©æ ˆï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        self.stack = []</span><br><span class="line">        self.min_stack = [math.inf]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.stack.append(x)</span><br><span class="line">        self.min_stack.append(<span class="built_in">min</span>(x, self.min_stack[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.stack.pop()</span><br><span class="line">        self.min_stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.min_stack[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/min-stack/&quot;&gt;ğŸ“Œ&lt;/a&gt; è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ‰æ•ˆçš„æ‹¬å·</title>
    <link href="https://scottzhang.pro/article/6d4e3bea.html"/>
    <id>https://scottzhang.pro/article/6d4e3bea.html</id>
    <published>2022-05-16T14:45:03.000Z</published>
    <updated>2022-05-17T01:36:42.948Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/valid-parentheses/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ '('ï¼Œ')'ï¼Œ'{'ï¼Œ'}'ï¼Œ'['ï¼Œ']'Â çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p></blockquote><span id="more"></span><p>æ³¨æ„ï¼šæœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><p>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</p><p>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isValid</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ³¨æ„ç†è§£æ ˆçš„åŸç†&quot;&quot;&quot;</span></span><br><span class="line">    stack = []</span><br><span class="line">    <span class="built_in">dict</span> = &#123;<span class="string">&quot;]&quot;</span>:<span class="string">&quot;[&quot;</span>, <span class="string">&quot;&#125;&quot;</span>:<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;)&quot;</span>:<span class="string">&quot;(&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment"># æŸ¥ valueï¼Œå¦‚æœå‡ºç°å·¦æ‹¬å·ï¼Œå°†å…¶æ”¾åˆ°æ ˆä¸­</span></span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> <span class="built_in">dict</span>.values():</span><br><span class="line">            stack.append(char)</span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯å‡ºç°äº†å³æ‹¬å·ã€è‹¥æ ˆæ˜¯ç©ºçš„æˆ–è€…</span></span><br><span class="line">        <span class="comment"># æ ¹æ®å³è¾¹æ‹¬å·æ‰¾åˆ°å¯¹åº”çš„å·¦æ‹¬å·ä¸ç­‰äºæ ˆé¡¶å…ƒç´ ï¼Œè¿”å› False</span></span><br><span class="line">        <span class="keyword">elif</span> char <span class="keyword">in</span> <span class="built_in">dict</span>.keys():</span><br><span class="line">            <span class="keyword">if</span> stack == [] <span class="keyword">or</span> <span class="built_in">dict</span>[char] != stack.pop():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># å…¶ä»–æƒ…å†µï¼Œè¿”å› False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> stack == []</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/valid-parentheses/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ &#39;(&#39;ï¼Œ&#39;)&#39;ï¼Œ&#39;{&#39;ï¼Œ&#39;}&#39;ï¼Œ&#39;[&#39;ï¼Œ&#39;]&#39;Â çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: åˆ¤æ–­ç¯å½¢é“¾è¡¨</title>
    <link href="https://scottzhang.pro/article/50c0087b.html"/>
    <id>https://scottzhang.pro/article/50c0087b.html</id>
    <published>2022-05-16T14:40:24.000Z</published>
    <updated>2022-05-17T01:36:24.562Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/linked-list-cycle/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p></blockquote><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_cycle_set</span>(<span class="params">head</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨é›†åˆæˆ–è€…å“ˆå¸Œè¡¨ï¼Œè®°å½•è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œè‹¥å†æ¬¡å‡ºç°åˆ™æœ‰ç¯</span></span><br><span class="line"><span class="string">       1. æ—¶é—´å¤æ‚åº¦ï¼šO(N)O(N)ï¼Œå…¶ä¸­ NN æ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ã€‚æœ€åæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="string">       2. ç©ºé—´å¤æ‚åº¦ï¼šO(N)O(N)ï¼Œå…¶ä¸­ NN æ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ã€‚ä¸»è¦ä¸ºå“ˆå¸Œè¡¨çš„å¼€é”€ï¼Œæœ€åæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        <span class="keyword">if</span> head <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            seen.add(head)</span><br><span class="line">        head = head.<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_cycle_fast_slow_pointer</span>(<span class="params">head</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€å¿«ä¸€æ…¢éå†é“¾è¡¨ï¼Œå¦‚æœé“¾è¡¨å­˜åœ¨ç¯ï¼Œåˆ™æœ€ç»ˆå¿«æŒ‡é’ˆè‚¯å®šä¼šä¸æ…¢æŒ‡é’ˆç›¸é‡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å¦‚æœå¤´èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…å¤´ç»“ç‚¹æ²¡æœ‰ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œåˆ™ä¸å­˜åœ¨ç¯</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.<span class="built_in">next</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸¤ä¸ªå¿«æ…¢æŒ‡é’ˆéå†ï¼Œè¿™é‡Œå¿«æŒ‡é’ˆæ¯”æ…¢æŒ‡é’ˆå…ˆå‡ºå‘</span></span><br><span class="line">    <span class="comment"># ä¸æ˜¯åŒä¸€ä¸ªä½ç½®å‡ºå‘ï¼Œè¿™ä¹ˆå†™çš„åŸå› æ˜¯ while çš„æ¡ä»¶éœ€è¦ä¸€å¼€å§‹</span></span><br><span class="line">    <span class="comment"># å¤„äºä¸æ»¡è¶³çš„æƒ…å†µ</span></span><br><span class="line">    slow = head</span><br><span class="line">    fast = head.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> slow != fast:</span><br><span class="line">        <span class="comment"># å¦‚æœ fast ä¸ºç©ºæˆ–æ²¡æœ‰ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè¯´æ˜éå†åˆ°äº†é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">        <span class="comment"># è¯´æ˜ä¸å­˜åœ¨ç¯ï¼Œæœ‰ç¯çš„è¯ä¼šå¾ªç¯åˆ°å‰é¢çš„ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> fast <span class="keyword">or</span> <span class="keyword">not</span> fast.<span class="built_in">next</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç§»åŠ¨å¿«æ…¢æŒ‡é’ˆ</span></span><br><span class="line">        fast = fast.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">        slow = slow.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># while åçš„æ¡ä»¶ä¸º Trueï¼Œå³ slow == fast, è¯´æ˜å­˜åœ¨ç¯</span></span><br><span class="line">    <span class="comment"># æ­¤æ—¶ slow æŒ‡å‘çš„ç»“ç‚¹ == fast æŒ‡å‘çš„ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p>é“¾è¡¨çš„è®¿é—®æ˜¯ä»ç¬¬ä¸€ä¸ªç»“ç‚¹å¼€å§‹çš„ï¼Œä¸è¦ç”¨æ•°ç»„çš„æ€ç»´å»ç†è§£é“¾è¡¨</p><p>åœ¨é“¾è¡¨æ“ä½œä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªä¼ªç»“ç‚¹ï¼Œåˆç§° dummy ç»“ç‚¹ï¼Œä½¿ç”¨ dummy ç»“ç‚¹çš„å¥½å¤„æ˜¯ 1. åœ¨é“¾è¡¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ²¡æœ‰åˆé€‚çš„ç»“ç‚¹å¯ä»¥ä½¿ç”¨ï¼Œç”¨ä¸€ä¸ªä¼ªç»“ç‚¹å¼€å§‹åˆå§‹åŒ–æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†éœ€è¦æ³¨æ„åœ¨è¿”å›çš„æ—¶å€™éœ€è¦è¿”å› dummy.next. 2. å¯ä»¥ä½¿ç”¨ <code>while node</code> æˆ–è€…æ˜¯ <code>if node</code> ï¼Œæ¥åˆ¤æ–­æŸä¸ªç»“ç‚¹æ˜¯å¦æœ‰ next</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/linked-list-cycle/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="é“¾è¡¨" scheme="https://scottzhang.pro/tags/%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨</title>
    <link href="https://scottzhang.pro/article/6b8b3431.html"/>
    <id>https://scottzhang.pro/article/6b8b3431.html</id>
    <published>2022-05-16T14:38:39.000Z</published>
    <updated>2022-05-17T01:36:26.983Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/merge-k-sorted-lists/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p></blockquote><span id="more"></span><h3 id="åˆå¹¶-k-ä¸ªæ’åºé“¾è¡¨">åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = [[1, 4, 5], [1, 3, 4], [2, 6]]</span><br><span class="line">è¾“å‡ºï¼š[1, 1, 2, 3, 4, 4, 5, 6]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeKLists</span>(<span class="params">lists</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¡ºåºåˆå¹¶ï¼Œæ•ˆç‡ä¸æ˜¯å¾ˆé«˜&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">l1, l2</span>):</span></span><br><span class="line">        d = c = ListNode(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt;= l2.val:</span><br><span class="line">                c.<span class="built_in">next</span>, l1 = l1, l1.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c.<span class="built_in">next</span>, l2 = l2, l2.<span class="built_in">next</span></span><br><span class="line">            c = c.<span class="built_in">next</span></span><br><span class="line">        c.<span class="built_in">next</span> = l1 <span class="keyword">if</span> l1 <span class="keyword">else</span> l2</span><br><span class="line">        <span class="keyword">return</span> d.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lists:</span><br><span class="line">        ans = merge(ans, i)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">mergeKLists([l1, l2])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeKLists</span>(<span class="params">lists</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨å †&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> heapq</span><br><span class="line">    dummy = ListNode(<span class="number">0</span>)</span><br><span class="line">    p = dummy</span><br><span class="line">    head = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lists)):</span><br><span class="line">        <span class="keyword">if</span> lists[i]:</span><br><span class="line">            heapq.heappush(head, (lists[i].val, i))</span><br><span class="line">            lists[i] = lists[i].<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        val, idx = heapq.heappop(head)</span><br><span class="line">        p.<span class="built_in">next</span> = ListNode(val)</span><br><span class="line">        p = p.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">if</span> lists[idx]:</span><br><span class="line">            heapq.heappush(head, (lists[idx].val, idx))</span><br><span class="line">            lists[idx] = lists[idx].<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">return</span> dummy.<span class="built_in">next</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/merge-k-sorted-lists/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="é“¾è¡¨" scheme="https://scottzhang.pro/tags/%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
</feed>
