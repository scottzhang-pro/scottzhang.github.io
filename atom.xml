<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Scott&#39;s Blog</title>
  
  <subtitle>å­¦åˆ™ä¸å›º, çŸ¥åˆ™ä¸æƒ‘</subtitle>
  <link href="https://scottzhang.pro/atom.xml" rel="self"/>
  
  <link href="https://scottzhang.pro/"/>
  <updated>2022-05-17T01:40:59.584Z</updated>
  <id>https://scottzhang.pro/</id>
  
  <author>
    <name>Scott</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•é¢˜: ä¸¤æ•°ä¹‹å’Œä¸ä¸‰æ•°ä¹‹å’Œ</title>
    <link href="https://scottzhang.pro/article/347c867a.html"/>
    <id>https://scottzhang.pro/article/347c867a.html</id>
    <published>2022-05-16T14:51:09.000Z</published>
    <updated>2022-05-17T01:40:59.584Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/linked-list-cycle/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsÂ å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ targetÂ  çš„é‚£Â ä¸¤ä¸ªÂ æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p></blockquote><span id="more"></span><h3 id="ä¸¤æ•°ä¹‹å’Œ">ä¸¤æ•°ä¹‹å’Œ</h3><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>():</span></span><br><span class="line">    hashtable = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        <span class="keyword">if</span> target - num <span class="keyword">in</span> hashtable:</span><br><span class="line">            <span class="keyword">return</span> [hashtable[target - num], i]</span><br><span class="line">        hashtable[nums[i]] = i</span><br><span class="line">    <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure><h3 id="ä¸‰æ•°ä¹‹å’Œ">ä¸‰æ•°ä¹‹å’Œ</h3><p>ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„Â numsï¼Œåˆ¤æ–­Â numsÂ ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾—Â a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><a href="https://leetcode-cn.com/problems/3sum/solution/pai-xu-shuang-zhi-zhen-zhu-xing-jie-shi-python3-by/">ç®—æ³•æµç¨‹</a>ï¼š</p><ol type="1"><li>ç‰¹åˆ¤ï¼Œå¯¹äºæ•°ç»„é•¿åº¦ nï¼Œå¦‚æœæ•°ç»„ä¸º null æˆ–è€…æ•°ç»„é•¿åº¦å°äº 3ï¼Œè¿”å› []ã€‚</li><li>å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚</li><li>éå†æ’åºåæ•°ç»„</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- è‹¥ nums[i] &gt; 0ï¼šå› ä¸ºå·²ç»æ’åºå¥½ï¼Œæ‰€ä»¥åé¢ä¸å¯èƒ½æœ‰ä¸‰ä¸ªæ•°åŠ å’Œç­‰äº 0ï¼Œç›´æ¥è¿”å›ç»“æœã€‚</span><br><span class="line">- å¯¹äºé‡å¤å…ƒç´ ï¼šè·³è¿‡ï¼Œé¿å…å‡ºç°é‡å¤è§£</span><br><span class="line">- ä»¤å·¦æŒ‡é’ˆ L=i+1ï¼Œå³æŒ‡é’ˆ R=nâˆ’1ï¼Œå½“ L&lt;R æ—¶ï¼Œæ‰§è¡Œå¾ªç¯ï¼š</span><br><span class="line">    - å½“ nums[i]+nums[L]+nums[R]==0ï¼Œæ‰§è¡Œå¾ªç¯ï¼Œåˆ¤æ–­å·¦ç•Œå’Œå³ç•Œæ˜¯å¦å’Œä¸‹ä¸€ä½ç½®é‡å¤ï¼Œå»é™¤é‡å¤è§£ã€‚å¹¶åŒæ—¶å°† L,R ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼Œå¯»æ‰¾æ–°çš„è§£</span><br><span class="line">    - è‹¥å’Œå¤§äº 0ï¼Œè¯´æ˜ nums[R] å¤ªå¤§ï¼ŒR å·¦ç§»</span><br><span class="line">    - è‹¥å’Œå°äº 0ï¼Œè¯´æ˜ nums[L] å¤ªå°ï¼ŒL å³ç§»</span><br></pre></td></tr></table></figure><p>ç®€å•æ¼”ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[-1, 0, 1, 2, -1, -4]</span><br><span class="line">[ I, L, 1, 2, -1,  R]</span><br><span class="line">[ I, 0, L, 2, -1,  R]</span><br><span class="line">[ I, 0, L, 2,  R, -4]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">nums = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">4</span>]</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">threeSum</span>(<span class="params">nums</span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(nums)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="comment"># null, é•¿åº¦ &lt; 3, è¿”å› []</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> nums <span class="keyword">or</span> n &lt; <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="comment"># æ’åºæ–¹ä¾¿æ“ä½œ</span></span><br><span class="line">    nums.sort()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å·²ç»æ’åºå¥½ï¼Œæ‰€ä»¥åé¢ä¸å¯èƒ½æœ‰ä¸‰ä¸ªæ•°åŠ å’Œç­‰äº 0ï¼Œç›´æ¥è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(nums[i] &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="comment"># è¿ç»­ä¸¤ä¸ªé‡å¤å€¼ï¼Œå‰é¢å·²ç»å°è¯•è¿‡æ‰€æœ‰ç»„åˆï¼Œæ‰€ä»¥è·³è¿‡    </span></span><br><span class="line">        <span class="keyword">if</span>(i &gt; <span class="number">0</span> <span class="keyword">and</span> nums[i] == nums[i-<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># L ä» i+1 å¼€å§‹ï¼ŒR ä»æ•°ç»„é•¿åº¦ -1 å¼€å§‹</span></span><br><span class="line">        L = i+<span class="number">1</span></span><br><span class="line">        R = n-<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(L &lt; R):</span><br><span class="line">            <span class="keyword">if</span>(nums[i]+nums[L]+nums[R] == <span class="number">0</span>):</span><br><span class="line">                res.append([nums[i], nums[L], nums[R]])</span><br><span class="line">                <span class="keyword">while</span>(L &lt; R <span class="keyword">and</span> nums[L] == nums[L+<span class="number">1</span>]):</span><br><span class="line">                    L = L+<span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span>(L &lt; R <span class="keyword">and</span> nums[R] == nums[R-<span class="number">1</span>]):</span><br><span class="line">                    R = R-<span class="number">1</span></span><br><span class="line">                L = L+<span class="number">1</span></span><br><span class="line">                R = R-<span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span>(nums[i]+nums[L]+nums[R] &gt; <span class="number">0</span>):</span><br><span class="line">                R = R-<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                L = L+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">threeSum(nums)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/linked-list-cycle/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsÂ å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ targetÂ  çš„é‚£Â ä¸¤ä¸ªÂ æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: å­—æ¯å¼‚ä½è¯åˆ†ç»„</title>
    <link href="https://scottzhang.pro/article/2239a89.html"/>
    <id>https://scottzhang.pro/article/2239a89.html</id>
    <published>2022-05-16T14:50:37.000Z</published>
    <updated>2022-05-17T01:36:29.592Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/group-anagrams/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚Leetcode</p></blockquote><span id="more"></span><h3 id="æ€è€ƒ">æ€è€ƒ</h3><p>å­—æ¯å¼‚ä½è¯ æ˜¯ç”±é‡æ–°æ’åˆ—æºå•è¯çš„å­—æ¯å¾—åˆ°çš„ä¸€ä¸ªæ–°å•è¯ï¼Œæ‰€æœ‰æºå•è¯ä¸­çš„å­—æ¯é€šå¸¸æ°å¥½åªç”¨ä¸€æ¬¡ã€‚</p><p>ä½¿ç”¨é¢˜ç›®"æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"æ€è·¯åˆ¤æ–­å¼‚ä½è¯ã€‚</p><p>å¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œç»„åˆæ‰§è¡Œä¸Šé¢çš„åˆ¤æ–­ï¼Œ éœ€è¦å°†æ‰€æœ‰çš„å¼‚ä½è¯æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦æ„å»ºå¦å¤–ä¸€ä¸ªæ•°ç»„ã€‚</p><p>å¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªæ–°çš„å½¢å¼ï¼Œéœ€è¦å°†æ–°çš„æ”¾åˆ°è¿™ä¸ªæ•°ç»„ï¼Œæ¯”å¯¹çš„å¯¹è±¡å¯ä»¥æ˜¯ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºæ‰€æœ‰å¼‚ä½è¯ä¹‹é—´åº”è¯¥éƒ½æ˜¯ç›¸ç­‰çš„å…³ç³»ï¼Œ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ä¸ªé‡åˆ°çš„è¯è¯­ä½œä¸ºé”®å’Œå€¼ï¼Œåç»­æ‰¾åˆ°çš„æ–°çš„æ”¾åˆ°å€¼ä¸­ã€‚</p><h3 id="è§£æ³•">è§£æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">groupAnagrams</span>(<span class="params">strs: <span class="built_in">list</span></span>):</span></span><br><span class="line">    angram_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(strs)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(strs)):</span><br><span class="line">            is_angram = isAnagramCounter(strs[i], strs[j])</span><br><span class="line">            <span class="keyword">if</span> is_angram:</span><br><span class="line">                <span class="keyword">if</span> strs[i] <span class="keyword">in</span> angram_dict:</span><br><span class="line">                    angram_dict[strs[i]].append(strs[j])</span><br><span class="line">                <span class="keyword">elif</span> strs[i] <span class="keyword">in</span> angram_dict.values():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    angram_dict[strs[i]] = []</span><br><span class="line">                    angram_dict[strs[i]].append(strs[j])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> angram_dict</span><br><span class="line"></span><br><span class="line">groupAnagrams(strs)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åŒé‡å¾ªç¯å¢åŠ äº†å¾ˆå¤šå¤æ‚åº¦ï¼Œå¯ä»¥ç›´æ¥å€Ÿé‰´æ’åºçš„ä¼˜ç§€è§£æ³•ï¼Œå…¶ä¸­ tuple(sorted(w)) ä¹Ÿå¯ä»¥æ¢æˆ ''.join(sorted(w))ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®°ä½ d.get(key, []) + [w]</span></span><br><span class="line">strs = [<span class="string">&quot;eat&quot;</span>,<span class="string">&quot;tea&quot;</span>,<span class="string">&quot;tan&quot;</span>,<span class="string">&quot;ate&quot;</span>,<span class="string">&quot;nat&quot;</span>,<span class="string">&quot;bat&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">groupAnagrams</span>(<span class="params">strs</span>):</span></span><br><span class="line">    d = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">sorted</span>(strs):</span><br><span class="line">        key = <span class="built_in">tuple</span>(<span class="built_in">sorted</span>(w))</span><br><span class="line">        d[key] = d.get(key, []) + [w]</span><br><span class="line">    <span class="keyword">return</span> d.values()</span><br><span class="line"></span><br><span class="line">groupAnagrams(strs)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/group-anagrams/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚Leetcode&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
    <category term="å­—å…¸" scheme="https://scottzhang.pro/tags/%E5%AD%97%E5%85%B8/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</title>
    <link href="https://scottzhang.pro/article/f2f7dffe.html"/>
    <id>https://scottzhang.pro/article/f2f7dffe.html</id>
    <published>2022-05-16T14:50:24.000Z</published>
    <updated>2022-05-17T01:36:39.810Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode-cn.com/problems/valid-anagram/">ğŸ“Œ</a> ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚</p></blockquote><span id="more"></span><p>ç›´æ¥æ’åºï¼Œå¼‚ä½è¯çš„é¡ºåºä¸åŒå‡ºç°çš„æ¬¡æ•°ä¸€æ ·ï¼Œæ‰€ä»¥ä½¿ç”¨ sort æ–¹æ³•æ’åºåçš„å€¼åº”è¯¥ç›¸ç­‰çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isAnagramSort</span>(<span class="params">s, t</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) != <span class="built_in">len</span>(t):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    s_sorted = <span class="built_in">sorted</span>(s)</span><br><span class="line">    t_sorted = <span class="built_in">sorted</span>(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s_sorted == t_sorted:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">isAnagramSort(a, b)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ collection ä¸­çš„ Counterã€‚</p><p>Counter æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ ==, !=, &lt;, &lt;=, &gt;, &gt;=.</p><p>éœ€è¦æ³¨æ„å¯¹äºä¸ªæ•°ä¸º 0çš„ï¼Œä¸ç®—å…¥æ¯”è¾ƒçš„èŒƒå›´ï¼Œå¦‚ Counter(a=1) == Counter(a=1, b=0) è¿”å› true.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isAnagramCounter</span>(<span class="params">s: <span class="built_in">str</span>, t: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">return</span> collections.Counter(s) == collections.Counter(t)</span><br></pre></td></tr></table></figure><p>é“¾æ¥ï¼š</p><ul><li><a href="https://leetcode.com/problems/valid-anagram/">è‹±æ–‡ç«™</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/valid-anagram/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
    <category term="collections" scheme="https://scottzhang.pro/tags/collections/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: ç”¨é˜Ÿåˆ—å®ç°æ ˆ</title>
    <link href="https://scottzhang.pro/article/5a9968.html"/>
    <id>https://scottzhang.pro/article/5a9968.html</id>
    <published>2022-05-16T14:45:32.000Z</published>
    <updated>2022-05-17T01:37:20.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/implement-stack-using-queues/">ğŸ“Œ</a> è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰</p></blockquote><span id="more"></span><p>å®ç° MyStack ç±»ï¼š</p><ul><li>void push(int x) å°†å…ƒç´  x å‹å…¥æ ˆé¡¶ã€‚</li><li>int pop() ç§»é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´ ã€‚</li><li>int top() è¿”å›æ ˆé¡¶å…ƒç´ ã€‚</li><li>boolean empty() å¦‚æœæ ˆæ˜¯ç©ºçš„ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚ Â </li></ul><p>æ³¨æ„ï¼š</p><p>ä½ åªèƒ½ä½¿ç”¨é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯Â push to backã€peek/pop from frontã€size å’ŒÂ is emptyÂ è¿™äº›æ“ä½œã€‚ ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒé˜Ÿåˆ—ã€‚Â ä½ å¯ä»¥ä½¿ç”¨ list ï¼ˆåˆ—è¡¨ï¼‰æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—Â , åªè¦æ˜¯æ ‡å‡†çš„é˜Ÿåˆ—æ“ä½œå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.queue1 = []</span><br><span class="line">        self.queue2 = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.queue1.append(x)</span><br><span class="line">        self.queue2 = <span class="built_in">list</span>(<span class="built_in">reversed</span>(self.queue1))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.queue2.pop()</span><br><span class="line">        <span class="keyword">del</span> self.queue1[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.queue2[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.queue1) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mystack = MyStack()</span><br><span class="line">mystack.push(<span class="number">1</span>)</span><br><span class="line">mystack.push(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">mystack.queue2</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/implement-stack-using-queues/&quot;&gt;ğŸ“Œ&lt;/a&gt; è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
    <category term="é˜Ÿåˆ—" scheme="https://scottzhang.pro/tags/%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ€å°æ ˆé—®é¢˜</title>
    <link href="https://scottzhang.pro/article/302a7493.html"/>
    <id>https://scottzhang.pro/article/302a7493.html</id>
    <published>2022-05-16T14:45:17.000Z</published>
    <updated>2022-05-17T01:36:36.736Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/min-stack/">ğŸ“Œ</a> è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p></blockquote><span id="more"></span><p>å®ç° MinStack ç±»:</p><ul><li>MinStack() åˆå§‹åŒ–å †æ ˆå¯¹è±¡ã€‚</li><li>void push(int val) å°†å…ƒç´ valæ¨å…¥å †æ ˆã€‚</li><li>void pop() åˆ é™¤å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li><li>int top() è·å–å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li><li>int getMin() è·å–å †æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack2Arr</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;å†…éƒ¨ä½¿ç”¨äº†ä¸¤ä¸ªæ ˆï¼ˆä¸€ä¸ªè¾…åŠ©æ ˆï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        self.stack = []</span><br><span class="line">        self.min_stack = [math.inf]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.stack.append(x)</span><br><span class="line">        self.min_stack.append(<span class="built_in">min</span>(x, self.min_stack[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.stack.pop()</span><br><span class="line">        self.min_stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.min_stack[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/min-stack/&quot;&gt;ğŸ“Œ&lt;/a&gt; è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æœ‰æ•ˆçš„æ‹¬å·</title>
    <link href="https://scottzhang.pro/article/6d4e3bea.html"/>
    <id>https://scottzhang.pro/article/6d4e3bea.html</id>
    <published>2022-05-16T14:45:03.000Z</published>
    <updated>2022-05-17T01:36:42.948Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/valid-parentheses/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ '('ï¼Œ')'ï¼Œ'{'ï¼Œ'}'ï¼Œ'['ï¼Œ']'Â çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p></blockquote><span id="more"></span><p>æ³¨æ„ï¼šæœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><p>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</p><p>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isValid</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ³¨æ„ç†è§£æ ˆçš„åŸç†&quot;&quot;&quot;</span></span><br><span class="line">    stack = []</span><br><span class="line">    <span class="built_in">dict</span> = &#123;<span class="string">&quot;]&quot;</span>:<span class="string">&quot;[&quot;</span>, <span class="string">&quot;&#125;&quot;</span>:<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;)&quot;</span>:<span class="string">&quot;(&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment"># æŸ¥ valueï¼Œå¦‚æœå‡ºç°å·¦æ‹¬å·ï¼Œå°†å…¶æ”¾åˆ°æ ˆä¸­</span></span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> <span class="built_in">dict</span>.values():</span><br><span class="line">            stack.append(char)</span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯å‡ºç°äº†å³æ‹¬å·ã€è‹¥æ ˆæ˜¯ç©ºçš„æˆ–è€…</span></span><br><span class="line">        <span class="comment"># æ ¹æ®å³è¾¹æ‹¬å·æ‰¾åˆ°å¯¹åº”çš„å·¦æ‹¬å·ä¸ç­‰äºæ ˆé¡¶å…ƒç´ ï¼Œè¿”å› False</span></span><br><span class="line">        <span class="keyword">elif</span> char <span class="keyword">in</span> <span class="built_in">dict</span>.keys():</span><br><span class="line">            <span class="keyword">if</span> stack == [] <span class="keyword">or</span> <span class="built_in">dict</span>[char] != stack.pop():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># å…¶ä»–æƒ…å†µï¼Œè¿”å› False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> stack == []</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/valid-parentheses/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ &#39;(&#39;ï¼Œ&#39;)&#39;ï¼Œ&#39;{&#39;ï¼Œ&#39;}&#39;ï¼Œ&#39;[&#39;ï¼Œ&#39;]&#39;Â çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ ˆ" scheme="https://scottzhang.pro/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: åˆ¤æ–­ç¯å½¢é“¾è¡¨</title>
    <link href="https://scottzhang.pro/article/50c0087b.html"/>
    <id>https://scottzhang.pro/article/50c0087b.html</id>
    <published>2022-05-16T14:40:24.000Z</published>
    <updated>2022-05-17T01:36:24.562Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/linked-list-cycle/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p></blockquote><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_cycle_set</span>(<span class="params">head</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨é›†åˆæˆ–è€…å“ˆå¸Œè¡¨ï¼Œè®°å½•è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œè‹¥å†æ¬¡å‡ºç°åˆ™æœ‰ç¯</span></span><br><span class="line"><span class="string">       1. æ—¶é—´å¤æ‚åº¦ï¼šO(N)O(N)ï¼Œå…¶ä¸­ NN æ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ã€‚æœ€åæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="string">       2. ç©ºé—´å¤æ‚åº¦ï¼šO(N)O(N)ï¼Œå…¶ä¸­ NN æ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ã€‚ä¸»è¦ä¸ºå“ˆå¸Œè¡¨çš„å¼€é”€ï¼Œæœ€åæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        <span class="keyword">if</span> head <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            seen.add(head)</span><br><span class="line">        head = head.<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_cycle_fast_slow_pointer</span>(<span class="params">head</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€å¿«ä¸€æ…¢éå†é“¾è¡¨ï¼Œå¦‚æœé“¾è¡¨å­˜åœ¨ç¯ï¼Œåˆ™æœ€ç»ˆå¿«æŒ‡é’ˆè‚¯å®šä¼šä¸æ…¢æŒ‡é’ˆç›¸é‡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å¦‚æœå¤´èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…å¤´ç»“ç‚¹æ²¡æœ‰ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œåˆ™ä¸å­˜åœ¨ç¯</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.<span class="built_in">next</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸¤ä¸ªå¿«æ…¢æŒ‡é’ˆéå†ï¼Œè¿™é‡Œå¿«æŒ‡é’ˆæ¯”æ…¢æŒ‡é’ˆå…ˆå‡ºå‘</span></span><br><span class="line">    <span class="comment"># ä¸æ˜¯åŒä¸€ä¸ªä½ç½®å‡ºå‘ï¼Œè¿™ä¹ˆå†™çš„åŸå› æ˜¯ while çš„æ¡ä»¶éœ€è¦ä¸€å¼€å§‹</span></span><br><span class="line">    <span class="comment"># å¤„äºä¸æ»¡è¶³çš„æƒ…å†µ</span></span><br><span class="line">    slow = head</span><br><span class="line">    fast = head.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> slow != fast:</span><br><span class="line">        <span class="comment"># å¦‚æœ fast ä¸ºç©ºæˆ–æ²¡æœ‰ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè¯´æ˜éå†åˆ°äº†é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">        <span class="comment"># è¯´æ˜ä¸å­˜åœ¨ç¯ï¼Œæœ‰ç¯çš„è¯ä¼šå¾ªç¯åˆ°å‰é¢çš„ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> fast <span class="keyword">or</span> <span class="keyword">not</span> fast.<span class="built_in">next</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç§»åŠ¨å¿«æ…¢æŒ‡é’ˆ</span></span><br><span class="line">        fast = fast.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">        slow = slow.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># while åçš„æ¡ä»¶ä¸º Trueï¼Œå³ slow == fast, è¯´æ˜å­˜åœ¨ç¯</span></span><br><span class="line">    <span class="comment"># æ­¤æ—¶ slow æŒ‡å‘çš„ç»“ç‚¹ == fast æŒ‡å‘çš„ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p>é“¾è¡¨çš„è®¿é—®æ˜¯ä»ç¬¬ä¸€ä¸ªç»“ç‚¹å¼€å§‹çš„ï¼Œä¸è¦ç”¨æ•°ç»„çš„æ€ç»´å»ç†è§£é“¾è¡¨</p><p>åœ¨é“¾è¡¨æ“ä½œä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªä¼ªç»“ç‚¹ï¼Œåˆç§° dummy ç»“ç‚¹ï¼Œä½¿ç”¨ dummy ç»“ç‚¹çš„å¥½å¤„æ˜¯ 1. åœ¨é“¾è¡¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ²¡æœ‰åˆé€‚çš„ç»“ç‚¹å¯ä»¥ä½¿ç”¨ï¼Œç”¨ä¸€ä¸ªä¼ªç»“ç‚¹å¼€å§‹åˆå§‹åŒ–æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†éœ€è¦æ³¨æ„åœ¨è¿”å›çš„æ—¶å€™éœ€è¦è¿”å› dummy.next. 2. å¯ä»¥ä½¿ç”¨ <code>while node</code> æˆ–è€…æ˜¯ <code>if node</code> ï¼Œæ¥åˆ¤æ–­æŸä¸ªç»“ç‚¹æ˜¯å¦æœ‰ next</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/linked-list-cycle/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="é“¾è¡¨" scheme="https://scottzhang.pro/tags/%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨</title>
    <link href="https://scottzhang.pro/article/6b8b3431.html"/>
    <id>https://scottzhang.pro/article/6b8b3431.html</id>
    <published>2022-05-16T14:38:39.000Z</published>
    <updated>2022-05-17T01:36:26.983Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/merge-k-sorted-lists/">ğŸ“Œ</a> ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p></blockquote><span id="more"></span><h3 id="åˆå¹¶-k-ä¸ªæ’åºé“¾è¡¨">åˆå¹¶ K ä¸ªæ’åºé“¾è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = [[1, 4, 5], [1, 3, 4], [2, 6]]</span><br><span class="line">è¾“å‡ºï¼š[1, 1, 2, 3, 4, 4, 5, 6]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeKLists</span>(<span class="params">lists</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¡ºåºåˆå¹¶ï¼Œæ•ˆç‡ä¸æ˜¯å¾ˆé«˜&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">l1, l2</span>):</span></span><br><span class="line">        d = c = ListNode(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt;= l2.val:</span><br><span class="line">                c.<span class="built_in">next</span>, l1 = l1, l1.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c.<span class="built_in">next</span>, l2 = l2, l2.<span class="built_in">next</span></span><br><span class="line">            c = c.<span class="built_in">next</span></span><br><span class="line">        c.<span class="built_in">next</span> = l1 <span class="keyword">if</span> l1 <span class="keyword">else</span> l2</span><br><span class="line">        <span class="keyword">return</span> d.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lists:</span><br><span class="line">        ans = merge(ans, i)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">mergeKLists([l1, l2])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mergeKLists</span>(<span class="params">lists</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨å †&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> heapq</span><br><span class="line">    dummy = ListNode(<span class="number">0</span>)</span><br><span class="line">    p = dummy</span><br><span class="line">    head = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lists)):</span><br><span class="line">        <span class="keyword">if</span> lists[i]:</span><br><span class="line">            heapq.heappush(head, (lists[i].val, i))</span><br><span class="line">            lists[i] = lists[i].<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        val, idx = heapq.heappop(head)</span><br><span class="line">        p.<span class="built_in">next</span> = ListNode(val)</span><br><span class="line">        p = p.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">if</span> lists[idx]:</span><br><span class="line">            heapq.heappush(head, (lists[idx].val, idx))</span><br><span class="line">            lists[idx] = lists[idx].<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">return</span> dummy.<span class="built_in">next</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/merge-k-sorted-lists/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="é“¾è¡¨" scheme="https://scottzhang.pro/tags/%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: æ— é‡å¤å­—ç¬¦ä¸²çš„æœ€é•¿å­ä¸²</title>
    <link href="https://scottzhang.pro/article/aaafc94b.html"/>
    <id>https://scottzhang.pro/article/aaafc94b.html</id>
    <published>2022-05-16T14:24:34.000Z</published>
    <updated>2022-05-17T01:36:33.533Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚</p></blockquote><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">    seen = &#123;&#125;</span><br><span class="line">    l = <span class="number">0</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        If s[r] not in seen, we can keep increasing the window size by moving right pointer</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> s[r] <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            output = <span class="built_in">max</span>(output, r-l+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># There are two cases if s[r] in seen:</span></span><br><span class="line">        <span class="comment"># case1: s[r] is inside the current window, we need to change the window by moving left pointer to seen[s[r]] + 1.</span></span><br><span class="line">        <span class="comment"># case2: s[r] is not inside the current window, we can keep increase the window</span></span><br><span class="line">            <span class="keyword">if</span> seen[s[r]] &lt; l:</span><br><span class="line">                output = <span class="built_in">max</span>(output,r-l+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l = seen[s[r]] + <span class="number">1</span></span><br><span class="line">        seen[s[r]] = r</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lengthOfLongestSubstring(<span class="string">&quot;pwwkew&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/longest-substring-without-repeating-characters/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜: ç››æ°´æœ€å¤šçš„å®¹å™¨</title>
    <link href="https://scottzhang.pro/article/45859c42.html"/>
    <id>https://scottzhang.pro/article/45859c42.html</id>
    <published>2022-05-16T14:20:11.000Z</published>
    <updated>2022-05-17T01:37:08.992Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode-cn.com/problems/container-with-most-water/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„Â heightÂ ã€‚æœ‰Â nÂ æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯Â (i, 0)Â å’ŒÂ (i, height[i]) æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p></blockquote><span id="more"></span><p>è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚</p><p>åŒæŒ‡é’ˆå¾€ä¸­é—´é æ‹¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_area_towards_center</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ•°ç»„ï¼šä¸€å¼€å§‹å°±å°† left bar å’Œ right bar è®¾ç½®åˆ°æœ€å·¦å’Œæœ€å³</span></span><br><span class="line"><span class="string">    æ…¢æ…¢æ”¶æ•›ï¼Œå› ä¸ºå®½åº¦å·²æ˜¯æœ€å¤§ï¼Œåªéœ€è¦æ§åˆ¶é«˜åº¦å³å¯</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    l, r = <span class="number">0</span>, <span class="built_in">len</span>(arr) - <span class="number">1</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> l &lt; r:</span><br><span class="line">        area = <span class="built_in">min</span>(arr[l], arr[r]) * (r - l)</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, area)</span><br><span class="line">        <span class="keyword">if</span> arr[l] &lt;= arr[r]:</span><br><span class="line">            l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">max_area_towards_center([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>])</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ for å¾ªç¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_area_2_loop</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ•°ç»„ï¼šæšä¸¾æ‰€æœ‰å…ƒç´ ï¼ŒåŒé‡ for å¾ªç¯ï¼Œæ‰¾å‡º area æœ€å¤§çš„</span></span><br><span class="line"><span class="string">    ç¼ºç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    area_max = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(arr)):</span><br><span class="line">            area = (j-i) * <span class="built_in">min</span>(arr[i], arr[j])</span><br><span class="line">            area_max = <span class="built_in">max</span>(area_max, area)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> area_max</span><br><span class="line"></span><br><span class="line">max_area_2_loop([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>])</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ">å‚è€ƒ</h3><ul><li>ğŸ‡ºğŸ‡¸ <a href="https://leetcode.com/problems/container-with-most-water/">è‹±æ–‡ç«™</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/container-with-most-water/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„Â heightÂ ã€‚æœ‰Â nÂ æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯Â (i, 0)Â å’ŒÂ (i, height[i]) æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜ï¼šç§»åŠ¨0</title>
    <link href="https://scottzhang.pro/article/22174669.html"/>
    <id>https://scottzhang.pro/article/22174669.html</id>
    <published>2022-05-16T14:17:58.000Z</published>
    <updated>2022-05-17T01:37:15.617Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://leetcode.cn/problems/move-zeroes/">ğŸ“Œ</a> ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ‰€æœ‰å…¶ä¸­çš„ 0ï¼Œç§»åŠ¨åˆ°æœ«å°¾ã€‚Leetcode</p></blockquote><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">my_arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_zero</span>(<span class="params">arr</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ•°ç»„ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆäº¤æ¢å€¼.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    zero_idx = <span class="number">0</span>  <span class="comment"># æ…¢æŒ‡é’ˆï¼Œå…¶æ•°å€¼è¡¨ç¤º0æ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr)):</span><br><span class="line">        <span class="comment"># è¦åšçš„æ“ä½œä¸æ…¢æŒ‡é’ˆç§»åŠ¨çš„æ¡ä»¶</span></span><br><span class="line">        <span class="comment"># è‹¥ä¸æ»¡è¶³æ…¢æŒ‡é’ˆç§»åŠ¨æ¡ä»¶ï¼Œæ…¢æŒ‡é’ˆåœç•™ä¸åŠ¨ï¼Œå¿«æŒ‡é’ˆç»§ç»­ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">if</span> arr[i] != <span class="number">0</span>:</span><br><span class="line">            arr[i], arr[zero_idx] = arr[zero_idx], arr[i]</span><br><span class="line">            zero_idx += <span class="number">1</span></span><br><span class="line">            <span class="comment"># print(f&quot;&#123;arr&#125;, i:&#123;i&#125;, zero_idx:&#123;zero_idx&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line"></span><br><span class="line">move_zero(my_arr)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/move-zeroes/&quot;&gt;ğŸ“Œ&lt;/a&gt; ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ‰€æœ‰å…¶ä¸­çš„ 0ï¼Œç§»åŠ¨åˆ°æœ«å°¾ã€‚Leetcode&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç®—æ³•é¢˜" scheme="https://scottzhang.pro/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"/>
    
    
    <category term="æ•°ç»„" scheme="https://scottzhang.pro/tags/%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>Python åç¨‹ä¸ç”Ÿæˆå™¨</title>
    <link href="https://scottzhang.pro/article/d7273f24.html"/>
    <id>https://scottzhang.pro/article/d7273f24.html</id>
    <published>2022-05-14T04:41:02.000Z</published>
    <updated>2022-05-15T13:50:32.274Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åç¨‹çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å›è°ƒç¼–å†™éš¾çš„é—®é¢˜ã€‚</p></blockquote><span id="more"></span><h1 id="åç¨‹">åç¨‹</h1><p>æ¯”å¦‚ï¼Œå›è°ƒæ¨¡å¼ç¼–ç å¤æ‚åº¦é«˜ã€åŒæ­¥ç¼–ç¨‹çš„å¹¶å‘æ€§ä¸é«˜ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹éœ€è¦çº¿ç¨‹é—´åŒæ­¥ï¼Œæœ‰ Lock çš„é™åˆ¶ã€‚</p><p>é‚£ä¹ˆèƒ½ä¸èƒ½é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å»ç¼–å†™å¼‚æ­¥çš„ä»£ç å‘¢ï¼Ÿ</p><p>ä¸€ä¸ªåŠæ³•æ˜¯ä½¿ç”¨å•çº¿ç¨‹å»åˆ‡æ¢ä»»åŠ¡ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢çº¿ç¨‹ï¼Œä¹Ÿä¸éœ€è¦é”ï¼Œè€Œä¸”å®ç°äº†å¹¶å‘æ€§å¾ˆé«˜ï¼ˆä½†éœ€è¦ç¨‹åºå‘˜è‡ªå·±å»è°ƒåº¦ä»»åŠ¡ï¼‰ç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_part1</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="comment"># job B ä¸º IO æ“ä½œï¼Œä¼šé˜»å¡</span></span><br><span class="line">    <span class="comment"># æˆ‘ä»¬å¸Œæœ›åœ¨æ‰§è¡Œåˆ° A çš„æ—¶å€™ï¼Œå¯ä»¥è·³å‡ºå»</span></span><br><span class="line">    <span class="comment"># ç»§ç»­æ‰§è¡Œè€—è´¹ CPU çš„éƒ¨åˆ†</span></span><br><span class="line">    a = do_job_A(arg)</span><br><span class="line">    b = do_job_B(a)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_all_job</span>():</span></span><br><span class="line">    p1 = do_part1(<span class="number">1</span>)</span><br><span class="line">    result = do_part2(p1)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>è¯´ç™½äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼Œå³å®ƒå¯ä»¥æš‚åœï¼Œå¹¶ä¸”åœ¨é€‚å½“çš„æ—¶å€™æ¢å¤ã€‚</p><h1 id="ç”Ÿæˆå™¨è¿›é˜¶">ç”Ÿæˆå™¨è¿›é˜¶</h1><h2 id="send">send</h2><p>ç”Ÿæˆå™¨ä¸åªæ˜¯å¯ä»¥äº§å‡ºå€¼ï¼Œè¿˜å¯ä»¥æ¥æ”¶å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    addr = <span class="keyword">yield</span> <span class="string">&quot;google.com&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(addr)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;microsoft.com&quot;</span></span><br><span class="line"></span><br><span class="line">g = gen()</span><br><span class="line">addr = <span class="built_in">next</span>(g)</span><br><span class="line"><span class="comment"># send çš„å€¼ï¼Œå°†å‡½æ•°èµ‹å€¼ç»™å†…éƒ¨çš„ addr</span></span><br><span class="line">after_send = g.send(<span class="string">&quot;apple.com&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¬¬ä¸€æ¬¡éœ€è¦è°ƒç”¨ next æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥ TypeError, å¦‚æœä¸è°ƒç”¨ nextï¼Œä¹Ÿå¯ä»¥åœ¨å¼€å§‹çš„æ—¶å€™ send ä¸€ä¸ª None.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    addr = <span class="keyword">yield</span> <span class="string">&quot;google.com&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(addr)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;microsoft.com&quot;</span></span><br><span class="line"></span><br><span class="line">g = gen()</span><br><span class="line">g.send(<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># send çš„å€¼ï¼Œå°†å‡½æ•°èµ‹å€¼ç»™å†…éƒ¨çš„ addr</span></span><br><span class="line">after_send = g.send(<span class="string">&quot;apple.com&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºåœ¨è°ƒç”¨ send å‘é€é None å€¼ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å¯åŠ¨ä¸€æ¬¡ç”Ÿæˆå™¨ã€‚</p><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol type="1"><li>ä½¿ç”¨ next</li><li>æˆ–è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ send æ–¹æ³•ä¼ å…¥ None å€¼</li></ol><p>å¦å¤–ç”Ÿæˆå™¨ï¼Œè¿˜æœ‰ä¸€ä¸ª close æ–¹æ³•ï¼Œå¯ä»¥å°†ç”Ÿæˆå™¨å…³é—­ã€‚</p><p>å¦‚æœä¸€ä¸ªç”Ÿæˆå™¨ä¼š yield ä¸‰æ¬¡ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡çš„æ—¶å€™ close äº†ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡çš„æ—¶å€™è°ƒç”¨ next å°±ä¼šæŠ¥ GeneratorExit é”™è¯¯ã€‚</p><h2 id="throw">throw</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    <span class="comment"># ä¸ºä»€ä¹ˆä¸æ˜¯ try microsoft</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">&quot;google.com&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Pass Test Error&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;microsoft.com&quot;</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;scottzhang.pro&quot;</span></span><br><span class="line"></span><br><span class="line">g = gen()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(g))</span><br><span class="line">g.throw(Exception, <span class="string">&quot;TestError&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(g))</span><br></pre></td></tr></table></figure><h2 id="yield-from">yield from</h2><blockquote><p>Python 3.3 æ–°è¯­æ³•ã€‚</p></blockquote><p>yield from å¯ä»¥ç†è§£ä¸º yiled çš„ç®€åŒ–ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸¤ç§å†™æ³•å·®ä¸å¤šæ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_chain</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    <span class="keyword">for</span> v1 <span class="keyword">in</span> args:</span><br><span class="line">        <span class="keyword">for</span> v2 <span class="keyword">in</span> v1:</span><br><span class="line">            <span class="keyword">yield</span> v2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_chain</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    <span class="keyword">for</span> v1 <span class="keyword">in</span> args:</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> v1</span><br></pre></td></tr></table></figure><p>yield from è¿˜æœ‰å¦å¤–ä¸€ä¸ªåŠŸèƒ½ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_gen</span>(<span class="params">gen</span>):</span></span><br><span class="line">    <span class="comment"># gen æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> gen</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    g = my_gen()</span><br><span class="line">    g.send(<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å‡ ä¸ªæ¦‚å¿µéœ€è¦åŒºåˆ†æ¸…æ¥šï¼š</p><ul><li>main å«åšè°ƒç”¨è€…</li><li>my_gen å«åšå§”æ‰˜ç”Ÿæˆå™¨</li><li>gen å«åšå­ç”Ÿæˆå™¨</li></ul><p><code>yield from</code> çš„å¦å¤–ä¸€ä¸ªç‰¹æ€§å°±æ˜¯èƒ½åœ¨è°ƒç”¨è€…å’Œå­ç”Ÿæˆå™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªé€šé“ï¼Œè€Œä¸”æ˜¯åŒå‘çš„ã€‚</p><p>ä¸€ä¸ªåŸºäºä¸Šé¢çš„æ¨¡å¼ç¼–ç¨‹çš„ä¾‹å­ï¼Œè¦æ±‚æ˜¯ç»Ÿè®¡ä¸€ä¸ªå­—å…¸ä¸­å€¼çš„ä¸ªæ•°ï¼Œ å¹¶å°†å€¼é‡æ–°èµ‹å€¼ä¸º(num, [values]) çš„å½¢å¼ï¼Œå³å€¼å˜ä¸ºä¸ªæ•°ä¸å€¼çš„å…ƒç»„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»“æœå­—å…¸</span></span><br><span class="line">final_result = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sales_sum</span>(<span class="params">pro_name</span>):</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    nums = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = <span class="keyword">yield</span></span><br><span class="line">        <span class="built_in">print</span>(pro_name+<span class="string">&quot;é”€é‡: &quot;</span>, x)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> x:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        total += x</span><br><span class="line">        nums.append(x)</span><br><span class="line">    <span class="keyword">return</span> total, nums</span><br><span class="line"></span><br><span class="line"><span class="comment"># å§”æ‰˜ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">middle</span>(<span class="params">key</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        final_result[key] = <span class="keyword">yield</span> <span class="keyword">from</span> sales_sum(key)</span><br><span class="line">        <span class="built_in">print</span>(key + <span class="string">&quot;é”€é‡ç»Ÿè®¡å®Œæˆï¼ï¼.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨è€…</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># äº§å“é”€é‡å­—å…¸</span></span><br><span class="line">    data_sets = &#123;</span><br><span class="line">        <span class="string">&quot;äº§å“A&quot;</span>: [<span class="number">1200</span>, <span class="number">1500</span>, <span class="number">3000</span>],</span><br><span class="line">        <span class="string">&quot;äº§å“B&quot;</span>: [<span class="number">28</span>,<span class="number">55</span>,<span class="number">98</span>,<span class="number">108</span> ],</span><br><span class="line">        <span class="string">&quot;äº§å“C&quot;</span>: [<span class="number">280</span>,<span class="number">560</span>,<span class="number">778</span>,<span class="number">70</span>],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> key, data_set <span class="keyword">in</span> data_sets.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;start key:&quot;</span>, key)</span><br><span class="line">        m = middle(key)</span><br><span class="line">        m.send(<span class="literal">None</span>) <span class="comment"># é¢„æ¿€ middle åç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> data_set:</span><br><span class="line">            m.send(value)   <span class="comment"># ç»™åç¨‹ä¼ é€’æ¯ä¸€ç»„çš„å€¼</span></span><br><span class="line">        m.send(<span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;final_result:&quot;</span>, final_result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä½ ä¼šæœ‰ç–‘é—®ä¸ºä»€ä¹ˆè¿™é‡Œä¸æŠŠå­ç”Ÿæˆå™¨å’Œå§”æ‰˜ç”Ÿæˆå™¨åˆäºŒä¸ºä¸€ï¼Œè¿™æ ·ç›´æ¥ä½¿ç”¨ yield ä¹Ÿå¯ä»¥å®ç°ã€‚</p><p>ä½†è¿™æ ·ä½ å°±å¾—åœ¨ç”Ÿæˆå™¨å¿«ç»“æŸçš„æ—¶å€™ï¼Œè‡ªå·±å¤„ç†ç”Ÿæˆå™¨å¯¹è±¡çš„å¼‚å¸¸ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">my_gen.send(last_value)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        my_gen.send(<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">except</span> StopIteration <span class="keyword">as</span> e:</span><br><span class="line">        result = e.value</span><br></pre></td></tr></table></figure><p>è€Œ yield from ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¤„ç†è¿™äº›é€»è¾‘ï¼Œä½†è¿˜ä¸æ­¢è¿™äº›ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ yield from èƒŒåæºç çš„åŸç†, çœ‹æºç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¤è¯†ä¸‹æ‰€ç”¨åˆ°çš„å˜é‡ã€‚</p><blockquote><p>PEP380</p></blockquote><ul><li>_iï¼šå­ç”Ÿæˆå™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨</li><li>_yï¼šå­ç”Ÿæˆå™¨ç”Ÿäº§çš„å€¼</li><li>_rï¼šyield from è¡¨è¾¾å¼æœ€ç»ˆçš„å€¼</li><li>_sï¼šè°ƒç”¨æ–¹é€šè¿‡send()å‘é€çš„å€¼</li><li>_eï¼šå¼‚å¸¸å¯¹è±¡</li></ul><p>æ‘˜å½•ä¸€æ®µç®€å•çš„æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_i = <span class="built_in">iter</span>(EXPR)      <span class="comment"># EXPRæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œ_iå…¶å®æ˜¯å­ç”Ÿæˆå™¨ï¼›</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    _y = <span class="built_in">next</span>(_i)   <span class="comment"># é¢„æ¿€å­ç”Ÿæˆå™¨ï¼ŒæŠŠäº§å‡ºçš„ç¬¬ä¸€ä¸ªå€¼å­˜åœ¨_yä¸­ï¼›</span></span><br><span class="line"><span class="keyword">except</span> StopIteration <span class="keyword">as</span> _e:</span><br><span class="line">    _r = _e.value   <span class="comment"># å¦‚æœæŠ›å‡ºäº†`StopIteration`å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±å°†å¼‚å¸¸å¯¹è±¡çš„`value`å±æ€§ä¿å­˜åˆ°_rï¼Œè¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µçš„è¿”å›å€¼ï¼›</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:    <span class="comment"># å°è¯•æ‰§è¡Œè¿™ä¸ªå¾ªç¯ï¼Œå§”æ‰˜ç”Ÿæˆå™¨ä¼šé˜»å¡ï¼›</span></span><br><span class="line">        _s = <span class="keyword">yield</span> _y   <span class="comment"># ç”Ÿäº§å­ç”Ÿæˆå™¨çš„å€¼ï¼Œç­‰å¾…è°ƒç”¨æ–¹`send()`å€¼ï¼Œå‘é€è¿‡æ¥çš„å€¼å°†ä¿å­˜åœ¨_sä¸­ï¼›</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _y = _i.send(_s)    <span class="comment"># è½¬å‘_sï¼Œå¹¶ä¸”å°è¯•å‘ä¸‹æ‰§è¡Œï¼›</span></span><br><span class="line">        <span class="keyword">except</span> StopIteration <span class="keyword">as</span> _e:</span><br><span class="line">            _r = _e.value       <span class="comment"># å¦‚æœå­ç”Ÿæˆå™¨æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±è·å–å¼‚å¸¸å¯¹è±¡çš„`value`å±æ€§å­˜åˆ°_rï¼Œé€€å‡ºå¾ªç¯ï¼Œæ¢å¤å§”æ‰˜ç”Ÿæˆå™¨çš„è¿è¡Œï¼›</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">RESULT = _r     <span class="comment"># _rå°±æ˜¯æ•´ä¸ªyield fromè¡¨è¾¾å¼è¿”å›çš„å€¼ã€‚</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œyield from è¿˜éœ€è¦å¤„ç†è¿™äº›é€»è¾‘ï¼š</p><ol type="1"><li>å­ç”Ÿæˆå™¨å¯èƒ½åªæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªä½œä¸ºåç¨‹çš„ç”Ÿæˆå™¨ï¼Œæ‰€ä»¥å®ƒä¸æ”¯æŒ.throw()å’Œ.close()æ–¹æ³•ï¼›</li><li>å¦‚æœå­ç”Ÿæˆå™¨æ”¯æŒ.throw()å’Œ.close()æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å­ç”Ÿæˆå™¨å†…éƒ¨ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›</li><li>è°ƒç”¨æ–¹è®©å­ç”Ÿæˆå™¨è‡ªå·±æŠ›å‡ºå¼‚å¸¸</li><li>å½“è°ƒç”¨æ–¹ä½¿ç”¨next()æˆ–è€….send(None)æ—¶ï¼Œéƒ½è¦åœ¨å­ç”Ÿæˆå™¨ä¸Šè°ƒç”¨next()å‡½æ•°ï¼Œå½“è°ƒç”¨æ–¹ä½¿ç”¨.send()å‘é€é None å€¼æ—¶ï¼Œæ‰è°ƒç”¨å­ç”Ÿæˆå™¨çš„.send()æ–¹æ³•ï¼›</li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>æ€»ç»“ä¸€ä¸‹å…³é”®ç‚¹ï¼š</p><ol type="1"><li>å­ç”Ÿæˆå™¨ç”Ÿäº§çš„å€¼ï¼Œéƒ½æ˜¯ç›´æ¥ä¼ ç»™è°ƒç”¨æ–¹çš„ï¼›è°ƒç”¨æ–¹é€šè¿‡.send()å‘é€çš„å€¼éƒ½æ˜¯ç›´æ¥ä¼ é€’ç»™å­ç”Ÿæˆå™¨çš„ï¼›å¦‚æœå‘é€çš„æ˜¯ Noneï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„__next__()æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ Noneï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„.send()æ–¹æ³•ï¼›</li><li>å­ç”Ÿæˆå™¨é€€å‡ºçš„æ—¶å€™ï¼Œæœ€åçš„return EXPRï¼Œä¼šè§¦å‘ä¸€ä¸ªStopIteration(EXPR)å¼‚å¸¸ï¼›</li><li>yield fromè¡¨è¾¾å¼çš„å€¼ï¼Œæ˜¯å­ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶ï¼Œä¼ é€’ç»™StopIterationå¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼›</li><li>å¦‚æœè°ƒç”¨çš„æ—¶å€™å‡ºç°StopIterationå¼‚å¸¸ï¼Œå§”æ‰˜ç”Ÿæˆå™¨ä¼šæ¢å¤è¿è¡Œï¼ŒåŒæ—¶å…¶ä»–çš„å¼‚å¸¸ä¼šå‘ä¸Š "å†’æ³¡"ï¼›</li><li>ä¼ å…¥å§”æ‰˜ç”Ÿæˆå™¨çš„å¼‚å¸¸é‡Œï¼Œé™¤äº†GeneratorExitä¹‹å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰å¼‚å¸¸å…¨éƒ¨ä¼ é€’ç»™å­ç”Ÿæˆå™¨çš„.throw()æ–¹æ³•ï¼›å¦‚æœè°ƒç”¨.throw()çš„æ—¶å€™å‡ºç°äº†StopIterationå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±æ¢å¤å§”æ‰˜ç”Ÿæˆå™¨çš„è¿è¡Œï¼Œå…¶ä»–çš„å¼‚å¸¸å…¨éƒ¨å‘ä¸Š "å†’æ³¡"ï¼›</li><li>å¦‚æœåœ¨å§”æ‰˜ç”Ÿæˆå™¨ä¸Šè°ƒç”¨.close()æˆ–ä¼ å…¥GeneratorExitå¼‚å¸¸ï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„.close()æ–¹æ³•ï¼Œæ²¡æœ‰çš„è¯å°±ä¸è°ƒç”¨ã€‚å¦‚æœåœ¨è°ƒç”¨.close()çš„æ—¶å€™æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±å‘ä¸Š "å†’æ³¡"ï¼Œå¦åˆ™çš„è¯å§”æ‰˜ç”Ÿæˆå™¨ä¼šæŠ›å‡ºGeneratorExitå¼‚å¸¸ã€‚</li></ol><h1 id="async-å’Œ-await">async å’Œ await</h1><p>Python 3.5+ åï¼Œå¼•å…¥äº† async å’Œ await ä¸¤ä¸ªå…³é”®å­—ï¼Œå®šä¹‰äº†åŸç”Ÿçš„åç¨‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">downloader</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Fake Result&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">download_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># do something</span></span><br><span class="line">    <span class="comment"># å°†ä»»åŠ¡äº¤ç»™å­åç¨‹å®Œæˆ</span></span><br><span class="line">    <span class="comment"># await åé¢è·Ÿçš„æ˜¯ collections.Awaittable å¯¹è±¡</span></span><br><span class="line">    <span class="comment"># ä¹Ÿå¯ä»¥å®ç° __await__ é­”æ³•æ–¹æ³•æ¥æ”¯æŒ</span></span><br><span class="line">    <span class="comment"># await å¯ä»¥ç†è§£ä¸º yield from</span></span><br><span class="line">    result = <span class="keyword">await</span> downloader(url)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    coro = download_url(<span class="string">&quot;www.scottzhang.pro&quot;</span>)</span><br><span class="line">    coro.send(<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç”Ÿæˆå™¨æ˜¯ä¸å¯ä»¥ç›´æ¥ä¼ ç»™ awaitï¼Œä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;Fake Result&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">download_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    result = <span class="keyword">await</span> downloader(url)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    coro = download_url(<span class="string">&quot;www.scottzhang.pro&quot;</span>)</span><br><span class="line">    coro.send(<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•æ˜¯ï¼ŒåŠ ä¸€ä¸ªè£…é¥°å™¨, è¿™ä¸ªè£…é¥°å™¨ä¼šå°†è¿™ä¸ªå‡½æ•°å®ç° <code>__await__</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> types</span><br><span class="line"></span><br><span class="line"><span class="meta">@types.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;Fake Result&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åç¨‹çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å›è°ƒç¼–å†™éš¾çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="åç¨‹" scheme="https://scottzhang.pro/tags/%E5%8D%8F%E7%A8%8B/"/>
    
    <category term="ç”Ÿæˆå™¨" scheme="https://scottzhang.pro/tags/%E7%94%9F%E6%88%90%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Python åç¨‹å’Œå¼‚æ­¥IO</title>
    <link href="https://scottzhang.pro/article/4bf14380.html"/>
    <id>https://scottzhang.pro/article/4bf14380.html</id>
    <published>2022-05-11T03:40:41.000Z</published>
    <updated>2022-05-14T04:42:10.320Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»‹ç»äº†ä¸€äº›å¼‚æ­¥IOçš„åŸºæœ¬æ¦‚å¿µä¸ Select å³å›è°ƒå‡½æ•°çš„ä½¿ç”¨ã€‚</p></blockquote><span id="more"></span><h1 id="ä¸€äº›åŸºæœ¬æ¦‚å¿µ">ä¸€äº›åŸºæœ¬æ¦‚å¿µ</h1><p>åœ¨å­¦ä¹ åç¨‹ä¹‹å‰ï¼Œå»ºè®®å…ˆå¤ä¹ ä¸€ä¸‹ socket ç¼–ç¨‹å’Œå¤šçº¿ç¨‹çš„çŸ¥è¯†ã€‚</p><p><strong>å¹¶å‘ä¸å¹¶è¡Œ</strong></p><p>å¹¶å‘ï¼šä¸€ä¸ªæ—¶é—´æ®µã€æœ‰å‡ ä¸ªç¨‹åºåœ¨åŒä¸€ä¸ª CPU ä¸Šè¿è¡Œï¼Œä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªç¨‹åºåœ¨CPUä¸Šè¿è¡Œã€‚</p><p>å¹¶è¡Œï¼šä»»æ„æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªç¨‹åºè¿è¡Œåœ¨å¤šä¸ª CPU ä¸Šã€‚</p><p><strong>åŒæ­¥å’Œå¼‚æ­¥</strong></p><blockquote><p>æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æœºåˆ¶ï¼ŒæŠŠæ“ä½œçœ‹æˆæ¶ˆæ¯åœ¨ä¸åŒçº¿ç¨‹ã€åç¨‹ä¸­å‘é€ï¼Œç„¶åå¾—åˆ° Futureè¿›è¡Œåç»­æ“ä½œã€‚</p></blockquote><p>åŒæ­¥ï¼šä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œå¿…é¡»ç­‰å¾…IOæ“ä½œå®Œæˆèœè¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚</p><p>å¼‚æ­¥ï¼šä»£ç è°ƒç”¨IOæ“ä½œæ—¶ï¼Œä¸å¿…ç­‰æ“ä½œå®Œæˆå°±è¿”å›çš„è°ƒç”¨æ–¹å¼ã€‚</p><p><strong>é˜»å¡å’Œéé˜»å¡</strong></p><blockquote><p>æ˜¯ä¸€ç§å‡½æ•°è°ƒç”¨çš„æœºåˆ¶ã€‚</p></blockquote><p>é˜»å¡ï¼šè°ƒç”¨å‡½æ•°æ˜¯å½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ã€‚</p><p>éé˜»å¡ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯-c10k-é—®é¢˜">ä»€ä¹ˆæ˜¯ C10K é—®é¢˜ï¼Ÿ</h1><p><a href="https://en.wikipedia.org/wiki/C10k_problem">C10K</a>ï¼Œä¸€ä¸ª1999 å¹´æå‡ºæ¥çš„æŠ€æœ¯æŒ‘æˆ˜ï¼Œå³æˆ‘ä»¬å¦‚ä½•åœ¨1é¢— 1GHz CPUï¼Œ2G å†…å­˜ï¼Œ1gbps ç½‘ç»œç¯å¢ƒä¸‹ï¼Œè®©å•å°æœåŠ¡å™¨åŒæ—¶ä¸º1ä¸‡ä¸ªå®¢æˆ·ç«¯æä¾›FTPæœåŠ¡ã€‚</p><h1 id="io-å¤šè·¯å¤ç”¨">IO å¤šè·¯å¤ç”¨</h1><p>Unix ä¸‹çš„äº”ç§ I/O æ¨¡å‹:</p><ul><li>é˜»å¡ I/O</li><li>éé˜»å¡ I/O</li><li>å¤šè·¯å¤ç”¨ I/O</li><li>ä¿¡å·é©±åŠ¨æ˜¯ I/O</li><li>å¼‚æ­¥I/O (POSIX çš„ aio_ç³»åˆ—å‡½æ•°)</li></ul><p>ä»¥ socket ä¸­çš„è¿æ¥å»ºç«‹ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --- é˜»å¡ I/O</span></span><br><span class="line"><span class="comment"># åŸºç¡€çš„ç”¨çš„æœ€å¤šçš„ï¼Œsocket.connect è¿æ¥æˆåŠŸåå†è¿”å›ï¼Œè¿™æ—¶å€™äº§ç”Ÿé˜»å¡</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((host, <span class="number">80</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---  éé˜»å¡ I/O</span></span><br><span class="line"><span class="comment"># å‘å‡º socket.connect åé©¬ä¸Šè¿”å›ï¼ˆä¸é˜»å¡ï¼Œä½†æ²¡æœ‰ç»“æœï¼‰</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.setblocking(<span class="literal">False</span>)</span><br><span class="line">client.connect((host, <span class="number">80</span>))</span><br><span class="line"><span class="comment"># éšåä¸åœè¯¢é—®æœåŠ¡ç«¯è¿æ¥æ˜¯å¦ï¼ŒæˆåŠŸåæ‰å¯ä»¥å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"># ä¸è¿‡æ­¤æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°±å¼€å§‹å¹²åˆ«çš„äº‹æƒ…</span></span><br><span class="line"><span class="keyword">while</span> (client connected):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">client.send(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---å¤šè·¯å¤ç”¨ I/O</span></span><br><span class="line"><span class="comment"># è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ select æ–¹æ³•ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘Šè¯‰æˆ‘ä»¬å“ªäº› socket çš„ç«¯å£</span></span><br><span class="line"><span class="comment"># å’Œæ–‡ä»¶å¥æŸ„å·²ç»å‡†å¤‡å¥½äº†ï¼Œå®ƒæ”¯æŒç›‘å¬å¤šä¸ªæ–‡ä»¶å’Œ socketï¼ˆselect æœ¬è´¨ä¸Šä¹Ÿæ˜¯é˜»å¡æ–¹æ³•)</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›‘å¬100ä¸ªç«¯å£ï¼Œåªè¦å…¶ä¸­æŸä¸ªç«¯å£å¯ç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç«‹å³å¤„ç†</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---ä¿¡å·é©±åŠ¨å¼ I/O</span></span><br><span class="line"><span class="comment"># åº”ç”¨è¾ƒå°‘ï¼Œæš‚æ—¶ä¸åšä»‹ç»</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---å¼‚æ­¥ I/O</span></span><br><span class="line"><span class="comment"># aio_read çœŸæ­£çš„å¼‚æ­¥</span></span><br></pre></td></tr></table></figure><p>select,poll,epoll éƒ½æ˜¯ I/0 å¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I/0 å¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚</p><p>ä½†select,poll, epoll æœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥ I/0ï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£ è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥V/0åˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥IOçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><h2 id="select">Select</h2><p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯ writefdsã€readfds, å’Œ exceptfdsã€‚</p><p>è°ƒç”¨å select å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚</p><p>å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><p>selectç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚</p><p>selectçš„ä¸€ä¸ªç¼ºç‚¹åœ¨äºï¼Œå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨Linuxä¸Šä¸€èˆ¬ä¸º1024ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆç‡çš„é™ä½ã€‚</p><h2 id="poll">Poll</h2><p>ä¸åŒä¸selectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ªpollfdçš„æŒ‡é’ˆå®ç°ã€‚</p><p>polfdç»“æ„åŒ…å«äº†è¦ç›‘è§†çš„eventå’Œå‘ç”Ÿçš„eventï¼Œä¸å†ä½¿ç”¨select "å‚æ•°-å€¼" ä¼ é€’çš„æ–¹å¼ã€‚</p><p>åŒæ—¶ï¼Œpollfdå¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆ ä½†æ˜¯æ•°é‡è¿‡å¤§åæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚å’Œselectè¥¿æ•°ä¸€æ ·ï¼Œpolè¿”å›åéœ€è¦è½®è¯¢polfdæ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚ä»ä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›åï¼Œé€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å– å·²ç»å°±ç»ªçš„socketã€‚</p><p>äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™</p><h2 id="epoll">Epoll</h2><p>epollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpolçš„å¢å¼ºç‰ˆæœ¬ã€‚</p><p>ç›¸å¯¹äºselectå’Œpollæ¥è¯´ï¼Œepolæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨-ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚</p><p>epoll å®ç°ä½¿ç”¨äº†çº¢é»‘æ ‘ã€‚</p><h2 id="å¯¹æ¯”">å¯¹æ¯”</h2><p>åœ¨å¹¶å‘é«˜çš„æƒ…å†µä¸‹ï¼Œè¿æ¥æ´»è·ƒåº¦ä¸æ˜¯å¾ˆé«˜ï¼Œepoll æ¯” selelct å¥½ï¼›</p><p>å¹¶å‘ä¸é«˜ï¼Œè¿æ¥å¾ˆæ´»è·ƒçš„æ—¶å€™ï¼Œselect æ¯” epoll å¥½ï¼›</p><h1 id="å®ä¾‹éé˜»å¡io">å®ä¾‹ï¼šéé˜»å¡I/O</h1><p>å…ˆçœ‹ä¸€æ®µä½¿ç”¨éé˜»å¡IOå®Œæˆ socket è¯·æ±‚ä¸æ¥å—çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨éé˜»å¡ioå®Œæˆhttpè¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># é€šè¿‡socketè¯·æ±‚html</span></span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    host = url.netloc</span><br><span class="line">    path = url.path</span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        path = <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å»ºç«‹socketè¿æ¥</span></span><br><span class="line">    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    client.setblocking(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        client.connect((host, <span class="number">80</span>)) <span class="comment">#é˜»å¡ä¸ä¼šæ¶ˆè€—cpu</span></span><br><span class="line">    <span class="keyword">except</span> BlockingIOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸åœçš„è¯¢é—®è¿æ¥æ˜¯å¦å»ºç«‹å¥½ï¼Œ éœ€è¦whileå¾ªç¯ä¸åœçš„å»æ£€æŸ¥çŠ¶æ€</span></span><br><span class="line">    <span class="comment"># åšè®¡ç®—ä»»åŠ¡æˆ–è€…å†æ¬¡å‘èµ·å…¶ä»–çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">    send_to = <span class="string">&quot;GET &#123;&#125; HTTP/1.1\r\nHost:&#123;&#125;\r\nConnection:close\r\n\r\n&quot;</span>.<span class="built_in">format</span>(path, host).encode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            client.send(send_to)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    data = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            d = client.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">except</span> BlockingIOError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> d:</span><br><span class="line">            data += d</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    data = data.decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    html_data = data.split(<span class="string">&quot;\r\n\r\n&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(html_data)</span><br><span class="line">    client.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_url(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å®ä¾‹select-å›è°ƒ">å®ä¾‹ï¼šSelect å›è°ƒ</h1><p>ä¸‹é¢è¿™ä¸ªæ˜¯ä½¿ç”¨ Select çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€å¤„ç†ç³»ç»Ÿå…¼å®¹æ€§é—®é¢˜</span></span><br><span class="line"><span class="comment"># å¦‚ Windows å’Œ Linux ä¸ä¸€æ ·, æ¨èä½¿ç”¨ selectors</span></span><br><span class="line"><span class="comment"># import select</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selectors <span class="keyword">import</span> DefaultSelector, EVENT_READ, EVENT_WRITE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">selector = DefaultSelector()</span><br><span class="line"><span class="comment"># ä½¿ç”¨selectå®Œæˆhttpè¯·æ±‚</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ªçº¿ç¨‹å‘å‡ºurlè¯·æ±‚åå³å¯ä¸ç®¡ï¼Œæ“ä½œç³»ç»Ÿ select</span></span><br><span class="line"><span class="comment"># ä¼šè‡ªåŠ¨ä½¿ç”¨å¯ç”¨çš„ socket å¤„ç†ï¼Œå¯¹æ¯”å¤šçº¿ç¨‹ä¸­ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª url</span></span><br><span class="line"><span class="comment"># çœå»äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä»¥åŠå…¶å ç”¨çš„å†…å­˜</span></span><br><span class="line">urls = []</span><br><span class="line">stop = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fetcher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connected</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        selector.unregister(key.fd)</span><br><span class="line">        self.client.send(<span class="string">&quot;GET &#123;&#125; HTTP/1.1\r\nHost:&#123;&#125;\r\nConnection:close\r\n\r\n&quot;</span>.<span class="built_in">format</span>(self.path, self.host).encode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">        selector.register(self.client.fileno(), EVENT_READ, self.readable)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">readable</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        d = self.client.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> d:</span><br><span class="line">            self.data += d</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            selector.unregister(key.fd)</span><br><span class="line">            data = self.data.decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">            html_data = data.split(<span class="string">&quot;\r\n\r\n&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="built_in">print</span>(html_data)</span><br><span class="line">            self.client.close()</span><br><span class="line">            urls.remove(self.spider_url)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> urls:</span><br><span class="line">                <span class="keyword">global</span> stop</span><br><span class="line">                stop = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">self, url</span>):</span></span><br><span class="line">        self.spider_url = url</span><br><span class="line">        url = urlparse(url)</span><br><span class="line">        self.host = url.netloc</span><br><span class="line">        self.path = url.path</span><br><span class="line">        self.data = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.path == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            self.path = <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å»ºç«‹socketè¿æ¥</span></span><br><span class="line">        self.client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.client.setblocking(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.client.connect((self.host, <span class="number">80</span>))  <span class="comment"># é˜»å¡ä¸ä¼šæ¶ˆè€—cpu</span></span><br><span class="line">        <span class="keyword">except</span> BlockingIOError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#æ³¨å†Œ</span></span><br><span class="line">        selector.register(self.client.fileno(), EVENT_WRITE, self.connected)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span>():</span></span><br><span class="line">    <span class="comment">#äº‹ä»¶å¾ªç¯ï¼Œä¸åœçš„è¯·æ±‚socketçš„çŠ¶æ€å¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment"># 1. selectæœ¬èº«æ˜¯ä¸æ”¯æŒregisteræ¨¡å¼</span></span><br><span class="line">    <span class="comment"># 2. socketçŠ¶æ€å˜åŒ–ä»¥åçš„å›è°ƒæ˜¯ç”±ç¨‹åºå‘˜å®Œæˆçš„</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> stop:</span><br><span class="line">        ready = selector.select()</span><br><span class="line">        <span class="keyword">for</span> key, mask <span class="keyword">in</span> ready:</span><br><span class="line">            call_back = key.data</span><br><span class="line">            call_back(key)</span><br><span class="line">    <span class="comment"># å›è°ƒ+äº‹ä»¶å¾ªç¯+select(poll\epoll)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    fetcher = Fetcher()</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        url = <span class="string">&quot;http://shop.projectsedu.com/goods/&#123;&#125;/&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">        urls.append(url)</span><br><span class="line">        fetcher = Fetcher()</span><br><span class="line">        fetcher.get_url(url)</span><br><span class="line">    loop()</span><br><span class="line">    <span class="built_in">print</span>(time.time()-start_time)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å›è°ƒçš„é—®é¢˜">å›è°ƒçš„é—®é¢˜</h1><p>ä½¿ç”¨å›è°ƒè™½ç„¶å¯ä»¥å¸¦æ¥æ•ˆç‡ä¸Šçš„æå‡ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å›è°ƒå‡½æ•°æ‰§è¡Œä¸æ­£å¸¸æ€ä¹ˆåŠï¼Ÿ</li><li>å›è°ƒå‡½æ•°é‡Œè¿˜è¦åµŒå¥—å›è°ƒæ€ä¹ˆåŠï¼ŸåµŒå¥—å¤šå±‚æ€ä¹ˆåŠï¼Ÿ</li><li>å¤šå±‚åµŒå¥—ä¸­ï¼ŒæŸä¸ªç¯èŠ‚å‡ºé”™äº†æ€ä¹ˆåŠï¼Ÿ</li><li>æœ‰ä¸ªæ•°æ®ï¼Œéœ€è¦æ¯ä¸ªå›è°ƒå‡½æ•°éƒ½å¤„ç†æ€ä¹ˆåŠï¼Ÿ</li><li>æ€ä¹ˆä½¿ç”¨å½“å‰å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Ÿ</li></ul><p>å½’çº³æ¥çœ‹ï¼Œå¯ä»¥è¯´å›è°ƒçš„é—®é¢˜åœ¨äºï¼š</p><ol type="1"><li>ä»£ç å¯è¯»æ€§å˜å·®</li><li>å…±äº«çŠ¶æ€çš„ç®¡ç†å›°éš¾</li><li>å¤„ç†å¼‚å¸¸æ¯”è¾ƒéº»çƒ¦</li></ol><p>è¦å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ—¶å€™å°±è½®åˆ°åç¨‹å‡ºåœºäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»‹ç»äº†ä¸€äº›å¼‚æ­¥IOçš„åŸºæœ¬æ¦‚å¿µä¸ Select å³å›è°ƒå‡½æ•°çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="socket" scheme="https://scottzhang.pro/tags/socket/"/>
    
    <category term="select" scheme="https://scottzhang.pro/tags/select/"/>
    
    <category term="poll" scheme="https://scottzhang.pro/tags/poll/"/>
    
    <category term="epoll" scheme="https://scottzhang.pro/tags/epoll/"/>
    
    <category term="å›è°ƒå‡½æ•°" scheme="https://scottzhang.pro/tags/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>Python å¤šè¿›ç¨‹</title>
    <link href="https://scottzhang.pro/article/4300f84b.html"/>
    <id>https://scottzhang.pro/article/4300f84b.html</id>
    <published>2022-05-11T03:23:35.000Z</published>
    <updated>2022-05-11T03:25:47.485Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Python å¤šè¿›ç¨‹ç¼–ç¨‹å‚è€ƒï¼Œé€‚åˆ CPU å¯†é›†å‹æ“ä½œã€‚</p></blockquote><span id="more"></span><h1 id="å¤šè¿›ç¨‹">å¤šè¿›ç¨‹</h1><p>åœ¨ Python ä¸­ï¼Œå¯¹äºIOå¯†é›†å‹æ“ä½œï¼Œå¯ä»¥è€ƒè™‘å¤šçº¿ç¨‹ã€‚è€Œ CPU å¯†é›†å‹æ“ä½œåˆ™åº”è€ƒè™‘å¤šè¿›ç¨‹ã€‚</p><p>åœ¨ Linux ä¸­, <code>os.fork()</code> å­è¿›ç¨‹ä¼šå°†çˆ¶è¿›ç¨‹ä¸­æ‰€æœ‰æ•°æ®æ‹·è´è¿‡æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hi, This is Scott!&quot;</span>)</span><br><span class="line">pid = os.fork()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä½äºå­è¿›ç¨‹: <span class="subst">&#123;os.getpid()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;çˆ¶è¿›ç¨‹ä¸º: <span class="subst">&#123;os.getppid()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä½äºçˆ¶è¿›ç¨‹: <span class="subst">&#123;pid&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¿è¡Œç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hi, This is Scott!</span><br><span class="line">ä½äºçˆ¶è¿›ç¨‹: 3021</span><br><span class="line">Hi, This is Scott!</span><br><span class="line">ä½äºå­è¿›ç¨‹: 3021</span><br><span class="line">çˆ¶è¿›ç¨‹ä¸º: 3020</span><br></pre></td></tr></table></figure><h1 id="multiprocessing">Multiprocessing</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something</span>(<span class="params">n</span>):</span></span><br><span class="line">    time.sleep(n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;do something in sub_progress&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    progress = multiprocessing.Process(</span><br><span class="line">        target=do_something,</span><br><span class="line">        args=(<span class="number">2</span>,)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;progress pid: <span class="subst">&#123;progress.pid&#125;</span>&quot;</span>)</span><br><span class="line">    progress.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;progress pid: <span class="subst">&#123;progress.pid&#125;</span>&quot;</span>)</span><br><span class="line">    progress.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;main progress finished&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">progress pid: None</span><br><span class="line">progress pid: 3391</span><br><span class="line">do something in sub_progress</span><br><span class="line">main progress finished</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼ï¼Œé‡å†™å†…éƒ¨çš„ run æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†å’Œå¤šçº¿ç¨‹ä¸­çš„ä»£ç ç±»ä¼¼ã€‚</p><h1 id="è¿›ç¨‹æ± ">è¿›ç¨‹æ± </h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something</span>(<span class="params">n</span>):</span></span><br><span class="line">    time.sleep(n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;do something in sub_progress&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># using a pool to manage process</span></span><br><span class="line">    pool = multiprocessing.Pool(multiprocessing.cpu_count())</span><br><span class="line">    result = pool.apply_async(do_something, args=(<span class="number">3</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># waiting all tasks finished</span></span><br><span class="line">    <span class="comment"># must close a pool before join it, for new task added to pool</span></span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    <span class="built_in">print</span>(result.get())</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â¯ python multiprocessing_test.py</span><br><span class="line">do something in sub_progress</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>pool ä¸­è¿˜æœ‰ <code>imap</code> æ–¹æ³•ï¼Œç±»ä¼¼çº¿ç¨‹ä¸­ <code>excuter.map</code> æ–¹æ³•ï¼Œresult ä¸ºæ¯ä¸ªå‡½æ•°çš„è¿”å›å€¼:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥é¡ºåº</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> pool.imap(do_something, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;do something in <span class="subst">&#123;result&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®Œæˆé¡ºåº</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> pool.imap_unordered(do_something, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;do something in <span class="subst">&#123;result&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â¯ python multiprocessing_test.py</span><br><span class="line">do something in sub_progress</span><br><span class="line">do something in 1s</span><br><span class="line">do something in sub_progress</span><br><span class="line">do something in 3s</span><br><span class="line">do something in sub_progress</span><br><span class="line">do something in 5s</span><br></pre></td></tr></table></figure><h1 id="è¿›ç¨‹é—´é€šä¿¡">è¿›ç¨‹é—´é€šä¿¡</h1><p>å¤šè¿›ç¨‹ä¸­ï¼Œä½¿ç”¨å…¨å±€å˜é‡æ˜¯æ— æ³•å…±äº«æ•°æ®çš„ï¼Œå› ä¸ºè¿›ç¨‹é—´çš„æ•°æ®æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚</p><h2 id="ä½¿ç”¨-queue">ä½¿ç”¨ Queue</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="comment"># ä¸‹é¢çš„ queue åœ¨å¤šè¿›ç¨‹ä¸­æ— æ³•ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># from queue import Queue</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">queue</span>):</span></span><br><span class="line">    queue.put(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">queue</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    data = queue.get()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue = Queue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    my_producer = Process(target=producer, args=(queue,))</span><br><span class="line">    my_consumer = Process(target=consumer, args=(queue,))</span><br><span class="line"></span><br><span class="line">    my_producer.start()</span><br><span class="line">    my_consumer.start()</span><br><span class="line"></span><br><span class="line">    my_producer.join()</span><br><span class="line">    my_consumer.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨è¿›ç¨‹æ± ">ä½¿ç”¨è¿›ç¨‹æ± </h2><p>Pool ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨ manager ä¸­çš„ queue.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Manager</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">queue</span>):</span></span><br><span class="line">    queue.put(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">queue</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    data = queue.get()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># pool ä¸­çš„ queue éœ€è¦ä½¿ç”¨ manager ä¸­çš„</span></span><br><span class="line">    queue = Manager().Queue(<span class="number">10</span>)</span><br><span class="line">    pool = Pool(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    pool.apply_async(producer, args=(queue,))</span><br><span class="line">    pool.apply_async(consumer, args=(queue,))</span><br><span class="line"></span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬è¿™é‡Œå‡ºç°äº†ä¸‰ä¸ª queueï¼Œæ³¨æ„åŒºåˆ†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Manager</span><br><span class="line">queue = Manager().Queue</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç®¡é“">ä½¿ç”¨ç®¡é“</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pipe, Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">pipe</span>):</span></span><br><span class="line">    pipe.send(<span class="string">&#x27;scott&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">pipe</span>):</span></span><br><span class="line">    data = pipe.recv()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># pipe åªèƒ½é€‚ç”¨äºä¸¤ä¸ªè¿›ç¨‹, ä½†æ›´é«˜æ•ˆï¼Œç›¸æ¯” queue å®ƒæ²¡é‚£ä¹ˆå¤šé”</span></span><br><span class="line">    recevie_pipe, send_pipe = Pipe()</span><br><span class="line"></span><br><span class="line">    my_producer = Process(target=producer, args=(send_pipe,))</span><br><span class="line">    my_consumer = Process(target=consumer, args=(recevie_pipe,))</span><br><span class="line"></span><br><span class="line">    my_producer.start()</span><br><span class="line">    my_consumer.start()</span><br><span class="line">    my_producer.join()</span><br><span class="line">    my_consumer.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å…±äº«å†…å­˜">ä½¿ç”¨å…±äº«å†…å­˜</h2><p>Manager ä¸­æœ‰ä¸€äº›æ”¯æŒå…±äº«å†…å­˜çš„æ•°æ®ç»“æ„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Manager</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">pipe</span>):</span></span><br><span class="line">    pipe.send(<span class="string">&#x27;scott&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">pipe</span>):</span></span><br><span class="line">    data = pipe.recv()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    share_var = Manager().<span class="built_in">dict</span></span><br><span class="line">    share_var = Manager().Array</span><br><span class="line">    share_var = Manager().<span class="built_in">list</span></span><br><span class="line">    <span class="comment"># and more</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Python å¤šè¿›ç¨‹ç¼–ç¨‹å‚è€ƒï¼Œé€‚åˆ CPU å¯†é›†å‹æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Python å¤šè¿›ç¨‹" scheme="https://scottzhang.pro/tags/Python-%E5%A4%9A%E8%BF%9B%E7%A8%8B/"/>
    
    <category term="Multiprocessing" scheme="https://scottzhang.pro/tags/Multiprocessing/"/>
    
  </entry>
  
  <entry>
    <title>Python å¤šçº¿ç¨‹</title>
    <link href="https://scottzhang.pro/article/55e6fd87.html"/>
    <id>https://scottzhang.pro/article/55e6fd87.html</id>
    <published>2022-05-11T03:09:56.000Z</published>
    <updated>2022-05-11T03:23:08.656Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Python å¤šçº¿ç¨‹ç¼–ç¨‹å‚è€ƒã€‚</p></blockquote><span id="more"></span><h1 id="å…³äºçº¿ç¨‹">å…³äºçº¿ç¨‹</h1><p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„æœ€å°è°ƒåº¦å•ä½ï¼Œå±äºè¿›ç¨‹ã€‚å¦‚æœå°†æ“ä½œç³»ç»Ÿæ¯”è¾ƒå·¥å‚ï¼Œé‚£ä¹ˆè¿›ç¨‹å°±å±äºè½¦é—´ï¼Œè€Œçº¿ç¨‹å°±æ˜¯å…·ä½“çš„å·¥äººã€‚</p><h1 id="ä½¿ç”¨-tread-ç±»">ä½¿ç”¨ Tread ç±»</h1><p>Python ä¸­çº¿ç¨‹çš„æ¨¡å—æ˜¯ treading, æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>å…ˆå¯¼å…¥åŒ…ï¼Œå®šä¹‰å¥½æˆ‘ä»¬éœ€è¦çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_detail_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¨¡æ‹Ÿçˆ¬å–ç½‘é¡µå†…å®¹çš„æ“ä½œ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;get detail started&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;get detail end&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_detail_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¨¡æ‹Ÿè·å–ç½‘é¡µåœ°å€çš„æ“ä½œ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;get url started&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;get url end&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿›è¡Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">    thread1 = threading.Thread(target=get_detail_html, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line">    thread2 = threading.Thread(target=get_detail_url, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çº¿ç¨‹å¯ä»¥å¹¶å‘ï¼Œæ‰€ä»¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œåæ— éœ€ç­‰å¾…æ‰§è¡Œç»“æœå³å¯ç»§ç»­æ‰§è¡Œæ‰“å°æ—¶é—´çš„ä»£ç </span></span><br><span class="line">    thread1.start()</span><br><span class="line">    thread2.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.time() - start_time)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰§è¡Œç»“æœ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get detail started</span><br><span class="line">get url started</span><br><span class="line"><span class="number">0.0020024776458740234</span></span><br><span class="line">get detail end</span><br><span class="line">get url end</span><br></pre></td></tr></table></figure><p>è®¾ç½®å®ˆæŠ¤çº¿ç¨‹å¯ä»¥è®©ä¸»çº¿ç¨‹ç»“æŸåå°†å­çº¿ç¨‹éƒ½ kill æ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">    thread1 = threading.Thread(target=get_detail_html, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line">    thread2 = threading.Thread(target=get_detail_url, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">    <span class="comment"># ä¸»è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå­çº¿ç¨‹éƒ½ kill æ‰ï¼Œè‹¥å…¶ä¸­åªæœ‰æŸä¸ª</span></span><br><span class="line">    <span class="comment"># å­çº¿ç¨‹è®¾ç½®äº†å®ˆæŠ¤çº¿ç¨‹ï¼Œåˆ™ç­‰å¾…å¦å¤–ä¸€ä¸ª</span></span><br><span class="line">    thread1.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    thread2.setDaemon(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çº¿ç¨‹å¯ä»¥å¹¶å‘ï¼Œæ‰€ä»¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œåæ— éœ€ç­‰å¾…æ‰§è¡Œç»“æœå³å¯ç»§ç»­æ‰§è¡Œæ‰“å°æ—¶é—´çš„ä»£ç </span></span><br><span class="line">    thread1.start()</span><br><span class="line">    thread2.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.time() - start_time)</span><br></pre></td></tr></table></figure><p>ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå…¶å®ƒå­çº¿ç¨‹ä¹Ÿå°†ç»“æŸï¼ˆåœ¨ jupyter ä¸­ä¸ä¸€æ ·ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get detail started</span><br><span class="line">get url started</span><br><span class="line">0.0010001659393310547</span><br></pre></td></tr></table></figure><p>åŒæ—¶çº¿ç¨‹è¿˜æœ‰ä¸€ä¸ª join æ–¹æ³•ï¼Œå¯ä»¥é€ æˆé˜»å¡å¹¶ç­‰å¾…å‰é¢çš„çº¿ç¨‹ç»“æŸä¹‹åæ‰è¿è¡Œåé¢çš„ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">    thread1 = threading.Thread(target=get_detail_html, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line">    thread2 = threading.Thread(target=get_detail_url, args=(<span class="string">&quot;&quot;</span>,))</span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çº¿ç¨‹å¯ä»¥å¹¶å‘ï¼Œæ‰€ä»¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œåæ— éœ€ç­‰å¾…æ‰§è¡Œç»“æœå³å¯ç»§ç»­æ‰§è¡Œæ‰“å°æ—¶é—´çš„ä»£ç </span></span><br><span class="line">    thread1.start()</span><br><span class="line">    thread2.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é˜»å¡ï¼Œç­‰æ‰€æœ‰å­çº¿ç¨‹è¿è¡Œå®Œæˆæ‰ç»§ç»­</span></span><br><span class="line">    thread1.join()</span><br><span class="line">    thread2.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.time() - start_time)</span><br></pre></td></tr></table></figure><h1 id="ç»§æ‰¿-tread-ç±»">ç»§æ‰¿ Tread ç±»</h1><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§æ‰¿ treading.Tread ç±»å®ç°å¤šçº¿ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetDetailHtml</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¨¡æ‹Ÿçˆ¬å–ç½‘é¡µå†…å®¹çš„æ“ä½œ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get detail started&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get detail end&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetDetailURL</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¨¡æ‹Ÿè·å–ç½‘é¡µåœ°å€çš„æ“ä½œ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get url started&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get url end&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    thread1 = GetDetailHtml()</span><br><span class="line">    thread2 = GetDetailURL()</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    thread1.start()</span><br><span class="line">    thread2.start()</span><br><span class="line"></span><br><span class="line">    thread1.join()</span><br><span class="line">    thread2.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.time() - start_time)</span><br></pre></td></tr></table></figure><h1 id="çº¿ç¨‹é—´é€šä¿¡">çº¿ç¨‹é—´é€šä¿¡</h1><p>å‰é¢æä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯è´Ÿè´£å»æŠ“ urlï¼Œä¸€ä¸ªæ˜¯å»çˆ¬å– url çš„å†…å®¹ï¼Œé‚£ä¹ˆå¯¹äºæŠ“åˆ°çš„ urlï¼Œä½ éœ€è¦æœ‰ä¸€ç§æ–¹å¼ä¼ ç»™çˆ¬å–å†…å®¹çš„å‡½æ•°ï¼Œè¿™å°±æ˜¯çº¿ç¨‹ä¹‹é—´éœ€è¦é€šä¿¡çš„ä¾‹å­ã€‚</p><p>çº¿ç¨‹ä¸­é€šä¿¡æœ‰å‡ ç§æ–¹æ¡ˆï¼š</p><ul><li>ä½¿ç”¨å…¨å±€å˜é‡</li><li>ä½¿ç”¨ Python ä¸­çš„é˜Ÿåˆ—ï¼Œå³ queue</li></ul><h1 id="çº¿ç¨‹åŒæ­¥">çº¿ç¨‹åŒæ­¥</h1><p>åœ¨ä¹‹å‰å…³äº GIL çš„æ–‡ç« ä¸­ï¼Œæœ‰ä¸€ä¸ªå¤šçº¿ç¨‹åŠ å‡çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        total += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desc</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        total -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">thread1 = threading.Thread(target=add)</span><br><span class="line">thread2 = threading.Thread(target=desc)</span><br><span class="line"></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"></span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æŸ¥çœ‹ä¸Šé¢ä»£ç çš„å­—èŠ‚ç çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°å¤§æ¦‚çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>åŠ è½½ total åˆ°å†…å­˜</li><li>åŠ è½½ 1</li><li>è¿›è¡ŒåŠ æ³•æ“ä½œ</li><li>èµ‹å€¼ç»™ total ï¼ˆå¤šçº¿ç¨‹çŠ¶æ€ä¸‹ï¼Œèµ‹å€¼ä¼šå‡ºé”™ï¼‰</li></ol><p>ä¸Šè¿°ä»£ç ï¼Œæ¯æ¬¡çš„ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œå°±æ˜¯å› ä¸ºåœ¨ä¸Šé¢4ä¸ªæ­¥éª¤çš„ä»»æ„ä¸€ä¸ªæ­¥éª¤ä¸­ï¼ŒGIL éƒ½æœ‰å¯èƒ½è¢«é‡Šæ”¾ï¼Œç„¶ååŠ è½½çš„å˜é‡è¢«å…¶ä»–çš„çº¿ç¨‹ä¿®æ”¹äº†ã€‚</p><p>è¿™é‡Œå°±å¼•å‡ºæˆ‘ä»¬çš„çº¿ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼Œå³æˆ‘ä»¬è®¾ç½®ä¸€ç§æ–¹æ³•ï¼Œè®©æŸä¸€æ®µä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰èƒ½åˆ‡æ¢åˆ°åˆ«çš„çº¿ç¨‹æ‰§è¡Œï¼Œè¿™å°±ä¿è¯äº†åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¸ä¼šå‡ºé”™ã€‚</p><h2 id="é”-lock">é” Lock</h2><p>åŒæ­¥æœºåˆ¶å¯ä»¥ä½¿ç”¨é”æ¥å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line">lock = Lock()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">global</span> lock</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        lock.acquire()</span><br><span class="line">        total += <span class="number">1</span></span><br><span class="line">        lock.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desc</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">global</span> lock</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        lock.acquire()</span><br><span class="line">        total -= <span class="number">1</span></span><br><span class="line">        lock.release()</span><br><span class="line"></span><br><span class="line">thread1 = threading.Thread(target=add)</span><br><span class="line">thread2 = threading.Thread(target=desc)</span><br><span class="line"></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Total is: <span class="subst">&#123;total&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># Total is: 0ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœæ­£ç¡®äº†</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨é”ï¼Œä¹Ÿä¼˜ç¼ºç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ€§èƒ½ä¸Šçš„æŸå¤±ï¼Œå¦å¤–æ˜¯å®¹æ˜“å¼•èµ·æ­»é”ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ²¡æœ‰ release å´é‡æ–°ç”³è¯·å¯¼è‡´æ­»é”</span></span><br><span class="line">lock.acquire()</span><br><span class="line">lock.acquire()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç«äº‰æ­»é”</span></span><br><span class="line"><span class="comment"># A ä»»åŠ¡éœ€è¦ aï¼Œbï¼ŒB ä»»åŠ¡éœ€è¦ bï¼Œa</span></span><br><span class="line"><span class="comment"># é‚£ä¹ˆ A å’Œ B äº’ç›¸æŒæœ‰ aï¼Œb å®¹æ˜“å¯¼è‡´æ­»é”</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å­å‡½æ•°æ­»é”</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something</span>(<span class="params">lock</span>):</span></span><br><span class="line">    lock.acquire()</span><br><span class="line"></span><br><span class="line">lock.acquire()</span><br><span class="line">do_something(lock)</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ç¬¬ä¸‰ç§æƒ…å†µï¼ŒPython æœ‰ä¸€ç§ RLockï¼ˆå¯ä»¥é‡å¤ç”³è¯·çš„é”ï¼‰, å¯ä»¥è®©ä½ è¿ç»­ç”³è¯·é”ï¼Œä½†æ˜¯æ³¨æ„ï¼Œç”³è¯·å’Œé‡Šæ”¾çš„æ¬¡æ•°è¦ä¸€æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> RLock</span><br><span class="line"></span><br><span class="line">lock.acquire()</span><br><span class="line">lock.acquire()</span><br><span class="line"><span class="comment"># pass</span></span><br><span class="line">lock.release()</span><br><span class="line">lock.release()</span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶å˜é‡-condition">æ¡ä»¶å˜é‡ Condition</h2><p>å‡è®¾æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯ï¼Œéœ€è¦è®¾è®¡ä¸€ä¸ªå¯¹è¯ç³»ç»Ÿï¼Œè®©ä¸¤ä¸ªäººå¯ä»¥äº’ç›¸å¯¹è¯ï¼Œå³ä»–ä»¬è¯´è¯çš„é¡ºåºéœ€è¦æ˜¯äº¤äº’çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Condition</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cond</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name=<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        self.cond = cond</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># notify å’Œ waitï¼Œå¿…é¡»åœ¨ with è¯­å¥ä¸­</span></span><br><span class="line">        <span class="keyword">with</span> self.cond:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>, 1&quot;</span>) <span class="comment"># Aå…ˆå¤„ç†è‡ªå·±çš„é€»è¾‘</span></span><br><span class="line">            self.cond.notify()       <span class="comment"># é€šçŸ¥è°ƒç”¨ wait çš„æ–¹æ³•å¯åŠ¨</span></span><br><span class="line">            self.cond.wait()         <span class="comment"># ç­‰å¾…æŸä¸ªå˜é‡çš„é€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>, 3&quot;</span>)</span><br><span class="line">            self.cond.notify()</span><br><span class="line">            self.cond.wait()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cond</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name=<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">        self.cond = cond</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># notify å’Œ waitï¼Œå¿…é¡»åœ¨ with è¯­å¥ä¸­</span></span><br><span class="line">        <span class="keyword">with</span> self.cond:</span><br><span class="line">            self.cond.wait()        <span class="comment"># Bé¡ºåºåœ¨åï¼Œæ‰€ä»¥å…ˆç­‰å¾…</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 2&quot;</span>) <span class="comment"># Bå†å¤„ç†è‡ªå·±çš„é€»è¾‘</span></span><br><span class="line">            self.cond.notify()      <span class="comment"># å†é€šçŸ¥ A</span></span><br><span class="line"></span><br><span class="line">            self.cond.wait()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 4&quot;</span>)</span><br><span class="line">            self.cond.notify()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cond = Condition()</span><br><span class="line"></span><br><span class="line">    a = A(cond)</span><br><span class="line">    b = B(cond)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯åŠ¨é¡ºåºå¾ˆé‡è¦ï¼Œåœ¨è¿™é‡Œå¦‚æœ a å¯åŠ¨ï¼Œé‚£ä¹ˆ a é¦–å…ˆå¤„ç†è‡ªå·±çš„ä»£ç </span></span><br><span class="line">    <span class="comment"># éšåå‘é€ notifyï¼Œä½†è¿™ä¸ªæ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œå› ä¸º b è¿˜æ²¡æœ‰å¯åŠ¨èµ·æ¥</span></span><br><span class="line">    <span class="comment"># æ‰€æœ‰æ­£ç¡®çš„æ–¹å¼æ˜¯å…ˆè®© b èµ·æ¥ç­‰å¾…ï¼Œå†å¯åŠ¨ a</span></span><br><span class="line">    b.start()</span><br><span class="line">    a.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆnotify å’Œ waitï¼Œå¿…é¡»åœ¨ with è¯­å¥ä¸­å‘¢ï¼Ÿcondition å†…éƒ¨æœ‰ä¸¤æŠŠé”</p><ul><li>ç¬¬ä¸€åº•å±‚é”ï¼Œæ§åˆ¶ condition çš„è¿›å…¥ï¼Œå³é€šè¿‡ with æˆ–è€… cond.acquire()ã€‚åœ¨è¿™é‡Œ B é€šè¿‡ with è¯­å¥è¿›å…¥ condition å†…éƒ¨åï¼Œå®ƒè°ƒç”¨äº† wait æ–¹æ³•ï¼Œwait å†…éƒ¨é¦–å…ˆä¼šå°†åº•å±‚é”é‡Šæ”¾ï¼Œè¿™æ · a æ‰å¯ä»¥é€šè¿‡ wiht è¯­å¥è¿›å…¥ conditionã€‚</li><li>éšåï¼Œåœ¨ wait æ–¹æ³•å†…ï¼Œå®ƒè¿˜ä¼šç”³è¯·ä¸€æŠŠæ–°çš„é”æ”¾å…¥conditionçš„ç­‰å¾…é˜Ÿåˆ—ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰ä¸­ï¼Œç­‰å¾… notify æ–¹æ³•çš„å”¤é†’</li></ul><p>äº†è§£äº†è¿™ä¸ªåŸç†ï¼Œä¸Šé¢çš„é—®é¢˜å°±å¾ˆç®€å•äº†ï¼Œå¦‚æœä¸å…ˆé€šè¿‡ with è¯­å¥ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è¿›å…¥åˆ° condition å†…éƒ¨çš„ã€‚</p><p>Condition ä¹Ÿæœ‰ç±»ä¼¼é”çš„ç”³è¯·ã€é‡Šæ”¾çš„æ¨¡å¼:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.cond.acquire()</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">self.cond.release()</span><br></pre></td></tr></table></figure><h2 id="ä¿¡å·é‡-semaphore">ä¿¡å·é‡ Semaphore</h2><p>Semaphore æ˜¯ç”¨äºæ§åˆ¶è¿›å…¥æ•°é‡çš„é”ã€‚</p><p>æ¯”å¦‚åœ¨æ–‡ä»¶çš„æ“ä½œä¸­ï¼Œéœ€è¦æ§åˆ¶è¯»å†™çº¿ç¨‹çš„æ•°é‡ã€‚åœ¨çˆ¬è™«çš„å®ç°ä¸­ï¼Œéœ€è¦é™åˆ¶è¯·æ±‚å¹¶å‘æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> calendar <span class="keyword">import</span> c</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlSpider</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;HTML çˆ¬å–æ¨¡æ‹Ÿå™¨ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        threading (Thread): ç»§æ‰¿è‡ªçº¿ç¨‹ç±»ï¼Œæ¯ä¸ª URL æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, url, sem</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.url = url</span><br><span class="line">        self.sem = sem</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.url&#125;</span> finished.&quot;</span>)</span><br><span class="line">        <span class="comment"># å¤„ç†å®Œæˆåï¼Œé‡Šæ”¾è¯¥é”</span></span><br><span class="line">        self.sem.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrlMaker</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, sem</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.sem = sem</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œæœ‰ 100 URL éœ€è¦å¤„ç†ï¼Œä½†æ˜¯åŒæ—¶å¹¶å‘è¿™ä¹ˆå¤šè¯·æ±‚ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="comment"># å¯ä»¥é€šè¿‡ semaphore é™åˆ¶å¹¶å‘çš„æ•°é‡æ¥æ§åˆ¶</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            <span class="comment"># ä¸€æŠŠ sem é”ï¼Œæœ€å¤šè¿›å…¥10ä¸ªçº¿ç¨‹</span></span><br><span class="line">            self.sem.acquire()</span><br><span class="line">            html_sider = HtmlSpider(<span class="string">f&quot;http:/scottzhang.pro/<span class="subst">&#123;i&#125;</span>&quot;</span>, self.sem)</span><br><span class="line">            html_sider.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sem = threading.Semaphore(<span class="number">10</span>)  <span class="comment"># æ§åˆ¶å¹¶å‘æ•°é‡ä¸º 10 ä¸ª</span></span><br><span class="line">    url_maker = UrlMaker(sem)</span><br><span class="line">    url_maker.start()</span><br></pre></td></tr></table></figure><p>ä¿¡å·é‡å†…éƒ¨å®é™…ä¸Šæ˜¯ä½¿ç”¨ condition å®ç°çš„ï¼Œè€Œ condition åˆ™æ˜¯ä½¿ç”¨ queue å®ç°çš„ã€‚</p><h1 id="threadpoolexecutor-çº¿ç¨‹æ± ">ThreadPoolExecutor çº¿ç¨‹æ± </h1><h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><p>çº¿ç¨‹æ± ä¹Ÿå¯ä»¥å®ç° semaphore çš„åŠŸèƒ½ï¼Œå³æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ã€‚</p><p>ä½†æ˜¯çº¿ç¨‹æ± å¯ä»¥æ§åˆ¶çš„ä¸œè¥¿æ›´å¤šï¼Œæ¯”å¦‚å®ƒå¯ä»¥è·å¾—æŸä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¸è¿”å›å€¼ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹å¯ä»¥ç«‹å³çŸ¥é“ã€‚</p><p>å…¶æ¬¡ï¼Œfutures å¯ä»¥è®©å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ç¼–ç æ¥å£ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> as_completed</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_function</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¨¡æ‹ŸæŸä¸ªå‡½æ•°çš„æ‰§è¡Œ&quot;&quot;&quot;</span></span><br><span class="line">    logging.info(<span class="string">&quot;Thread %s: starting&quot;</span>, name)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    logging.info(<span class="string">&quot;Thread %s: finishing&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_thread_1</span>():</span></span><br><span class="line">    logging.info(<span class="string">&quot;# Start thread with method 1&quot;</span>)</span><br><span class="line">    executor = ThreadPoolExecutor(max_workers=<span class="number">2</span>)</span><br><span class="line">    task1 = executor.submit(thread_function, (<span class="string">&#x27;A thread&#x27;</span>))</span><br><span class="line">    task2 = executor.submit(thread_function, (<span class="string">&#x27;B thread&#x27;</span>))</span><br><span class="line">    task3 = executor.submit(thread_function, (<span class="string">&#x27;C thread&#x27;</span>))</span><br><span class="line">    <span class="comment"># æŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼Œè¿”å›ç»“æœ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Task 1 status: <span class="subst">&#123;task1.done()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># å–æ¶ˆæŸä¸ªä»»åŠ¡(è¿˜æœªæ‰§è¡Œ)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Cancel task 3: <span class="subst">&#123;task3.cancel()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_thread_2</span>(<span class="params">names</span>):</span></span><br><span class="line">    logging.info(<span class="string">&quot;# Start thread with method 2&quot;</span>)</span><br><span class="line">    executor = ThreadPoolExecutor(max_workers=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    all_tasks = [</span><br><span class="line">        executor.submit(thread_function, (x)) <span class="keyword">for</span> x <span class="keyword">in</span> names</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># è¿™é‡Œä¼šç›´æ¥è¿›å…¥åˆ° as_completed é€»è¾‘ï¼Œå¹¶ä¸ä¼šé˜»å¡</span></span><br><span class="line">    <span class="comment"># as_completed ä¼šå°†å·²ç»å®Œæˆçš„ task yield</span></span><br><span class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> as_completed(all_tasks):</span><br><span class="line">        data = future.result()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_thread_3</span>(<span class="params">names</span>):</span></span><br><span class="line">    logging.info(<span class="string">&quot;# Start thread with method 3&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">3</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        data = executor.<span class="built_in">map</span>(thread_function, names)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">format</span> = <span class="string">&quot;%(asctime)s: %(message)s&quot;</span></span><br><span class="line">    logging.basicConfig(<span class="built_in">format</span>=<span class="built_in">format</span>, level=logging.INFO,</span><br><span class="line">                        datefmt=<span class="string">&quot;%H:%M:%S&quot;</span>)</span><br><span class="line"></span><br><span class="line">    names = [<span class="string">&#x27;A thread&#x27;</span>, <span class="string">&#x27;B thread&#x27;</span>, <span class="string">&#x27;C thread&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    start_thread_1()</span><br><span class="line">    start_thread_2(names)</span><br><span class="line">    start_thread_3(names)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">15:36:09: # Start thread with method 1</span><br><span class="line">15:36:09: Thread A thread: starting</span><br><span class="line">15:36:09: Thread B thread: starting</span><br><span class="line">Task 1 status: False</span><br><span class="line">Cancel task 3: True</span><br><span class="line">15:36:09: # Start thread with method 2</span><br><span class="line">15:36:09: Thread A thread: starting</span><br><span class="line">15:36:09: Thread B thread: starting</span><br><span class="line">15:36:09: Thread C thread: starting</span><br><span class="line">15:36:11: Thread B thread: finishing</span><br><span class="line">15:36:11: Thread A thread: finishing</span><br><span class="line">15:36:11: Thread C thread: finishing</span><br><span class="line">15:36:11: Thread A thread: finishing</span><br><span class="line">15:36:11: # Start thread with method 3</span><br><span class="line">15:36:11: Thread A thread: starting</span><br><span class="line">15:36:11: Thread B thread: starting</span><br><span class="line">15:36:11: Thread B thread: finishing</span><br><span class="line">15:36:13: Thread B thread: finishing</span><br><span class="line">15:36:13: Thread C thread: starting</span><br><span class="line">15:36:13: Thread A thread: finishing</span><br><span class="line">15:36:15: Thread C thread: finishing</span><br></pre></td></tr></table></figure><p>å¦å¤– <code>concurrent.futures</code> ä¸­è¿˜æœ‰ wait æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥é˜»å¡ã€‚æ¯”å¦‚ä½ æƒ³æŒ‡å®šæŸä¸ªæˆ–è€…æŸäº›ä»»åŠ¡å®Œæˆæ‰ç»§ç»­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> wait, FIRST_COMPLETED</span><br><span class="line"></span><br><span class="line">executor = ThreadPoolExecutor(max_workers=<span class="number">2</span>)</span><br><span class="line">all_tasks = [executor.submit(thread_function, (x)) <span class="keyword">for</span> x <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">wait(all_task)  <span class="comment"># ç­‰æ‰€æœ‰ task ç»“æŸæ‰å®Œæˆ</span></span><br><span class="line">wait(all_task, return_when=FIRST_COMPLETED)</span><br></pre></td></tr></table></figure><h2 id="ç†è§£-future-ç±»">ç†è§£ Future ç±»</h2><p>å½“æˆ‘ä»¬è°ƒç”¨æ—¶:</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>task1 <span class="op">=</span> executor.submit(thread_function, (<span class="st">&#39;A thread&#39;</span>))</span></code></pre></div><p>task1 æ˜¯ä¸€ä¸ª Future ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹è´¯ç©¿æˆ‘ä»¬æ•´ä¸ªå¤šçº¿ç¨‹çš„ä½“ç³»ä¸­ã€‚</p><p>å› ä¸º Python ä¸ºäº†æä¾›ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œå°†å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ä»¥åŠåç¨‹éƒ½é‡‡ç”¨äº†ä¸€æ ·çš„è®¾è®¡æ¨¡å¼ã€‚</p><p>ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ <code>thread_function</code> å‡½æ•°å¹¶æ²¡æœ‰å»è®¿é—®ä»»ä½• Future å®ä¾‹ï¼Œä¸ºä»€ä¹ˆå®ƒå´å¯ä»¥æ‹¿åˆ° å‡½æ•°çš„æ‰§è¡ŒçŠ¶æ€å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ submit çš„æºç ï¼š</p><figure><img src="https://s2.loli.net/2022/05/10/kptihyjHsd4m9lO.png" alt="image.png" /><figcaption aria-hidden="true">image.png</figcaption></figure><p>å…¶ä¸­ f ä¸º future ç±»å®ä¾‹ï¼›w ä¸º workitem å®ä¾‹ï¼›workitem è´Ÿè´£äº†å°† future å®ä¾‹å’Œæˆ‘ä»¬çš„å‡½æ•°ï¼Œä»¥åŠå…¶å‚æ•°åšç»‘å®šã€‚</p><p>å¹¶å°† w æ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Python å¤šçº¿ç¨‹ç¼–ç¨‹å‚è€ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="GIL" scheme="https://scottzhang.pro/tags/GIL/"/>
    
    <category term="çº¿ç¨‹" scheme="https://scottzhang.pro/tags/%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="Thread" scheme="https://scottzhang.pro/tags/Thread/"/>
    
    <category term="ThreadPoolExecutor" scheme="https://scottzhang.pro/tags/ThreadPoolExecutor/"/>
    
    <category term="Python Future" scheme="https://scottzhang.pro/tags/Python-Future/"/>
    
  </entry>
  
  <entry>
    <title>Spark-æµ…æAPI ä¸å·¥å…·é›†P1</title>
    <link href="https://scottzhang.pro/article/28c39ad6.html"/>
    <id>https://scottzhang.pro/article/28c39ad6.html</id>
    <published>2022-03-21T13:20:08.000Z</published>
    <updated>2022-03-21T13:21:17.422Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Spark æ¦‚è¿°ã€æµ…æã€å·¥å…·é›†ä¸ç»“æ„åŒ–APIã€‚</p></blockquote><span id="more"></span><h2 id="spark-æŒ‡å—">Spark æŒ‡å—</h2><h2 id="å¤§æ•°æ®ä¸-spark-æ¦‚è¿°">å¤§æ•°æ®ä¸ Spark æ¦‚è¿°</h2><p><img src="https://s2.loli.net/2022/03/21/FrOiSsICP6Lhz51.png" /></p><h2 id="spark-æµ…æ">Spark æµ…æ</h2><figure><img src="https://s2.loli.net/2022/03/21/eO2kihfLurdR96C.png" alt="sparkæµ…æ1, åŸºæœ¬æ¶æ„ã€å¤šè¯­è¨€ã€API ä»¥åŠ SparkSession" /><figcaption aria-hidden="true">sparkæµ…æ1, åŸºæœ¬æ¶æ„ã€å¤šè¯­è¨€ã€API ä»¥åŠ SparkSession</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/21/u2j5WVkyzgBhxdY.png" alt="spark çš„ä¸»è¦æ¶æ„" /><figcaption aria-hidden="true">spark çš„ä¸»è¦æ¶æ„</figcaption></figure><p>å¤šè¯­è¨€æ”¯æŒä¸­é€šè¿‡ spark ä¼šè¯æäº¤ä»»åŠ¡ç»™æ‰§è¡Œå™¨ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://s2.loli.net/2022/03/21/AjqW67HLPRhaCTD.png" alt="å¤šè¯­è¨€ API.png" /><figcaption aria-hidden="true">å¤šè¯­è¨€ API.png</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/21/QmZVLvBwWj9xGFe.png" alt="sparkæµ…æ2,æ•°æ®åˆ†åŒºã€è½¬æ¢æ“ä½œã€æƒ°æ€§è¯„ä¼°ã€åŠ¨ä½œæ“ä½œä¸ç”¨æˆ·æ¥å£" /><figcaption aria-hidden="true">sparkæµ…æ2,æ•°æ®åˆ†åŒºã€è½¬æ¢æ“ä½œã€æƒ°æ€§è¯„ä¼°ã€åŠ¨ä½œæ“ä½œä¸ç”¨æˆ·æ¥å£</figcaption></figure><h2 id="spark-å·¥å…·é›†ä»‹ç»">Spark å·¥å…·é›†ä»‹ç»</h2><figure><img src="https://s2.loli.net/2022/03/21/8lsOzB4ejMPy1X7.png" alt="Spark å·¥å…·é›†.png" /><figcaption aria-hidden="true">Spark å·¥å…·é›†.png</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/21/rojM52HmCB1wRge.png" alt="spark å·¥å…·é›†æ¶æ„" /><figcaption aria-hidden="true">spark å·¥å…·é›†æ¶æ„</figcaption></figure><h2 id="ç»“æ„åŒ–-api">ç»“æ„åŒ– API</h2><figure><img src="https://s2.loli.net/2022/03/21/uvgWDohx7JceLrQ.png" alt="ç»“æ„åŒ– API" /><figcaption aria-hidden="true">ç»“æ„åŒ– API</figcaption></figure><p>ç»“æ„åŒ–APIæŒ‡ä»¥ä¸‹ä¸‰ç§æ ¸å¿ƒåˆ†å¸ƒå¼é›†åˆç±»å‹çš„APIï¼š - Datasetç±»å‹ã€‚ - DataFrameç±»å‹ã€‚ - SQLè¡¨å’Œè§†å›¾ã€‚</p><p>ç»“æ„åŒ–APIæ˜¯åœ¨ç¼–å†™å¤§éƒ¨åˆ†æ•°æ®å¤„ç†ç¨‹åºæ—¶ä¼šç”¨åˆ°çš„åŸºç¡€æŠ½è±¡æ¦‚å¿µã€‚</p><h3 id="ç»“æ„åŒ–apiçš„æ‰§è¡Œæ­¥éª¤">ç»“æ„åŒ–APIçš„æ‰§è¡Œæ­¥éª¤</h3><ul><li>ç¼–å†™DataFrame / Dataset / SQLä»£ç ã€‚</li><li>å¦‚æœä»£ç èƒ½æœ‰æ•ˆæ‰§è¡Œï¼Œ Sparkå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªé€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼ˆLogical Planï¼‰ã€‚</li><li>Sparkå°†æ­¤é€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬åŒ–ä¸ºä¸€ä¸ªç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼ˆPhysical Planï¼‰ï¼Œ æ£€æŸ¥å¯è¡Œçš„ ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­æ£€æŸ¥ä¼˜åŒ–ã€‚</li><li>Sparkåœ¨é›†ç¾¤ä¸Šæ‰§è¡Œè¯¥ç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼ˆRDDæ“ä½œï¼‰ã€‚</li></ul><figure><img src="https://s2.loli.net/2022/03/21/GltsvRengH6C9QZ.png" alt="Catalystä¼˜åŒ–å™¨.png" /><figcaption aria-hidden="true">Catalystä¼˜åŒ–å™¨.png</figcaption></figure><blockquote><p>é€šè¿‡æ§åˆ¶å°æäº¤ç»™Sparkï¼Œæˆ–è€…ä»¥ä¸€ä¸ªSparkä½œä¸šçš„å½¢å¼æäº¤ã€‚ç„¶åä»£ç å°†äº¤ç”±Catalystä¼˜åŒ–å™¨å†³å®šå¦‚ä½•æ‰§è¡Œï¼Œ å¹¶æŒ‡å®šä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ã€‚ æœ€åä»£ç è¢«è¿è¡Œï¼Œ å¾—åˆ°çš„ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚å›¾4-1å±•ç¤ºäº†æ•´ä¸ªè¿‡ç¨‹ã€‚</p></blockquote><h3 id="é€»è¾‘è®¡åˆ’">é€»è¾‘è®¡åˆ’</h3><p><img src="https://s2.loli.net/2022/03/21/YEerSUfdGn7RLbx.png" /></p><blockquote><p>Sparkä½¿ç”¨catalogï¼ˆæ‰€æœ‰è¡¨å’ŒDataFrameä¿¡æ¯çš„å­˜å‚¨åº“ï¼‰åœ¨åˆ†æå™¨ä¸­ è§£æåˆ—å’Œè¡¨æ ¼ã€‚ å¦‚æœç›®å½•ä¸­ä¸å­˜åœ¨æ‰€éœ€çš„è¡¨æˆ–åˆ—åç§°ï¼Œ åˆ†æå™¨å¯èƒ½ä¼šæ‹’ç»è¯¥æœªè§£æçš„ é€»è¾‘è®¡åˆ’ã€‚</p></blockquote><h3 id="ç‰©ç†è®¡åˆ’">ç‰©ç†è®¡åˆ’</h3><p><img src="https://s2.loli.net/2022/03/21/wlUpdFQYTNZ85oa.png" /></p><blockquote><p>åœ¨æˆåŠŸåˆ›å»ºä¼˜åŒ–çš„é€»è¾‘è®¡åˆ’åï¼Œ Sparkå¼€å§‹æ‰§è¡Œç‰©ç†è®¡åˆ’æµç¨‹ã€‚ç‰©ç†è§„åˆ’äº§ç”Ÿä¸€ç³»åˆ—çš„RDDå’Œè½¬æ¢æ“ä½œã€‚ è¿™å°±æ˜¯Sparkè¢«ç§°ä¸ºç¼–è¯‘å™¨çš„åŸå› ï¼Œ å› ä¸ºå®ƒ å°†å¯¹DataFrameã€Datasetå’ŒSQLä¸­çš„æŸ¥è¯¢æ¥ä½œä¸ºä½ ç¼–è¯‘ä¸€ç³»åˆ—RDDçš„è½¬æ¢æ“ä½œã€‚</p></blockquote><h3 id="æ‰§è¡Œ">æ‰§è¡Œ</h3><p>åœ¨é€‰æ‹©ä¸€ä¸ªç‰©ç†è®¡åˆ’æ—¶ï¼Œ Sparkå°†æ‰€æœ‰ä»£ç è¿è¡Œåœ¨Sparkçš„åº•å±‚ç¼–ç¨‹æ¥å£RDDä¸Šï¼ˆç¬¬â…¢ éƒ¨åˆ†å°†ä¼šä»‹ç»ï¼‰ã€‚ Sparkåœ¨è¿è¡Œæ—¶æ‰§è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œ ç”Ÿæˆå¯ä»¥åœ¨æ‰§è¡ŒæœŸé—´ä¼˜åŒ–ä»»åŠ¡æˆ– é˜¶æ®µçš„æœ¬åœ°Javaå­—èŠ‚ç ï¼Œæœ€ç»ˆå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Spark æ¦‚è¿°ã€æµ…æã€å·¥å…·é›†ä¸ç»“æ„åŒ–APIã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Spark æƒå¨æŒ‡å—" scheme="https://scottzhang.pro/categories/Spark-%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="Spark" scheme="https://scottzhang.pro/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>Linux æ˜¯å¦‚ä½•å·¥ä½œçš„-ç®¡ç†è®¾å¤‡</title>
    <link href="https://scottzhang.pro/article/d7967d77.html"/>
    <id>https://scottzhang.pro/article/d7967d77.html</id>
    <published>2022-03-20T15:11:55.000Z</published>
    <updated>2022-03-20T15:13:42.225Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº Linux çš„è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿè®¾å¤‡è·¯å¾„ä¸è®¾å¤‡åã€udev, SCSI ç­‰å†…å®¹ã€‚</p></blockquote><span id="more"></span><p>Linux è®¾å¤‡</p><h2 id="è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿdevice-files">è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿï¼ˆDevice filesï¼‰</h2><p>æ“ä½œç³»ç»Ÿè´Ÿè´£å¸®æˆ‘ä»¬ç®¡ç†è®¾å¤‡ï¼Œå°†å…¶æŠ½è±¡æˆç±»ä¼¼æ–‡ä»¶çš„å½¢å¼æ”¾åœ¨ç£ç›˜ä¸Šï¼Œæ‰€ä»¥å½“å¾€è®¾å¤‡ä¸­è¾“å‡ºå†…å®¹ï¼Œå°±åƒæˆ‘ä»¬å¾€ä¸€ä¸ªæ–‡ä»¶ä¸­å†™å†…å®¹ä¸€æ ·ï¼Œè¿™äº›è®¾å¤‡æ–‡ä»¶å­˜æ”¾äº <code>/dev</code> ä¸­, æ‰§è¡Œ <code>ls /dev</code> å¯ä»¥çœ‹åˆ°è¿™äº›è®¾å¤‡ã€‚</p><p>Linuxå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåŠ¨æ€çš„åœ¨/devç›®å½•ä¸‹åˆ›å»ºå¥½å„ç§è®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿå¯åŠ¨å/devç›®å½•ä¸‹å°±æœ‰äº†å„ç§è®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶ï¼Œç›´æ¥å°±å¯ä½¿ç”¨äº†ï¼‰ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä»–è¿˜å¯ä»¥åœ¨è®¾å¤‡å¸è½½åè‡ªåŠ¨çš„åˆ é™¤/devä¸‹å¯¹åº”çš„è®¾å¤‡æ–‡ä»¶èŠ‚ç‚¹ï¼ˆè¿™å¯¹äºä¸€äº›çƒ­æ’æ‹”è®¾å¤‡å¾ˆæœ‰ç”¨ï¼Œæ’ä¸Šçš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºï¼Œæ‹”æ‰çš„æ—¶å€™åˆè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚</p><p>åœ¨æˆ‘ä»¬ç¼–å†™è®¾å¤‡é©±åŠ¨çš„æ—¶å€™ï¼Œä¸å¿…å†å»ä¸ºè®¾å¤‡æŒ‡å®šä¸»è®¾å¤‡å·ï¼Œåœ¨è®¾å¤‡æ³¨å†Œæ—¶ç”¨0æ¥åŠ¨æ€çš„è·å–å¯ç”¨çš„ä¸»è®¾å¤‡å·ï¼Œç„¶ååœ¨é©±åŠ¨ä¸­æ¥å®ç°åˆ›å»ºå’Œé”€æ¯è®¾å¤‡æ–‡ä»¶ï¼ˆä¸€èˆ¬åœ¨é©±åŠ¨æ¨¡å—åŠ è½½å’Œå¸è½½å‡½æ•°ä¸­æ¥å®ç°ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l</span><br><span class="line">brw-rw----   1 root disk 8, 1 Sep  6 08:37 sda1</span><br><span class="line">crw-rw-rw-   1 root root 1, 3 Sep  6 08:37 null</span><br><span class="line">prw-r--r--   1 root root    0 Mar  3 19:17 fdata</span><br><span class="line">srw-rw-rw-   1 root root    0 Dec 18 07:43 log</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œ<code>b, c, p, s</code> åˆ†åˆ«ä»£è¡¨ block, character, pipe, and socketã€‚</p><p>block è®¾å¤‡ï¼šPrograms access data from a block device in fixed chunksï¼Œblock deviceâ€™s total size is fixed and easy to index, processes have quick random access to any block in the device with the help of the kernel.</p><p>character è®¾å¤‡ï¼šwork with data streamsï¼Œonly character, donâ€™t have a size. Like printer; kernel cannot back up and reexamine the data stream after it has passed data to a device or process.</p><p>Pipe device: like character device, work with IO process instead of kernel.</p><p>Socket device: special-purpose interfaces that are frequently used for interprocess communication. Theyâ€™re often found outside of the /dev directory.</p><h2 id="ç³»ç»Ÿè®¾å¤‡è·¯å¾„">ç³»ç»Ÿè®¾å¤‡è·¯å¾„</h2><p>/dev ä¸‹é¢çš„åå­—æ‰€èƒ½å‘Šè¯‰ä½ çš„ä¿¡æ¯å¾ˆæœ‰é™ï¼Œè€Œä¸”å†…æ ¸æ ¹æ®è®¾å¤‡è¢«å‘ç°çš„é¡ºåºæ¥ç»™è®¾å¤‡å‘½åï¼Œæ‰€ä»¥ä¸€æ—¦è®¡ç®—æœºé‡å¯ï¼Œè¿™äº›è®¾å¤‡çš„åå­—æœ‰å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚</p><p>Linux æ ¹æ®è®¾å¤‡çš„å±æ€§ï¼Œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾æ¥è®¿é—®æ‰€æœ‰çš„è®¾å¤‡ï¼Œå³ï¼š <code>/sys/devices</code>ã€‚</p><p>/dev ä¸‹çš„æ–‡ä»¶è®©ç”¨æˆ·è¿›ç¨‹å¯ä»¥ä¸è®¾å¤‡äº¤äº’ã€‚/sys/devices ç”¨æ¥æŸ¥çœ‹å’Œç®¡ç†è®¾å¤‡ã€‚</p><p>sys ç›®å½•ä¸‹è¿˜æœ‰ä¸€äº›åˆ†ç±»ï¼Œæ¯”å¦‚ <code>/sys/block</code> ä¸‹é¢éƒ½æ˜¯å—è®¾å¤‡ã€‚</p><p>åœ¨ /dev ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°è®¾å¤‡çš„è·¯å¾„ä¸Šæœ‰ç‚¹ä¸å®¹æ˜“ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ <code>udevadm</code> å‘½ä»¤æŸ¥çœ‹ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ä¹‹åä»‹ç»æ›´å¤šå…³äºè¿™ä¸ªå‘½ä»¤çš„çŸ¥è¯†ã€‚</p><h2 id="dd-å’Œ-è®¾å¤‡">dd å’Œ è®¾å¤‡</h2><p><code>dd</code> ç¨‹åºåœ¨ä¸å—è®¾å¤‡ä¸å­—ç¬¦è®¾å¤‡æ—¶éå¸¸æ–¹ä¾¿ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å‘½ä»¤ï¼Œéœ€è¦ç‰¹åˆ«å°å¿ƒçš„ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å—æ•°æ®ä¸­å¤åˆ¶å›ºå®šå¤§å°çš„æ•°æ®</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=new_file bs=1024 count=1</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>if, è¾“å…¥æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯æ ‡å‡†è¾“å…¥</li><li>of, è¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯æ ‡å‡†è¾“å‡º</li><li>bs, å—å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ b æˆ–è€… k</li><li>count=numï¼Œå—çš„ä¸ªæ•°ï¼Œå½“ä½¿ç”¨å¤§æ–‡ä»¶æˆ–è€…æ–‡ä»¶æµï¼Œéœ€è¦ç”¨ count æˆ–ä¸‹é¢çš„ skip æ¥æ§åˆ¶å¤§å°</li><li>skip=num, å¦å¤–ä¸€ä¸ªæ§åˆ¶å¤§å°çš„é€‰é¡¹</li></ul><h2 id="è®¾å¤‡å">è®¾å¤‡å</h2><h3 id="æ‰¾åˆ°è®¾å¤‡å">æ‰¾åˆ°è®¾å¤‡å</h3><p>æ‰¾åˆ°è®¾å¤‡åæœ‰æ—¶å€™å¾ˆéº»çƒ¦ï¼Œè¿™é‡Œæä¾›äº†é›†ä¸­æ–¹å¼ï¼š</p><ol type="1"><li>ä½¿ç”¨ <code>udevadm</code></li><li>æ£€æŸ¥ /sys ç›®å½•</li><li>é€šè¿‡ <code>journalctl -k</code> å‘½ä»¤æ‰“å°ç³»ç»Ÿå†…æ ¸çš„æ¶ˆæ¯ã€æ—¥å¿—ï¼ŒçŒœæµ‹è®¾å¤‡å</li><li>å¯¹äºå­˜å‚¨è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡ mount å‘½ä»¤æŸ¥çœ‹</li><li>é€šè¿‡ <code>cat /proc/devices</code> å‘½ä»¤æŸ¥çœ‹å—è®¾å¤‡å’Œå­—ç¬¦è®¾å¤‡çš„é©±åŠ¨ã€‚</li></ol><p>å…¶ä¸­åªæœ‰ç¬¬ä¸€ç§æ–¹å¼æ˜¯æœ€å¯é çš„ï¼Œå»ºè®®ä¸»è¦è¿˜æ˜¯ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿä¸­å®åœ¨æ˜¯æ²¡æœ‰ <code>udevadm</code> å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥å†å‚è€ƒå…¶ä»–çš„æ–¹å¼ã€‚</p><p>ä¸‹é¢çš„å†…å®¹ä¼šä¾‹ä¸¾å‡º Linux ä¸­æœ€å¸¸è§çš„ä¸€äº›è®¾å¤‡ï¼Œä»¥åŠå®ƒä»¬çš„å‘½åã€‚</p><h3 id="å­˜å‚¨è®¾å¤‡-devsd">å­˜å‚¨è®¾å¤‡ /dev/sd*</h3><p>å­˜å‚¨è®¾å¤‡çš„å‘½åä¸€èˆ¬ä»¥ sd å¼€å¤´ï¼Œå³ SCSI disk çš„ç®€å†™, SCSI çš„æ„æ€æ˜¯ï¼šSmall Computer System Interfaceã€‚SCSI æ˜¯æœ€æ—©è¢«å¼€å‘ç”¨æ¥åœ¨å­˜å‚¨è®¾å¤‡å’Œå¤–å›´è®¾å¤‡ä¹‹é—´è¿›è¡Œé€šè®¯ã€‚</p><p><code>lsscsi</code> å‘½ä»¤å¯ä»¥ç”¨æ¥æ£€æŸ¥è®¾å¤‡ä¸­çš„å­˜å‚¨è®¾å¤‡ï¼Œå®ƒçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/03/13/5Iuy2Kewt6jAJqX.png" /></p><p>å…¶ä¸­ 1 è¡¨ç¤ºè®¾å¤‡åœ¨ç³»ç»Ÿä¸­çš„ä½ç½®ï¼›2 è¡¨ç¤ºè®¾å¤‡æè¿°ï¼› 3 è¡¨ç¤ºå»å“ªé‡Œæ‰¾åˆ°è¿™ä¸ªè®¾å¤‡ï¼›</p><h3 id="è™šæ‹Ÿå­˜å‚¨-devxvd-devvd">è™šæ‹Ÿå­˜å‚¨ /dev/xvd*, /dev/vd*</h3><p>æœ‰çš„ç£ç›˜è®¾å¤‡æ˜¯ä¸ºäº†è™šæ‹Ÿæœºä¼˜åŒ–è€Œå­˜åœ¨çš„ï¼Œä¾‹å¦‚ AWS å®ä¾‹ï¼ŒVirtual-Box.</p><h3 id="non-volatile-memory-devices-devnvme">Non-Volatile Memory Devices: /dev/nvme*</h3><p>æœ‰ä¸€äº›ç³»ç»Ÿç°åœ¨ä½¿ç”¨ Non-Volatile memoryï¼Œå³ NVMe æ¥å£ä¸æŸäº›ç±»å‹çš„å›ºæ€å­˜å‚¨é€šä¿¡ã€‚</p><p>å¯ä»¥ç”¨ <code>nvme list</code> å‘½ä»¤åˆ—å‡ºè¿™äº›è®¾å¤‡ã€‚</p><h3 id="device-mapper-devdm--devmapper">Device Mapper: /dev/dm-*, /dev/mapper/*</h3><p>Device Mapper å¹¶ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆFile Systemï¼‰ï¼Œè€Œæ˜¯ Linux å†…æ ¸æ˜ å°„å—è®¾å¤‡çš„ä¸€ç§æŠ€æœ¯æ¡†æ¶ã€‚æä¾›çš„ä¸€ç§ä»é€»è¾‘è®¾å¤‡ï¼ˆè™šæ‹Ÿè®¾å¤‡ï¼‰åˆ°ç‰©ç†è®¾å¤‡çš„æ˜ å°„æ¡†æ¶æœºåˆ¶ï¼Œåœ¨è¯¥æœºåˆ¶ä¸‹ï¼Œç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ ¹æ®è‡ªå·±çš„éœ€è¦åˆ¶å®šå®ç°å­˜å‚¨èµ„æºçš„ç®¡ç†ç­–ç•¥ã€‚</p><p>ä½¿ç”¨äº†è¿™ç§æ˜ å°„çš„åå­—ä¸€èˆ¬ä»¥ <code>/dev/dm-</code> æˆ–è€… <code>/dev/mapper</code> å‘½åã€‚</p><h3 id="cd-å’Œ-dvd-devsr">CD å’Œ DVD: /dev/sr*</h3><p>ä¸€èˆ¬å‘½åä¸º /dev/sr0, /dev/sr1ï¼Œåªè¯»ã€‚å¦‚æœæ˜¯å¯ä»¥å†™çš„ï¼Œå¯èƒ½ä¼šå‘½åä¸ºï¼š/dev/sg0.</p><h3 id="pata-hard-disks-devhd">PATA Hard Disks: /dev/hd*</h3><p>Older type of storage bus. <code>/dev/hda, /dev/hdb, /dev/hdc, and /dev/hdd</code> , å¦‚æœä½ å‘ç°ä½ çš„ SATA é©±åŠ¨è¢«è¯†åˆ«æˆä¸Šé¢çš„æ ¼å¼ï¼Œåˆ™ä»£è¡¨å®ƒå·¥ä½œåœ¨é’±è£æ¨¡å¼ä¸‹ï¼Œè¿™ä¼šå½±å“æ€§èƒ½ï¼Œä½ å¯ä»¥æŸ¥çœ‹ BIOS è®¾ç½®æ˜¯å¦æ­£ç¡®ã€‚</p><h3 id="ç»ˆç«¯devtty-devpts-and-devtty">ç»ˆç«¯ï¼š/dev/tty*, /dev/pts/*, and /dev/tty</h3><p>ç»ˆç«¯æ˜¯ä¸€ç§è®¾å¤‡ï¼Œå®ƒåœ¨ç”¨æˆ·è¿›ç¨‹å’Œ I/O è®¾å¤‡é—´ä¼ è¾“å­—ç¬¦ã€‚è€Œä¸”å¤§éƒ¨åˆ†ç»ˆç«¯å±äºä¼ªè®¾å¤‡ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªçœŸçš„ç¡¬ä»¶ã€‚</p><p>ä¸¤ä¸ªå¸¸è§çš„ç»ˆç«¯è®¾å¤‡æ˜¯ /dev/tty1ï¼ˆç¬¬ä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°ï¼‰å’Œ /dev/pts/0ï¼ˆç¬¬ä¸€ä¸ªä¼ªç»ˆç«¯è®¾å¤‡ï¼‰ã€‚ /dev/pts ç›®å½•æœ¬èº«å°±æ˜¯ä¸€ä¸ªä¸“ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>æ˜¾ç¤ºæ¨¡å¼å’Œè™šæ‹Ÿç»ˆç«¯ï¼š</p><p>Linux ä¸»è¦æœ‰ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼ï¼Œæ–‡æœ¬å’Œå›¾å½¢ã€‚</p><p>Linux ç³»ç»Ÿä¼ ç»Ÿä¸Šæ˜¯åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹å¯åŠ¨çš„ï¼Œç°åœ¨åˆ†å‘çš„å¤§éƒ¨åˆ†çš„ç³»ç»Ÿåˆ™ä¼šéšè—æ–‡æœ¬æ¨¡å¼ã€‚</p><p>è¿™é‡Œçš„æ§åˆ¶å°æˆ–ç»ˆç«¯éƒ½æ˜¯è®¡ç®—æœºäº§ç”Ÿæ—©æœŸçš„é—ç•™ä¸‹æ¥çš„æ¦‚å¿µã€‚ä¸ºäº†å……åˆ†ä½¿ç”¨è®¡ç®—æœºæä¾›çš„è®¡ç®—èµ„æºï¼Œæ—©æœŸå¾ˆå¤šè®¡ç®—æœºä¼šè¿æ¥è‹¥å¹²ç»ˆç«¯æ§åˆ¶å°ï¼Œè¿™äº›ç»ˆç«¯æ§åˆ¶å°ä»ç¡¬ä»¶ä¸Šæ„é€ å¾ˆç®€å•ï¼ŒåªåŒ…æ‹¬é”®ç›˜å’Œæ˜¾ç¤ºå™¨ï¼Œä¸æ‰§è¡Œè®¡ç®—çš„ä»»åŠ¡ï¼Œåªç®€å•çš„æŠŠç”¨æˆ·çš„è¾“å…¥å‘é€åˆ°ä¸»è®¡ç®—æœºå»å¤„ç†ï¼Œç„¶åå†æŠŠè®¡ç®—ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p><h3 id="ä¸²è¡Œç«¯å£-devttys-devttyusb-devttyacm">ä¸²è¡Œç«¯å£: /dev/ttyS*, /dev/ttyUSB*, /dev/ttyACM*</h3><p>ä¸²è¡Œæ¥å£ï¼ˆSerial portï¼‰ï¼Œä¸»è¦ç”¨äºä¸²è¡Œå¼é€ä½æ•°æ®ä¼ è¾“ã€‚æŒ‰ç”µæ°”æ ‡å‡†åŠåè®®æ¥åˆ†åŒ…æ‹¬RS-232-Cã€RS-422ã€RS485ã€USBç­‰ã€‚ RS-232-Cã€RS-422ä¸RS-485æ ‡å‡†åªå¯¹æ¥å£çš„ç”µæ°”ç‰¹æ€§åšå‡ºè§„å®šï¼Œä¸æ¶‰åŠæ¥å¤–æŒ‚ç¨‹å¼ã€ç”µç¼†æˆ–åè®®ã€‚USBæ˜¯è¿‘å‡ å¹´å‘å±•èµ·æ¥çš„æ–°å‹æ¥å£æ ‡å‡†ï¼Œä¸»è¦åº”ç”¨äºé«˜é€Ÿæ•°æ®ä¼ è¾“é¢†åŸŸã€‚</p><p>å¯ä»¥ä½¿ç”¨ screen æ¥è¿æ¥ usb ä¸²å£è®¾å¤‡ã€‚</p><blockquote><p>å‚è€ƒ<a href="https://cloud.tencent.com/developer/news/304629">å‘½ä»¤è¡Œç•Œé¢ã€ç»ˆç«¯ã€Shellã€TTY çš„åŒºåˆ«</a></p></blockquote><h3 id="å¹¶è¡Œç«¯å£devlp0-and-devlp1">å¹¶è¡Œç«¯å£ï¼š/dev/lp0 and /dev/lp1</h3><p>è®¡ç®—æœºä¸Šæ•°æ®ä»¥å¹¶è¡Œæ–¹å¼ä¼ é€’çš„ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´è‡³å°‘åº”è¯¥æœ‰ä¸¤æ¡è¿æ¥çº¿ç”¨äºä¼ é€’æ•°æ®ã€‚ ä¸åªä½¿ç”¨ä¸€æ ¹çº¿ä¼ é€’æ•°æ®ï¼ˆè¿™é‡Œæ²¡æœ‰åŒ…æ‹¬ç”¨äºæ¥åœ°ã€æ§åˆ¶ç­‰çš„è¿æ¥çº¿ï¼‰çš„ä¸²è¡Œç«¯å£ç›¸æ¯”ï¼Œå¹¶å£åœ¨ç›¸åŒçš„æ•°æ®ä¼ é€é€Ÿç‡ä¸‹ï¼Œå¹¶å£å¯ä»¥æ›´å¿«åœ°ä¼ è¾“æ•°æ®ã€‚æ‰€ä»¥åœ¨21ä¸–çºªä¹‹å‰ï¼Œåœ¨éœ€è¦è¾ƒå¤§ä¼ è¾“é€Ÿåº¦çš„åœ°æ–¹ï¼Œä¾‹å¦‚æ‰“å°æœºï¼Œå¹¶å£å¾—åˆ°å¹¿æ³›ä½¿ç”¨ã€‚ä½†æ˜¯éšç€é€Ÿåº¦è¿…é€Ÿæé«˜ï¼Œå¹¶ä¸”ä¸Šå¯¼çº¿ä¹‹é—´æ•°æ®åŒæ­¥æˆä¸ºä¸€ä¸ªå¾ˆéš¾å¤„ç†çš„éš¾é¢˜ï¼Œå¯¼è‡´å¹¶å£åœ¨é€Ÿåº¦ç«èµ›ä¸­é€æ¸è¢«æ·˜æ±°ã€‚USBç­‰æ”¹è¿›çš„ä¸²å£é€æ¸ä»£æ›¿äº†å¹¶å£ã€‚</p><h3 id="éŸ³é¢‘è®¾å¤‡devsnd-devdsp-devaudio-and-more">éŸ³é¢‘è®¾å¤‡ï¼š/dev/snd/*, /dev/dsp, /dev/audio, and More</h3><p>Linux æœ‰ä¸¤ç§éŸ³é¢‘è®¾å¤‡ï¼ŒALSA å’Œ OSSã€‚åˆ†åˆ«ä»£è¡¨äº† Advanced Linux Sound Architecture å’Œ Open Sound System.</p><p>The ALSA devices are in the /dev/snd directory, but itâ€™s difficult to work with them directly. Linux systems that use ALSA support OSS backward-compatible devices if the OSS kernel support is currently loaded.</p><h3 id="åˆ›å»ºè®¾å¤‡æ–‡ä»¶">åˆ›å»ºè®¾å¤‡æ–‡ä»¶</h3><p>åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦è‡ªå·±åˆ›å»ºè®¾å¤‡æ–‡ä»¶ï¼Œå®ƒä»¬ä¼šè¢« devtmpfs å’Œ udev è‡ªåŠ¨åˆ›å»ºã€‚ä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•åšã€‚</p><p><code>mknod</code> å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªè®¾å¤‡ã€‚ä½ å¿…é¡»çŸ¥é“è®¾å¤‡çš„åå­—ï¼Œä»¥åŠå®ƒçš„ä¸»è¦ã€æ¬¡è¦ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># b 8 1, æŒ‡å®šäº† block è®¾å¤‡ï¼Œmajor ç‰ˆæœ¬ä¸º8ï¼Œminor ç‰ˆæœ¬ä¸º1</span></span><br><span class="line">mknod /dev/dda1 b 8 1</span><br></pre></td></tr></table></figure><p>å¯¹äºlinux æ¥è¯´ç®¡ç†å¦‚æ­¤å¤šçš„è®¾å¤‡ä»¥åŠç‰ˆæœ¬æ˜¯éå¸¸å¤æ‚çš„ï¼Œç‰¹åˆ«æ˜¯å½“linuxç³»ç»Ÿåœ¨å‡çº§çš„æ—¶å€™ï¼Œåæ¥å‡ºç°äº† devfsï¼Œä¸€ä¸ªå†…æ ¸ç©ºé—´ä¸­çš„ /dev çš„å®ç°ï¼Œå®ƒåŒ…æ‹¬äº†æ‰€æœ‰ç°åœ¨å†…æ ¸æ”¯æŒçš„è®¾å¤‡ï¼Œå¯ä»¥æŒ‡å®šè®¾å¤‡å·ã€æ‰€æœ‰è€…ã€ç”¨æˆ·ç©ºé—´ç­‰ä¿¡æ¯ï¼Œdevfs è¿è¡Œåœ¨å†…æ ¸ç¯å¢ƒä¸­ï¼Œå¹¶æœ‰ä¸å°‘ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°ä¸»/è¾…è®¾å¤‡å·ä¸å¤Ÿï¼Œå‘½åä¸çµæ´»ï¼Œä¸èƒ½æŒ‡å®šè®¾å¤‡åç§°ç­‰é—®é¢˜ã€‚</p><p>æ‰€ä»¥åäººåˆå¼€å‘äº† udev å’Œ devtmpfs.</p><h2 id="udev">udev</h2><p>å…³äº udev çš„ç›¸å…³ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« : <a href="https://www.pianshen.com/article/5062954066/">Linux æ–‡ä»¶ç³»ç»Ÿä¸è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ ï¼ˆä¸€ï¼‰â€”â€” udev è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ</a></p><h3 id="devtmpfs">devtmpfs</h3><p>The devtmpfs filesystem was developed in response to the problem of device availability during boot.</p><h3 id="udevd-æ“ä½œå’Œé…ç½®">udevd æ“ä½œå’Œé…ç½®</h3><p>åœ¨ GNU/Linux ç³»ç»Ÿä¸­ï¼Œè™½ç„¶è®¾å¤‡çš„åº•å±‚æ”¯æŒæ˜¯åœ¨å†…æ ¸å±‚é¢å¤„ç†çš„ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬ç›¸å…³çš„äº‹ä»¶ç®¡ç†æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­é€šè¿‡ udev æ¥ç®¡ç†çš„ã€‚ç¡®åˆ‡åœ°è¯´æ˜¯ç”± udevd å®ˆæŠ¤è¿›ç¨‹æ¥å®Œæˆçš„ã€‚</p><p>Udevd å®ˆæŠ¤è¿›ç¨‹æ‰€ä½œçš„æ“ä½œå¦‚ä¸‹ï¼š</p><ol type="1"><li>å†…æ ¸é€šè¿‡å†…éƒ¨çš„ç½‘ç»œè¿æ¥å‘ udevd å‘é€ä¸€ä¸ªåä¸º uevent çš„é€šçŸ¥äº‹ä»¶</li><li>udevd ä» uevent ä¸­åŠ è½½æ‰€æœ‰çš„å±æ€§</li><li>udevd ä» rule ä¸­æå–ã€è¿‡æ»¤æˆ–è€…æ˜¯æ›´æ–°ç›¸å…³å†…å®¹</li></ol><p>å¯ä»¥ä½¿ç”¨ <code>udevadm monitor --property</code> å¾—åˆ°ä¸€ä¸ª uevent çš„å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ACTION=change</span><br><span class="line">DEVNAME=sde</span><br><span class="line">DEVPATH=/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2/1-1.2:1.0/host4/</span><br><span class="line">target4:0:0/4:0:0:3/block/sde</span><br><span class="line">DEVTYPE=disk</span><br><span class="line">DISK_MEDIA_CHANGE=1</span><br><span class="line">MAJOR=8</span><br><span class="line">MINOR=64</span><br><span class="line">SEQNUM=2752</span><br><span class="line">SUBSYSTEM=block</span><br><span class="line">UDEV_LOG=3</span><br></pre></td></tr></table></figure><p>udev è§„åˆ™æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªä»¥ .rules ä¸ºæ‰©å±•åçš„æ–‡ä»¶ä¸­ã€‚é‚£äº›æ–‡ä»¶ä¸»è¦æ”¾åœ¨ä¸¤ä¸ªä½ç½®ï¼š/usr/lib/udev/rules.dï¼Œè¿™ä¸ªç›®å½•ç”¨äºå­˜æ”¾ç³»ç»Ÿå®‰è£…çš„è§„åˆ™ï¼›/etc/udev/rules.d/ è¿™ä¸ªç›®å½•æ˜¯ä¿ç•™ç»™è‡ªå®šä¹‰è§„åˆ™çš„ã€‚</p><p>å®šä¹‰é‚£äº›è§„åˆ™çš„æ–‡ä»¶çš„å‘½åæƒ¯ä¾‹æ˜¯ä½¿ç”¨ä¸€ä¸ªæ•°å­—ä½œä¸ºå‰ç¼€ï¼ˆæ¯”å¦‚ï¼Œ50-udev-default.rulesï¼‰ï¼Œå¹¶ä¸”ä»¥å®ƒä»¬åœ¨ç›®å½•ä¸­çš„è¯æ±‡é¡ºåºè¿›è¡Œå¤„ç†çš„ã€‚åœ¨ /etc/udev/rules.d ä¸­å®‰è£…çš„æ–‡ä»¶ï¼Œä¼šè¦†ç›–å®‰è£…åœ¨ç³»ç»Ÿé»˜è®¤è·¯å¾„ä¸­çš„åŒåæ–‡ä»¶ã€‚</p><p>ä¸‹é¢æ˜¯ udevd è§„åˆ™çš„è¡Œä¸ºé€»è¾‘ï¼š</p><ol type="1"><li>udevd reads rules from start to finish of a rules file.</li><li>After reading a rule and possibly executing its action, udevd continues reading the current rules file for more applicable rules.</li><li>There are directives (such as GOTO) to skip over parts of rules files if necessary. These are usually placed at the top of a rules file to skip over the entire file if itâ€™s irrelevant to a particular device that udevd is configuring.</li></ol><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ª /dev/sda ä¸‹é¢çš„ç¬¦å·é“¾æ¥ï¼Œå®ƒè¢«å®šä¹‰åœ¨ <code>lib/udev/rules.d/60-persistent-storage.rules</code> å½“ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­æœ‰å‡ è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ATA</span><br><span class="line">KERNEL==&quot;sd*[!0-9]|sr*&quot;, ENV&#123;ID_SERIAL&#125;!=&quot;?*&quot;, SUBSYSTEMS==&quot;scsi&quot;, ATTRS&#123;vendor&#125;==&quot;ATA&quot;, IMPORT&#123;program&#125;=&quot;ata_id --export $devnode&quot;</span><br><span class="line"></span><br><span class="line"># ATAPI devices (SPC-3 or later)</span><br><span class="line">KERNEL==&quot;sd*[!0-9]|sr*&quot;, ENV&#123;ID_SERIAL&#125;!=&quot;?*&quot;, SUBSYSTEMS==&quot;scsi&quot;, ATTRS&#123;type&#125;==&quot;5&quot;,ATTRS&#123;scsi_level&#125;==&quot;[6-9]*&quot;, IMPORT&#123;program&#125;=&quot;ata_id --export $devnode&quot;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å†…æ ¸çš„ SCSI å­ç³»ç»Ÿï¼Œè¿™äº›è§„åˆ™ä¼šä¸ AKA ç¡¬ç›˜ä»¥åŠ optical media è®¾å¤‡åŒ¹é…ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡æ–‡æœ¬çš„æ¨¡å¼æ¥åŒ¹é…ï¼Œæ¯”å¦‚ <code>"sd*[!0-9]|sr*"</code>.</p><blockquote><p>ATA æ˜¯ä¸€ä¸ªå¹¿ä¸ºä½¿ç”¨çš„ IDE å’Œ EIDEè®¾å¤‡ç›¸å…³çš„æ ‡å‡†ï¼Œæ„æ€æ˜¯é«˜çº§æŠ€æœ¯é™„ä»¶è§„æ ¼ã€‚ATAçš„ç¡¬ç›˜åˆ†ä¸º PATA å’Œ SATAï¼Œå…¶ä¸­ P ä»£è¡¨çš„æ˜¯å¹¶è¡Œã€Sä»£è¡¨çš„ä¸²è¡Œã€‚ç›®å‰ SATA ä½¿ç”¨å¹¿æ³›ï¼Œå®ƒçš„é€Ÿåº¦æ¯” PATA å¿«å¤ªå¤šï¼Œè€Œä¸”ä½“ç§¯å°ã€æ•£çƒ­ä¹Ÿæ›´å¥½ã€‚</p></blockquote><p>æ›´å¤šå…³äºç¼–å†™ udev çš„è§„åˆ™ï¼Œå¯å‚è€ƒè¿™ç¯‡æ–‡ç« :&gt; <a href="https://linux.cn/article-9365-1.html">åœ¨ Linux ä¸­å¦‚ä½•ç¼–å†™åŸºæœ¬çš„ udev è§„åˆ™</a></p><h3 id="udevç®¡ç†å·¥å…·udevadm">udevç®¡ç†å·¥å…·ï¼šudevadm</h3><p>Udevadm ç¨‹åºæ˜¯ udev çš„ä¸€ä¸ªç®¡ç†å·¥å…·ã€‚ä½ å¯ä»¥é‡æ–°åŠ è½½ udev çš„è§„åˆ™ï¼Œè§¦å‘äº‹ä»¶ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼Œä½ å¯ä»¥æŸ¥æ‰¾å’Œæ¢ç´¢ç³»ç»Ÿçš„è®¾å¤‡ï¼Œæˆ–è€…æ˜¯ç›‘æ§å†…æ ¸å‘å‡ºçš„ uevents äº‹ä»¶ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨ udevadm æ£€æŸ¥ç³»ç»Ÿè®¾å¤‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm info --query=all --name=/dev/sda </span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯è¿™æ¡å‘½ä»¤åœ¨æˆ‘ç”µè„‘ä¸Šçš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@scott-pc:/mnt/c/Users/Scott# udevadm info --query=all --name=/dev/sda</span><br><span class="line">P: /devices/LNXSYSTM:00/LNXSYBUS:00/ACPI0004:00/VMBUS:00/fd1d2cbd-ce7c-535c-966b-eb5f811c95f0/host0/target0:0:0/0:0:0:0/block/sda</span><br><span class="line">N: sda</span><br><span class="line">L: 0</span><br><span class="line">E: DEVPATH=/devices/LNXSYSTM:00/LNXSYBUS:00/ACPI0004:00/VMBUS:00/fd1d2cbd-ce7c-535c-966b-eb5f811c95f0/host0/target0:0:0/0:0:0:0/block/sda</span><br><span class="line">E: DEVNAME=/dev/sda</span><br><span class="line">E: DEVTYPE=disk</span><br><span class="line">E: MAJOR=8</span><br><span class="line">E: MINOR=0</span><br><span class="line">E: SUBSYSTEM=block</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¯ä¸€è¡Œä»£è¡¨äº†ä¸€ä¸ªè®¾å¤‡çš„å±æ€§ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p><ul><li>P: æœ€å¼€å§‹çš„é‚£è¡Œï¼Œæ˜¯ sysfs è®¾å¤‡è·¯å¾„</li><li>N: è®¾å¤‡èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç»™ /dev ä¸‹é¢æ–‡ä»¶çš„åå­—</li><li>S: è¡¨æ˜äº†è®¾å¤‡èŠ‚ç‚¹çš„ç¬¦å·é“¾æ¥</li><li>Eï¼š ä» udevd è§„åˆ™ä¸­æ‰¾åˆ°çš„é™„åŠ çš„ä¿¡æ¯</li></ul><h3 id="ä½¿ç”¨-udevadm-ç›‘æ§è®¾å¤‡">ä½¿ç”¨ udevadm ç›‘æ§è®¾å¤‡</h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>udevadm monitor</code> æ¥ç›‘æ§ç”µè„‘ä¸Šçš„è®¾å¤‡ï¼Œä¸‹é¢æ˜¯å®ƒçš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">KERNEL[658299.569485] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)</span><br><span class="line">KERNEL[658299.569667] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)</span><br><span class="line">KERNEL[658299.570614] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/host15 </span><br><span class="line">(scsi)</span><br><span class="line">KERNEL[658299.570645] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/ </span><br><span class="line">host15/scsi_host/host15 (scsi_host)</span><br><span class="line">UDEV [658299.622579] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)</span><br><span class="line">UDEV [658299.623014] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)</span><br><span class="line">UDEV [658299.623673] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/host15 </span><br><span class="line">(scsi)</span><br><span class="line">UDEV [658299.623690] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/</span><br><span class="line">host15/scsi_host/host15 (scsi_host)</span><br><span class="line">--snip--</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰é‡å¤çš„è¾“å‡ºï¼Œå› ä¸ºé»˜è®¤ä¼šè¾“å‡ºæ¥è‡ªå†…æ ¸çš„æ¶ˆæ¯ï¼Œä»¥åŠ udevd å¤„ç†çš„æ¶ˆæ¯ï¼Œå¯ä»¥æŒ‡å®š --kernel é€‰é¡¹åªæŸ¥çœ‹å†…æ ¸çš„æ¶ˆæ¯ï¼Œ--udev æŸ¥çœ‹ udevdå¤„ç†çš„æ¶ˆæ¯ï¼Œä»¥åŠ--property åˆ™å¯ä»¥è®©ä½ æŸ¥çœ‹æ•´ä¸ª uevent, åŒ…æ‹¬å±æ€§ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ subsystem æ¥ filter è¿™äº›æ¶ˆæ¯,æ¯”å¦‚ä½ åªæƒ³è¦çœ‹åˆ° SCSI å­ç³»ç»Ÿçš„ kernel çš„æ¶ˆæ¯ï¼Œå¯æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ udevadm monitor --kernel --subsystem-match=scsi</span><br></pre></td></tr></table></figure><p>å…³äºæ›´å¤š Udevadm çš„ä½¿ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹ udevadm(8) çš„æ“ä½œæ‰‹å†Œã€‚udev æœ¬èº«è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„çŸ¥è¯†ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹å«åš udisksd, å®ƒä¼šç›‘å¬äº‹ä»¶ï¼Œå½“æœ‰æ–°çš„ç£ç›˜æ¥å…¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘è¿›ç¨‹å‘é€æ¶ˆæ¯ã€‚</p><h2 id="æ·±å…¥ç†è§£scsi-å’Œ-linux-å†…æ ¸">æ·±å…¥ç†è§£ï¼šSCSI å’Œ Linux å†…æ ¸</h2><p>è¿™ä¸€å°èŠ‚æˆ‘ä»¬ä¼šæ¢è®¨ Linux å†…æ ¸å¯¹äº SCSI çš„æ”¯æŒï¼Œä»¥å¢åŠ å¯¹ Linux å†…æ ¸æ¶æ„çš„ç†è§£ã€‚å¦‚æœæ˜¯ä¸ºäº†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ç£ç›˜ï¼Œä½ æ— éœ€å­¦ä¹ æœ¬å°èŠ‚ä¸­çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬å…ˆè®²ä¸€ä¸ªå°èƒŒæ™¯ï¼Œä¼ ç»Ÿçš„SCSiç¡¬ä»¶é…ç½®æ˜¯ä¸€ä¸ªä¸»æœºé€‚é…å™¨é€šè¿‡ SCSIæ€»çº¿è¿æ¥äº†ä¸€ç³»åˆ—çš„è®¾å¤‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://s2.loli.net/2022/03/17/hYZJzEHWNAUKQXp.png" /></p><p>å…¶ä¸­çš„ç”µè„‘é€šè¿‡ SCSI Host Adapter æ¥ä¸å…¶ä»–çš„ Disk é€šä¿¡ï¼Œæ¯ä¸€ä¸ª Disk éƒ½æœ‰å”¯ä¸€çš„ IDï¼Œå¯¹äºæ¯ä¸€ä¸ªå•ç‹¬çš„ Diskï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥é€šè¿‡ SCSI å‘½ä»¤è¿›è¡Œç‚¹å¯¹ç‚¹çš„é€šä¿¡ã€‚</p><p>æ–°ç‰ˆæœ¬çš„ SCSIï¼Œä¹Ÿå°±æ˜¯ Serial Attached SCSI ï¼ˆSASï¼‰æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œä½†åœ¨å¤§éƒ¨åˆ†æœºå™¨ä¸Šï¼Œä¹Ÿè®¸æ‰¾ä¸åˆ°ä»»ä½•çœŸæ­£æ„ä¹‰ä¸Šçš„ SCSI è®¾å¤‡ã€‚</p><p>SATA ç£ç›˜åœ¨ä½ çš„ç³»ç»Ÿä¸Šï¼Œä¹Ÿå·² SCSI è®¾å¤‡çš„å½¢å¼å‡ºç°ï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰ä¸€ç‚¹ä¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ libata åº“ ä¸­çš„ç¿»è¯‘å±‚é€šä¿¡ã€‚</p><p>è¿™äº›è¯´æ˜äº†ä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æŸ¥çœ‹ç³»ç»Ÿä¸Šçš„è®¾å¤‡ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lsscsi</span><br><span class="line">[0:0:0:0]   disk    ATA       WDC WD3200AAJS-2  01.0  /dev/sda</span><br><span class="line">[1:0:0:0]   cd/dvd  Slimtype  DVD A DS8A5SH     XA15  /dev/sr0</span><br><span class="line">[2:0:0:0]   disk    USB2.0    CardReader CF     0100  /dev/sdb</span><br><span class="line">[2:0:0:1]   disk    USB2.0    CardReader SM XD  0100  /dev/sdc</span><br><span class="line">[2:0:0:2]   disk    USB2.0    CardReader MS     0100  /dev/sdd</span><br><span class="line">[2:0:0:3]   disk    USB2.0    CardReader SD     0100  /dev/sde</span><br><span class="line">[3:0:0:0]   disk    FLASH     Drive UT_USB20    0.00  /dev/sdf</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹æ–¹æ‹¬å·ä¸­çš„å†…å®¹ï¼Œä»å·¦è‡³å³åˆ†åˆ«æ˜¯ SCSI é€‚é…å™¨å·ï¼ŒSCSI æ€»çº¿å·ï¼Œè®¾å¤‡çš„ SCSI IDï¼Œä»¥åŠ LUNï¼ˆLogical Unit Numberï¼‰é€»è¾‘å¿«å·ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªé€‚é…å™¨(scsi0-3)ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªæ€»çº¿ï¼ˆå·ç éƒ½ä»0å¼€å§‹ï¼‰ï¼Œæ¯ä¸€ä¸ªæ€»çº¿ä¸Šï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªè®¾å¤‡ã€‚USB è¯»å¡å™¨åœ¨ 2:0:0 ä¸Šæœ‰å››ä¸ªé€»è¾‘å•å…ƒï¼Œé€šè¿‡LUN ç¼–å·å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºè¿™ä¸€ç‚¹ï¼Œå³å†…æ ¸ç»™æ¯ä¸ªé€»è¾‘å•å…ƒéƒ½åˆ†é…äº†ä¸€ä¸ª device file.</p><p>Figure 3-2 æ˜¯å†…æ ¸ä¸­çš„é©±åŠ¨ä¸æ¥å£çš„ç»“æ„ï¼š</p><figure><img src="https://s2.loli.net/2022/03/17/XQPdsrIfNbOKVG8.png" alt="Figure 3-2" /><figcaption aria-hidden="true">Figure 3-2</figcaption></figure><ul><li>å›¾ä¸­ä¸Šé¢çš„å±‚è´Ÿè´£å¤„ç†è®¾å¤‡é›†çš„æ“ä½œï¼Œæ¯”å¦‚ sd(SCSI Disk) åœ¨è¿™å±‚ï¼›å®ƒçŸ¥é“å¦‚ä½•ç¿»è¯‘æ¥è‡ªå†…æ ¸å—è®¾å¤‡æ¥å£çš„å‘½ä»¤ï¼Œå°†å®ƒå˜æˆç£ç›˜ç‰¹å®šçš„ã€SCSI åè®®çš„æŒ‡ä»¤</li><li>ä¸­é—´å±‚ï¼Œè¿æ¥é¡¶å±‚å’Œåº•å±‚ï¼Œä¼ è¾“ SCSI æ¶ˆæ¯ï¼Œtrack æ‰€æœ‰çš„SCSIæ€»çº¿ï¼Œä»¥åŠæ’å…¥åˆ°ç³»ç»Ÿä¸Šçš„è®¾å¤‡</li><li>æ‰§è¡Œç‰¹å®šçš„ç¡¬ä»¶æ“ä½œã€‚</li></ul><blockquote><p>The top and bottom layers contain many different drivers, but itâ€™s important to remember that, for any given device file on your system, the kernel (nearly always) uses one top-layer driver and one lower-layer driver. For the disk at /dev/sda in our example, the kernel uses the sd top-layer driver and the ATA bridge lower-layer driver.</p></blockquote><h3 id="usb-å­˜å‚¨-and-scsi">USB å­˜å‚¨ and SCSI</h3><p>ä¸ºäº†ä½¿ SCSI å­ç³»ç»Ÿä¸å¸¸è§çš„ USB å­˜å‚¨ç¡¬ä»¶é€šä¿¡ï¼Œå¦‚å›¾ 3-2 æ‰€ç¤ºï¼Œå†…æ ¸éœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¾ƒä½å±‚çš„ SCSI é©±åŠ¨ç¨‹åºã€‚ ä»¥ /dev/sdf ä¸ºä»£è¡¨çš„ USB é—ªå­˜é©±åŠ¨å™¨å¯ä»¥ç†è§£ SCSI å‘½ä»¤ï¼Œä½†è¦çœŸæ­£ä¸é©±åŠ¨å™¨é€šä¿¡ï¼Œå†…æ ¸éœ€è¦çŸ¥é“å¦‚ä½•é€šè¿‡ USB ç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚</p><p>ä»æŠ½è±¡ç»“æ„ä¸Šæ¥çœ‹ï¼ŒUSB å’Œ SCSI å¾ˆåƒï¼Œå®ƒä»¬éƒ½æœ‰ device classes, buses, host controllerã€‚ æ‰€ä»¥ Linux åœ¨å†…æ ¸ä¸­ä¸€ä¸ª USB Subsystem.</p><p>å°±åƒ SCSI å­ç³»ç»Ÿåœ¨å…¶ç»„ä»¶ä¹‹é—´ä¼ é€’ SCSI å‘½ä»¤ä¸€æ ·ï¼ŒUSB å­ç³»ç»Ÿåœ¨å…¶ç»„ä»¶ä¹‹é—´ä¼ é€’ USB æ¶ˆæ¯ã€‚ ç”šè‡³è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äº lsscsi çš„ lsusb å‘½ä»¤ã€‚</p><p>è¿™é‡Œæœ‰è¶£çš„åœ¨äºï¼ŒUSB å­ç³»ç»Ÿåœ¨ä¸€å¤´ä½¿ç”¨çš„æ˜¯ USB å‘½ä»¤ï¼Œè€Œå¦å¤–ä¸€å¤´åˆ™ä½¿ç”¨çš„æ˜¯ SCSI å‘½ä»¤ã€‚</p><p>åœ¨ç»“æ„ä¸Šï¼ŒUSB å­ç³»ç»Ÿå’Œ SCSI å­ç³»ç»Ÿæ˜¯åˆ†å¼€çš„ï¼Œå› ä¸ºä¸¤ä¸ªå­ç³»ç»Ÿä¸åº”è¯¥å…±äº«åŒä¸€ä¸ªé©±åŠ¨ï¼Œä¸ºäº†è®©å®ƒä»¬å¯ä»¥é€šä¿¡ï¼Œåœ¨ SCSI å­ç³»ç»Ÿä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ª lower-layer çš„ SCSI bridge.</p><h3 id="scsi-å’Œ-ata">SCSI å’Œ ATA</h3><p>SATA ç¡¬ç›˜å’Œå…¶ä»–çš„CD/DVDè®¾å¤‡éƒ½ä½¿ç”¨äº† SATA æ¥å£ã€‚ä¸ºäº†è¿æ¥å†…æ ¸ä¸­ SATA ä¸“ç”¨çš„é©±åŠ¨ä¸ SCSI å­ç³»ç»Ÿï¼Œå†…æ ¸åˆ©ç”¨äº†ä¸€ä¸ª bridge driver, å†…æ ¸ä½¿ç”¨äº†ä¸€ä¸ªæ¡¥æ¥é©±åŠ¨ç¨‹åºï¼Œå°±åƒ USB é©±åŠ¨å™¨ä¸€æ ·ï¼Œä½†å…·æœ‰ä¸åŒçš„æœºåˆ¶å’Œé¢å¤–çš„å¤æ‚æ€§ã€‚ å…‰é©±ä½¿ç”¨ ATAPIï¼Œä¸€ç§ä»¥ ATA åè®®ç¼–ç çš„ SCSI å‘½ä»¤ç‰ˆæœ¬ã€‚ ä½†æ˜¯ï¼Œç¡¬ç›˜ä¸ä½¿ç”¨ ATAPIï¼Œä¹Ÿä¸ç¼–ç ä»»ä½• SCSI å‘½ä»¤ï¼</p><p>Linux å†…æ ¸ä½¿ç”¨åä¸º libata çš„åº“çš„ä¸€éƒ¨åˆ†æ¥åè°ƒ SATAï¼ˆå’Œ ATAï¼‰é©±åŠ¨å™¨ä¸ SCSI å­ç³»ç»Ÿã€‚</p><h3 id="é€šç”¨-scsi-è®¾å¤‡">é€šç”¨ SCSI è®¾å¤‡</h3><p>å½“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ä¸ SCSI å­ç³»ç»Ÿé€šä¿¡æ—¶ï¼Œå®ƒé€šå¸¸é€šè¿‡å—è®¾å¤‡å±‚å’Œ/æˆ–ä½äº SCSI è®¾å¤‡ç±»é©±åŠ¨ç¨‹åºï¼ˆå¦‚ sd æˆ– srï¼‰ä¹‹ä¸Šçš„å¦ä¸€ä¸ªå…¶ä»–å†…æ ¸æœåŠ¡æ¥è¿›è¡Œã€‚ æ¢å¥è¯è¯´ï¼Œå¤§å¤šæ•°ç”¨æˆ·è¿›ç¨‹ä»ä¸éœ€è¦çŸ¥é“å…³äº SCSI è®¾å¤‡æˆ–å…¶å‘½ä»¤çš„ä»»ä½•ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯ï¼Œç”¨æˆ·è¿›ç¨‹å¯ä»¥ç»•è¿‡è®¾å¤‡ç±»é©±åŠ¨ç¨‹åº,ç›´æ¥å‘è®¾å¤‡æä¾› SCSI åè®®å‘½ä»¤ã€‚ ä¾‹å¦‚å¯ä»¥åœ¨ lsscsi å‘½ä»¤åæ·»åŠ  -g é€‰é¡¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lsscsi -g</span><br><span class="line">[0:0:0:0]   disk    ATA       WDC WD3200AAJS-2  01.0  /dev/sda 1/dev/sg0</span><br><span class="line">[1:0:0:0]   cd/dvd  Slimtype  DVD A DS8A5SH     XA15  /dev/sr0   /dev/sg1</span><br><span class="line">[2:0:0:0]   disk    USB2.0    CardReader CF     0100  /dev/sdb   /dev/sg2</span><br><span class="line">[2:0:0:1]   disk    USB2.0    CardReader SM XD  0100  /dev/sdc   /dev/sg3</span><br><span class="line">[2:0:0:2]   disk    USB2.0    CardReader MS     0100  /dev/sdd   /dev/sg4</span><br><span class="line">[2:0:0:3]   disk    USB2.0    CardReader SD     0100  /dev/sde   /dev/sg5</span><br><span class="line">[3:0:0:0]   disk    FLASH     Drive UT_USB20    0.00  /dev/sdf   /dev/sg6</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é€šç”¨è®¾å¤‡ï¼Ÿ ç­”æ¡ˆä¸å†…æ ¸ä¸­ä»£ç çš„å¤æ‚æ€§æœ‰å…³ã€‚ éšç€ä»»åŠ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæœ€å¥½å°†å®ƒä»¬æ’é™¤åœ¨å†…æ ¸ä¹‹å¤–ã€‚ è€ƒè™‘ CD/DVD å†™å…¥å’Œè¯»å–ã€‚ è¯»å–å…‰ç›˜æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ“ä½œï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªä¸“é—¨çš„å†…æ ¸é©±åŠ¨ç¨‹åºã€‚</p><p>ç„¶è€Œï¼Œå†™å…¥å…‰ç›˜æ¯”è¯»å–è¦å›°éš¾å¾—å¤šï¼Œå¹¶ä¸”æ²¡æœ‰å…³é”®çš„ç³»ç»ŸæœåŠ¡ä¾èµ–äºå†™å…¥çš„åŠ¨ä½œã€‚ æ²¡æœ‰ç†ç”±ç”¨è¿™ä¸ªæ´»åŠ¨æ¥å¢åŠ å†…æ ¸ç©ºé—´ã€‚ å› æ­¤ï¼Œè¦åœ¨ Linux ä¸­å†™å…¥å…‰ç›˜ï¼Œæ‚¨éœ€è¦è¿è¡Œä¸€ä¸ªä¸é€šç”¨ SCSI è®¾å¤‡ï¼ˆä¾‹å¦‚ /dev/sg1ï¼‰å¯¹è¯çš„ç”¨æˆ·ç©ºé—´ç¨‹åºã€‚ è¿™ä¸ªç¨‹åºå¯èƒ½æ¯”å†…æ ¸é©±åŠ¨ç¨‹åºæ•ˆç‡ä½ä¸€ç‚¹ï¼Œä½†å®ƒæ›´å®¹æ˜“æ„å»ºå’Œç»´æŠ¤ã€‚</p><h3 id="å•ä¸ªè®¾å¤‡çš„å¤šç§è®¿é—®æ–¹æ³•">å•ä¸ªè®¾å¤‡çš„å¤šç§è®¿é—®æ–¹æ³•</h3><p>å›¾ 3-3 æ˜¾ç¤ºäº† Linux SCSI å­ç³»ç»Ÿä»ç”¨æˆ·ç©ºé—´è®¿é—®å…‰é©±çš„ä¸¤ä¸ªæ–¹æ³•ï¼ˆsr å’Œ sgï¼‰ï¼ˆçœç•¥äº† SCSI åº•å±‚ä»¥ä¸‹çš„ä»»ä½•é©±åŠ¨ç¨‹åºï¼‰ã€‚</p><p>è¿›ç¨‹ A ä½¿ç”¨ sr é©±åŠ¨ç¨‹åºä»é©±åŠ¨å™¨è¯»å–ï¼Œè¿›ç¨‹ B ä½¿ç”¨ sg é©±åŠ¨ç¨‹åºå†™å…¥é©±åŠ¨å™¨ã€‚ ä½†æ˜¯ï¼Œåƒè¿™æ ·çš„è¿›ç¨‹é€šå¸¸ä¸ä¼šåŒæ—¶è¿è¡Œä»¥è®¿é—®åŒä¸€è®¾å¤‡ã€‚</p><figure><img src="https://s2.loli.net/2022/03/17/XQPdsrIfNbOKVG8.png" alt="3-3" /><figcaption aria-hidden="true">3-3</figcaption></figure><p>åœ¨å›¾ 3-3 ä¸­ï¼Œè¿›ç¨‹ A ä»å—è®¾å¤‡ä¸­è¯»å–æ•°æ®ã€‚ ä½†æ˜¯ç”¨æˆ·è¿›ç¨‹çœŸçš„ä»¥è¿™ç§æ–¹å¼è¯»å–æ•°æ®å—ï¼Ÿ é€šå¸¸ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è¿™ç§è®¿é—®ä¸æ˜¯ç›´æ¥çš„ï¼Œå› ä¸ºåœ¨å—è®¾å¤‡ä¹‹ä¸Šè¿˜æœ‰æ›´å¤šçš„å±‚ï¼Œç”šè‡³æ›´å¤šçš„ç¡¬ç›˜è®¿é—®ç‚¹ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­å­¦ä¹ ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å…³äº Linux çš„è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿè®¾å¤‡è·¯å¾„ä¸è®¾å¤‡åã€udev, SCSI ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="How Linux Works" scheme="https://scottzhang.pro/categories/How-Linux-Works/"/>
    
    
    <category term="Linux" scheme="https://scottzhang.pro/tags/Linux/"/>
    
    <category term="Operating System" scheme="https://scottzhang.pro/tags/Operating-System/"/>
    
    <category term="udev" scheme="https://scottzhang.pro/tags/udev/"/>
    
    <category term="SCSI" scheme="https://scottzhang.pro/tags/SCSI/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨-æ•°æ®ç³»ç»Ÿ P2</title>
    <link href="https://scottzhang.pro/article/ec2d337d.html"/>
    <id>https://scottzhang.pro/article/ec2d337d.html</id>
    <published>2022-03-20T15:07:08.000Z</published>
    <updated>2022-03-20T15:10:33.578Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ã€Œè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€ä¹¦ä¸­ç¬¬ä¸‰ã€å››ç« å†…å®¹çš„æ€ç»´å¯¼å›¾ã€‚åŒ…æ‹¬ï¼šå­˜å‚¨ä¸æ£€ç´¢ã€ç¼–ç æ•°æ®ç­‰å†…å®¹ã€‚</p></blockquote><span id="more"></span><h1 id="å­˜å‚¨ä¸æ£€ç´¢">3. å­˜å‚¨ä¸æ£€ç´¢</h1><h2 id="é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„">é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„</h2><figure><img src="https://s2.loli.net/2022/03/19/e2KTmgGZcw9th57.png" alt="é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„" /><figcaption aria-hidden="true">é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„</figcaption></figure><h3 id="æ•£åˆ—ç´¢å¼•">æ•£åˆ—ç´¢å¼•</h3><figure><img src="https://s2.loli.net/2022/03/19/k1KDrNagqEcGRtl.png" alt="ä»¥ç±» CSV æ ¼å¼å­˜å‚¨é”®å€¼å¯¹çš„æ—¥å¿—ï¼Œå¹¶ä½¿ç”¨å†…å­˜æ•£åˆ—æ˜ å°„è¿›è¡Œç´¢å¼•" /><figcaption aria-hidden="true">ä»¥ç±» CSV æ ¼å¼å­˜å‚¨é”®å€¼å¯¹çš„æ—¥å¿—ï¼Œå¹¶ä½¿ç”¨å†…å­˜æ•£åˆ—æ˜ å°„è¿›è¡Œç´¢å¼•</figcaption></figure><h3 id="sstable">SSTable</h3><figure><img src="https://s2.loli.net/2022/03/19/EVPSAbnZQypHuks.png" alt="é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„" /><figcaption aria-hidden="true">é©±åŠ¨æ•°æ®åº“çš„æ•°æ®ç»“æ„</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/19/R9mu5kEyvLtP3d2.png" alt="é”®å€¼æ›´æ–°æ—¥å¿—å‹ç¼©" /><figcaption aria-hidden="true">é”®å€¼æ›´æ–°æ—¥å¿—å‹ç¼©</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/19/LZ4NIC9WTB2t3bJ.png" alt="åŒæ—¶æ‰§è¡Œå‹ç¼©å’Œåˆ†æ®µåˆå¹¶" /><figcaption aria-hidden="true">åŒæ—¶æ‰§è¡Œå‹ç¼©å’Œåˆ†æ®µåˆå¹¶</figcaption></figure><p>SSTable çš„ä¼˜åŠ¿</p><ol type="1"><li>å³ä½¿æ–‡ä»¶å¤§äºå¯ç”¨å†…å­˜ï¼Œåˆå¹¶æ®µçš„æ“ä½œä»ç„¶æ˜¯ç®€å•è€Œé«˜æ•ˆçš„ã€‚</li><li>ä¸ºäº†åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„é”®ï¼Œä½ ä¸å†éœ€è¦åœ¨å†…å­˜ä¸­ä¿å­˜æ‰€æœ‰é”®çš„ç´¢å¼•ã€‚</li><li>ç”±äºè¯»å–è¯·æ±‚æ— è®ºå¦‚ä½•éƒ½éœ€è¦æ‰«ææ‰€è¯·æ±‚èŒƒå›´å†…çš„å¤šä¸ªé”®å€¼å¯¹ï¼Œå› æ­¤å¯ä»¥å°†è¿™äº›è®°å½•åˆ†ç»„ä¸ºå—ï¼ˆblockï¼‰ï¼Œå¹¶åœ¨å°†å…¶å†™å…¥ç¡¬ç›˜ä¹‹å‰å¯¹å…¶è¿›è¡Œå‹ç¼©</li></ol><h2 id="äº‹åŠ¡å¤„ç†è¿˜æ˜¯å­˜å‚¨åˆ†æ">3.2 äº‹åŠ¡å¤„ç†è¿˜æ˜¯å­˜å‚¨åˆ†æ</h2><figure><img src="https://s2.loli.net/2022/03/19/m6WxNfZC5PpsOhk.png" alt="äº‹åŠ¡å¤„ç†åˆ†æ" /><figcaption aria-hidden="true">äº‹åŠ¡å¤„ç†åˆ†æ</figcaption></figure><h3 id="olap-vs-oltp">OLAP vs OLTP</h3><table><thead><tr class="header"><th>å±æ€§</th><th>äº‹åŠ¡å¤„ç†ç³»ç»Ÿ OLTP</th><th>åˆ†æç³»ç»Ÿ OLAP</th></tr></thead><tbody><tr class="odd"><td>ä¸»è¦è¯»å–æ¨¡å¼</td><td>æŸ¥è¯¢å°‘é‡è®°å½•ï¼ŒæŒ‰é”®è¯»å–</td><td>åœ¨å¤§æ‰¹é‡è®°å½•ä¸Šèšåˆ</td></tr><tr class="even"><td>ä¸»è¦å†™å…¥æ¨¡å¼</td><td>éšæœºè®¿é—®ï¼Œå†™å…¥è¦æ±‚ä½å»¶æ—¶</td><td>æ‰¹é‡å¯¼å…¥ï¼ˆETLï¼‰æˆ–è€…äº‹ä»¶æµ</td></tr><tr class="odd"><td>ä¸»è¦ç”¨æˆ·</td><td>ç»ˆç«¯ç”¨æˆ·ï¼Œé€šè¿‡ Web åº”ç”¨</td><td>å†…éƒ¨æ•°æ®åˆ†æå¸ˆï¼Œç”¨äºå†³ç­–æ”¯æŒ</td></tr><tr class="even"><td>å¤„ç†çš„æ•°æ®</td><td>æ•°æ®çš„æœ€æ–°çŠ¶æ€ï¼ˆå½“å‰æ—¶é—´ç‚¹ï¼‰</td><td>éšæ—¶é—´æ¨ç§»çš„å†å²äº‹ä»¶</td></tr><tr class="odd"><td>æ•°æ®é›†å°ºå¯¸</td><td>GB ~ TB</td><td>TB ~ PB</td></tr></tbody></table><h3 id="æ•°æ®ä»“åº“">æ•°æ®ä»“åº“</h3><p>OLTP ç³»ç»Ÿå¾€å¾€å¯¹ä¸šåŠ¡è¿ä½œè‡³å…³é‡è¦ï¼Œå› è€Œé€šå¸¸ä¼šè¦æ±‚ é«˜å¯ç”¨ ä¸ ä½å»¶è¿Ÿã€‚æ‰€ä»¥ DBA ä¼šå¯†åˆ‡å…³æ³¨ä»–ä»¬çš„ OLTP æ•°æ®åº“ï¼Œä»–ä»¬é€šå¸¸ä¸æ„¿æ„è®©ä¸šåŠ¡åˆ†æäººå‘˜åœ¨ OLTP æ•°æ®åº“ä¸Šè¿è¡Œä¸´æ—¶çš„åˆ†ææŸ¥è¯¢ï¼Œå› ä¸ºè¿™äº›æŸ¥è¯¢é€šå¸¸å¼€é”€å·¨å¤§ï¼Œä¼šæ‰«æå¤§éƒ¨åˆ†æ•°æ®é›†ï¼Œè¿™ä¼šæŸå®³åŒæ—¶åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ€§èƒ½ã€‚</p><p>ä» OLTP æ•°æ®åº“ä¸­æå–æ•°æ®ï¼ˆä½¿ç”¨å®šæœŸçš„æ•°æ®è½¬å‚¨æˆ–è¿ç»­çš„æ›´æ–°æµï¼‰ï¼Œè½¬æ¢æˆé€‚åˆåˆ†æçš„æ¨¡å¼ï¼Œæ¸…ç†å¹¶åŠ è½½åˆ°æ•°æ®ä»“åº“ä¸­ã€‚å°†æ•°æ®å­˜å…¥ä»“åº“çš„è¿‡ç¨‹ç§°ä¸º â€œæŠ½å– - è½¬æ¢ - åŠ è½½ï¼ˆETLï¼‰â€ã€‚</p><figure><img src="https://s2.loli.net/2022/03/19/1q2SbhHmzZoeA3i.png" alt="äº‹åŠ¡å¤„ç†åˆ†æ-æ•°æ®ä»“åº“" /><figcaption aria-hidden="true">äº‹åŠ¡å¤„ç†åˆ†æ-æ•°æ®ä»“åº“</figcaption></figure><h3 id="åˆ—å¼å­˜å‚¨">åˆ—å¼å­˜å‚¨</h3><figure><img src="https://s2.loli.net/2022/03/19/29WjEJDOoRHq5lp.png" alt="åˆ—å¼å­˜å‚¨" /><figcaption aria-hidden="true">åˆ—å¼å­˜å‚¨</figcaption></figure><h1 id="ç¼–ç ä¸æ¼”åŒ–">4. ç¼–ç ä¸æ¼”åŒ–</h1><h2 id="ç¼–ç æ•°æ®çš„æ ¼å¼">ç¼–ç æ•°æ®çš„æ ¼å¼</h2><figure><img src="https://s2.loli.net/2022/03/20/OMzifUsVo5aNhdj.png" alt="ç¼–ç ä¸æ¼”åŒ–-æ ¼å¼1" /><figcaption aria-hidden="true">ç¼–ç ä¸æ¼”åŒ–-æ ¼å¼1</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/20/WHOUvbmGMj4wnks.png" alt="ç¼–ç ä¸æ¼”åŒ–-æ ¼å¼2" /><figcaption aria-hidden="true">ç¼–ç ä¸æ¼”åŒ–-æ ¼å¼2</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/20/Wmj9cRuQgToqLyz.png" alt="ç¼–ç ä¸æ¼”åŒ–-æ¨¡å¼" /><figcaption aria-hidden="true">ç¼–ç ä¸æ¼”åŒ–-æ¨¡å¼</figcaption></figure><h2 id="æ•°æ®æµçš„ç±»å‹">æ•°æ®æµçš„ç±»å‹</h2><figure><img src="https://s2.loli.net/2022/03/20/cpGuNimlo9SZ6zK.png" alt="æ•°æ®æµ" /><figcaption aria-hidden="true">æ•°æ®æµ</figcaption></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ã€Œè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€ä¹¦ä¸­ç¬¬ä¸‰ã€å››ç« å†…å®¹çš„æ€ç»´å¯¼å›¾ã€‚åŒ…æ‹¬ï¼šå­˜å‚¨ä¸æ£€ç´¢ã€ç¼–ç æ•°æ®ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8/"/>
    
    
    <category term="database" scheme="https://scottzhang.pro/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨-æ•°æ®ç³»ç»Ÿ P1</title>
    <link href="https://scottzhang.pro/article/752462c7.html"/>
    <id>https://scottzhang.pro/article/752462c7.html</id>
    <published>2022-03-18T13:44:15.000Z</published>
    <updated>2022-03-18T13:47:06.306Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ã€Œè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€ä¹¦ä¸­ç¬¬ä¸€äºŒç« å†…å®¹çš„æ€ç»´å¯¼å›¾ã€‚åŒ…æ‹¬ï¼šç¬¬ä¸€ç« å…³äºå¯é æ€§ã€å¯ä¼¸ç¼©æ€§ã€å¯ç»´æŠ¤æ€§ä»¥åŠç¬¬äºŒç« ä»‹ç»çš„æ•°æ®æ¨¡å‹ä¸æŸ¥è¯¢è¯­è¨€ã€‚</p></blockquote><span id="more"></span><p>è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨-æ•°æ®ç³»ç»Ÿ</p><h1 id="å¯é æ€§å¯ä¼¸ç¼©æ€§å¯ç»´æŠ¤æ€§">1. å¯é æ€§ã€å¯ä¼¸ç¼©æ€§ã€å¯ç»´æŠ¤æ€§</h1><h2 id="å¯é æ€§">1.1 å¯é æ€§</h2><figure><img src="https://s2.loli.net/2022/03/18/oMFv6ndUyYaERgm.png" alt="1-1" /><figcaption aria-hidden="true">1-1</figcaption></figure><h2 id="å¯ä¼¸ç¼©æ€§">1.2 å¯ä¼¸ç¼©æ€§</h2><figure><img src="https://s2.loli.net/2022/03/18/MZfmFU98SGbJHe2.png" alt="1-2" /><figcaption aria-hidden="true">1-2</figcaption></figure><h2 id="å¯ç»´æŠ¤æ€§">1.3 å¯ç»´æŠ¤æ€§</h2><figure><img src="https://s2.loli.net/2022/03/18/SO3gwFKtd8U7iaL.png" alt="1-3" /><figcaption aria-hidden="true">1-3</figcaption></figure><h1 id="æ•°æ®æ¨¡å‹ä¸æŸ¥è¯¢è¯­è¨€">2. æ•°æ®æ¨¡å‹ä¸æŸ¥è¯¢è¯­è¨€</h1><h2 id="å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹">2.1 å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹</h2><figure><img src="https://s2.loli.net/2022/03/18/an5Gom1VSOcqBp6.png" alt="å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹2-1.png" /><figcaption aria-hidden="true">å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹2-1.png</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/18/rS9UTdP7OC1YJqv.png" alt="å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹2-2.png" /><figcaption aria-hidden="true">å…³ç³»æ¨¡å‹ä¸æ–‡æ¡£æ¨¡å‹2-2.png</figcaption></figure><h2 id="æ•°æ®æŸ¥è¯¢è¯­è¨€">2.2 æ•°æ®æŸ¥è¯¢è¯­è¨€</h2><figure><img src="https://s2.loli.net/2022/03/18/Gf6BhxwE3jTVDcr.png" alt="æ•°æ®æŸ¥è¯¢è¯­è¨€2-3.png" /><figcaption aria-hidden="true">æ•°æ®æŸ¥è¯¢è¯­è¨€2-3.png</figcaption></figure><h2 id="å›¾æ•°æ®æ¨¡å‹">2.3 å›¾æ•°æ®æ¨¡å‹</h2><figure><img src="https://s2.loli.net/2022/03/18/7rQefncS3tWBLd6.png" alt="å›¾æ•°æ®ç¤ºä¾‹2-3-1.png" /><figcaption aria-hidden="true">å›¾æ•°æ®ç¤ºä¾‹2-3-1.png</figcaption></figure><p>ä¸€ä¸ªå›¾æ•°æ®æ¨¡å‹ç¤ºä¾‹ã€‚å¯ä»¥ä»ç¤¾äº¤ç½‘ç»œæˆ–ç³»è°±æ•°æ®åº“ä¸­è·å¾—ï¼šå®ƒæ˜¾ç¤ºäº†ä¸¤ä¸ªäººï¼Œæ¥è‡ªçˆ±è¾¾è·å·çš„ Lucy å’Œæ¥è‡ªæ³•å›½ Beaune çš„ Alainã€‚ä»–ä»¬å·²å©šï¼Œä½åœ¨ä¼¦æ•¦ã€‚</p><figure><img src="https://s2.loli.net/2022/03/18/uFSEp4mULksXdYo.png" alt="å›¾æ•°æ®æ¨¡å‹2-3-2.png" /><figcaption aria-hidden="true">å›¾æ•°æ®æ¨¡å‹2-3-2.png</figcaption></figure><figure><img src="https://s2.loli.net/2022/03/18/ajBF7HSo9ZT8AOR.png" alt="å›¾æ•°æ®æ¨¡å‹2-3-3.png" /><figcaption aria-hidden="true">å›¾æ•°æ®æ¨¡å‹2-3-3.png</figcaption></figure><p>åœ¨å†å²ä¸Šï¼Œæ•°æ®æœ€å¼€å§‹è¢«è¡¨ç¤ºä¸ºä¸€æ£µå¤§æ ‘ï¼ˆå±‚æ¬¡æ•°æ®æ¨¡å‹ï¼‰ï¼Œä½†æ˜¯è¿™ä¸åˆ©äºè¡¨ç¤ºå¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥å‘æ˜äº†å…³ç³»æ¨¡å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æœ€è¿‘ï¼Œå¼€å‘äººå‘˜å‘ç°ä¸€äº›åº”ç”¨ç¨‹åºä¹Ÿä¸é€‚åˆé‡‡ç”¨å…³ç³»æ¨¡å‹ã€‚æ–°çš„éå…³ç³»å‹ â€œNoSQLâ€ æ•°æ®å­˜å‚¨åœ¨ä¸¤ä¸ªä¸»è¦æ–¹å‘ä¸Šå­˜åœ¨åˆ†æ­§ï¼š</p><p>æ–‡æ¡£æ•°æ®åº“ çš„åº”ç”¨åœºæ™¯æ˜¯ï¼šæ•°æ®é€šå¸¸æ˜¯è‡ªæˆ‘åŒ…å«çš„ï¼Œè€Œä¸”æ–‡æ¡£ä¹‹é—´çš„å…³ç³»éå¸¸ç¨€å°‘ã€‚ å›¾å½¢æ•°æ®åº“ ç”¨äºç›¸åçš„åœºæ™¯ï¼šä»»æ„äº‹ç‰©éƒ½å¯èƒ½ä¸ä»»ä½•äº‹ç‰©ç›¸å…³è”ã€‚ è¿™ä¸‰ç§æ¨¡å‹ï¼ˆæ–‡æ¡£ï¼Œå…³ç³»å’Œå›¾å½¢ï¼‰åœ¨ä»Šå¤©éƒ½è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å„è‡ªçš„é¢†åŸŸéƒ½å‘æŒ¥å¾ˆå¥½ã€‚ä¸€ä¸ªæ¨¡å‹å¯ä»¥ç”¨å¦ä¸€ä¸ªæ¨¡å‹æ¥æ¨¡æ‹Ÿ â€” ä¾‹å¦‚ï¼Œå›¾æ•°æ®å¯ä»¥åœ¨å…³ç³»æ•°æ®åº“ä¸­è¡¨ç¤º â€” ä½†ç»“æœå¾€å¾€æ˜¯ç³Ÿç³•çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ç€é’ˆå¯¹ä¸åŒç›®çš„çš„ä¸åŒç³»ç»Ÿï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„ä¸‡èƒ½è§£å†³æ–¹æ¡ˆã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ã€Œè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€ä¹¦ä¸­ç¬¬ä¸€äºŒç« å†…å®¹çš„æ€ç»´å¯¼å›¾ã€‚åŒ…æ‹¬ï¼šç¬¬ä¸€ç« å…³äºå¯é æ€§ã€å¯ä¼¸ç¼©æ€§ã€å¯ç»´æŠ¤æ€§ä»¥åŠç¬¬äºŒç« ä»‹ç»çš„æ•°æ®æ¨¡å‹ä¸æŸ¥è¯¢è¯­è¨€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8/"/>
    
    
    <category term="database" scheme="https://scottzhang.pro/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>Linux-åŸºæœ¬å‘½ä»¤ä¸ç›®å½•ç»“æ„</title>
    <link href="https://scottzhang.pro/article/fa8d7a03.html"/>
    <id>https://scottzhang.pro/article/fa8d7a03.html</id>
    <published>2022-03-02T07:06:53.000Z</published>
    <updated>2022-03-02T07:19:54.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« æ¶µç›–äº†Linuxä¸­å…³äºåŸºæœ¬å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€ç‰¹æ®Šç¬¦å·ã€Shell ç¼–è¾‘å·¥å…·ã€å¸®åŠ©æ–‡æ¡£æŸ¥è¯¢ã€æ ‡å‡†è¾“å…¥è¾“å‡ºã€ç¬¦å·é“¾æ¥ã€è§£å‹ç¼©ã€è¶…çº§ç”¨æˆ·ä»¥åŠç›®å½•çš„ç»“æ„ä»‹ç»ç­‰å†…å®¹ã€‚</p></blockquote><span id="more"></span><h2 id="å…³äº-unix-å’Œ-linux">å…³äº Unix å’Œ Linux</h2><p>Linux is a Unix flavor at heart. Youâ€™ll see the word Unix in this chapter more than Linux because you can take what you learn straight over to BSD and other Unix-flavored systems.</p><h2 id="bourne-shell-binsh">Bourne Shell: /bin/sh</h2><p>A shell is a program that runs commands.</p><p>ç°åœ¨æœ‰å¾ˆå¤šçš„ Shellï¼Œä½†å¤§éƒ¨åˆ†çš„éƒ½æ˜¯èµ·æºäº Bourne shell (/bin/sh)ï¼Œè¿™æ˜¯è´å°”å®éªŒå®¤æ—©æœŸå¼€å‘ç»™ Unix ç”¨çš„ã€‚</p><p>Linux ä¹Ÿæœ‰ä¸€ä¸ªä¼˜åŒ–è¿‡çš„ Shell å« <code>bash</code>ï¼Œå…¨ç§°æ˜¯ bourne again shell.</p><h2 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">cp</span><br><span class="line">mv</span><br><span class="line">rm</span><br><span class="line">touch</span><br><span class="line">mkdir</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">grep</span><br><span class="line">less</span><br><span class="line">more</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">diff å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶ä¸åŒ</span><br><span class="line">file æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„æ ¼å¼</span><br><span class="line">find</span><br><span class="line">head</span><br><span class="line">tail</span><br><span class="line">sort</span><br><span class="line">passwd æ”¹å¯†ç </span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒå’Œ-shell-å˜é‡">ç¯å¢ƒå’Œ Shell å˜é‡</h2><p>Shell ç¯å¢ƒä¸‹å¯ä»¥ä¿å­˜ä¸€äº›å˜é‡:</p><p><img src="https://s2.loli.net/2022/03/01/U13k84fPnlTDwYp.png" /></p><p>å¦‚æœå¸Œæœ›å½“ shell å¯åŠ¨çš„æ—¶å€™å°±å°†ä¸€äº›å˜é‡å­˜èµ·æ¥ï¼Œåˆ™å¯é€šè¿‡ç¯å¢ƒå˜é‡ã€‚</p><p>The main difference between environment and shell variables is that the operating system passes all of your shellâ€™s environment variables to programs that the shell runs, whereas shell variables cannot be accessed in the commands that you run.</p><h2 id="å‘½ä»¤åœ°å€">å‘½ä»¤åœ°å€</h2><p><code>Path</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬è¾“å…¥çš„æŒ‡ä»¤ shell ä¼šå»è¿™äº›è·¯å¾„ä¸­å¯»æ‰¾ç¨‹åºï¼Œä¾‹å¦‚è¿™æ˜¯æˆ‘çš„ç”µè„‘ä¸Š <code>Path</code> çš„å€¼ï¼š</p><p><img src="https://s2.loli.net/2022/03/01/6Z1ztSubRsA3vlP.png" /></p><p>è¿™ä¸ªåœ°å€ä¸­çš„å¯ä»¥ç¼–è¾‘ï¼Œæ·»åŠ ã€‚</p><h2 id="ç‰¹æ®Šç¬¦å·">ç‰¹æ®Šç¬¦å·</h2><table><colgroup><col style="width: 16%" /><col style="width: 16%" /><col style="width: 66%" /></colgroup><thead><tr class="header"><th>ç¬¦å·</th><th>ç¬¦å·å</th><th>å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td>*</td><td>star, asterisk</td><td>Regular expression, glob character</td></tr><tr class="even"><td>.</td><td>dot</td><td>Current directory, file/hostname delimiter</td></tr><tr class="odd"><td>!</td><td>bang</td><td>Negation, command history</td></tr><tr class="even"><td>|</td><td>pipe</td><td>Command pipes</td></tr><tr class="odd"><td>/</td><td>(forward) slash</td><td>Directory delimiter, search command</td></tr><tr class="even"><td>\</td><td>backslash</td><td>Literals, macros (never directories)</td></tr><tr class="odd"><td>$</td><td>dollar</td><td>Variables, end of line</td></tr><tr class="even"><td>'</td><td>tick, (single) quote</td><td>Literal strings</td></tr><tr class="odd"><td>`</td><td>backtick, backquote</td><td>Command substitution</td></tr><tr class="even"><td>"</td><td>double quote</td><td>Semi-literal strings</td></tr><tr class="odd"><td>^</td><td>caret</td><td>Negation, beginning of line</td></tr><tr class="even"><td>~</td><td>tilde, squiggle</td><td>Negation, directory shortcut</td></tr><tr class="odd"><td>#</td><td>hash, sharp, pound</td><td>Comments, preprocessor, substitutions</td></tr><tr class="even"><td>[ ]</td><td>(square) brackets</td><td>Ranges</td></tr><tr class="odd"><td>{ }</td><td>braces, (curly) brackets</td><td>Statement blocks, ranges</td></tr><tr class="even"><td>_</td><td>underscore, under</td><td>Cheap substitute for a space used when spaces arenâ€™t wanted or allowed, or when autocomplete algorithms get confused</td></tr></tbody></table><h2 id="shell-ä¸­ç¼–è¾‘">Shell ä¸­ç¼–è¾‘</h2><table><thead><tr class="header"><th>å¿«æ·é”®</th><th>å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td>CTRL-B</td><td>Move the cursor left</td></tr><tr class="even"><td>CTRL-F</td><td>Move the cursor right</td></tr><tr class="odd"><td>CTRL-P</td><td>View the previous command (or move the cursor up)</td></tr><tr class="even"><td>CTRL-N</td><td>View the next command (or move the cursor down)</td></tr><tr class="odd"><td>CTRL-A</td><td>Move the cursor to the beginning of the line</td></tr><tr class="even"><td>CTRL-E</td><td>Move the cursor to the end of the line</td></tr><tr class="odd"><td>CTRL-W</td><td>Erase the preceding word</td></tr><tr class="even"><td>CTRL-U</td><td>Erase from cursor to beginning of line</td></tr><tr class="odd"><td>CTRL-K</td><td>Erase from cursor to end of line</td></tr><tr class="even"><td>CTRL-Y</td><td>Paste erased text (for example, from CTRL-U)</td></tr></tbody></table><h2 id="æŸ¥è¯¢å¸®åŠ©æ–‡æ¡£">æŸ¥è¯¢å¸®åŠ©æ–‡æ¡£</h2><p><code>man ls</code> æŸ¥è¯¢ ls çš„å¸®åŠ©ï¼›<code>man -k kerword</code> æŸ¥è¯¢æœ‰ keyword å…³é”®å­—çš„å¸®åŠ©ï¼Œç»“æœä½ ä¼šå‘ç°æœ‰äº›æ•°å­—ï¼Œè¿™äº›æ•°å­—æ˜¯å‘Šè¯‰ä½ è¿™ä¸ªå‘½ä»¤åœ¨å“ªä¸ªåˆ†ç±»ä¸‹å‡ºç°ï¼Œæ•°å­—å¯¹åº”çš„åˆ†ç±»ä¿¡æ¯å¦‚ä¸‹</p><table><thead><tr class="header"><th>Section</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>1</td><td>User commands</td></tr><tr class="even"><td>2</td><td>Kernel system calls</td></tr><tr class="odd"><td>3</td><td>Higher-level Unix programming library documentation</td></tr><tr class="even"><td>4</td><td>Device interface and driver information</td></tr><tr class="odd"><td>5</td><td>File descriptions (system configuration files)</td></tr><tr class="even"><td>6</td><td>Games</td></tr><tr class="odd"><td>7</td><td>File formats, conventions, and encodings (ASCII, suffixes, and so on)</td></tr><tr class="even"><td>8</td><td>System commands and servers</td></tr></tbody></table><h2 id="æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯">æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯</h2><ul><li><code>command &gt; file</code> # å‘½ä»¤çš„è¾“å‡ºå­˜åˆ° file</li><li><code>command &gt;&gt; file</code> # å‘½ä»¤çš„è¾“å‡ºè¿½åŠ åˆ° file</li><li><code>command1 | command2</code> # å‘½ä»¤1 çš„è¾“å‡ºä½œä¸ºå‘½ä»¤2 çš„è¾“å…¥</li><li><code>head &lt; /proc/cpuinfo#</code> æ–‡ä»¶å†…å®¹åˆ°è¾“å‡º</li></ul><p>å¦‚æœæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ä¼šæŠ¥é”™ï¼Œä½†å¸Œæœ›å°†æŠ¥é”™çš„å†…å®¹å•ç‹¬ä¿å­˜åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œå¯ä½¿ç”¨ä¸‹å›¾çš„å‘½ä»¤ï¼ŒThe number <code>2</code> specifies the stream ID that the shell modifies. Stream ID 1 is standard output (the default), and 2 is standard error. <code>&gt;&amp;</code> notation will send both standard output and standard error to the file named f</p><p><img src="https://s2.loli.net/2022/03/01/utf8BAJgk43Fnbz.png" /></p><h2 id="ç®¡ç†è¿›ç¨‹">ç®¡ç†è¿›ç¨‹</h2><h3 id="åˆ—å‡ºè¿›ç¨‹">åˆ—å‡ºè¿›ç¨‹</h3><p>åœ¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª PID ä½œä¸ºæ ‡è¯†è¿›ç¨‹çš„å”¯ä¸€ IDï¼Œåœ¨ Linux å¯ä»¥ä½¿ç”¨ <code>ps</code> å‘½ä»¤ç›´æ¥æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„æƒ…å†µ:</p><p><img src="https://s2.loli.net/2022/03/02/X3bOYeqWzfl9Ex4.png" /></p><ul><li>PID, The process ID.</li><li>TTY, The terminal device where the process is running. More about this later.</li><li>STAT, what the process is doing and where its memory resides. For example, S means sleeping and R means running. (See the ps(1) manual page for a description of all the symbols.)</li><li>TIME, the total amount of time that the process has spent running instructions on the processor. Remember that because processes donâ€™t run constantly, this is different from the time since the process started (or â€œwall-clock timeâ€).</li><li>COMMAND, This one might seem obvious as the command used to run the program, but be aware that a process can change this field from its original value. Furthermore, the shell can perform glob expansion, and this field will reflect the expanded command instead of what you enter at the prompt.</li></ul><blockquote><p>Mac ä¸‹æ²¡æœ‰ STAT è¿™åˆ—</p></blockquote><p>Ps è¿˜æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥æŒ‡å®šï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä¹‰è¾“å‡ºï¼š</p><ul><li><code>ps x</code>â€ƒShow all of your running processes.</li><li><code>ps ax</code>â€ƒShow all processes on the system, not just the ones you own.</li><li><code>ps u</code>â€ƒInclude more detailed information on processes.</li><li><code>ps w</code>â€ƒShow full command names, not just what fits on one line.</li></ul><h3 id="æ€æ­»è¿›ç¨‹">æ€æ­»è¿›ç¨‹</h3><p>æ€æ­»ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ kill æŒ‡ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kill pid, è®©å†…æ ¸å‘è¿›ç¨‹å‘é€ä¸€ä¸ª TERM ä¿¡å·ï¼ˆé»˜è®¤ï¼‰ï¼Œåœæ­¢è¯¥è¿›ç¨‹</span><br><span class="line">kill -STOP pid, å‘é€ STOP ä¿¡å·ï¼Œ å†»ç»“è¯¥è¿›ç¨‹ï¼Œå†»ç»“çš„è¿›ç¨‹è¿˜ä¼šå­˜åœ¨äºå†…å­˜</span><br><span class="line">kill -CONT pid, æ¢å¤ä¸€ä¸ªå†»ç»“çš„è¿›ç¨‹</span><br></pre></td></tr></table></figure><p>å‘é€ä¸Šé¢çš„æŒ‡ä»¤å¯èƒ½ä½ è¿˜ä¼šçœ‹åˆ°è¿›ç¨‹å­˜åœ¨ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¼šç»™è¿›ç¨‹æœºä¼šå»å¤„ç†ç°åœºï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½ç›´æ¥å¿½ç•¥ä½ å‘é€çš„ä¿¡å·ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥å¼ºåˆ¶æ€æ­»ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸ç»™å…¶ä»»ä½•æœºä¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -KILL pid</span><br><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure><h3 id="ä½œä¸šç®¡ç†">ä½œä¸šç®¡ç†</h3><p>ä½œä¸šç®¡ç†ï¼Œallows you to suspend and switch between programs youâ€™re usingã€‚</p><p>For example, you can send a TSTP signal with CTRL-Z and then start the process again by entering fg (bring to foreground) or bg (move to background; see the next section).</p><p>å¯ä½¿ç”¨ <code>jobs</code> æŸ¥çœ‹æ˜¯å¦æœ‰ä»€ä¹ˆä½œä¸šæ­£åœ¨è¿è¡Œã€‚</p><p>ç”¨ <code>screen</code> æˆ–è€… <code>tmux</code> æ¥ç®¡ç†ä½œä¸šæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚</p><h3 id="è¿›ç¨‹æ”¾åˆ°åå°ä½¿ç”¨">è¿›ç¨‹æ”¾åˆ°åå°ä½¿ç”¨</h3><p>å¦‚æœä½ æœ‰ä¸€ä¸ªè§£å‹å¤§é‡æ–‡ä»¶çš„éœ€æ±‚ï¼Œå½“ä½ è¿è¡Œçš„æ—¶å€™ï¼Œåªæœ‰å½“å…¨éƒ¨ä»»åŠ¡ç»“æŸä½ æ‰ä¼šçœ‹åˆ°è¾“å‡ºï¼Œè¿™æ—¶å€™ä½ ä¹Ÿæ²¡åŠæ³•åšä»€ä¹ˆï¼Œä½†ä½ å¯ä»¥å°†è¿™ä¸ªä»»åŠ¡æ”¾åˆ°åå°å»åšï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip file.gz &amp;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šç»™ä½ ä¸€ä¸ª PID å‘Šè¯‰ä½ æ­£åœ¨å¤„ç†è¿™ä¸ªä»»åŠ¡çš„è¿›ç¨‹ã€‚</p><p>å¦‚æœè¿™ä¸ªåå°è¿è¡Œçš„è¿›ç¨‹éœ€è¦æ ‡å‡†è¾“å…¥ï¼Œé‚£ä¹ˆå®ƒä¼šè¿›å…¥å†»ç»“çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>fg</code> å°†å…¶å¸¦å…¥å‰å°ï¼Œå¦‚æœè¿™ä¸ªåå°è¿›ç¨‹æŠ¥é”™äº†ï¼Œé‚£ä½ ä¼šæ”¶åˆ°æŠ¥é”™çš„ä¿¡æ¯ï¼ˆå³ä¾¿ä½ å½“æ—¶æ­£åœ¨å¿™åˆ«çš„äº‹æƒ…ğŸ˜‚ï¼‰ï¼Œå¦‚æœä¸æƒ³è¢«æ‰“æ‰°ï¼Œæœ€å¥½å°†å…¶é”™è¯¯ä¿¡æ¯é‡å®šå‘åˆ°å…¶ä»–åœ°æ–¹ï¼ˆå‰é¢ä»‹ç»è¿‡ï¼‰.</p><h2 id="æ–‡ä»¶æ¨¡å¼å’Œæƒé™">æ–‡ä»¶æ¨¡å¼å’Œæƒé™</h2><p>æ‰€æœ‰ Unix æ–‡ä»¶éƒ½æœ‰ä¸€ç»„æƒé™æ¥å†³å®šä½ æ˜¯å¦å¯ä»¥è¯»æˆ–è€…å†™:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 juser somegroup 7041  Mar 26 19:34  endnotes.html</span><br></pre></td></tr></table></figure><p>æœ€å¼€å§‹çš„ <code>-rw-r--r--</code> è¡¨æ˜äº†è¯¥æ–‡ä»¶çš„æƒé™ï¼Œå…¶å«ä¹‰å¦‚ä¸‹:</p><p><img src="https://s2.loli.net/2022/03/02/GIVpzYK9hBNSUxC.png" /></p><p>ç¬¬ä¸€ä¸ª - å¾€åå¼€å§‹ï¼Œä¸‰ä¸ªä¸€ç»„ä¸ºæƒé™ç»„ï¼Œå…¶ä¸­å„ä¸ªå­—æ¯çš„æ„æ€å¦‚ä¸‹ï¼š</p><ul><li>r means that the file is readable.</li><li>w means that the file is writable.</li><li>x means that the file is executable (you can run it as a program).</li><li>- means â€œnothingâ€ (more specifically, the permission for that slot in the set has not been granted).</li><li>æœ‰äº›ä¼šæ˜¯sï¼Œç”¨æ¥è¡¨ç¤ºç”¨æˆ·æ‰§è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå°†ä»¥è¿™ä¸ªç¨‹åºæ‰€æœ‰è€…çš„èº«ä»½æ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥è®¾ç½®sæƒé™ï¼Œè€Œæ— éœ€å…ˆæœ‰xï¼Œä½†æ˜¯æœ‰å¯èƒ½æœªç”Ÿæ•ˆï¼ˆå°†ä»¥å¤§Sè¡¨ç¤ºï¼‰</li><li>Mac OS Xæ–‡ä»¶ç³»ç»Ÿè¿˜æœ‰ä¸€ä¸ªçš„é™„åŠ å±æ€§@.</li></ul><h2 id="æƒé™ä¿®æ”¹">æƒé™ä¿®æ”¹</h2><p>ä½¿ç”¨ <code>chmod</code> æ¥ä¿®æ”¹æƒé™ï¼Œå¦‚å¯¹ group å’Œ others å¢åŠ å†™æƒé™:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod g+r file</span><br><span class="line">chmod o+r file</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…é€šè¿‡ä¸€æ¡å‘½ä»¤</span></span><br><span class="line">chmod go+r file</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šçœ‹åˆ°é€šè¿‡æ•°å­—æ¥æŒ‡å®šæƒé™çš„å½¢å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sets all permission bits at once</span></span><br><span class="line">chmod 644 file</span><br></pre></td></tr></table></figure><p>æ— éœ€è®°ä½æ‰€æœ‰æ•°å­—çš„æ„æ€ï¼Œå¸¸ç”¨çš„æƒé™å¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š</p><table style="width:100%;"><colgroup><col style="width: 14%" /><col style="width: 57%" /><col style="width: 28%" /></colgroup><thead><tr class="header"><th>Mode</th><th>Meaning</th><th>Used for</th></tr></thead><tbody><tr class="odd"><td>644</td><td>user: read/write; group, other: read</td><td>files</td></tr><tr class="even"><td>600</td><td>user: read/write; group, other: none</td><td>files</td></tr><tr class="odd"><td>755</td><td>user: read/write/execute; group, other: read/execute</td><td>directories, programs</td></tr><tr class="even"><td>700</td><td>user: read/write/execute; group, other: none</td><td>directories, programs</td></tr><tr class="odd"><td>711</td><td>user: read/write/execute; group, other: execute</td><td>directories</td></tr></tbody></table><p>å…³äºç›®å½•çš„æƒé™ï¼š</p><ul><li>You can list the contents of a directory if itâ€™s readable, but you can only access a file in a directory if the directory is executable.</li><li>You need both in most cases;</li></ul><p><code>unmask</code> å‘½ä»¤:</p><ul><li>ou can specify a set of default permissions with the umask shell command, which applies a predefined set of permissions to any new file you create.</li><li>use umask 022 if you want everyone to be able to see all of the files and directories that you create, and use umask 077 if you donâ€™t.</li></ul><h2 id="ç¬¦å·é“¾æ¥">ç¬¦å·é“¾æ¥</h2><p>symbolic link is a file that points to another file or a directory, effectively creating an alias (like a shortcut in Windows). Symbolic links offer quick access to obscure directory paths.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx 1 ruser users  11 Feb 27 13:52  somedir -&gt; /home/origdir</span><br></pre></td></tr></table></figure><p>è‹¥ç¬¦å·é“¾æ¥ä»£è¡¨çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¾èµ–è¯¥æ–‡ä»¶çš„å‘½ä»¤ä¼šå‡ºé”™ï¼Œé™¤äº† <code>ls file</code>ã€‚</p><p>é€šè¿‡ç¬¦å·é“¾æ¥ï¼Œä½ æ— æ³•çŸ¥é“æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„ç‰¹å¾ï¼Œä½ å¿…é¡»è®¿é—®è¯¥è·¯å¾„å»çœ‹äº†æ‰çŸ¥é“ï¼Œè€Œä¸”ä¸€ä¸ªç¬¦å·é“¾æ¥å¯ä»¥æŒ‡å‘å¦å¤–ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè¿™ç§è¢«ç§°ä¸º chained symbolic links.</p><p>åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥å¯ä»¥é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -s æŒ‡å®šä¸ºè½¯é“¾æ¥ï¼Œè‹¥æ²¡æœ‰åˆ™æ˜¯ç¡¬é“¾æ¥</span><br><span class="line">ln -s target linkname</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸è¦å°† target å’Œ linkname æåäº†ï¼Œå¦åˆ™ä¼šå‘ç”Ÿçš„äº‹æƒ…å°±æ˜¯ï¼šcreates a link named target inside linkname, and the link will point to itself unless linkname is a full path.</p></blockquote><p>ç¬¦å·é“¾æ¥å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä½ ä»¥ä¸ºä½ ç¼–è¾‘çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯ä»¥ç¼–è¾‘ï¼‰ï¼Œä½†å…¶å®å®ƒæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</p><p>ç¬¦å·é“¾æ¥æœ¬è´¨ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¿å­˜çš„æ˜¯ç›®æ ‡æ–‡ä»¶çš„åœ°å€ï¼Œè€Œç¡¬é“¾æ¥åˆ™æ˜¯æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸­åº•å±‚çš„æ•°æ®ã€‚</p><ul><li>å½“å¯¹ä¸€ä¸ªæ–‡ä»¶åˆ›å»ºäº†ç¡¬é“¾æ¥ï¼Œå¦‚æœå¯¹ç¡¬é“¾æ¥ä¿®æ”¹ï¼Œé‚£ä¹ˆåŸå§‹æ–‡ä»¶ä¹Ÿä¼šè¢«ä¿®æ”¹</li><li>å½“åŸå§‹æ–‡ä»¶è¢«åˆ é™¤ï¼Œè®¿é—®ç¡¬é“¾æ¥è¿˜å¯ä»¥çœ‹åˆ°åŸå§‹æ–‡ä»¶å†…å®¹ï¼Œå› ä¸ºåº•å±‚çš„æ–‡ä»¶æ•°æ®å­˜åœ¨ç¡¬é“¾æ¥è¿™ä¸ªå¼•ç”¨ï¼Œå¹¶æœªè¢«çœŸçš„åˆ é™¤ï¼›è®¿é—®è½¯é“¾æ¥åˆ™ä¼šæç¤ºåŸå§‹æ–‡ä»¶å·²ç»ä¸è§ã€‚</li><li>åŸå§‹æ–‡ä»¶è¢«åˆ é™¤åï¼Œå½“å‘ç¡¬é“¾æ¥è¿½åŠ å†…å®¹ï¼Œç¡¬é“¾æ¥æ–‡ä»¶å†…å®¹ä¼šæœ‰åŸå§‹å†…å®¹å’Œæ–°å†…å®¹ï¼›è½¯è¿æ¥åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶å°†æ–°å†…å®¹å†™å…¥ã€‚</li></ul><h2 id="è§£å‹ç¼©">è§£å‹ç¼©</h2><ul><li><code>gzip</code>, The program gzip (GNU Zip) is one of the current standard Unix compression programs. ä½†æ— æ³•å‹ç¼©å¤šä¸ªæ–‡ä»¶.</li><li><code>tar</code>, å¯å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œç»†èŠ‚å¦‚ä¸‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å‹ç¼©</span><br><span class="line"># c, create mode</span><br><span class="line"># v, æ˜¾ç¤ºè¾“å…¥ï¼Œä¸¤ä¸ªvåˆ™æ˜¾ç¤ºæ›´å¤šç»†èŠ‚</span><br><span class="line"># f, æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">tar cvf archive.tar file1 file2 ...</span><br><span class="line"></span><br><span class="line"># è§£å‹</span><br><span class="line">tar xvf archive.tar</span><br><span class="line"># x, è§£å‹æ¨¡å¼</span><br></pre></td></tr></table></figure><p>åœ¨è§£å‹ä¸€ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œå…ˆæŸ¥çœ‹å‹ç¼©æ–‡ä»¶å†…æœ‰å“ªäº›ä¸œè¥¿æ˜¯æœ‰å¿…è¦çš„ï¼Œå¯ä»¥é€šè¿‡ <code>t</code> æ¨¡å¼æ¥å®ç°ã€‚</p><p>è§£å‹æ—¶çš„æƒé™æ§åˆ¶ï¼š consider using the p option to preserve permissions. Use this in extract mode to override your umask and get the exact permissions specified in the archive.</p><p>å‹ç¼©æ–‡ä»¶æœ‰æ—¶å€™ä¼šæœ‰å¤šé‡å‹ç¼©çš„æƒ…å†µï¼Œæ¯”å¦‚ä½ å¯èƒ½çœ‹åˆ°ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶: <code>file.tar.gz</code>ï¼Œè§£å‹è¿™ç§æ–‡ä»¶éœ€è¦ä»å³å¾€å·¦ä½¿ç”¨å¯¹åº”å·¥å…·è§£å‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gunzip file.tar.gz</span><br><span class="line">tar xvf file.tar</span><br></pre></td></tr></table></figure><p>ä½†åˆ†åˆ«è§£å‹æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œéœ€è¦ä¸¤æ¬¡ç£ç›˜è¯»å†™å’Œioæ—¶é—´ï¼Œå¯ä»¥åˆ©ç”¨ç®¡é“æ¥å¤„ç†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat file.tar.gz | tar xvf -</span><br></pre></td></tr></table></figure><p><code>zcat</code> ç›¸å½“äº <code>gunzip -dc</code>, å…¶ä¸­ d çš„æ„æ€æ˜¯è§£å‹ï¼Œc çš„æ„æ€æ˜¯å°†ç»“æœæ”¾åˆ°æ ‡å‡†è¾“å‡ºã€‚</p><p><code>zcat</code> ä½¿ç”¨éå¸¸é¢‘ç¹, æ‰€ä»¥ tar å°†å…¶æ”¾åœ¨å†…ç½®å‚æ•°ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar ztvf file.tar.gz</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„è§£å‹å·¥å…·è¿˜æœ‰ <code>xz</code> å’Œ <code>bzip2</code>.</p><h2 id="linux-ç›®å½•ç»“æ„">Linux ç›®å½•ç»“æ„</h2><p>ç›®å½•ç»“æ„ä¸€èˆ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2022/03/02/vRuS1hNDzWUI2Hl.png" /></p><hr /><p><strong>ä¸€èˆ¬çš„ç›®å½•æ–‡ä»¶å¤¹ä»‹ç»ï¼š</strong></p><ul><li>/binâ€ƒContains ready-to-run programs (also known as executables), including most of the basic Unix commands such as ls and cp. Most of the programs in /bin are in binary format, having been created by a C compiler, but some are shell scripts in modern systems.</li><li>/devâ€ƒContains device files. Youâ€™ll learn more about these in Chapter 3.</li><li>/etcâ€ƒThis core system configuration directory (pronounced EHT-see) contains the user password, boot, device, networking, and other setup files.</li><li>/homeâ€ƒHolds home (personal) directories for regular users. Most Unix installations conform to this standard.</li><li>/libâ€ƒAn abbreviation for library, this directory holds library files containing code that executables can use. There are two types of libraries: static and shared. The /lib directory should contain only shared libraries, but other lib directories, such as /usr/lib, contain both varieties as well as other auxiliary files. (Weâ€™ll discuss shared libraries in more detail in Chapter 15.)</li><li>/procâ€ƒProvides system statistics through a browsable directory-and-file interface. Much of the /proc subdirectory structure on Linux is unique, but many other Unix variants have similar features. The /proc directory contains information about currently running processes as well as some kernel parameters.</li><li>/runâ€ƒContains runtime data specific to the system, including certain process IDs, socket files, status records, and, in many cases, system logging. This is a relatively recent addition to the root directory; in older systems, you can find it in /var/run. On newer systems, /var/run is a symbolic link to /run.</li><li>/sysâ€ƒThis directory is similar to /proc in that it provides a device and system interface. Youâ€™ll read more about /sys in Chapter 3.</li><li>/sbinâ€ƒThe place for system executables. Programs in /sbin directories relate to system management, so regular users usually do not have /sbin components in their command paths. Many of the utilities found here donâ€™t work if not run as root.</li><li>/tmpâ€ƒA storage area for smaller, temporary files that you donâ€™t care much about. Any user may read to and write from /tmp, but the user may not have permission to access another userâ€™s files there. Many programs use this directory as a workspace. If something is extremely important, donâ€™t put it in /tmp because most distributions clear /tmp when the machine boots and some even remove its old files periodically. Also, donâ€™t let /tmp fill up with garbage because its space is usually shared with something critical (the rest of /, for example).</li><li>/usrâ€ƒAlthough pronounced â€œuser,â€ this subdirectory has no user files. Instead, it contains a large directory hierarchy, including the bulk of the Linux system. Many of the directory names in /usr are the same as those in the root directory (like /usr/bin and /usr/lib), and they hold the same type of files. (The reason that the root directory does not contain the complete system is primarily historicâ€”in the past, it was to keep space requirements low for the root.)</li><li>/varâ€ƒThe variable subdirectory, where programs record information that can change over the course of time. System logging, user tracking, caches, and other files that system programs create and manage are here. (Youâ€™ll notice a /var/tmp directory here, but the system doesnâ€™t wipe it on boot.)</li></ul><p><strong>å…¶ä»– root ç›®å½•ä¸‹çš„å­æ–‡ä»¶å¤¹ï¼š</strong></p><ul><li>/bootâ€ƒContains kernel boot loader files. These files pertain only to the very first stage of the Linux startup procedure, so you wonâ€™t find information about how Linux starts up its services in this directory. See Chapter 5 for more about this.</li><li>/mediaâ€ƒA base attachment point for removable media such as flash drives that is found in many distributions.</li><li>/optâ€ƒThis may contain additional third-party software. Many systems donâ€™t use /opt.</li></ul><p><strong>å…¶ä»–ç”¨æˆ·ç›®å½•ä¸‹å­˜åœ¨çš„å­æ–‡ä»¶å¤¹ï¼š</strong></p><ul><li>/includeâ€ƒHolds header files used by the C compiler.</li><li>/localâ€ƒIs where administrators can install their own software. Its structure should look like that of / and /usr.</li><li>/manâ€ƒContains manual pages.</li><li>/shareâ€ƒContains files that should work on other kinds of Unix machines with no loss of functionality. These are usually auxiliary data files that programs and libraries read as necessary. In the past, networks of machines would share this directory from a file server, but today a share directory used in this manner is rare because there are no realistic space restraints for these kinds of files on contemporary systems. Instead, on Linux distributions, youâ€™ll find /man, /info, and many other subdirectories here because it is an easily understood convention.</li></ul><p><strong>å†…æ ¸è·¯å¾„</strong></p><p>åœ¨ Linux ä¸­ï¼Œå†…æ ¸ä¸€èˆ¬æ”¾åœ¨ /vmlinuz or /boot/vmlinuzï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œboot loader ä¼šå¯åŠ¨å†…æ ¸ã€‚å…³äº boot loader ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­ä»‹ç»ã€‚</p><h2 id="ä»¥è¶…çº§ç”¨æˆ·æ‰§è¡Œå‘½ä»¤">ä»¥è¶…çº§ç”¨æˆ·æ‰§è¡Œå‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vipw</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ <code>/etc/sudoers</code> æ–‡ä»¶é…ç½®è°å¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤æ‰§è¡Œï¼Œæ˜¯å¦éœ€è¦å¯†ç ç­‰ã€‚</p><p>ä¸‹é¢çš„é…ç½®è¡¨æ˜ï¼Œuser1 å’Œ user2 å¯ä»¥ç›´æ¥ä½¿ç”¨ sudo å‘½ä»¤ï¼Œè€Œä¸éœ€è¦è¾“å…¥å¯†ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># defines an ADMINS user alias with the two users</span><br><span class="line">User_Alias ADMINS = user1, user2</span><br><span class="line"></span><br><span class="line"># users in the ADMINS alias can use sudo to execute commands as root</span><br><span class="line"># The second ALL means â€œany command.â€ The first ALL means â€œany host.â€ </span><br><span class="line">ADMINS ALL = NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"># superuser may also use sudo to run any command on any host.</span><br><span class="line"># extra (ALL) means that the superuser may also run commands as any other user.</span><br><span class="line">root ALL=(ALL) ALL</span><br><span class="line"></span><br><span class="line"># ä¸Šé¢çš„è¿™å¥ï¼Œå¯ä»¥æ‰©å±•ä¸º</span><br><span class="line">ADMINS ALL = (ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ <code>visudo</code> å‘½ä»¤æ¥ç¼–è¾‘ä¸Šé¢è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šæ£€æŸ¥ä½ çš„è¯­æ³•ã€‚</p></blockquote><p>è¦æŸ¥çœ‹ sudo å‘½ä»¤çš„å†å²è®°å½•ï¼Œå¯ä½¿ç”¨:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl SYSLOG_IDENTIFIER=sudo</span><br></pre></td></tr></table></figure><p>æ¥å¯ç”¨ï¼Œå¯¹äºè€ä¸€ç‚¹çš„ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦åœ¨ <code>/var/log</code> æŸ¥çœ‹, æ¯”å¦‚ <code>/var/log/auth.log.</code></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ¶µç›–äº†Linuxä¸­å…³äºåŸºæœ¬å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€ç‰¹æ®Šç¬¦å·ã€Shell ç¼–è¾‘å·¥å…·ã€å¸®åŠ©æ–‡æ¡£æŸ¥è¯¢ã€æ ‡å‡†è¾“å…¥è¾“å‡ºã€ç¬¦å·é“¾æ¥ã€è§£å‹ç¼©ã€è¶…çº§ç”¨æˆ·ä»¥åŠç›®å½•çš„ç»“æ„ä»‹ç»ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="How Linux Works" scheme="https://scottzhang.pro/categories/How-Linux-Works/"/>
    
    
    <category term="Linux" scheme="https://scottzhang.pro/tags/Linux/"/>
    
    <category term="Operating-System" scheme="https://scottzhang.pro/tags/Operating-System/"/>
    
  </entry>
  
</feed>
