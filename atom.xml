<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Scott&#39;s Blog</title>
  
  <subtitle>å­¦åˆ™ä¸å›º, çŸ¥åˆ™ä¸æƒ‘</subtitle>
  <link href="https://scottzhang.pro/atom.xml" rel="self"/>
  
  <link href="https://scottzhang.pro/"/>
  <updated>2022-03-02T07:18:56.439Z</updated>
  <id>https://scottzhang.pro/</id>
  
  <author>
    <name>Scott</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux-åŸºæœ¬å‘½ä»¤ä¸ç›®å½•ç»“æ„</title>
    <link href="https://scottzhang.pro/article/fa8d7a03.html"/>
    <id>https://scottzhang.pro/article/fa8d7a03.html</id>
    <published>2022-03-02T07:06:53.000Z</published>
    <updated>2022-03-02T07:18:56.439Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« æ¶µç›–äº†Linuxä¸­å…³äºåŸºæœ¬å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€ç‰¹æ®Šç¬¦å·ã€Shell ç¼–è¾‘å·¥å…·ã€å¸®åŠ©æ–‡æ¡£æŸ¥è¯¢ã€æ ‡å‡†è¾“å…¥è¾“å‡ºã€ç¬¦å·é“¾æ¥ã€è§£å‹ç¼©ã€è¶…çº§ç”¨æˆ·ä»¥åŠç›®å½•çš„ç»“æ„ä»‹ç»ç­‰å†…å®¹ã€‚</p></blockquote><span id="more"></span><h2 id="å…³äº-unix-å’Œ-linux">å…³äº Unix å’Œ Linux</h2><p>Linux is a Unix flavor at heart. Youâ€™ll see the word Unix in this chapter more than Linux because you can take what you learn straight over to BSD and other Unix-flavored systems.</p><h2 id="bourne-shell-binsh">Bourne Shell: /bin/sh</h2><p>A shell is a program that runs commands.</p><p>ç°åœ¨æœ‰å¾ˆå¤šçš„ Shellï¼Œä½†å¤§éƒ¨åˆ†çš„éƒ½æ˜¯èµ·æºäº Bourne shell (/bin/sh)ï¼Œè¿™æ˜¯è´å°”å®éªŒå®¤æ—©æœŸå¼€å‘ç»™ Unix ç”¨çš„ã€‚</p><p>Linux ä¹Ÿæœ‰ä¸€ä¸ªä¼˜åŒ–è¿‡çš„ Shell å« <code>bash</code>ï¼Œå…¨ç§°æ˜¯ bourne again shell.</p><h2 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">cp</span><br><span class="line">mv</span><br><span class="line">rm</span><br><span class="line">touch</span><br><span class="line">mkdir</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">grep</span><br><span class="line">less</span><br><span class="line">more</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">diff å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶ä¸åŒ</span><br><span class="line">file æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„æ ¼å¼</span><br><span class="line">find</span><br><span class="line">head</span><br><span class="line">tail</span><br><span class="line">sort</span><br><span class="line">passwd æ”¹å¯†ç </span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒå’Œ-shell-å˜é‡">ç¯å¢ƒå’Œ Shell å˜é‡</h2><p>Shell ç¯å¢ƒä¸‹å¯ä»¥ä¿å­˜ä¸€äº›å˜é‡:</p><p><img src="https://s2.loli.net/2022/03/01/U13k84fPnlTDwYp.png" /></p><p>å¦‚æœå¸Œæœ›å½“ shell å¯åŠ¨çš„æ—¶å€™å°±å°†ä¸€äº›å˜é‡å­˜èµ·æ¥ï¼Œåˆ™å¯é€šè¿‡ç¯å¢ƒå˜é‡ã€‚</p><p>The main difference between environment and shell variables is that the operating system passes all of your shellâ€™s environment variables to programs that the shell runs, whereas shell variables cannot be accessed in the commands that you run.</p><h2 id="å‘½ä»¤åœ°å€">å‘½ä»¤åœ°å€</h2><p><code>Path</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬è¾“å…¥çš„æŒ‡ä»¤ shell ä¼šå»è¿™äº›è·¯å¾„ä¸­å¯»æ‰¾ç¨‹åºï¼Œä¾‹å¦‚è¿™æ˜¯æˆ‘çš„ç”µè„‘ä¸Š <code>Path</code> çš„å€¼ï¼š</p><p><img src="https://s2.loli.net/2022/03/01/6Z1ztSubRsA3vlP.png" /></p><p>è¿™ä¸ªåœ°å€ä¸­çš„å¯ä»¥ç¼–è¾‘ï¼Œæ·»åŠ ã€‚</p><h2 id="ç‰¹æ®Šç¬¦å·">ç‰¹æ®Šç¬¦å·</h2><table><colgroup><col style="width: 16%" /><col style="width: 16%" /><col style="width: 66%" /></colgroup><thead><tr class="header"><th>ç¬¦å·</th><th>ç¬¦å·å</th><th>å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td>*</td><td>star, asterisk</td><td>Regular expression, glob character</td></tr><tr class="even"><td>.</td><td>dot</td><td>Current directory, file/hostname delimiter</td></tr><tr class="odd"><td>!</td><td>bang</td><td>Negation, command history</td></tr><tr class="even"><td>|</td><td>pipe</td><td>Command pipes</td></tr><tr class="odd"><td>/</td><td>(forward) slash</td><td>Directory delimiter, search command</td></tr><tr class="even"><td>\</td><td>backslash</td><td>Literals, macros (never directories)</td></tr><tr class="odd"><td>$</td><td>dollar</td><td>Variables, end of line</td></tr><tr class="even"><td>'</td><td>tick, (single) quote</td><td>Literal strings</td></tr><tr class="odd"><td>`</td><td>backtick, backquote</td><td>Command substitution</td></tr><tr class="even"><td>"</td><td>double quote</td><td>Semi-literal strings</td></tr><tr class="odd"><td>^</td><td>caret</td><td>Negation, beginning of line</td></tr><tr class="even"><td>~</td><td>tilde, squiggle</td><td>Negation, directory shortcut</td></tr><tr class="odd"><td>#</td><td>hash, sharp, pound</td><td>Comments, preprocessor, substitutions</td></tr><tr class="even"><td>[ ]</td><td>(square) brackets</td><td>Ranges</td></tr><tr class="odd"><td>{ }</td><td>braces, (curly) brackets</td><td>Statement blocks, ranges</td></tr><tr class="even"><td>_</td><td>underscore, under</td><td>Cheap substitute for a space used when spaces arenâ€™t wanted or allowed, or when autocomplete algorithms get confused</td></tr></tbody></table><h2 id="shell-ä¸­ç¼–è¾‘">Shell ä¸­ç¼–è¾‘</h2><table><thead><tr class="header"><th>å¿«æ·é”®</th><th>å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td>CTRL-B</td><td>Move the cursor left</td></tr><tr class="even"><td>CTRL-F</td><td>Move the cursor right</td></tr><tr class="odd"><td>CTRL-P</td><td>View the previous command (or move the cursor up)</td></tr><tr class="even"><td>CTRL-N</td><td>View the next command (or move the cursor down)</td></tr><tr class="odd"><td>CTRL-A</td><td>Move the cursor to the beginning of the line</td></tr><tr class="even"><td>CTRL-E</td><td>Move the cursor to the end of the line</td></tr><tr class="odd"><td>CTRL-W</td><td>Erase the preceding word</td></tr><tr class="even"><td>CTRL-U</td><td>Erase from cursor to beginning of line</td></tr><tr class="odd"><td>CTRL-K</td><td>Erase from cursor to end of line</td></tr><tr class="even"><td>CTRL-Y</td><td>Paste erased text (for example, from CTRL-U)</td></tr></tbody></table><h2 id="æŸ¥è¯¢å¸®åŠ©æ–‡æ¡£">æŸ¥è¯¢å¸®åŠ©æ–‡æ¡£</h2><p><code>man ls</code> æŸ¥è¯¢ ls çš„å¸®åŠ©ï¼›<code>man -k kerword</code> æŸ¥è¯¢æœ‰ keyword å…³é”®å­—çš„å¸®åŠ©ï¼Œç»“æœä½ ä¼šå‘ç°æœ‰äº›æ•°å­—ï¼Œè¿™äº›æ•°å­—æ˜¯å‘Šè¯‰ä½ è¿™ä¸ªå‘½ä»¤åœ¨å“ªä¸ªåˆ†ç±»ä¸‹å‡ºç°ï¼Œæ•°å­—å¯¹åº”çš„åˆ†ç±»ä¿¡æ¯å¦‚ä¸‹</p><table><thead><tr class="header"><th>Section</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>1</td><td>User commands</td></tr><tr class="even"><td>2</td><td>Kernel system calls</td></tr><tr class="odd"><td>3</td><td>Higher-level Unix programming library documentation</td></tr><tr class="even"><td>4</td><td>Device interface and driver information</td></tr><tr class="odd"><td>5</td><td>File descriptions (system configuration files)</td></tr><tr class="even"><td>6</td><td>Games</td></tr><tr class="odd"><td>7</td><td>File formats, conventions, and encodings (ASCII, suffixes, and so on)</td></tr><tr class="even"><td>8</td><td>System commands and servers</td></tr></tbody></table><h2 id="æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯">æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯</h2><ul><li><code>command &gt; file</code> # å‘½ä»¤çš„è¾“å‡ºå­˜åˆ° file</li><li><code>command &gt;&gt; file</code> # å‘½ä»¤çš„è¾“å‡ºè¿½åŠ åˆ° file</li><li><code>command1 | command2</code> # å‘½ä»¤1 çš„è¾“å‡ºä½œä¸ºå‘½ä»¤2 çš„è¾“å…¥</li><li><code>head &lt; /proc/cpuinfo#</code> æ–‡ä»¶å†…å®¹åˆ°è¾“å‡º</li></ul><p>å¦‚æœæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ä¼šæŠ¥é”™ï¼Œä½†å¸Œæœ›å°†æŠ¥é”™çš„å†…å®¹å•ç‹¬ä¿å­˜åˆ°å…¶ä»–æ–‡ä»¶ä¸­ï¼Œå¯ä½¿ç”¨ä¸‹å›¾çš„å‘½ä»¤ï¼ŒThe number <code>2</code> specifies the stream ID that the shell modifies. Stream ID 1 is standard output (the default), and 2 is standard error. <code>&gt;&amp;</code> notation will send both standard output and standard error to the file named f</p><p><img src="https://s2.loli.net/2022/03/01/utf8BAJgk43Fnbz.png" /></p><h2 id="ç®¡ç†è¿›ç¨‹">ç®¡ç†è¿›ç¨‹</h2><h3 id="åˆ—å‡ºè¿›ç¨‹">åˆ—å‡ºè¿›ç¨‹</h3><p>åœ¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª PID ä½œä¸ºæ ‡è¯†è¿›ç¨‹çš„å”¯ä¸€ IDï¼Œåœ¨ Linux å¯ä»¥ä½¿ç”¨ <code>ps</code> å‘½ä»¤ç›´æ¥æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„æƒ…å†µ:</p><p><img src="https://s2.loli.net/2022/03/02/X3bOYeqWzfl9Ex4.png" /></p><ul><li>PID, The process ID.</li><li>TTY, The terminal device where the process is running. More about this later.</li><li>STAT, what the process is doing and where its memory resides. For example, S means sleeping and R means running. (See the ps(1) manual page for a description of all the symbols.)</li><li>TIME, the total amount of time that the process has spent running instructions on the processor. Remember that because processes donâ€™t run constantly, this is different from the time since the process started (or â€œwall-clock timeâ€).</li><li>COMMAND, This one might seem obvious as the command used to run the program, but be aware that a process can change this field from its original value. Furthermore, the shell can perform glob expansion, and this field will reflect the expanded command instead of what you enter at the prompt.</li></ul><blockquote><p>Mac ä¸‹æ²¡æœ‰ STAT è¿™åˆ—</p></blockquote><p>Ps è¿˜æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥æŒ‡å®šï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä¹‰è¾“å‡ºï¼š</p><ul><li><code>ps x</code>â€ƒShow all of your running processes.</li><li><code>ps ax</code>â€ƒShow all processes on the system, not just the ones you own.</li><li><code>ps u</code>â€ƒInclude more detailed information on processes.</li><li><code>ps w</code>â€ƒShow full command names, not just what fits on one line.</li></ul><h3 id="æ€æ­»è¿›ç¨‹">æ€æ­»è¿›ç¨‹</h3><p>æ€æ­»ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ kill æŒ‡ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kill pid, è®©å†…æ ¸å‘è¿›ç¨‹å‘é€ä¸€ä¸ª TERM ä¿¡å·ï¼ˆé»˜è®¤ï¼‰ï¼Œåœæ­¢è¯¥è¿›ç¨‹</span><br><span class="line">kill -STOP pid, å‘é€ STOP ä¿¡å·ï¼Œ å†»ç»“è¯¥è¿›ç¨‹ï¼Œå†»ç»“çš„è¿›ç¨‹è¿˜ä¼šå­˜åœ¨äºå†…å­˜</span><br><span class="line">kill -CONT pid, æ¢å¤ä¸€ä¸ªå†»ç»“çš„è¿›ç¨‹</span><br></pre></td></tr></table></figure><p>å‘é€ä¸Šé¢çš„æŒ‡ä»¤å¯èƒ½ä½ è¿˜ä¼šçœ‹åˆ°è¿›ç¨‹å­˜åœ¨ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¼šç»™è¿›ç¨‹æœºä¼šå»å¤„ç†ç°åœºï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½ç›´æ¥å¿½ç•¥ä½ å‘é€çš„ä¿¡å·ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥å¼ºåˆ¶æ€æ­»ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸ç»™å…¶ä»»ä½•æœºä¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -KILL pid</span><br><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure><h3 id="ä½œä¸šç®¡ç†">ä½œä¸šç®¡ç†</h3><p>ä½œä¸šç®¡ç†ï¼Œallows you to suspend and switch between programs youâ€™re usingã€‚</p><p>For example, you can send a TSTP signal with CTRL-Z and then start the process again by entering fg (bring to foreground) or bg (move to background; see the next section).</p><p>å¯ä½¿ç”¨ <code>jobs</code> æŸ¥çœ‹æ˜¯å¦æœ‰ä»€ä¹ˆä½œä¸šæ­£åœ¨è¿è¡Œã€‚</p><p>ç”¨ <code>screen</code> æˆ–è€… <code>tmux</code> æ¥ç®¡ç†ä½œä¸šæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚</p><h3 id="è¿›ç¨‹æ”¾åˆ°åå°ä½¿ç”¨">è¿›ç¨‹æ”¾åˆ°åå°ä½¿ç”¨</h3><p>å¦‚æœä½ æœ‰ä¸€ä¸ªè§£å‹å¤§é‡æ–‡ä»¶çš„éœ€æ±‚ï¼Œå½“ä½ è¿è¡Œçš„æ—¶å€™ï¼Œåªæœ‰å½“å…¨éƒ¨ä»»åŠ¡ç»“æŸä½ æ‰ä¼šçœ‹åˆ°è¾“å‡ºï¼Œè¿™æ—¶å€™ä½ ä¹Ÿæ²¡åŠæ³•åšä»€ä¹ˆï¼Œä½†ä½ å¯ä»¥å°†è¿™ä¸ªä»»åŠ¡æ”¾åˆ°åå°å»åšï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip file.gz &amp;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šç»™ä½ ä¸€ä¸ª PID å‘Šè¯‰ä½ æ­£åœ¨å¤„ç†è¿™ä¸ªä»»åŠ¡çš„è¿›ç¨‹ã€‚</p><p>å¦‚æœè¿™ä¸ªåå°è¿è¡Œçš„è¿›ç¨‹éœ€è¦æ ‡å‡†è¾“å…¥ï¼Œé‚£ä¹ˆå®ƒä¼šè¿›å…¥å†»ç»“çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>fg</code> å°†å…¶å¸¦å…¥å‰å°ï¼Œå¦‚æœè¿™ä¸ªåå°è¿›ç¨‹æŠ¥é”™äº†ï¼Œé‚£ä½ ä¼šæ”¶åˆ°æŠ¥é”™çš„ä¿¡æ¯ï¼ˆå³ä¾¿ä½ å½“æ—¶æ­£åœ¨å¿™åˆ«çš„äº‹æƒ…ğŸ˜‚ï¼‰ï¼Œå¦‚æœä¸æƒ³è¢«æ‰“æ‰°ï¼Œæœ€å¥½å°†å…¶é”™è¯¯ä¿¡æ¯é‡å®šå‘åˆ°å…¶ä»–åœ°æ–¹ï¼ˆå‰é¢ä»‹ç»è¿‡ï¼‰.</p><h2 id="æ–‡ä»¶æ¨¡å¼å’Œæƒé™">æ–‡ä»¶æ¨¡å¼å’Œæƒé™</h2><p>æ‰€æœ‰ Unix æ–‡ä»¶éƒ½æœ‰ä¸€ç»„æƒé™æ¥å†³å®šä½ æ˜¯å¦å¯ä»¥è¯»æˆ–è€…å†™:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 juser somegroup 7041  Mar 26 19:34  endnotes.html</span><br></pre></td></tr></table></figure><p>æœ€å¼€å§‹çš„ <code>-rw-r--r--</code> è¡¨æ˜äº†è¯¥æ–‡ä»¶çš„æƒé™ï¼Œå…¶å«ä¹‰å¦‚ä¸‹:</p><p><img src="https://s2.loli.net/2022/03/02/GIVpzYK9hBNSUxC.png" /></p><p>ç¬¬ä¸€ä¸ª - å¾€åå¼€å§‹ï¼Œä¸‰ä¸ªä¸€ç»„ä¸ºæƒé™ç»„ï¼Œå…¶ä¸­å„ä¸ªå­—æ¯çš„æ„æ€å¦‚ä¸‹ï¼š</p><ul><li>r means that the file is readable.</li><li>w means that the file is writable.</li><li>x means that the file is executable (you can run it as a program).</li><li>- means â€œnothingâ€ (more specifically, the permission for that slot in the set has not been granted).</li><li>æœ‰äº›ä¼šæ˜¯sï¼Œç”¨æ¥è¡¨ç¤ºç”¨æˆ·æ‰§è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå°†ä»¥è¿™ä¸ªç¨‹åºæ‰€æœ‰è€…çš„èº«ä»½æ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥è®¾ç½®sæƒé™ï¼Œè€Œæ— éœ€å…ˆæœ‰xï¼Œä½†æ˜¯æœ‰å¯èƒ½æœªç”Ÿæ•ˆï¼ˆå°†ä»¥å¤§Sè¡¨ç¤ºï¼‰</li><li>Mac OS Xæ–‡ä»¶ç³»ç»Ÿè¿˜æœ‰ä¸€ä¸ªçš„é™„åŠ å±æ€§@.</li></ul><h2 id="æƒé™ä¿®æ”¹">æƒé™ä¿®æ”¹</h2><p>ä½¿ç”¨ <code>chmod</code> æ¥ä¿®æ”¹æƒé™ï¼Œå¦‚å¯¹ group å’Œ others å¢åŠ å†™æƒé™:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod g+r file</span><br><span class="line">chmod o+r file</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…é€šè¿‡ä¸€æ¡å‘½ä»¤</span></span><br><span class="line">chmod go+r file</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šçœ‹åˆ°é€šè¿‡æ•°å­—æ¥æŒ‡å®šæƒé™çš„å½¢å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sets all permission bits at once</span></span><br><span class="line">chmod 644 file</span><br></pre></td></tr></table></figure><p>æ— éœ€è®°ä½æ‰€æœ‰æ•°å­—çš„æ„æ€ï¼Œå¸¸ç”¨çš„æƒé™å¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š</p><table style="width:100%;"><colgroup><col style="width: 14%" /><col style="width: 57%" /><col style="width: 28%" /></colgroup><thead><tr class="header"><th>Mode</th><th>Meaning</th><th>Used for</th></tr></thead><tbody><tr class="odd"><td>644</td><td>user: read/write; group, other: read</td><td>files</td></tr><tr class="even"><td>600</td><td>user: read/write; group, other: none</td><td>files</td></tr><tr class="odd"><td>755</td><td>user: read/write/execute; group, other: read/execute</td><td>directories, programs</td></tr><tr class="even"><td>700</td><td>user: read/write/execute; group, other: none</td><td>directories, programs</td></tr><tr class="odd"><td>711</td><td>user: read/write/execute; group, other: execute</td><td>directories</td></tr></tbody></table><p>å…³äºç›®å½•çš„æƒé™ï¼š</p><ul><li>You can list the contents of a directory if itâ€™s readable, but you can only access a file in a directory if the directory is executable.</li><li>You need both in most cases;</li></ul><p><code>unmask</code> å‘½ä»¤:</p><ul><li>ou can specify a set of default permissions with the umask shell command, which applies a predefined set of permissions to any new file you create.</li><li>use umask 022 if you want everyone to be able to see all of the files and directories that you create, and use umask 077 if you donâ€™t.</li></ul><h2 id="ç¬¦å·é“¾æ¥">ç¬¦å·é“¾æ¥</h2><p>symbolic link is a file that points to another file or a directory, effectively creating an alias (like a shortcut in Windows). Symbolic links offer quick access to obscure directory paths.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx 1 ruser users  11 Feb 27 13:52  somedir -&gt; /home/origdir</span><br></pre></td></tr></table></figure><p>è‹¥ç¬¦å·é“¾æ¥ä»£è¡¨çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¾èµ–è¯¥æ–‡ä»¶çš„å‘½ä»¤ä¼šå‡ºé”™ï¼Œé™¤äº† <code>ls file</code>ã€‚</p><p>é€šè¿‡ç¬¦å·é“¾æ¥ï¼Œä½ æ— æ³•çŸ¥é“æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„ç‰¹å¾ï¼Œä½ å¿…é¡»è®¿é—®è¯¥è·¯å¾„å»çœ‹äº†æ‰çŸ¥é“ï¼Œè€Œä¸”ä¸€ä¸ªç¬¦å·é“¾æ¥å¯ä»¥æŒ‡å‘å¦å¤–ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè¿™ç§è¢«ç§°ä¸º chained symbolic links.</p><p>åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥å¯ä»¥é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -s æŒ‡å®šä¸ºè½¯é“¾æ¥ï¼Œè‹¥æ²¡æœ‰åˆ™æ˜¯ç¡¬é“¾æ¥</span><br><span class="line">ln -s target linkname</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸è¦å°† target å’Œ linkname æåäº†ï¼Œå¦åˆ™ä¼šå‘ç”Ÿçš„äº‹æƒ…å°±æ˜¯ï¼šcreates a link named target inside linkname, and the link will point to itself unless linkname is a full path.</p></blockquote><p>ç¬¦å·é“¾æ¥å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä½ ä»¥ä¸ºä½ ç¼–è¾‘çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯ä»¥ç¼–è¾‘ï¼‰ï¼Œä½†å…¶å®å®ƒæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</p><p>ç¬¦å·é“¾æ¥æœ¬è´¨ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¿å­˜çš„æ˜¯ç›®æ ‡æ–‡ä»¶çš„åœ°å€ï¼Œè€Œç¡¬é“¾æ¥åˆ™æ˜¯æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸­åº•å±‚çš„æ•°æ®ã€‚</p><ul><li>å½“å¯¹ä¸€ä¸ªæ–‡ä»¶åˆ›å»ºäº†ç¡¬é“¾æ¥ï¼Œå¦‚æœå¯¹ç¡¬é“¾æ¥ä¿®æ”¹ï¼Œé‚£ä¹ˆåŸå§‹æ–‡ä»¶ä¹Ÿä¼šè¢«ä¿®æ”¹</li><li>å½“åŸå§‹æ–‡ä»¶è¢«åˆ é™¤ï¼Œè®¿é—®ç¡¬é“¾æ¥è¿˜å¯ä»¥çœ‹åˆ°åŸå§‹æ–‡ä»¶å†…å®¹ï¼Œå› ä¸ºåº•å±‚çš„æ–‡ä»¶æ•°æ®å­˜åœ¨ç¡¬é“¾æ¥è¿™ä¸ªå¼•ç”¨ï¼Œå¹¶æœªè¢«çœŸçš„åˆ é™¤ï¼›è®¿é—®è½¯é“¾æ¥åˆ™ä¼šæç¤ºåŸå§‹æ–‡ä»¶å·²ç»ä¸è§ã€‚</li><li>åŸå§‹æ–‡ä»¶è¢«åˆ é™¤åï¼Œå½“å‘ç¡¬é“¾æ¥è¿½åŠ å†…å®¹ï¼Œç¡¬é“¾æ¥æ–‡ä»¶å†…å®¹ä¼šæœ‰åŸå§‹å†…å®¹å’Œæ–°å†…å®¹ï¼›è½¯è¿æ¥åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶å°†æ–°å†…å®¹å†™å…¥ã€‚</li></ul><h2 id="è§£å‹ç¼©">è§£å‹ç¼©</h2><ul><li><code>gzip</code>, The program gzip (GNU Zip) is one of the current standard Unix compression programs. ä½†æ— æ³•å‹ç¼©å¤šä¸ªæ–‡ä»¶.</li><li><code>tar</code>, å¯å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œç»†èŠ‚å¦‚ä¸‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å‹ç¼©</span><br><span class="line"># c, create mode</span><br><span class="line"># v, æ˜¾ç¤ºè¾“å…¥ï¼Œä¸¤ä¸ªvåˆ™æ˜¾ç¤ºæ›´å¤šç»†èŠ‚</span><br><span class="line"># f, æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">tar cvf archive.tar file1 file2 ...</span><br><span class="line"></span><br><span class="line"># è§£å‹</span><br><span class="line">tar xvf archive.tar</span><br><span class="line"># x, è§£å‹æ¨¡å¼</span><br></pre></td></tr></table></figure><p>åœ¨è§£å‹ä¸€ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œå…ˆæŸ¥çœ‹å‹ç¼©æ–‡ä»¶å†…æœ‰å“ªäº›ä¸œè¥¿æ˜¯æœ‰å¿…è¦çš„ï¼Œå¯ä»¥é€šè¿‡ <code>t</code> æ¨¡å¼æ¥å®ç°ã€‚</p><p>è§£å‹æ—¶çš„æƒé™æ§åˆ¶ï¼š consider using the p option to preserve permissions. Use this in extract mode to override your umask and get the exact permissions specified in the archive.</p><p>å‹ç¼©æ–‡ä»¶æœ‰æ—¶å€™ä¼šæœ‰å¤šé‡å‹ç¼©çš„æƒ…å†µï¼Œæ¯”å¦‚ä½ å¯èƒ½çœ‹åˆ°ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶: <code>file.tar.gz</code>ï¼Œè§£å‹è¿™ç§æ–‡ä»¶éœ€è¦ä»å³å¾€å·¦ä½¿ç”¨å¯¹åº”å·¥å…·è§£å‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gunzip file.tar.gz</span><br><span class="line">tar xvf file.tar</span><br></pre></td></tr></table></figure><p>ä½†åˆ†åˆ«è§£å‹æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œéœ€è¦ä¸¤æ¬¡ç£ç›˜è¯»å†™å’Œioæ—¶é—´ï¼Œå¯ä»¥åˆ©ç”¨ç®¡é“æ¥å¤„ç†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat file.tar.gz | tar xvf -</span><br></pre></td></tr></table></figure><p><code>zcat</code> ç›¸å½“äº <code>gunzip -dc</code>, å…¶ä¸­ d çš„æ„æ€æ˜¯è§£å‹ï¼Œc çš„æ„æ€æ˜¯å°†ç»“æœæ”¾åˆ°æ ‡å‡†è¾“å‡ºã€‚</p><p><code>zcat</code> ä½¿ç”¨éå¸¸é¢‘ç¹, æ‰€ä»¥ tar å°†å…¶æ”¾åœ¨å†…ç½®å‚æ•°ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar ztvf file.tar.gz</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„è§£å‹å·¥å…·è¿˜æœ‰ <code>xz</code> å’Œ <code>bzip2</code>.</p><h2 id="linux-ç›®å½•ç»“æ„">Linux ç›®å½•ç»“æ„</h2><p>ç›®å½•ç»“æ„ä¸€èˆ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2022/03/02/vRuS1hNDzWUI2Hl.png" /></p><hr /><p><strong>ä¸€èˆ¬çš„ç›®å½•æ–‡ä»¶å¤¹ä»‹ç»ï¼š</strong></p><ul><li>/binâ€ƒContains ready-to-run programs (also known as executables), including most of the basic Unix commands such as ls and cp. Most of the programs in /bin are in binary format, having been created by a C compiler, but some are shell scripts in modern systems.</li><li>/devâ€ƒContains device files. Youâ€™ll learn more about these in Chapter 3.</li><li>/etcâ€ƒThis core system configuration directory (pronounced EHT-see) contains the user password, boot, device, networking, and other setup files.</li><li>/homeâ€ƒHolds home (personal) directories for regular users. Most Unix installations conform to this standard.</li><li>/libâ€ƒAn abbreviation for library, this directory holds library files containing code that executables can use. There are two types of libraries: static and shared. The /lib directory should contain only shared libraries, but other lib directories, such as /usr/lib, contain both varieties as well as other auxiliary files. (Weâ€™ll discuss shared libraries in more detail in Chapter 15.)</li><li>/procâ€ƒProvides system statistics through a browsable directory-and-file interface. Much of the /proc subdirectory structure on Linux is unique, but many other Unix variants have similar features. The /proc directory contains information about currently running processes as well as some kernel parameters.</li><li>/runâ€ƒContains runtime data specific to the system, including certain process IDs, socket files, status records, and, in many cases, system logging. This is a relatively recent addition to the root directory; in older systems, you can find it in /var/run. On newer systems, /var/run is a symbolic link to /run.</li><li>/sysâ€ƒThis directory is similar to /proc in that it provides a device and system interface. Youâ€™ll read more about /sys in Chapter 3.</li><li>/sbinâ€ƒThe place for system executables. Programs in /sbin directories relate to system management, so regular users usually do not have /sbin components in their command paths. Many of the utilities found here donâ€™t work if not run as root.</li><li>/tmpâ€ƒA storage area for smaller, temporary files that you donâ€™t care much about. Any user may read to and write from /tmp, but the user may not have permission to access another userâ€™s files there. Many programs use this directory as a workspace. If something is extremely important, donâ€™t put it in /tmp because most distributions clear /tmp when the machine boots and some even remove its old files periodically. Also, donâ€™t let /tmp fill up with garbage because its space is usually shared with something critical (the rest of /, for example).</li><li>/usrâ€ƒAlthough pronounced â€œuser,â€ this subdirectory has no user files. Instead, it contains a large directory hierarchy, including the bulk of the Linux system. Many of the directory names in /usr are the same as those in the root directory (like /usr/bin and /usr/lib), and they hold the same type of files. (The reason that the root directory does not contain the complete system is primarily historicâ€”in the past, it was to keep space requirements low for the root.)</li><li>/varâ€ƒThe variable subdirectory, where programs record information that can change over the course of time. System logging, user tracking, caches, and other files that system programs create and manage are here. (Youâ€™ll notice a /var/tmp directory here, but the system doesnâ€™t wipe it on boot.)</li></ul><p><strong>å…¶ä»– root ç›®å½•ä¸‹çš„å­æ–‡ä»¶å¤¹ï¼š</strong></p><ul><li>/bootâ€ƒContains kernel boot loader files. These files pertain only to the very first stage of the Linux startup procedure, so you wonâ€™t find information about how Linux starts up its services in this directory. See Chapter 5 for more about this.</li><li>/mediaâ€ƒA base attachment point for removable media such as flash drives that is found in many distributions.</li><li>/optâ€ƒThis may contain additional third-party software. Many systems donâ€™t use /opt.</li></ul><p><strong>å…¶ä»–ç”¨æˆ·ç›®å½•ä¸‹å­˜åœ¨çš„å­æ–‡ä»¶å¤¹ï¼š</strong></p><ul><li>/includeâ€ƒHolds header files used by the C compiler.</li><li>/localâ€ƒIs where administrators can install their own software. Its structure should look like that of / and /usr.</li><li>/manâ€ƒContains manual pages.</li><li>/shareâ€ƒContains files that should work on other kinds of Unix machines with no loss of functionality. These are usually auxiliary data files that programs and libraries read as necessary. In the past, networks of machines would share this directory from a file server, but today a share directory used in this manner is rare because there are no realistic space restraints for these kinds of files on contemporary systems. Instead, on Linux distributions, youâ€™ll find /man, /info, and many other subdirectories here because it is an easily understood convention.</li></ul><p><strong>å†…æ ¸è·¯å¾„</strong></p><p>åœ¨ Linux ä¸­ï¼Œå†…æ ¸ä¸€èˆ¬æ”¾åœ¨ /vmlinuz or /boot/vmlinuzï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œboot loader ä¼šå¯åŠ¨å†…æ ¸ã€‚å…³äº boot loader ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­ä»‹ç»ã€‚</p><h2 id="ä»¥è¶…çº§ç”¨æˆ·æ‰§è¡Œå‘½ä»¤">ä»¥è¶…çº§ç”¨æˆ·æ‰§è¡Œå‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vipw</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ <code>/etc/sudoers</code> æ–‡ä»¶é…ç½®è°å¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤æ‰§è¡Œï¼Œæ˜¯å¦éœ€è¦å¯†ç ç­‰ã€‚</p><p>ä¸‹é¢çš„é…ç½®è¡¨æ˜ï¼Œuser1 å’Œ user2 å¯ä»¥ç›´æ¥ä½¿ç”¨ sudo å‘½ä»¤ï¼Œè€Œä¸éœ€è¦è¾“å…¥å¯†ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># defines an ADMINS user alias with the two users</span><br><span class="line">User_Alias ADMINS = user1, user2</span><br><span class="line"></span><br><span class="line"># users in the ADMINS alias can use sudo to execute commands as root</span><br><span class="line"># The second ALL means â€œany command.â€ The first ALL means â€œany host.â€ </span><br><span class="line">ADMINS ALL = NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"># superuser may also use sudo to run any command on any host.</span><br><span class="line"># extra (ALL) means that the superuser may also run commands as any other user.</span><br><span class="line">root ALL=(ALL) ALL</span><br><span class="line"></span><br><span class="line"># ä¸Šé¢çš„è¿™å¥ï¼Œå¯ä»¥æ‰©å±•ä¸º</span><br><span class="line">ADMINS ALL = (ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ <code>visudo</code> å‘½ä»¤æ¥ç¼–è¾‘ä¸Šé¢è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šæ£€æŸ¥ä½ çš„è¯­æ³•ã€‚</p></blockquote><p>è¦æŸ¥çœ‹ sudo å‘½ä»¤çš„å†å²è®°å½•ï¼Œå¯ä½¿ç”¨:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl SYSLOG_IDENTIFIER=sudo</span><br></pre></td></tr></table></figure><p>æ¥å¯ç”¨ï¼Œå¯¹äºè€ä¸€ç‚¹çš„ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦åœ¨ <code>/var/log</code> æŸ¥çœ‹, æ¯”å¦‚ <code>/var/log/auth.log.</code></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ¶µç›–äº†Linuxä¸­å…³äºåŸºæœ¬å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€ç‰¹æ®Šç¬¦å·ã€Shell ç¼–è¾‘å·¥å…·ã€å¸®åŠ©æ–‡æ¡£æŸ¥è¯¢ã€æ ‡å‡†è¾“å…¥è¾“å‡ºã€ç¬¦å·é“¾æ¥ã€è§£å‹ç¼©ã€è¶…çº§ç”¨æˆ·ä»¥åŠç›®å½•çš„ç»“æ„ä»‹ç»ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="How Linux Works" scheme="https://scottzhang.pro/categories/How-Linux-Works/"/>
    
    
    <category term="Linux" scheme="https://scottzhang.pro/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux æ˜¯å¦‚ä½•å·¥ä½œçš„- Big Picture</title>
    <link href="https://scottzhang.pro/article/74b16f02.html"/>
    <id>https://scottzhang.pro/article/74b16f02.html</id>
    <published>2022-03-01T09:48:07.000Z</published>
    <updated>2022-03-01T09:51:34.008Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ã€ŠHow Linux Worksã€‹ é˜…è¯»ç¬”è®°ã€‚</p></blockquote><span id="more"></span><h1 id="big-picture">Big Picture</h1><p>ç†è§£æ“ä½œç³»ç»Ÿå¦‚ä½•å·¥ä½œçš„å…³é”®æ˜¯å­¦ä¼šæŠ½è±¡ï¼Œæˆ‘ä»¬ä¼šå°† Linux ç³»ç»ŸæŠ½è±¡æˆä¸åŒçš„å±‚ï¼š</p><p><img src="https://s2.loli.net/2022/03/01/4fLjqxBO3KyPS65.png" /></p><p>å†…æ ¸å’Œç”¨æˆ·è¿›ç¨‹æœ‰ä¸åŒçš„è¿è¡Œæ€ï¼š</p><ul><li>the kernel runs in kernel mode, and the user processes run in user mode.</li><li>Code running in kernel mode has unrestricted access to the processor and main memory.</li><li>User mode restricts access to a (usually quite small) subset of memory and safe CPU operations.</li></ul><h2 id="ç†è§£å†…å­˜">ç†è§£å†…å­˜</h2><ul><li>main memory is just a big storage area for a bunch of 0s and 1s.</li><li>where the running kernel and processes reside</li></ul><h2 id="å†…æ ¸">å†…æ ¸</h2><ul><li>ç®¡ç†è¿›ç¨‹ï¼Œå†³å®šå“ªä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ CPU</li><li>Memory, è¿½è¸ªã€åˆ†é…æ‰€æœ‰å†…å­˜ï¼Œå¦‚ä½•å¤šè¿›ç¨‹é—´å…±äº«å†…å­˜</li><li>è®¾å¤‡ï¼Œæä¾›ç¡¬ä»¶ä¸è½¯ä»¶çš„æ¥å£</li><li>ç³»ç»Ÿè°ƒç”¨å’Œå…¶ä»–åŠŸèƒ½</li></ul><h3 id="ç®¡ç†è¿›ç¨‹">ç®¡ç†è¿›ç¨‹</h3><p>é¦–å…ˆï¼Œè¿›ç¨‹æ˜¯çš„è¿è¡Œæ˜¯ â€œsimultaneouslyâ€ çš„ï¼ŒåŒä¸€æ—¶åˆ»åœ¨ä¸€ä¸ªCPUæ ¸å¿ƒä¸Šï¼Œåªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ CPUï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨ CPU ä¸Šè¿è¡Œä¸€å°æ®µæ—¶é—´ï¼Œå†…æ ¸éœ€è¦ç®¡ç†ä¸åŒè¿›ç¨‹åœ¨ CPU ä¸Šçš„åˆ‡æ¢ã€‚</p><blockquote><p>åˆ‡æ¢æ„å‘³ç€ç¨‹åºæ‰€åœ¨çš„ç¯å¢ƒï¼ˆå˜é‡å€¼ã€å†…å­˜åœ°å€ç­‰ï¼‰éœ€è¦è®°å½•ä¸‹æ¥ï¼Œå½“å†æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦é‡æ–°æ¢å¤ï¼Œè¿™æ˜¯é€šè¿‡ CPU çš„å¯„å­˜å™¨å®ç°çš„ã€‚åŒæ—¶æ¯ä¸€ä¸ªè¿›ç¨‹è‡ªå·±ä¹Ÿæœ‰è®¸å¤šç§çŠ¶æ€ï¼Œå¦‚å°±ç»ªæ€ã€è¿è¡Œæ€ã€é˜»å¡æ€ç­‰ï¼Œè¿™äº›çŠ¶æ€çš„åˆ‡æ¢ä¹Ÿéœ€è¦å†…æ ¸æ¥å®ç°ï¼Œä¸€ä¸ªè¿›ç¨‹å±äºå“ªä¸ªçŠ¶æ€ï¼Œå°±éœ€è¦å°†å…¶æ”¾åˆ°è¯¥çŠ¶æ€çš„é˜Ÿåˆ—ä¸­å»ã€‚ä¸è¿‡çŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œæœ‰æ—¶å€™å¯èƒ½æ˜¯è¿›ç¨‹è‡ªå·±æ¥è¯·æ±‚çš„ï¼Œæ–¹æ³•æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ã€‚</p></blockquote><h3 id="ç®¡ç†å†…å­˜">ç®¡ç†å†…å­˜</h3><ul><li>å†…æ ¸åœ¨å†…å­˜ä¸­ï¼Œå¿…é¡»æœ‰ä¸€æ®µå¸¸é©»çš„åŒºåŸŸï¼Œå®ƒæ˜¯æ— æ³•è¢«ç”¨æˆ·è¿›ç¨‹è®¿é—®çš„</li><li>æ¯ä¸ªç”¨æˆ·è¿›ç¨‹éœ€è¦æœ‰è‡ªå·±çš„å†…å­˜åŒºåŸŸä¸å…¶ä»–è¿›ç¨‹éš”ç¦»</li><li>ç”¨æˆ·è¿›ç¨‹ä¹‹é—´éœ€è¦å…±äº«å†…å­˜</li><li>ç”¨æˆ·è¿›ç¨‹çš„å†…å­˜éœ€è¦æ˜¯åªè¯»çš„</li><li>ç³»ç»Ÿå¯ä»¥é€šè¿‡å°†å†…å­˜åŒºåŸŸçš„æ•°æ®æ”¾åˆ°ç£ç›˜ï¼Œæ”¯æŒå¤§äºç‰©ç†å†…å­˜çš„æ•°æ®æ”¾å…¥å†…å­˜ä¸­</li></ul><h3 id="ç®¡ç†è®¾å¤‡ä¸é©±åŠ¨">ç®¡ç†è®¾å¤‡ä¸é©±åŠ¨</h3><p>åªæœ‰å†…æ ¸å¯ä»¥æ§åˆ¶è®¾å¤‡çš„è®¿é—®ï¼Œè¿™æ˜¯ä¸ºäº†ç®€åŒ–å’ŒæŠ½è±¡åº•å±‚çš„ç¡¬ä»¶ï¼Œé˜²æ­¢ç”¨æˆ·è¿›ç¨‹ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼ˆæ¯”å¦‚ç›´æ¥å…³é—­ç”µæºï¼‰ã€‚</p><h3 id="ç³»ç»Ÿè°ƒç”¨">ç³»ç»Ÿè°ƒç”¨</h3><ul><li>system calls (or syscalls) perform specific tasks that a user process alone cannot do well or at all.</li><li>Two system calls, fork() and exec(), are important to understanding how processes startï¼š<ul><li>When a process calls <code>fork()</code>, the kernel creates a nearly identical copy of the process.</li><li>When a process calls <code>exec(program)</code>, the kernel loads and starts program, replacing the current process.</li></ul></li><li>ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒçœ‹ä¸‹å›¾:</li></ul><p><img src="https://s2.loli.net/2022/03/01/2tKeHglsfwEPRTu.png" /></p><h2 id="ç”¨æˆ·ç©ºé—´">ç”¨æˆ·ç©ºé—´</h2><ul><li>å†…æ ¸åˆ†é…ç»™ç”¨æˆ·è¿›ç¨‹çš„ï¼Œåœ¨å†…å­˜ä¸­çš„ç©ºé—´ç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚</li><li>Most of the real action on a Linux system happens in user space.</li></ul><figure><img src="https://s2.loli.net/2022/03/01/g1OikwaPRIKl4F5.png" alt="Example set of components fit together and interact on a Linux system" /><figcaption aria-hidden="true">Example set of components fit together and interact on a Linux system</figcaption></figure><h2 id="ç”¨æˆ·">ç”¨æˆ·</h2><ul><li>ç”¨æˆ·çš„å®šä¹‰ï¼šA user is an entity that can run processes and own files.</li><li>å†…æ ¸é€šè¿‡ç”¨æˆ· ID è€Œä¸æ˜¯ç”¨æˆ·åæ¥ç®¡ç†ç”¨æˆ·ã€‚kernel does not manage the usernames; instead, it identifies users by simple numeric identifiers called user IDs.</li><li>Linux é€šè¿‡ç”¨æˆ·ä¸»è¦æ˜¯æ¥ç®¡ç† permissions and boundariesï¼Œæ¯ä¸ªç”¨æˆ·ç©ºé—´éƒ½å±äºæŸä¸ªç”¨æˆ·ï¼Œè¿›ç¨‹ä¹Ÿä¸€æ ·ï¼Œç”¨æˆ·åªèƒ½å¯¹è‡ªå·±çš„è¿›ç¨‹ã€ç©ºé—´ã€æ–‡ä»¶æœ‰æƒé™ã€‚</li><li>ç°å® Linux ç³»ç»Ÿä¸­ä¼šæœ‰ä¸€ç³»åˆ—çš„ç”¨æˆ·ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª root ç”¨æˆ·è¢«ç§°ä¸ºè¶…çº§ç”¨æˆ·ï¼Œä»–å¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ä¸ç©ºé—´</li><li>è¿˜æœ‰ä¸€ä¸ªç¾¤ç»„çš„æ¦‚å¿µï¼Œå³ä¸€ç»„ç”¨æˆ·</li></ul><blockquote><p>ä¸‹ä¸€ç« è¯·å‚è€ƒï¼šåŸºæœ¬å‘½ä»¤ä¸ç›®å½•ç»“æ„ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ã€ŠHow Linux Worksã€‹ é˜…è¯»ç¬”è®°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="How Linux Works" scheme="https://scottzhang.pro/categories/How-Linux-Works/"/>
    
    
    <category term="Linux" scheme="https://scottzhang.pro/tags/Linux/"/>
    
    <category term="Operating System" scheme="https://scottzhang.pro/tags/Operating-System/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•å¼€æº BI å·¥å…· Metabase çš„éƒ¨ç½²</title>
    <link href="https://scottzhang.pro/article/75e7492b.html"/>
    <id>https://scottzhang.pro/article/75e7492b.html</id>
    <published>2022-02-15T12:58:36.000Z</published>
    <updated>2022-02-22T03:46:16.970Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç”¨æœ€ç®€å•ã€å¿«é€Ÿçš„æ–¹å¼è®©ä½ ä»¬å…¬å¸çš„æ¯ä¸€ä½æ‹¥æœ‰å•†ä¸šæ™ºèƒ½ä¸åˆ†æã€‚</p></blockquote><span id="more"></span><h1 id="metabase-ä»‹ç»">Metabase ä»‹ç»</h1><p>Metabase æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¼€æºç‰ˆå’Œä¼ä¸šç‰ˆï¼Œæœ‰ä¸¤ç§æ–¹å¼å°†å®ƒä»¬éƒ¨ç½²åˆ°ç”Ÿæˆç¯å¢ƒï¼š</p><ol type="1"><li>Metabase äº‘ï¼Œæœ‰é’±ä¸æƒ³è‡ªå·±æŠ˜è…¾çš„é€‰æ‹©ï¼Œä½†æ•°æ®è®¿é—®æ¯”è¾ƒå—é™åˆ¶</li><li>è‡ªå·±æ‰˜ç®¡ï¼Œåœ¨è‡ªå·±çš„æœºå™¨ä¸Šæˆ–è€…æ˜¯äº‘æœåŠ¡å•†çš„ä¸»æœºä¸Š</li></ol><p>å¯¹äº Metabase äº‘ï¼Œä»–ä»¬ä¼šå¸®ä½ æå®šè®¾ç½®ï¼Œå¤‡ä»½ï¼Œå‡çº§ï¼Œä½ åªéœ€è¦ä¸“æ³¨åœ¨ä½¿ç”¨ä¸Šï¼Œè€Œä¸éœ€è¦ç®¡å¦‚ä½•éƒ¨ç½²ç­‰ç­‰ã€‚</p><p>å¯¹äºè‡ªå·±æ‰˜ç®¡çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸¤ä¸ªä¸œè¥¿ï¼š</p><ol type="1"><li>ä¸€å°æœåŠ¡å™¨è¿è¡Œ Metabase åº”ç”¨</li><li>ä¸€ä¸ªåº”ç”¨çš„æœåŠ¡å™¨ï¼Œç”¨æ¥å­˜å‚¨ Metabase è¿è¡ŒæœŸé—´äº§ç”Ÿçš„æ•°æ®</li></ol><p>å¯¹äºéƒ¨ç½²æ–¹å¼ï¼Œç”¨æˆ·æ˜¯æ„Ÿè§‰ä¸åˆ°ä»»ä½•å·®åˆ«çš„ï¼Œå®é™…ä¸Š Metabase æ–‡æ¡£ä¹Ÿå†™äº†ï¼Œåœ¨åº•å±‚å³ä¾¿æ˜¯ä½¿ç”¨ Dockerï¼ŒMetabase ä¹Ÿæ˜¯ä½¿ç”¨ Metabase JAR çš„æ–¹å¼è¿è¡Œã€‚</p><p>å¦å¤–å¯¹äºè¿™ä¸€ç‚¹çš„é€‰æ‹©ï¼Œä¹Ÿä¸ team å†…éƒ¨æˆå‘˜çš„æŠ€æœ¯å‚¨å¤‡æœ‰å…³ï¼Œå¦‚æœä½ çš„ team æˆå‘˜æ¯”è¾ƒæ‡‚ Dockerï¼Œæ¯”å¦‚ æœåŠ¡å™¨ã€ç½‘ç»œç­‰æŠ€æœ¯ï¼Œåˆ™é€‰æ‹© Dockerï¼Œå¦åˆ™é€‰æ‹© JARï¼›å¦‚æœä½ çš„ taem æˆå‘˜å¯¹ä¸¤è€…éƒ½æ˜¯å·®ä¸å¤šçš„æ‡‚ï¼Œåˆ™é€‰æ‹© JARï¼Œå› ä¸ºå®ƒéœ€è¦å­¦ä¹ çš„å†…å®¹ç›¸å¯¹è¾ƒå°‘ã€‚</p><p>å¯¹äºæ•°æ®åº“ï¼Œå»ºè®®ä½¿ç”¨ PostgreSQLï¼ŒMySQLï¼Œæˆ–è€… MariaDbã€‚</p><p>å¦‚æœä½ ä½¿ç”¨äº‘ä¸»æœºï¼Œåˆ™å®ƒä»¬ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†å¤‡ä»½ï¼Œå¦åˆ™ä½ å°±éœ€è¦è‡ªå·±å¤‡ä»½ã€‚</p><h1 id="ä½¿ç”¨-docker-éƒ¨ç½²">ä½¿ç”¨ docker éƒ¨ç½²</h1><p>ä½¿ç”¨ docker éƒ¨ç½² metabase éå¸¸ç®€å•ï¼Œæ‰“å¼€ Metabase å®˜æ–¹çš„ docker image <a href="https://hub.docker.com/r/metabase/metabase">é¡µé¢</a>ã€‚</p><p>å¤åˆ¶ä¸‹é¢çš„è¯­å¥ï¼Œå°† docker image æ‹‰å–ä¸‹æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull metabase/metabase</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œç›´æ¥å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ windows æœºå™¨ä¸Šï¼Œ3000 ç«¯å£æ— æ³•æ‰“å¼€ï¼Œæ‰€ä»¥å°†å…¶è®¾ç½®ä¸º 8889</span></span><br><span class="line"><span class="comment"># docker -p ä¸­ï¼Œé¡ºåºæ˜¯ å®¿ä¸»æœºç«¯å£:dockerå†…ç«¯å£</span></span><br><span class="line">docker run -d -p 8889:3000 --name metabase metabase/metabase</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®æœ¬æœºçš„ 8889 ç«¯å£å°±å¯ä»¥çœ‹åˆ°æ¬¢è¿ç•Œé¢äº†ã€‚</p><figure><img src="https://s2.loli.net/2022/02/15/BGpNfu5T7RVQXiE.png" alt="image.png" /><figcaption aria-hidden="true">image.png</figcaption></figure><p>ä½†æ˜¯åœ¨æ·»åŠ æ•°æ®åº“çš„ç•Œé¢ä¸­ï¼Œæ˜¯æ²¡æœ‰ Oracle çš„ï¼Œå¯¹æˆ‘æ¥è¯´è¿™æ˜¯åˆšéœ€ï¼Œæ²¡åŠæ³•å¾—é…ç½®ä¸€ä¸‹ã€‚</p><p>éœ€è¦æˆ‘ä»¬å» Oracle ä¸‹è½½ JDBC Driver JAR æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°å®¹å™¨å†…çš„ plugins æ–‡ä»¶å¤¹ã€‚</p><ol type="1"><li>è®¿é—® Oracle JDBC <a href="https://www.oracle.com/database/technologies/appdev/jdbc-ucp-19-13-c-downloads.html">ä¸‹è½½é¡µé¢</a>ï¼Œè¿™é‡Œæ˜¯æ–‡æ¡£å†…æ¨èçš„ç‰ˆæœ¬</li><li>å¾€ä¸‹é¢æ‰¾åˆ° ojdbc8.jar</li><li>ä½¿ç”¨ docker cp å‘½ä»¤ä»å®¿ä¸»æœºæ‹·è´è¯¥åŒ…åˆ°å®¹å™¨å†…</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp C:\Users\Scott\Downloads\ojdbc8.jar 614bccac20ce:/plugins/</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€ metabase ï¼Œæ·»åŠ æ•°æ®åº“è¿æ¥ï¼Œå³å¯çœ‹åˆ° Oracle ä¹Ÿå‡ºç°åœ¨åˆ—è¡¨ä¸­äº†ã€‚</p><p><img src="https://s2.loli.net/2022/02/15/5dOZYaUimMJfKVe.png" /></p><p>è‡³æ­¤ï¼Œä½¿ç”¨ Docker å¯¹äº Meta çš„éƒ¨ç½²å°±ç»“æŸäº†ã€‚</p><p>è¿˜æœ‰ä¸€äº›é«˜çº§çš„å†…å®¹ï¼Œæ¯”å¦‚å¦‚ä½•å°†åº”ç”¨çš„æ•°æ®å­˜å‚¨åœ¨ docker å¤–éƒ¨ï¼Œæˆ–è€…æ˜¯å­˜å‚¨åœ¨ postgres æ•°æ®åº“ä¸­ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘çš„<a href="https://www.metabase.com/docs/latest/operations-guide/running-metabase-on-docker.html">æ–‡æ¡£</a>ã€‚</p><h1 id="é…ç½®é‚®ç®±">é…ç½®é‚®ç®±</h1><p>ä¸€å¼€å§‹ä½¿ç”¨ Metabase è®¾ç½®é‚®ç®±ï¼Œå‚è€ƒ Metabase çš„<a href="https://www.metabase.com/docs/latest/administration-guide/02-setting-up-email.html">å®˜ç½‘æ–‡æ¡£</a>(2022-2-21)å¹¶æ²¡æœ‰ outlook çš„è®¾ç½®æ•™ç¨‹, ä½†è®¾ç½®çš„è¿‡ç¨‹å’Œå‚æ•°åº”è¯¥æ˜¯å·®ä¸å¤šçš„ã€‚</p><p>äºæ˜¯æœç´¢ smtp outlook çš„è®¾ç½®æ–‡æ¡£ï¼Œæ‰¾åˆ°äº†å¾®è½¯çš„å¸®åŠ©æ–‡æ¡£: <em><a href="https://support.microsoft.com/en-us/office/pop-imap-and-smtp-settings-8361e398-8af4-4e97-b147-6c6c4ac95353">POP, IMAP, and SMTP settings</a></em></p><p>æŒ‰ç…§å¾®è½¯çš„æ•™ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SMTP: smtp.office365.com</span><br><span class="line">SMTP: 587</span><br></pre></td></tr></table></figure><p>å–å†³äºä½ å…¬å¸çš„é…ç½®ï¼Œä½ å¯èƒ½ç›´æ¥é…ç½®æˆåŠŸï¼Œæˆ–è€…ä¹Ÿæœ‰å¯èƒ½åƒæˆ‘ä¸€æ ·é‡åˆ°æ— æ³•è¿æ¥åˆ° smtp æœåŠ¡å™¨çš„æƒ…å†µã€‚</p><p>è¿™æ—¶å€™éœ€è¦ä½ æ£€æŸ¥ä½ å…¬å¸çš„smtpé‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œç„¶åå°†ç«¯å£æ¢æˆ25å†è¯•è¯•ã€‚</p><blockquote><p>å¯ä½¿ç”¨ telnet å‘½ä»¤æ¥æµ‹è¯•ä¸é‚®ä»¶æœåŠ¡å™¨çš„è¿æ¥ï¼Œå¦‚: <code>telnet smtp.office365.com 25</code> æ˜¯æµ‹è¯•åˆ°è¯¥ç½‘å€çš„25ç«¯å£è¿æ¥æƒ…å†µã€‚</p></blockquote><p>å¦‚æœä½ å…¬å¸çš„åœ°å€æ˜¯ google.comï¼Œé‚£ä¹ˆä½ å…¬å¸çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€æœ‰å¯èƒ½æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">google.mail.protection.outlook.com</span><br><span class="line"># æˆ–è€…</span><br><span class="line">google-com.mail.protection.outlook.com</span><br></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2022/02/22/w9MZhjNbYV3f8XU.png" alt="metabase é‚®ç®±é…ç½®" /><figcaption aria-hidden="true">metabase é‚®ç®±é…ç½®</figcaption></figure><h1 id="å‚è€ƒ">å‚è€ƒ</h1><ul><li><a href="https://juejin.cn/post/6844903760867622920">æ•°æ®å¯è§†åŒ–åˆ†æå¹³å°å¼€æºæ–¹æ¡ˆé›†é”¦</a></li><li><a href="https://juejin.cn/post/6844904200728641550">å¼€æº BIï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©äº† Metabase</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ç”¨æœ€ç®€å•ã€å¿«é€Ÿçš„æ–¹å¼è®©ä½ ä»¬å…¬å¸çš„æ¯ä¸€ä½æ‹¥æœ‰å•†ä¸šæ™ºèƒ½ä¸åˆ†æã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é¡¹ç›®è®°å½•" scheme="https://scottzhang.pro/categories/%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="Metabase" scheme="https://scottzhang.pro/tags/Metabase/"/>
    
    <category term="Docker" scheme="https://scottzhang.pro/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•å¼€æº BI å·¥å…· Superset çš„éƒ¨ç½²</title>
    <link href="https://scottzhang.pro/article/35c1cbc9.html"/>
    <id>https://scottzhang.pro/article/35c1cbc9.html</id>
    <published>2022-02-15T09:51:50.000Z</published>
    <updated>2022-02-15T09:58:11.100Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Apache Superset æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ¢æŸ¥ä¸å¯è§†åŒ–å¹³å°ï¼Œè¯¥å·¥å…·åœ¨å¯è§†åŒ–ã€æ˜“ç”¨æ€§å’Œäº¤äº’æ€§ä¸Šéå¸¸æœ‰ç‰¹è‰²ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–åˆ†æã€‚</p></blockquote><span id="more"></span><h1 id="ä½¿ç”¨-docker-å®‰è£…-superset">ä½¿ç”¨ Docker å®‰è£… Superset</h1><ol type="1"><li>ç¬¬ä¸€æ­¥éœ€è¦å®‰è£… Docker Engine å’Œ Docker Composeï¼Œåœ¨ Mac ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ Docker Desktopï¼Œå…¶ä¸­åŒ…æ‹¬äº† Docker Engine å’Œ Docker Composeã€‚å®‰è£…å¥½ Docker åï¼Œéœ€è¦è¿›å…¥ Docker è®¾ç½®å°†é»˜è®¤çš„å†…å­˜è®¾ç½®ä¸º 6 GB</li><li>å…‹éš† Superset çš„ä»“åº“åˆ°æœ¬åœ°:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/apache/superset.git</span><br></pre></td></tr></table></figure><ol start="3" type="1"><li>å°†ä»“åº“æ‹·è´åˆ°æœ¬åœ°åï¼Œæ‰§è¡Œä¸‹é¢ä¸¤æ¡è¯­å¥ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-non-dev.yml pull</span><br><span class="line">docker-compose -f docker-compose-non-dev.yml up</span><br></pre></td></tr></table></figure><p>å…³äº <code>docker compose</code> çš„ CLI å‘½ä»¤å‚æ•°ä¸ç›¸å…³çš„è§£é‡Šï¼Œå‚è€ƒ <a href="https://docs.docker.com/compose/reference/#command-options-overview-and-help">Overview of docker-compose CLI</a>.</p><p>å¦‚æœéœ€è¦æŒ‡å®šç‰ˆæœ¬çš„ supersetï¼Œéœ€è¦åœ¨è¿™ä¸€æ­¥æŒ‡å®šï¼Œæ–¹æ³•æ˜¯åœ¨å‰é¢åŠ ä¸Š tag å‚æ•°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout 1.4.0</span><br><span class="line">TAG=1.4.0 docker-compose -f docker-compose-non-dev.yml pull</span><br><span class="line">TAG=1.4.0 docker-compose -f docker-compose-non-dev.yml up</span><br></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨æ—¥å¿—ä¸­ï¼Œå¯èƒ½ä¼šçœ‹åˆ°æ£€æµ‹åˆ°é»˜è®¤çš„ secret stringï¼Œæç¤ºæˆ‘ä»¬ä½¿ç”¨è‡ªå·±ç”Ÿæˆçš„å­—ç¬¦ï¼Œè¿˜è´´å¿ƒçš„ç»™äº†æˆ‘ä»¬ç”Ÿæˆç¤ºä¾‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -base64 42</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œsuperset_worker æç¤ºæˆ‘ä»¬åœ¨ä½¿ç”¨è¶…çº§ç”¨æˆ·å¯åŠ¨ worker, å¹¶æç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">You&#x27;re running the worker with superuser privileges: </span><br><span class="line">this is absolutely not recommended!&quot;</span><br><span class="line"></span><br><span class="line">Please specify a different user using the --uid option.</span><br><span class="line">User information: uid=0 euid=0 gid=0 egid=0</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹‹åå†æ¥çœ‹è¿™ä¸ªé—®é¢˜ã€‚</p><p>åŒæ—¶åœ¨ superset_init ä¸­ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°å®ƒçš„åˆå§‹åŒ–é…ç½®æ–‡ä»¶åœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/docker/pythonpath_dev/superset_config.py</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å…¶å®å·²ç»å¯ä»¥æ‰“å¼€ <code>http://0.0.0.0:8088</code> è®¿é—® superset çš„æœåŠ¡äº†, é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>admin</code>ã€‚</p><h1 id="windows-ä½¿ç”¨-wsl-å®‰è£…">Windows ä½¿ç”¨ WSL å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo apt-get install build-essential libssl-dev libffi-dev python-dev python-pip libsasl2-dev libldap2-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® python å’Œ pip åï¼Œå®‰è£…è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">pip install virtualenv</span><br><span class="line">python3 -m venv venv</span><br><span class="line">. venv/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… superset</span></span><br><span class="line">pip install apache-superset</span><br><span class="line"><span class="comment"># åˆå§‹åŒ– db</span></span><br><span class="line">superset db upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç®¡ç†å‘˜è´¦å·</span></span><br><span class="line"><span class="built_in">export</span> FLASK_APP=superset</span><br><span class="line">superset fab create-admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ä¾‹å­ï¼Œå¯é€‰</span></span><br><span class="line">superset load_examples</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">superset init</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥å¯åŠ¨</span></span><br><span class="line">superset run -p 8088 --with-threads --reload --debugger</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ wsgi æœåŠ¡</span></span><br><span class="line"><span class="comment"># å®‰è£…ç›¸å…³æœåŠ¡</span></span><br><span class="line">pip install gunicorn</span><br><span class="line">pip install gevent</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ wsgi æœåŠ¡å¯åŠ¨</span></span><br><span class="line">gunicorn  -w 10 -k gevent --timeout 120 -b 0.0.0.0:7668 --limit-request-line 0 --limit-request-field_size 0 <span class="string">&quot;superset.app:create_app()&quot;</span></span><br></pre></td></tr></table></figure><h1 id="é…ç½®-superset">é…ç½® Superset</h1><p>é…ç½® superset éœ€è¦ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå³ä¸Šé¢æˆ‘ä»¬æ—¥å¿—ä¸­çœ‹åˆ°è¿‡çš„é‚£ä¸ªæ–‡ä»¶ï¼Œå®ƒéœ€è¦è¢«æ·»åŠ åˆ°ä½ çš„ PYTHONPATH ä¸­ã€‚</p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in superset_config.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Superset specific config</span></span><br><span class="line">ROW_LIMIT = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">SUPERSET_WEBSERVER_PORT = <span class="number">8088</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask App Builder configuration</span></span><br><span class="line"><span class="comment"># Your App secret key</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;\2\1thisismyscretkey\1\2\e\y\y\h&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The SQLAlchemy connection string to your database backend</span></span><br><span class="line"><span class="comment"># This connection defines the path to the database that stores your</span></span><br><span class="line"><span class="comment"># superset metadata (slices, connections, tables, dashboards, ...).</span></span><br><span class="line"><span class="comment"># Note that the connection information to connect to the datasources</span></span><br><span class="line"><span class="comment"># you want to explore are managed directly in the web UI</span></span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;sqlite:////path/to/superset.db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask-WTF flag for CSRF</span></span><br><span class="line">WTF_CSRF_ENABLED = <span class="literal">True</span></span><br><span class="line"><span class="comment"># Add endpoints that need to be exempt from CSRF protection</span></span><br><span class="line">WTF_CSRF_EXEMPT_LIST = []</span><br><span class="line"><span class="comment"># A CSRF token that expires in 1 year</span></span><br><span class="line">WTF_CSRF_TIME_LIMIT = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this API key to enable Mapbox visualizations</span></span><br><span class="line">MAPBOX_API_KEY = <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨<a href="https://github.com/apache/superset/blob/master/superset/config.py">è¿™é‡Œ</a>æ‰¾åˆ°æ‰€æœ‰å¯é€‰çš„é…ç½®æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚</p><h1 id="è¿æ¥æ•°æ®åº“">è¿æ¥æ•°æ®åº“</h1><p>ç”±äºæˆ‘éœ€è¦æµ‹è¯•çš„æ•°æ®åº“æ˜¯ Oracleï¼Œè€Œ superset å®‰è£…åå†…éƒ¨å¹¶ä¸ä¼šå¸¦æœ‰æ•°æ®åº“é©±åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œæ–¹æ³•æ˜¯åœ¨ä»“åº“å†…éƒ¨çš„ docker ç›®å½•ä¸‹é¢ï¼Œæ–°å»º <code>requirements-local.txt</code> æ–‡ä»¶ï¼Œå¹¶å¡«å…¥åŒ…çš„åå­—ï¼Œå¦‚å¯¹äº oracle æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cx_Oracle</span><br></pre></td></tr></table></figure><p>ç„¶åå…³æ‰ superset æœåŠ¡ï¼Œé‡æ–°ç”Ÿæˆé•œåƒå†å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build --force-rm</span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><p>è¿æ¥ oracleï¼Œåªå®‰è£… cx_Oracle æ˜¯ä¸å¤Ÿçš„ï¼Œå¯èƒ½è¿˜éœ€è¦æœ‰ instantclient å®¢æˆ·ç«¯ã€‚</p><p>åœ¨ web ç•Œé¢æ·»åŠ æ•°æ®åº“å¯èƒ½ä¼šçœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cannot locate a 64-bit Oracle Client library: &quot;libclntsh.so: cannot open shared object file: No such file or directory&quot;. See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help</span><br><span class="line">(Background on this error at: http://sqlalche.me/e/13/4xp6)</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯æ²¡æœ‰é…ç½® Oracle çš„ instant clientï¼Œéœ€è¦åœ¨ç¯å¢ƒä¸­å®‰è£…æ‰å¯ä»¥è¿æ¥ Oracleã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æˆåŠŸå¯åŠ¨åï¼Œè¿˜éœ€è¦å®‰è£… cx_Oracle å’Œ instant client æ‰å¯ä»¥è¿æ¥ oracle</span><br><span class="line"># é¦–å…ˆéœ€è¦ä¸‹è½½ instant client, è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå» Oracle å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬å³å¯ï¼Œæˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ instantclient-basic-linux.x64-12.2.0.1.0.zip</span><br><span class="line"></span><br><span class="line">apt-get update &amp;&amp; apt-get install -y libaio1       # è£…ä¾èµ–</span><br><span class="line">Unzip instantclient-basic-linux.x64-12.2.0.1.0.zip # è§£å‹</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶</span><br><span class="line">cd /opt/oracle/instantclient* \</span><br><span class="line">rm -f *jdbc* *occi* *mysql* *README *jar uidrvci genezi adrci \</span><br><span class="line">echo /instantclient* &gt; /etc/ld.so.conf.d/oracle-instantclient.conf \</span><br><span class="line"></span><br><span class="line"># é…ç½® tnsnames</span><br><span class="line">&amp;&amp; ldconfig \</span><br><span class="line">&amp;&amp; mkdir -p instantclient_12_2/network/admin \</span><br><span class="line">&amp;&amp; cp tnsnames.ora instantclient_12_2/network/admin/ \</span><br><span class="line">&amp;&amp; cp /sqlnet.ora instantclient_12_2/network/admin/</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ tnsnames, tnsnames.ora æ–‡ä»¶ä¸­çš„æ•°æ®åº“åœ°å€é…ç½®å¯èƒ½åœ¨ wsl ä¸­æ— æ³•è¿æ¥ï¼Œè¿™é‡ŒæŠ˜è…¾äº†ä¸€ä¼šï¼Œåœ¨å®¿ä¸»æœºä¸Š ping è¯¥åœ°å€å¾—åˆ°äº†ä¸€ä¸ª domain.org å½¢å¼çš„åœ°å€ï¼Œé‡æ–°å¡«å…¥è§£å†³äº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Apache Superset æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ¢æŸ¥ä¸å¯è§†åŒ–å¹³å°ï¼Œè¯¥å·¥å…·åœ¨å¯è§†åŒ–ã€æ˜“ç”¨æ€§å’Œäº¤äº’æ€§ä¸Šéå¸¸æœ‰ç‰¹è‰²ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–åˆ†æã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é¡¹ç›®è®°å½•" scheme="https://scottzhang.pro/categories/%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="superset" scheme="https://scottzhang.pro/tags/superset/"/>
    
    <category term="cx_oracle" scheme="https://scottzhang.pro/tags/cx-oracle/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜å…ˆé˜Ÿåˆ—ä¸å †</title>
    <link href="https://scottzhang.pro/article/c172b52c.html"/>
    <id>https://scottzhang.pro/article/c172b52c.html</id>
    <published>2022-02-09T13:42:44.000Z</published>
    <updated>2022-02-15T09:50:15.679Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¼˜å…ˆé˜Ÿåˆ— Priority Queue (PQ) æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå †ï¼ˆheapï¼‰æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è¯´æ˜¯ä¼˜å…ˆé˜Ÿåˆ—çš„ä¸€ä¸ªå®ç°ã€‚</p></blockquote><span id="more"></span><h1 id="ä¼˜å…ˆé˜Ÿåˆ—">ä¼˜å…ˆé˜Ÿåˆ—</h1><p>ä¼˜å…ˆé˜Ÿåˆ—è‡³å°‘éœ€è¦æœ‰ä»¥ä¸‹è¿™äº›æ“ä½œï¼š</p><ul><li>is_empty, é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</li><li>add_element, å¢åŠ å…ƒç´ </li><li>pop_element, å¼¹å‡ºå…ƒç´ </li></ul><p>Python æœ‰ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°ï¼Œå³å †ï¼ˆheapqï¼‰ï¼Œå…¶ä¸­æœ€å°çš„å…ƒç´ æ‹¥æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ã€‚å®ƒçš„æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼éƒ½åªä¼šå°äºæˆ–ç­‰äºæ‰€æœ‰å­©å­èŠ‚ç‚¹ï¼ˆçš„å€¼ï¼‰; æœ€å°çš„å…ƒç´ æ€»æ˜¯åœ¨æ ¹ç»“ç‚¹ï¼šheap[0]</p><p>Python heapq æ¨¡å—å’Œä¸€èˆ¬çš„å †æ•°æ®ç»“æ„ï¼Œåœ¨è®¾è®¡æ—¶ä¸å…è®¸æŸ¥æ‰¾é™¤æœ€å°å…ƒç´ ä¹‹å¤–çš„ä»»ä½•å…ƒç´ ã€‚å¯¹äºæŒ‰å¤§å°æ£€ç´¢ä»»ä½•å…ƒç´ ï¼Œæ›´å¥½çš„é€‰æ‹©æ˜¯äºŒå‰æœç´¢æ ‘ã€‚</p><p>å †ä½¿ç”¨äº†å®Œå…¨äºŒå‰æ ‘æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè¿™æ„å‘³ç€æ ‘çš„æ·±åº¦ç­‰äº2ä¸ºåº•ï¼Œå…ƒç´ ä¸ªæ•°çš„å¯¹æ•°ã€‚å †ä¸­æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶ä»»ä½•å­èŠ‚ç‚¹ï¼Œè¿™ä¸€ç‚¹ä¸äºŒå‰æœç´¢æ ‘ä¸ä¸€æ ·ï¼ˆå­èŠ‚ç‚¹ä¸­å·¦èŠ‚ç‚¹å°äºå³èŠ‚ç‚¹ï¼‰</p><p><img src="https://files.realpython.com/media/heap-tree.4b4413ff133c.png" /></p><p>ä¼˜å…ˆé˜Ÿåˆ—åœ¨ç¼–ç¨‹ä¸­åº”ç”¨å¹¿æ³›ï¼Œç‰¹åˆ«æ˜¯é‚£äº›éœ€è¦åœ¨ä¸€äº›å…ƒç´ ä¸­æŸ¥æ‰¾æç«¯å€¼çš„æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p><ul><li>æ ¹æ®ç‚¹å‡»é‡ï¼ŒæŸ¥æ‰¾åšå®¢ä¸­æœ€å—æ¬¢è¿çš„5ç¯‡æ–‡ç« </li><li>æ‰¾å‡ºä» a ç‚¹åˆ° b ç‚¹æœ€å¿«çš„è·¯å¾„</li><li>ä½ æœ‰å‘é€é‚®ä»¶çš„ä¸€äº›ä»»åŠ¡ï¼Œå…¶ä¸­ä¸€äº›é‚®ä»¶éœ€è¦æ¯5åˆ†é’Ÿå‘ä¸€æ¬¡ï¼Œå¦å¤–çš„ä¸€äº›éœ€è¦æ¯4åˆ†é’Ÿå‘ä¸€æ¬¡</li></ul><h1 id="åœ¨-heapq-æ¨¡å—ä¸­ä½œä¸ºåˆ—è¡¨çš„å †">åœ¨ heapq æ¨¡å—ä¸­ä½œä¸ºåˆ—è¡¨çš„å †</h1><p>å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ—è¡¨æ¥è¡¨ç¤ºï¼ˆ<a href="%5Bæœ€å°å †æ’åº_Python_å“”å“©å“”å“©_bilibili%5D(https://www.bilibili.com/video/BV1ph411r7A6?from=search&amp;seid=14588240802172044798)">ä¸‹å›¾</a>è¡¨ç¤ºçš„ä¸ºæœ€å¤§å †ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2022/02/08/ftlG2QF6pxjYuhe.png" alt="æ•°ç»„è¡¨ç¤ºå †" /><figcaption aria-hidden="true">æ•°ç»„è¡¨ç¤ºå †</figcaption></figure><ul><li>ç”¨ i æ¥è¡¨ç¤ºç´¢å¼•å€¼ï¼ˆä¹Ÿæœ‰ç”¨ kï¼‰</li><li>ä½œä¸ºçˆ¶èŠ‚ç‚¹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„æ•°ç»„ä¸‹æ ‡ä¸º 2*i + 1.</li><li>ä½œä¸ºçˆ¶èŠ‚ç‚¹ï¼Œå®ƒçš„ç¬¬äºŒä¸ªå­èŠ‚ç‚¹æ•°ç»„ä¸‹æ ‡ä¸º 2*i + 2.</li><li>ä½œä¸ºå­èŠ‚ç‚¹ï¼Œå®ƒçš„çˆ¶èŠ‚ç‚¹ä¸º (i - 1) // 2.</li></ul><p>Python ä¸­æœ€å°å †çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå³å­èŠ‚ç‚¹éƒ½è¦å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h[i] &lt;= h[2*i + 1] and h[i] &lt;= h[2*i + 2]</span><br></pre></td></tr></table></figure><h1 id="æ“ä½œå †">æ“ä½œå †</h1><p>Python ä¸­å †çš„å®ç°æ˜¯ä¾èµ–äº list çš„ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»ã€‚</p><p>å¯ä»¥ä»ä¸€ä¸ªç©ºå †å¼€å§‹åˆå§‹åŒ–æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªlistéœ€è¦å°†å…¶ä¸­çš„å…ƒç´ æ”¾åˆ°å †ä¸­ï¼Œåˆ™å¯é€šè¿‡ heaptify() æ¥æŠŠä¸€ä¸ª list è½¬æˆå †ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line">a = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">7</span>]</span><br><span class="line"><span class="comment"># heapify() ä¿®æ”¹åˆ—è¡¨ï¼Œä½†ä¸å¯¹å®ƒè¿›è¡Œæ’åºã€‚</span></span><br><span class="line">heapq.heapify(a)</span><br><span class="line">a[<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡å †æ¥å®ç°ä¼˜å…ˆçº§ä»»åŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">h = []</span><br><span class="line">heappush(h, (<span class="number">5</span>, <span class="string">&#x27;write code&#x27;</span>))</span><br><span class="line">heappush(h, (<span class="number">7</span>, <span class="string">&#x27;release product&#x27;</span>))</span><br><span class="line">heappush(h, (<span class="number">1</span>, <span class="string">&#x27;write spec&#x27;</span>))</span><br><span class="line">heappush(h, (<span class="number">3</span>, <span class="string">&#x27;create tests&#x27;</span>))</span><br><span class="line">heappop(h)</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸€ä¸ªå‰é¢æåˆ°çš„å‘é€ email çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email</span>(<span class="params">frequency, details</span>):</span></span><br><span class="line">    current = datetime.datetime.now()</span><br><span class="line">    <span class="comment"># äº§ç”Ÿä¸€ä¸ªæ— é™å¾ªç¯çš„ç”Ÿæˆå™¨</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        current += frequency</span><br><span class="line">        <span class="keyword">yield</span> current.strftime(<span class="string">&quot;%Y/%m/%d %H:%M&quot;</span>) , details</span><br><span class="line"></span><br><span class="line">fast_email = email(datetime.timedelta(minutes=<span class="number">15</span>), <span class="string">&quot;fast email&quot;</span>)</span><br><span class="line">slow_email = email(datetime.timedelta(minutes=<span class="number">40</span>), <span class="string">&quot;slow email&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸¤ä¸ªç”Ÿæˆå™¨åœ¨ heapq ä¸­ merge</span></span><br><span class="line">unified = heapq.merge(fast_email, slow_email)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è°ƒç”¨ç»“åˆåçš„ç”Ÿæˆå™¨ 10 æ¬¡çœ‹çœ‹ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(unified))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(&#x27;2022/02/08 17:40&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 17:55&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:05&#x27;, &#x27;slow email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:10&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:25&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:40&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:45&#x27;, &#x27;slow email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 18:55&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 19:10&#x27;, &#x27;fast email&#x27;)</span><br><span class="line">(&#x27;2022/02/08 19:25&#x27;, &#x27;fast email&#x27;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° fast email æ˜¯é—´éš” 15 åˆ†é’Ÿæ¯æ¬¡å‘é€ï¼Œè€Œ slow email åˆ™æ˜¯40 åˆ†é’Ÿä¸€æ¬¡ï¼Œå®ƒä»¬å®Œç¾çš„äº¤é”™æˆä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ã€‚</p><p>merge å¹¶ä¸ä¼šä¸€æ¬¡æ€§å°†æ‰€æœ‰è¾“å…¥å…¨éƒ¨è¯»å–ï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬ä¼ å…¥çš„æ— é™é‡å¤çš„ç”Ÿæˆå™¨ï¼Œå®ƒä¹Ÿéå¸¸å¿«ä¸”ä¸å ç”¨å¾ˆå¤šå†…å­˜ã€‚</p><h1 id="ä½¿ç”¨å †çš„å…¶ä»–åœºæ™¯">ä½¿ç”¨å †çš„å…¶ä»–åœºæ™¯</h1><p>å †è¿˜æ“…é•¿è§£å†³ç»Ÿè®¡æœ€å¤§æˆ–è€…æœ€å°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç»Ÿè®¡å¾—å¥–æ¬¡æ•°å¾—ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line">results=<span class="string">&quot;&quot;&quot;\</span></span><br><span class="line"><span class="string">Christania Williams      11.80</span></span><br><span class="line"><span class="string">Marie-Josee Ta Lou       10.86</span></span><br><span class="line"><span class="string">Elaine Thompson          10.71</span></span><br><span class="line"><span class="string">Tori Bowie               10.83</span></span><br><span class="line"><span class="string">Shelly-Ann Fraser-Pryce  10.86</span></span><br><span class="line"><span class="string">English Gardner          10.94</span></span><br><span class="line"><span class="string">Michelle-Lee Ahye        10.92</span></span><br><span class="line"><span class="string">Dafne Schippers          10.90</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">top_3 = heapq.nsmallest(</span><br><span class="line">    <span class="number">3</span>,                                  <span class="comment"># æŒ‡ç¤ºè¿”å›å¤šå°‘ä¸ªå…ƒç´ </span></span><br><span class="line">    results.splitlines(),               <span class="comment"># åˆ†å‰²æˆæ•°ç»„ï¼Œè¦æ¯”è¾ƒçš„å…ƒç´ æˆ–æ•°æ®é›†</span></span><br><span class="line">    key=<span class="keyword">lambda</span> x: <span class="built_in">float</span>(x.split()[-<span class="number">1</span>])  <span class="comment"># ç¡®å®šå¦‚ä½•æ¯”è¾ƒå…ƒç´ çš„å¯è°ƒç”¨å‡½æ•°</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>.join(top_3))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Elaine Thompson          10.71</span><br><span class="line">Tori Bowie               10.83</span><br><span class="line">Marie-Josee Ta Lou       10.86</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¼˜å…ˆé˜Ÿåˆ— Priority Queue (PQ) æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå †ï¼ˆheapï¼‰æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è¯´æ˜¯ä¼˜å…ˆé˜Ÿåˆ—çš„ä¸€ä¸ªå®ç°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="https://scottzhang.pro/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="heapq" scheme="https://scottzhang.pro/tags/heapq/"/>
    
    <category term="queue" scheme="https://scottzhang.pro/tags/queue/"/>
    
    <category term="PQ" scheme="https://scottzhang.pro/tags/PQ/"/>
    
    <category term="heap" scheme="https://scottzhang.pro/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>Python ä»€ä¹ˆæ˜¯GILé”</title>
    <link href="https://scottzhang.pro/article/eefff7f1.html"/>
    <id>https://scottzhang.pro/article/eefff7f1.html</id>
    <published>2022-01-17T12:54:03.000Z</published>
    <updated>2022-02-15T09:50:15.677Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç†è§£ Python ä¸­çš„ GIL é”å¯¹äºæƒ³è¦äº†è§£ Python å¤šçº¿ç¨‹æ˜¯éå¸¸é‡è¦çš„ã€‚</p></blockquote><span id="more"></span><h1 id="ä»€ä¹ˆæ˜¯-gil">ä»€ä¹ˆæ˜¯ GIL</h1><p>Python å…¨å±€è§£é‡Šå™¨é”æˆ– GIL(Global Interpreter Lock)ï¼Œç®€å•æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªäº’æ–¥ä½“ï¼ˆæˆ–é”ï¼‰ï¼Œå®ƒåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ Python è§£é‡Šå™¨çš„æ§åˆ¶æƒã€‚</p><p>è¿™æ„å‘³ç€ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ CPU ä¸Šå¯ä»¥æ‰§è¡Œå­—èŠ‚ç ï¼Œå³ä¾¿æ˜¯åœ¨æ‹¥æœ‰å¤šæ ¸ CPU çš„æƒ…å†µä¸‹ï¼Œè¿™ä¹Ÿæ˜¯ Python è¢«è¯Ÿç—…çš„ä¸€ä¸ªç‚¹ã€‚</p><h1 id="gil-è§£å†³äº†ä»€ä¹ˆé—®é¢˜">GIL è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h1><p>æ—¢ç„¶ GIL ä¼šå¸¦æ¥æ€§èƒ½åˆ©ç”¨ä¸Šçš„é—®é¢˜ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿ</p><p>åœ¨è°ˆè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆæ¥è¯´è¯´ Python ä¸­çš„å†…å­˜ç®¡ç†ï¼ŒPython ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å®ç°å†…å­˜ç®¡ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">a = []</span><br><span class="line">b = a</span><br><span class="line">sys.getrefcount(a)</span><br><span class="line"><span class="comment"># 3</span></span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å˜é‡æŒ‡å‘å®ƒçš„æ—¶å€™ï¼Œå®ƒå°±ä¼šè¢«é”€æ¯ã€‚</p><p>è¿™ç§å¼•ç”¨è®¡æ•°çš„æœºåˆ¶éœ€è¦ä¸€ä¸ªä¿æŠ¤æœºåˆ¶ï¼Œä»¥ç¡®ä¿å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œä¸ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆæ¯”å¦‚ A çº¿ç¨‹å¯¹ X åŠ ä¸€ç™¾ä¸‡æ¬¡ï¼ŒB çº¿ç¨‹å¯¹ X å‡ä¸€ç™¾ä¸‡æ¬¡ï¼‰ï¼Œå¦‚æœæ”¾ä»»ä¸ç®¡ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ°¸è¿œæ— æ³•é‡Šæ”¾ï¼‰ï¼Œæˆ–è€…æ˜¯é”™è¯¯é‡Šæ”¾äº†è¿˜å­˜åœ¨å¼•ç”¨çš„å†…å­˜ã€‚</p><p>å¦‚æœç»™åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å…±äº«çš„æ•°æ®ç»“æ„çš„å¼•ç”¨è®¡æ•°åŠ ä¸€æŠŠé”ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«ä¸ä¸€è‡´åœ°ä¿®æ”¹ã€‚</p><p>ä½†æ˜¯ç»™æ¯ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…æ˜¯ä¸€ç»„å¯¹è±¡ï¼‰éƒ½åŠ é”å¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼Œè€Œä¸”åœ¨å¤šæŠŠé”çš„æƒ…å†µä¸‹ï¼Œå¯¹äºé”çš„ç”³è¯·ä¸é‡Šæ”¾åˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p>GIL è§„å®šæ‰§è¡Œä»»ä½• Python å­—èŠ‚ç éƒ½éœ€è¦å…ˆè·å¾—è§£é‡Šå™¨é”, è¿™å°±é¿å…äº†æ­»é”å’Œæ€§èƒ½å¤§å¹…ä¸‹é™çš„æƒ…å†µï¼Œåå¤„æ˜¯ Python ç¨‹åºåªèƒ½ä»¥å•çº¿ç¨‹çš„å½¢å¼è¿è¡Œã€‚</p><h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©-gil-ä½œä¸ºè§£å†³æ–¹æ¡ˆ">ä¸ºä»€ä¹ˆé€‰æ‹© GIL ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Ÿ</h1><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆåœ¨ Python ä¸­ä½¿ç”¨äº†ä¸€ç§çœ‹ä¼¼å¦‚æ­¤ç¬¨æ‹™çš„æ–¹æ³•å‘¢ï¼Ÿ Python çš„å¼€å‘äººå‘˜åšå‡ºäº†ä¸€ä¸ªé”™è¯¯çš„å†³å®šå—ï¼Ÿæ¯•ç«Ÿç°åœ¨åŠ¨ä¸åŠ¨ç»™å°±æ˜¯ 8 æ ¸ CPUã€‚</p><p>åœ¨ <a href="https://www.youtube.com/watch?v=KVKufdTphKs&amp;t=731s">Larry Hastings</a> å…³äº GIL çš„æ¼”è®²ä¸­ï¼Œä»–è¯´ï¼šâ€œé€‰æ‹© GIl çš„è¿™ä¸ªå†³å®šæ­£æ˜¯è®© Python å¦‚æ­¤æµè¡Œçš„åŸå› â€</p><p>åœ¨æ“ä½œç³»ç»Ÿå‡ºç°çº¿ç¨‹è¿™ä¸ªæ¦‚å¿µä»¥å‰ï¼ŒPythonå°±å­˜åœ¨ã€‚Python è¢«è®¾è®¡çš„æ˜“äºä½¿ç”¨ï¼Œä»¥ä½¿å¾—å¼€å‘æ›´å¿«ã€‚æ—©æœŸçš„ Python ä¾èµ–è®¸å¤š C çš„åº“ï¼Œä¸ºäº†é¿å…é—®é¢˜çš„äº§ç”Ÿï¼Œè¿™äº› C ç¨‹åºéœ€è¦ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å†…å­˜ç®¡ç†ï¼Œè€Œ GIL è®©è¿™æˆä¸ºäº†å¯èƒ½ã€‚å¯ä»¥è¯´ GIL æ˜¯ CPython å¼€å‘äººå‘˜åœ¨ Python æ—©æœŸé¢ä¸´çš„éš¾é¢˜çš„ä¸€ä¸ªå®ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><h1 id="ä»€ä¹ˆæ˜¯-cpython">ä»€ä¹ˆæ˜¯ CPython</h1><p>Cpython æ˜¯ç”¨ C å†™çš„ä¸€ä¸ªè§£é‡Šå™¨ã€‚</p><p>PYthon æœ‰å¾ˆå¤šä¸ªè§£é‡Šå™¨ï¼Œå¦‚ CPython, Jython, IronPython ä»¥åŠ PyPy, åˆ†åˆ«ä½¿ç”¨ C, Java, C# å’Œ Python å®ç°ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ C å¹¶ä¸æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ã€‚ä½ å¯èƒ½å¬è¯´è¿‡åœ¨ Python ä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼ˆæ¯”å¦‚ int, str)ï¼Œè¿™åœ¨ CPython å±‚é¢çš„å®ç°ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåœ¨ CPython ä¸­ï¼Œæœ‰ä¸€ä¸ª struct å«åš PyObjectï¼ŒCPython ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä½¿ç”¨å®ƒã€‚</p><blockquote><p>Note: A struct, or structure, in C is a custom data type that groups together different data types. To compare to object-oriented languages, itâ€™s like a class with attributes and no methods.</p></blockquote><p>PyObjectï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ Python å¯¹è±¡çš„çˆ·çˆ·ï¼ŒåŒ…å«äº†ä¸¤ä¸ªä¸œè¥¿:</p><ul><li><code>ob_refcnt</code>, å¼•ç”¨è®¡æ•°ï¼Œå®ç°åƒåœ¾å›æ”¶æœºåˆ¶</li><li><code>ob_type</code>, æŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­ä¿å­˜äº†å®é™…çš„å¯¹è±¡ç±»å‹</li></ul><p>å…³äº CPython çš„å†…å­˜ç®¡ç†ï¼Œå¯ä»¥å‚è€ƒ RealPython çš„<a href="https://realpython.com/python-memory-management/#garbage-collection">è¿™ç¯‡</a>æ–‡ç« ã€‚</p><h1 id="gil-çš„å½±å“">GIL çš„å½±å“</h1><p>Python ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨çº¿ç¨‹æ¥åŒæ—¶å¯¹ä¸€ä¸ªå˜é‡è¿›è¡ŒåŠ å‡æ“ä½œï¼Œä¼šå‘ç°ç»“æœæ˜¯ä¸ä¸€æ ·çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        total += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desc</span>():</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        total -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">thread1 = threading.Thread(target=add)</span><br><span class="line">thread2 = threading.Thread(target=desc)</span><br><span class="line"></span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"></span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯æ¬¡çš„ç»“æœéƒ½ä¸ä¸€æ ·</span></span><br><span class="line"><span class="comment"># GIL å¹¶ä¸æ˜¯ä¸Šé¢æŸä¸ªå‡½æ•°ä¸€ç›´å æœ‰ï¼Œè€Œæ˜¯åœ¨æŸä¸ªå‡½æ•°è½¬åŒ–æˆå­—èŠ‚ç å</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œä¸€æ®µé•¿åº¦çš„å­—èŠ‚ç åï¼Œä¼šé‡Šæ”¾ GIL ç ï¼Œç„¶åç»™å…¶ä»–çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">print</span>(total)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>GIL è®©ä½ åœ¨åŒä¸€æ—¶åˆ»åªèƒ½åˆ©ç”¨åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹äº CPU å¯†é›†å‹ç¨‹åºï¼Œä½¿ç”¨å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ï¼Œå…¶æ‰§è¡Œæ•ˆç‡æ˜¯ä¸€æ ·çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># single_threaded.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">COUNT = <span class="number">50000000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">while</span> n&gt;<span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">countdown(COUNT)</span><br><span class="line">end = time.time()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ‰€éœ€æ—¶é—´(ç§’) -&#x27;</span>, end - start)</span><br></pre></td></tr></table></figure><p>åœ¨å››æ ¸çš„æœºå™¨ä¸Šï¼Œå®ƒéœ€è¦çš„æ—¶é—´æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python single_threaded.py</span><br><span class="line">æ‰€éœ€æ—¶é—´(ç§’) - 6.20024037361145</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹ç¼–å†™ä¸€ä¸ªä¸€æ ·çš„ç¨‹åº:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># multi_threaded.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">COUNT = <span class="number">50000000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">while</span> n&gt;<span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">t1 = Thread(target=countdown, args=(COUNT//<span class="number">2</span>,))</span><br><span class="line">t2 = Thread(target=countdown, args=(COUNT//<span class="number">2</span>,))</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line">end = time.time()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ‰€éœ€æ—¶é—´(ç§’) -&#x27;</span>, end - start)</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæŸ¥çœ‹ç»“æœ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python multi_threaded.py</span><br><span class="line">æ‰€éœ€æ—¶é—´(ç§’) - <span class="number">6.924342632293701</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨å¤šçº¿ç¨‹å’Œä¸é€‚ç”¨å¤šçº¿ç¨‹èŠ±çš„æ—¶é—´æ˜¯å·®ä¸å¤šçš„ã€‚</p><p>GIL å¯¹äº CPU å¯†é›†å‹çš„ç¨‹åºæœ‰é™åˆ¶çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„åˆ™æ²¡æœ‰å¾ˆå¤§å½±å“ã€‚</p><p>å¦‚æœä½ ç¼–å†™äº†ä½¿ç”¨çº¿ç¨‹å»å¤„ç†å›¾è±¡ä¸­çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆç”šè‡³ä¼šè®©ä½ çš„è¿è¡Œæ—¶é—´å¢åŠ ï¼Œè¿™æ˜¯å› ä¸ºç”³è¯·å’Œé‡Šæ”¾é”è¿˜éœ€è¦é¢å¤–çš„å¼€é”€ã€‚</p><p>åœ¨ Python 3 æ›´æ–°çš„æ—¶å€™ï¼Œè®¸å¤šäººéƒ½å¸Œæœ›å°† GIL ç§»é™¤ï¼Œç¡®å®ä¹Ÿæœ‰å¾ˆå¤šäººåšè¿‡å°è¯•ï¼Œä½†å‘ç°è¿™ä¹ˆåšé™¤äº†å¯¼è‡´å¾ˆå¤šçš„ C è¯­è¨€åº“ä¸æ”¯æŒæ„å¤–ï¼Œè¿˜è®©å•çº¿ç¨‹ä¸‹çš„ Python ç›¸æ¯”è¾ƒ Python2 æ›´æ…¢ã€‚</p><p>æ‰€ä»¥ Python çš„åˆ›å§‹äººåœ¨è°ˆåŠ GIL æ—¶è¯´ï¼š</p><blockquote><p>â€œIâ€™d welcome a set of patches into Py3k only if the performance for a single-threaded program (and for a multi-threaded but I/O-bound program) does not decreaseâ€.</p></blockquote><p>ä½† Python3 å¯¹ GIl æœ‰è¿‡ä¸€æ¬¡å‡çº§ï¼Œå³å°† IO å¯†é›†å‹çš„çº¿ç¨‹ç”³è¯·é”çš„ä¼˜å…ˆçº§é™ä½ã€‚</p><p>Python çš„ GIL ä¼šé¥¿æ­» I/O å¯†é›†å‹çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä»¬ä¸ç»™å®ƒä»¬ä» CPU å¯†é›†å‹çº¿ç¨‹è·å– GIL çš„æœºä¼šã€‚</p><p>è¿™æ˜¯å› ä¸º Python å†…ç½®äº†ä¸€ç§æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å¼ºåˆ¶çº¿ç¨‹åœ¨å›ºå®šçš„è¿ç»­ä½¿ç”¨é—´éš”åé‡Šæ”¾ GILï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–äººè·å¾— GILï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç»§ç»­ä½¿ç”¨å®ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># The interval is set to 100 instructions:</span></span><br><span class="line">sys.getcheckinterval()</span><br></pre></td></tr></table></figure><p>è¿™ç§æœºåˆ¶çš„é—®é¢˜åœ¨äºï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒCPU å¯†é›†å‹çº¿ç¨‹ä¼šåœ¨å…¶ä»–çº¿ç¨‹è·å– GIL ä¹‹å‰é‡æ–°è·å– GILï¼Œåœ¨ 2009 å¹´çš„æ—¶å€™ï¼Œè¿™ä¸ª bug åœ¨ Python 3.2 ä¸­ç”± Antoine Pitrou ä¿®å¤äº†ï¼Œä»–è®¾è®¡äº†ä¸€ç§æœºåˆ¶å»æŸ¥çœ‹å…¶ä»–çº¿ç¨‹ç”³è¯·é”ä½†è¢«æ‹’ç»çš„æ¬¡æ•°ï¼Œç›®çš„å°±æ˜¯é˜²æ­¢ CPU å¯†é›†å‹çº¿ç¨‹é•¿æœŸå ç”¨ GIL é”ã€‚</p><h1 id="å¦‚ä½•è§£å†³-gil-å¸¦æ¥çš„é—®é¢˜">å¦‚ä½•è§£å†³ GIL å¸¦æ¥çš„é—®é¢˜</h1><p>å¦‚æœç¡®å®š GIL æ˜¯ä½ ç¨‹åºçš„ç“¶é¢ˆï¼Œå¯ä»¥æœ‰å‡ ä¸ªä¼˜åŒ–çš„æ–¹å‘ï¼š</p><p><strong>ä½¿ç”¨å¤šè¿›ç¨‹</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">COUNT = <span class="number">50000000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">while</span> n&gt;<span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pool = Pool(processes=<span class="number">2</span>)</span><br><span class="line">    start = time.time()</span><br><span class="line">    r1 = pool.apply_async(countdown, [COUNT//<span class="number">2</span>])</span><br><span class="line">    r2 = pool.apply_async(countdown, [COUNT//<span class="number">2</span>])</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ‰€éœ€æ—¶é—´(ç§’)&#x27;</span>, end - start)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œæ‰€éœ€æ—¶é—´åªéœ€è¦ 4 ç§’ã€‚åœ¨è¿›ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ GIL é”ç”¨äºå†…éƒ¨çº¿ç¨‹çš„æ§åˆ¶ï¼Œæ‰€ä»¥äº’ä¸å½±å“ã€‚</p><blockquote><p>å‚è€ƒé˜®ä¸€å³°å…³äº: <a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html">è¿›ç¨‹ä¸çº¿ç¨‹çš„ä¸€ä¸ªç®€å•è§£é‡Š</a>ã€‚</p></blockquote><p><strong>æ›´æ¢è§£é‡Šå™¨</strong></p><p>GIL çš„é—®é¢˜ï¼Œåªå­˜åœ¨äºæœ€å¼€å§‹çš„ CPython ä¸­ã€‚</p><p>è¿™ç¯‡æ–‡ç« å¯¹ Python çš„ GIL åšäº†ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œå¦‚æœä½ è¿˜æƒ³äº†è§£ GIL æ›´åº•å±‚çš„ä¸œè¥¿ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ David Beazley å…³äº GIL çš„è®²åº§: <a href="https://www.youtube.com/watch?v=Obt-vMVdM8s">Understanding the Python GIL</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ç†è§£ Python ä¸­çš„ GIL é”å¯¹äºæƒ³è¦äº†è§£ Python å¤šçº¿ç¨‹æ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="GIL" scheme="https://scottzhang.pro/tags/GIL/"/>
    
  </entry>
  
  <entry>
    <title>äº†è§£ Python Magic Method</title>
    <link href="https://scottzhang.pro/article/23c3a2e1.html"/>
    <id>https://scottzhang.pro/article/23c3a2e1.html</id>
    <published>2022-01-16T14:07:47.000Z</published>
    <updated>2022-02-15T09:50:15.678Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†é­”æ³•æ–¹æ³•ï¼Œå¹¶å¸¦ä½ ä½¿ç”¨é­”æ³•æ–¹æ³•å®ç°è‡ªå®šä¹‰çš„åºåˆ—ã€‚</p></blockquote><span id="more"></span><h1 id="é­”æ³•æ–¹æ³•">é­”æ³•æ–¹æ³•</h1><p>é­”æ³•æ–¹æ³•æ˜¯ä¸ºäº†å¢å¼ºæŸä¸ªç±»çš„ç‰¹æ€§ï¼Œå®ƒæœ‰çº¦å®šä¿—æˆçš„åå­—ï¼Œä½ åªéœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, employee_list</span>):</span></span><br><span class="line">        self.employee = employee_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æ­¤ç±»çš„å®ä¾‹ï¼Œæ”¯æŒè¢« for å¾ªç¯è®¿é—®å†…éƒ¨ employee</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.employee[item]</span><br><span class="line"></span><br><span class="line">company = Company([<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;MicroSoft&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯æŒ for å¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> company_name <span class="keyword">in</span> company:</span><br><span class="line">    <span class="built_in">print</span>(company_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯æŒåˆ‡ç‰‡</span></span><br><span class="line">company[:<span class="number">2</span>]</span><br></pre></td></tr></table></figure><h1 id="æœ‰å“ªäº›é­”æ³•æ–¹æ³•">æœ‰å“ªäº›é­”æ³•æ–¹æ³•</h1><p>é¦–å…ˆå¯ä»¥åˆ†ä¸ºéæ•°å­¦è¿ç®—ä¸æ•°å­¦ç›¸å…³ã€‚</p><p>éæ•°å­¦è¿ç®—ä¸­åˆæœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œ__repr__, __str__</span><br><span class="line">- é›†åˆåºåˆ—ç›¸å…³ï¼Œ__len__, __get/set/delitem__, __contains__</span><br><span class="line">- è¿­ä»£ç›¸å…³, __iter__, __next__</span><br><span class="line">- å¯è°ƒç”¨, __call__</span><br><span class="line">- with ä¸Šä¸‹æ–‡ç®¡ç†å™¨, __enter__, __exit__</span><br><span class="line">- æ•°å€¼è½¬æ¢ï¼Œ__abs__, __int/float/bool/...__, __hash__</span><br><span class="line">- å…ƒç±»ç›¸å…³, __new__, __init__</span><br><span class="line">- å±æ€§ç›¸å…³ï¼Œ__get/setattr__, __get/setattribute__. __dir__</span><br><span class="line">- å±æ€§æè¿°ç¬¦, __get__, __set__, __delete__</span><br><span class="line">- åç¨‹, __await__, __aiter__, __anext__, __aenter__, __aexit__</span><br></pre></td></tr></table></figure><p>æ•°å­¦è¿ç®—åˆ™æœ‰ä¸€å…ƒã€äºŒå…ƒè¿ç®—ç¬¦ï¼Œç®—æ•°è¿ç®—ç¬¦ï¼Œä½è¿ç®—ç¬¦ç­‰ç­‰ï¼Œæš‚æ—¶ä¸åšè¿‡å¤šä»‹ç»ã€‚</p><p>åœ¨ Python ä¸­ï¼Œlen æ–¹æ³•æœ‰å…¶ç‰¹æ®Šæ€§ã€‚å½“ len ä½œç”¨åœ¨å†…ç½®ç±»å‹å¦‚ set, list, dict ä¸Šçš„æ—¶å€™ï¼Œå› ä¸ºè¿™äº›ç»“æ„éƒ½æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œæ€§èƒ½éå¸¸é«˜ï¼Œå½“ len è®¡ç®—è¿™äº›æ•°æ®ç»“æ„çš„é•¿åº¦çš„æ—¶å€™ï¼Œä¼šç›´æ¥è¯»å–è¿™ä¸ªæ•°æ®ç»“æ„çš„é•¿åº¦å€¼ï¼ˆC ä¼šç»´æŠ¤ä¸€ä¸ªé•¿åº¦å€¼ï¼‰ï¼Œè€Œä¸ä¼šéå†è¯¥æ ‘ç»“æ„ã€‚</p><h1 id="åº”ç”¨è‡ªå®šä¹‰åºåˆ—">åº”ç”¨ï¼šè‡ªå®šä¹‰åºåˆ—</h1><h2 id="åºåˆ—ç±»å‹">åºåˆ—ç±»å‹</h2><p>åœ¨äº†è§£å¦‚ä½•è‡ªå®šä¹‰åºåˆ—ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ python æœ‰å“ªäº›å†…ç½®çš„åºåˆ—ç±»ï¼Œæˆ‘ä»¬å°†å…¶ä¸­åˆ†ä¸ºè¿™å‡ ç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å¾€é‡Œé¢æ”¾ä¸œè¥¿</span></span><br><span class="line">- å®¹å™¨åºåˆ—ï¼š<span class="built_in">list</span>, <span class="built_in">tuple</span>, deque</span><br><span class="line"><span class="comment"># éå®¹å™¨</span></span><br><span class="line">- æ‰å¹³åºåˆ—ï¼š<span class="built_in">str</span>, <span class="built_in">bytes</span>, <span class="built_in">bytearray</span>, array.array</span><br><span class="line"><span class="comment"># åºåˆ—å†…éƒ¨å…ƒç´ å¯ä»¥å˜åŒ–</span></span><br><span class="line">- å¯å˜åºåˆ—ï¼š <span class="built_in">list</span>, deque, <span class="built_in">bytearray</span>, array</span><br><span class="line"><span class="comment"># åºåˆ—å†…éƒ¨å…ƒç´ ä¸å¯å˜åŒ–</span></span><br><span class="line">- ä¸å¯å˜ï¼š<span class="built_in">str</span>, <span class="built_in">tuple</span>, <span class="built_in">bytes</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™äº›åºåˆ—ç±»ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡ for å¾ªç¯å»è®¿é—®å…¶å†…éƒ¨çš„å…ƒç´ ã€‚</p><p>è¦æƒ³å®ç°åºåˆ—ç±»ï¼Œåˆ™éœ€è¦å®ç°åºåˆ—çš„åè®®ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>_collections_abc</code> äº†è§£è¦å®ç°åºåˆ—åè®®æ‰€éœ€è¦çš„å‡½æ•°ã€‚</p><p>åœ¨åºåˆ—ä¸­ï¼Œä¸€èˆ¬éƒ½æ”¯æŒ <code>+ += extend</code> æ–¹æ³•ï¼Œä½†ä½ çŸ¥é“ä»–ä»¬çš„åŒºåˆ«å—ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># +, c = [1, 2, 3, 4]</span></span><br><span class="line">c = a + [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># +=, a = [1, 2, 3, 4]</span></span><br><span class="line">a += [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå°† += åé¢æ¢æˆå…ƒç»„å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"># ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">a += (<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯ + å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"># ä¼šæŠ¥é”™</span></span><br><span class="line">c = a + (<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>+=</code> æ”¯æŒä»»æ„åºåˆ—ç±»å‹ï¼Œå…¶èƒŒååŸç†æ˜¯è°ƒç”¨ä¸€ä¸ªé­”æ³•å‡½æ•° <code>__iadd__</code>, å…¶ä¸­åˆæ˜¯ä¾èµ– <code>__extend__</code> æ–¹æ³•ï¼Œå†…éƒ¨ä½¿ç”¨çš„æ˜¯ for å¾ªç¯å¯¹å…ƒç´ å–å€¼å¹¶ç›¸åŠ ï¼Œæ‰€ä»¥åªè¦æ˜¯å¯ä»¥è¿­ä»£çš„ç±»å‹ï¼Œéƒ½æ”¯æŒç”¨ <code>+=</code> æ“ä½œã€‚</p></blockquote><p>å¦å¤–è¦æ³¨æ„ list çš„ <code>append</code> å’Œ <code>extend</code> æ–¹æ³•çš„åŒºåˆ«ï¼Œextend æ˜¯å°†æ•°ç»„å†…çš„å€¼ä¸€ä¸ªä¸€ä¸ªæ”¾å…¥å¦ä¸€ä¸ªæ•°ç»„ï¼Œè€Œ append æ˜¯å°†æ•´ä¸ªæ•°ç»„æ”¾å…¥å¦ä¸€ä¸ªæ•°ç»„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">arr.extend([<span class="number">3</span>, <span class="number">4</span>])  <span class="comment"># [1, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line">arr.append([<span class="number">3</span>, <span class="number">4</span>])  <span class="comment"># [1, 2, [3, 4]]</span></span><br><span class="line">arr.append((<span class="number">3</span>, <span class="number">4</span>))  <span class="comment"># [1, 2, (3, 4)]</span></span><br></pre></td></tr></table></figure><h2 id="å®ç°å¯åˆ‡ç‰‡å¯¹è±¡">å®ç°å¯åˆ‡ç‰‡å¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DCGroup</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, dpt, industry, staff</span>):</span></span><br><span class="line">        self.dpt = dpt</span><br><span class="line">        self.industry = industry</span><br><span class="line">        self.staff = staff</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®ç°åºåˆ—åè®®éœ€è¦çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.staff.reverse()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™ä¸ªæ˜¯å®ç°åˆ‡ç‰‡çš„å…³é”®ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ‡ç‰‡æ“ä½œä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="comment"># è‹¥è¿™æ ·è¿”å›ï¼Œåˆ™ç›´æ¥å«åˆ‡ç‰‡æ“ä½œäº¤ç»™äº†å†…ç½®çš„ list æ“ä½œ</span></span><br><span class="line">        <span class="comment"># return self.staff[item]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½†å¦‚æœä½ æƒ³è¦è¿”å›çš„ä¸œè¥¿æ˜¯ä¸€ä¸ª Group å¯¹è±¡å‘¢ï¼Ÿ</span></span><br><span class="line">        <span class="comment"># è¿™æ ·ä½ å°±å¯ä»¥ä¸€ç›´åˆ‡ç‰‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™å°±éœ€è¦ç†è§£ ä¼ å…¥çš„ itemï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª slice å¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯æ ¹æ® index è®¿é—®ï¼Œåˆ™æ˜¯ int å€¼</span></span><br><span class="line"></span><br><span class="line">        cls = <span class="built_in">type</span>(self)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">slice</span>):</span><br><span class="line">            <span class="keyword">return</span> cls(</span><br><span class="line">                dpt=self.dpt,</span><br><span class="line">                industry=self.industry,</span><br><span class="line">                staff=self.staff[item]</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(item, numbers.Integral):</span><br><span class="line">            <span class="keyword">return</span> cls(</span><br><span class="line">                dpt=self.dpt,</span><br><span class="line">                industry=self.industry,</span><br><span class="line">                staff=[self.staff[item]]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.staff)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(self.staff)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="keyword">if</span> item <span class="keyword">in</span> self.staff:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">dc = DCGroup(dpt=<span class="string">&#x27;DC&#x27;</span>, industry=<span class="string">&#x27;IMF&#x27;</span>, staff=[<span class="string">&#x27;Scott&#x27;</span>, <span class="string">&#x27;Austin&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">dc[:<span class="number">1</span>].staff  <span class="comment"># [&#x27;Scott&#x27;]</span></span><br><span class="line"><span class="string">&#x27;Scott&#x27;</span> <span class="keyword">in</span> dc <span class="comment"># True</span></span><br><span class="line"><span class="built_in">len</span>(dc)  <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> dc:</span><br><span class="line">    <span class="built_in">print</span>(user)</span><br><span class="line"></span><br><span class="line"><span class="built_in">reversed</span>(dc)</span><br></pre></td></tr></table></figure><h2 id="æ‹“å±•ç»´æŠ¤å·²æ’åºåºåˆ—">æ‹“å±•ï¼šç»´æŠ¤å·²æ’åºåºåˆ—</h2><p><code>bisect</code> æ˜¯ç”¨æ¥å¤„ç†å·²æ’åºçš„å‡åºåºåˆ—çš„åŒ…ï¼Œä½¿ç”¨çš„æ˜¯äºŒåˆ†æŸ¥æ‰¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"></span><br><span class="line"><span class="comment"># insort æ’å…¥</span></span><br><span class="line">int_list = []</span><br><span class="line">bisect.insort(int_list, <span class="number">3</span>)</span><br><span class="line">bisect.insort(int_list, <span class="number">2</span>)</span><br><span class="line">bisect.insort(int_list, <span class="number">1</span>)</span><br><span class="line">bisect.insort(int_list, <span class="number">5</span>)</span><br><span class="line">bisect.insort(int_list, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(int_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æ’å…¥çš„ä½ç½®ä¼šæ˜¯ä»€ä¹ˆä¸‹æ ‡</span></span><br><span class="line"><span class="built_in">print</span>(bisect.bisect(int_list, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bisect.bisect_left(int_list, <span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(bisect.bisect_right(int_list, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 5, 9]</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br></pre></td></tr></table></figure><p>Python ä¸­è¿˜æœ‰å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ array, deque.</p><p>list ç›¸å½“äºå®¹å™¨ï¼Œå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹ï¼Œè€Œarray åªèƒ½å­˜æ”¾æŒ‡å®šæ•°æ®ç±»å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># array éå¸¸å¿«ï¼Œlist å¾ˆçµæ´»</span></span><br><span class="line">my_array = array.array(<span class="string">&quot;i&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä»‹ç»äº†é­”æ³•æ–¹æ³•ï¼Œå¹¶å¸¦ä½ ä½¿ç”¨é­”æ³•æ–¹æ³•å®ç°è‡ªå®šä¹‰çš„åºåˆ—ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="é­”æ³•å‡½æ•°" scheme="https://scottzhang.pro/tags/%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0/"/>
    
    <category term="magic method" scheme="https://scottzhang.pro/tags/magic-method/"/>
    
    <category term="dunder method" scheme="https://scottzhang.pro/tags/dunder-method/"/>
    
  </entry>
  
  <entry>
    <title>Python æ·±å…¥ç†è§£ç±»ä¸å¯¹è±¡</title>
    <link href="https://scottzhang.pro/article/4bcdc7f7.html"/>
    <id>https://scottzhang.pro/article/4bcdc7f7.html</id>
    <published>2022-01-16T13:54:41.000Z</published>
    <updated>2022-02-15T09:50:15.678Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ·±å…¥ç†è§£ Python ä¸­çš„ç±»ä¸å¯¹è±¡ã€‚</p></blockquote><span id="more"></span><h1 id="ç±»å’Œå¯¹è±¡">ç±»å’Œå¯¹è±¡</h1><p>å¯¹è±¡æ˜¯ä¸€ä¸ªæœ‰ç€ç›¸åº”è¡Œä¸ºçš„æ•°æ®çš„é›†åˆï¼Œæ¯”å¦‚è‹¹æœå’Œæ©˜å­å¯ä»¥è¯´éƒ½æ˜¯å¯¹è±¡ã€‚</p><p>å‡è®¾æˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªå†œåœºæ¸¸æˆï¼Œè‹¹æœä¼šæ”¾åˆ°ç¯®å­é‡Œï¼Œæ©˜å­ä¼šæ”¾åˆ°æ¡¶ä¸­ï¼Œé‚£ä¹ˆç°åœ¨å°±æœ‰å››ä¸ªå¯¹è±¡ã€‚</p><p>å¯¹è±¡å’Œç±»æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿç±»æè¿°äº†å¯¹è±¡ï¼Œå®ƒä»¬å°±åƒæ˜¯åˆ›å»ºå¯¹è±¡çš„æ¨¡æ¿ã€‚</p><h1 id="é™æ€æ–¹æ³•ä¸ç±»æ–¹æ³•">é™æ€æ–¹æ³•ä¸ç±»æ–¹æ³•</h1><p>ç†è§£æ–¹æ³•æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼ŒPython ä¸­çš„é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ä»¥åŠæŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« -<a href="https://scottzhang.pro/article/18dbdeeb.html">å•ä¾‹æ¨¡å¼åŠå…¶å®ç°åŸç†</a>ã€‚</p><h1 id="type-object-å’Œ-class-çš„å…³ç³»">type, object å’Œ class çš„å…³ç³»</h1><p>type æœ‰ä¸¤ç§ç”¨æ³•ï¼šä¸€ä¸ªæ˜¯ç”Ÿæˆä¸€ä¸ªç±»ï¼›å¦å¤–ä¸€ä¸ªæ˜¯æŸ¥çœ‹æŸä¸ªå¯¹è±¡çš„ç±»å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(<span class="number">1</span>)   <span class="comment"># class int</span></span><br><span class="line"><span class="built_in">type</span>(<span class="built_in">int</span>) <span class="comment"># class type</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># type -&gt; int -&gt;1</span></span><br><span class="line"><span class="comment"># type -&gt; class -&gt; obj</span></span><br></pre></td></tr></table></figure><p>object æ˜¯æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œobject çš„åŸºç±»æ˜¯ç©ºï¼Œ object æ˜¯ type ç”Ÿæˆçš„ã€‚</p><p>ä½† type æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼ŒåŒæ—¶ type ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œtype çš„åŸºç±»åˆæ˜¯ objectã€‚</p><p>ä¸ºäº†ç†è§£å…¶ä¸­çš„å…³ç³»ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><figure><img src="https://s2.loli.net/2022/01/09/NrGE3UmuzJpbdIk.png" alt="object, type and class" /><figcaption aria-hidden="true">object, type and class</figcaption></figure><ul><li>è™šçº¿æè¿°çš„æ˜¯å®ä¾‹å…³ç³»ï¼Œå®çº¿æè¿°çš„æ˜¯ç»§æ‰¿å…³ç³»</li><li>type åˆ›å»ºäº†æ‰€æœ‰çš„å¯¹è±¡ï¼›type ç»§æ‰¿è‡ª objectï¼Œè€Œ object åˆæ˜¯ type çš„ä¸€ä¸ªå®ä¾‹ï¼›type è¿˜æ˜¯è‡ªå·±çš„å®ä¾‹ï¼ˆè¿è‡ªå·±éƒ½ä¸æ”¾è¿‡ï¼‰ï¼›</li></ul><p>ä¸¾ä¾‹ï¼šlist ç»§æ‰¿è‡ª objectï¼Œ"abc" ç»§æ‰¿è‡ª str, str åˆç»§æ‰¿è‡ª objectï¼›listç±»ç»§æ‰¿è‡ª object ç±»ï¼ŒåŒæ—¶ list ä¹Ÿæ˜¯ type çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥å…¶å® list æ—¢æ˜¯ç±»ä¹Ÿæ˜¯å®ä¾‹ï¼Œå³ python ä¸­ä¸€åˆ‡çš†å¯¹è±¡çš„ä¸€ä¸ªç†è§£ã€‚</p><p>ä¸ºä»€ä¹ˆ list æ˜¯ä¸€ä¸ª classçš„åŒæ—¶ï¼Œä¹Ÿè¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºå¦‚æœå®ƒå˜æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ã€‚è€Œåœ¨é™æ€è¯­è¨€ä¸­ï¼Œç±»ä¸€æ—¦åˆ›å»ºæ”¾åˆ°å†…å­˜ä¸­ï¼Œä¿®æ”¹èµ·æ¥å°±å¾ˆéº»çƒ¦äº†ã€‚è€Œ python ä¸­å°†å…¶å˜æˆå¯¹è±¡ï¼Œå°±å¾ˆç®€å•äº†ã€‚</p><h1 id="é¸­å­ç±»å‹å’Œå¤šæ€">é¸­å­ç±»å‹å’Œå¤šæ€</h1><p>å½“ä½ çœ‹è§ä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±æ˜¯é¸­å­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;I am a dog&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;I am a Duck&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> [Dog, Duck]:</span><br><span class="line">    obj().say()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æŠ½è±¡åŸºç±»">æŠ½è±¡åŸºç±»</h1><p>æŠ½è±¡åŸºç±»ï¼Œå…¶ä»–ç±»å¯ä»¥ç»§æ‰¿æ­¤ç±»ï¼Œå¹¶å¿…é¡»è¦å®ç°å…¶è§„å®šçš„æ–¹æ³•ï¼ŒæŠ½è±¡åŸºç±»æœ¬èº«æ— æ³•å®ä¾‹åŒ–å‡ºä»»ä½•å¯¹è±¡ã€‚</p><p>åœ¨ Python ä¸­ï¼Œæ£€æŸ¥æŸä¸ªç±»æ˜¯å¦æœ‰æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ hasattr æ–¹æ³•æ£€æŸ¥ï¼Œæ¯”å¦‚:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, employee_list</span>):</span></span><br><span class="line">        self.employee = employee_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.employee)</span><br><span class="line"></span><br><span class="line">com = Company([<span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Google&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ hasattr æ£€æŸ¥ç±»æ˜¯å¦æœ‰æŸä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="built_in">hasattr</span>(com, <span class="string">&quot;__len__&quot;</span>)</span><br></pre></td></tr></table></figure><p>å…¶ç»“æœä¸ä¸‹é¢ä»£ç ä¸€è‡´ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sized</span><br><span class="line"><span class="comment"># é—®é¢˜ï¼šcom æ²¡æœ‰ç»§æ‰¿è‡ª Sizedï¼Œä¸ºä½•å¯ä»¥ä½¿ç”¨ isinstance åˆ¤æ–­ï¼Ÿ</span></span><br><span class="line"><span class="comment"># Sized å†…éƒ¨æœ‰ä¸€ä¸ª __subclasshot æ–¹æ³•ï¼Œå…¶ä¸­ä¼šç›´æ¥åˆ¤æ–­ com æœ‰æ²¡æœ‰ len æ–¹æ³•</span></span><br><span class="line"><span class="built_in">isinstance</span>(com, Sized)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ Sized æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚èƒŒåçš„é€»è¾‘æ˜¯ï¼Œcom å®ç°äº† <code>__len__</code> æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒç»§æ‰¿äº† Sized æŠ½è±¡åŸºç±»ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸ºçœŸã€‚</p><p>å¦å¤–ä¸€ç§æŠ½è±¡åŸºç±»çš„åº”ç”¨æ˜¯é™åˆ¶å­ç±»å¿…é¡»å®ç°æŸäº›æ–¹æ³•:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ½è±¡åŸºç±»ï¼šé™åˆ¶å­ç±»å¿…é¡»å®ç°æŸä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheBase</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self, key, value</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€ä¸ª RedisCache ç±»ï¼Œç»§æ‰¿è‡ª CacheBase</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisCache</span>(<span class="params">CacheBase</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– RedisCache</span></span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™æ­¥ä¸ä¼šæŠ¥é”™</span></span><br><span class="line">redis_cache = RedisCache()</span><br><span class="line"><span class="comment"># è°ƒç”¨ get æˆ–è€… set çš„æ—¶å€™æ‰ä¼šæŠ¥é”™</span></span><br><span class="line">redis_cache.get(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å¸Œæœ›åœ¨ RedisCache åˆå§‹åŒ–çš„æ—¶å€™å°±æŠ¥é”™ï¼Œåˆ™éœ€è¦ä½¿ç”¨ abc æŠ½è±¡åŸºç±»æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheBaseABC</span>(<span class="params">metaclass=abc.ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„ä¼šæŠ¥é”™</span></span><br><span class="line">redis_cache_abc = CacheBaseABC()</span><br></pre></td></tr></table></figure><blockquote><p>Python ä¸­ï¼Œabc æ¨¡å—ï¼Œæœ‰ç³»ç»Ÿå…¨å±€çš„abcï¼Œä¹Ÿæœ‰ collections.abc</p></blockquote><p>åœ¨å¹³æ—¶çš„ç¼–ç å®è·µä¸­ï¼Œæ³¨æ„ä¸è¦è¿‡åº¦ä¾èµ– abc æ¨¡å—ï¼Œå®¹æ˜“å¯¼è‡´è¿‡åº¦è®¾è®¡, å¯ä»¥è€ƒè™‘ä½¿ç”¨ mixin çš„æ–¹å¼ã€‚</p><h1 id="isinstance-å’Œ-type">isinstance å’Œ type</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">b = B()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ä¸¤ä¸ªéƒ½æ˜¯ true</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(b, B))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(b, A))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(b) <span class="keyword">is</span> B)</span><br><span class="line"><span class="comment"># ä¹Ÿæ˜¯ True</span></span><br><span class="line"><span class="comment"># æ³¨æ„ is å’Œ == çš„åŒºåˆ«</span></span><br><span class="line"><span class="comment"># is çš„æ„æ€æ˜¯ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå³ id() è¿”å›çš„å€¼æ˜¯ä¸æ˜¯ä¸€æ ·</span></span><br><span class="line"><span class="comment"># == çš„æ„æ€æ˜¯ï¼Œåˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰</span></span><br></pre></td></tr></table></figure><h1 id="ç±»å˜é‡ä¸å®ä¾‹å˜é‡">ç±»å˜é‡ä¸å®ä¾‹å˜é‡</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    z = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">a = A(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹ä¼šå‘ä¸ŠæŸ¥æ‰¾æ‰¾ä¸åˆ°çš„å€¼ï¼Œæ¯”å¦‚è¿™é‡Œçš„z</span></span><br><span class="line"><span class="built_in">print</span>(a.z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»è‡ªç„¶ä¹Ÿå¯ä»¥æ‰¾åˆ°å±äºè‡ªå·±çš„å€¼</span></span><br><span class="line"><span class="built_in">print</span>(A.z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»æ— æ³•æ‰¾åˆ°å±äºå®ä¾‹çš„å€¼, æ­¤å¤„æŠ¥é”™</span></span><br><span class="line"><span class="built_in">print</span>(a.x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å®ä¾‹çš„å€¼ï¼Œå¹¶ä¸ä¼šä¿®æ”¹ç±»ä¸­çš„å€¼</span></span><br><span class="line">a.z = <span class="number">99</span></span><br><span class="line"><span class="built_in">print</span>(a.z)  <span class="comment"># 99</span></span><br><span class="line"><span class="built_in">print</span>(A.z)     <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åˆ›å»ºä¹‹å‰ï¼Œä¿®æ”¹ç±»å†…éƒ¨çš„å€¼ï¼Œå®ä¾‹çš„å€¼ä¹Ÿä¼šå˜åŒ–</span></span><br><span class="line">A.z = <span class="number">100</span></span><br><span class="line">a = A(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">a.z  <span class="comment"># 100</span></span><br></pre></td></tr></table></figure><h1 id="å±æ€§å’ŒæŸ¥æ‰¾é¡ºåº">å±æ€§å’ŒæŸ¥æ‰¾é¡ºåº</h1><p>å±æ€§åˆ†ä¸ºç±»å±æ€§ã€å®ä¾‹å±æ€§ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ä¾‹ä¸å­˜åœ¨çš„å±æ€§ï¼Œåœ¨ç±»ä¸­è‹¥å¯ä»¥æ‰¾åˆ°åˆ™ä¼šè¢«è¿”å›ï¼Œè¿™ä¸ªæŸ¥æ‰¾é¡ºåºæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>ç®€å•çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœæ²¡æœ‰å®ä¾‹çš„ name ä¼šä½¿ç”¨ç±»çš„ nameï¼Œå³ Aã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">&quot;A&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;obj&quot;</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.name <span class="comment"># obj</span></span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæ˜¯å¤šç»§æ‰¿æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼ŒA æ˜¯B, C, D, Eçš„çˆ¶ç±»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">D     E</span><br><span class="line">|     |</span><br><span class="line">B     C</span><br><span class="line"> \   /</span><br><span class="line">   A</span><br><span class="line"></span><br><span class="line"># DFS çš„æœç´¢é¡ºåº</span><br><span class="line">Deep First Search(DFS): A -&gt; B -&gt; D -&gt; C -&gt; E</span><br><span class="line"></span><br><span class="line">   D</span><br><span class="line"> /   \</span><br><span class="line">B     C</span><br><span class="line"> \   /</span><br><span class="line">   A</span><br><span class="line"></span><br><span class="line"># DFS å­˜åœ¨çš„é—®é¢˜</span><br><span class="line">è¿™é‡Œçš„æœç´¢é¡ºåºæ˜¯A -&gt; B -&gt; D -&gt; C</span><br><span class="line">C ä¸­æœ‰ä¸€ä¸ªå‡½æ•°æ˜¯é‡è½½ D çš„ï¼Œä¼šå¯¼è‡´æ— æ³•é‡è½½</span><br><span class="line"></span><br><span class="line"># å¼•å…¥å¹¿åº¦ä¼˜å…ˆç®—æ³•</span><br><span class="line">å¯¹äºå›¾2ï¼ŒBFS: A -&gt; B -&gt; C -&gt; D</span><br><span class="line">å¯¹äºå›¾2ï¼Œåˆæœ‰äº†æ–°é—®é¢˜ï¼Œå‡è®¾ Bï¼ŒCï¼ŒD éƒ½æœ‰ä¸€ä¸ª get æ–¹æ³•</span><br><span class="line">é‚£ä¹ˆå¦‚æœ B æ‰¾ä¸åˆ°ï¼Œå¹¿åº¦ä¼˜å…ˆä¼šå» C ä¸­æ‰¾ï¼ŒC çš„ get å°±ä¼šè¦†ç›– D çš„</span><br><span class="line">æŒ‰ç†è¯´åº”è¯¥ B å’Œ D æ˜¯ä¸€å—</span><br><span class="line"></span><br><span class="line"># å¼•å…¥ C3 ç®—æ³•</span><br><span class="line"># todo</span><br><span class="line"></span><br><span class="line">åœ¨ python ä¸­ï¼Œå¯ä»¥é€šè¿‡ class.__mro__ æŸ¥çœ‹æŸ¥æ‰¾é¡ºåº</span><br></pre></td></tr></table></figure><h1 id="å¤šç»§æ‰¿">å¤šç»§æ‰¿</h1><p>Python ä¹Ÿæ”¯æŒå¤šçº¿ç¨‹ï¼Œä¸è¿‡æ›´æ¨èä½¿ç”¨ Mixin çš„æ¨¡å¼ã€‚</p><p>æœ¬è´¨ä¸Šè¯´å°±æ˜¯è®©ä½ çš„ç±»ç»§æ‰¿è‡ªå„ç§å•ä¸€åŠŸèƒ½çš„ç±»ã€‚å¯ä»¥ç®€å•ç†è§£ä¸º java ä¸­çš„å‡½æ•°ï¼Œè®¾è®¡æ¨¡å¼ä¸­çš„ç»„åˆæ¨¡å¼ã€‚</p><p>åœ¨è®¾è®¡ mixin ç±»çš„æ—¶å€™ï¼Œå°½é‡è®©å®ƒåŠŸèƒ½å•ä¸€ï¼›ä¸è¦è®©å®ƒå’ŒåŸºç±»å…³è”ï¼Œè¿™æ ·å°±å¯ä»¥å’Œä»»æ„åŸºç±»ç»„åˆï¼›å…¶æ¬¡åœ¨ mixin ä¸­ï¼Œä¸è¦ä½¿ç”¨ super è¿™ç§ç”¨æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># minxin.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListDirMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListFileMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> minxin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>(<span class="params">mixin.ListDirMixin, mixin.ListFileMixin</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨">ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h1><p>é¦–å…ˆé€šè¿‡ä¸¤æ®µä»£ç æ¥çœ‹ try except åœ¨ Python ä¸­çš„å·¥ä½œæœºåˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€ä¸ªæ•æ‰å¼‚å¸¸çš„ä¾‹å­</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> KeyError</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;KeyError&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>try è¿˜å¯ä»¥æœ‰å…¶ä»–çš„é€»è¾‘åˆ†æ”¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœ raise çš„ Error å’Œ except çš„ä¸ä¸€æ ·åˆ™æ— æ³•æ•æ‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> IndexError</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;KeyError&quot;</span>)</span><br><span class="line"><span class="comment"># elseï¼Œtry å†…æ²¡æœ‰ raise errorï¼Œæ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ°¸è¿œä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Other Error&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># finally æ°¸è¿œéƒ½ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Always run&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨ python æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ€åä¸ç®¡å¦‚ä½•éƒ½éœ€è¦å…³é—­è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯èƒ½ä¼šåœ¨ try ä¸­æ‰“å¼€å¹¶è¯»å–æ–‡ä»¶ï¼Œ ç„¶ååœ¨ finally ä¸­å…³é—­è¯¥æ–‡ä»¶ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœä½ åœ¨ try ä¸­æ‰“å¼€æ–‡ä»¶ä¹‹å‰æŠ¥é”™äº†ï¼Œé‚£ä¹ˆåœ¨ finally ä¸­åˆ™ä¼šæ— æ³•å…³é—­è¯¥æ–‡ä»¶ï¼Œå› ä¸ºæ–‡ä»¶å¯¹è±¡ è¿˜æ²¡æ¥å¾—åŠåˆ›å»ºã€‚</p><p>å†æ¥ä¸€ä¸ªä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">try_test</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">raise</span> IndexError</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºä»€ä¹ˆè¿”å› 4 ï¼Ÿ</span></span><br><span class="line"><span class="comment"># å¦‚æœæœ‰ finally è¯­å¥ï¼Œå°±ä¼šè¿”å› finally ä¸­çš„å€¼ï¼Œå³ 4</span></span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›ä¹‹å‰ return è¿”å›çš„å€¼ï¼Œå³ 2</span></span><br><span class="line">try_test()</span><br></pre></td></tr></table></figure><p>with è¯­å¥çš„å‡ºç°ï¼Œå¯ä»¥ç®€åŒ–æˆ‘ä»¬çš„ try, finally çš„ä½¿ç”¨ã€‚è€Œ with è¯­å¥æœ¬èº«å±äºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ä¸€ç§å®ç°ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒéµä»äº†ä¸€ç§ç±»åè®®ï¼ˆå®ç°äº† 2 ä¸ªé­”æ³•å‡½æ•°).</p><p>è¿™é‡Œæ¶‰åŠäº†ä¸¤ä¸ªé­”æ³•å‡½æ•°, <code>__enter__</code>, <code>__exit__</code>ã€‚ï¼ˆé­”æ³•å‡½æ•°å°†ä¼šåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« æ›´æ–°ï¼‰</p><p>å¦‚æœä½ å®ç°äº†æŸä¸ªç±»çš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå³å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ with è¯­å¥è°ƒç”¨ä½ çš„ç±»ï¼Œæ¯”å¦‚:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sample</span>:</span></span><br><span class="line">    <span class="comment"># è¿›å…¥ with çš„æ—¶å€™ï¼Œå…ˆè°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;enter&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·³å‡º with è¯­å¥åä¼šè‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_something</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;doing something&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Sample() <span class="keyword">as</span> sample:</span><br><span class="line">    sample.do_something()</span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥é€šè¿‡ contextlib è¿›ä¸€æ­¥ç®€åŒ–ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™æ˜¯ python æä¾›çš„å†…ç½®æ¨¡å—, å®ƒå¯ä»¥å°†ä¸€ä¸ª å‡½æ•°å˜æˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_open</span>(<span class="params">file_name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;open a file&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> &#123;&#125;  <span class="comment"># å¿…é¡»ä½¿ç”¨ç”Ÿæˆå™¨</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;exit logic&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> file_open(<span class="string">&quot;file.txt&quot;</span>) <span class="keyword">as</span> f_opend:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;processing...&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ·±å…¥ç†è§£ Python ä¸­çš„ç±»ä¸å¯¹è±¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£ Python ä¸€åˆ‡çš†å¯¹è±¡</title>
    <link href="https://scottzhang.pro/article/7cdaf89.html"/>
    <id>https://scottzhang.pro/article/7cdaf89.html</id>
    <published>2022-01-16T13:14:17.000Z</published>
    <updated>2022-02-15T09:50:15.679Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼ŸPython ä¸­çš„å¯¹è±¡åˆä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„å¯¹è±¡æœ‰ä½•ä¸åŒï¼Ÿ</p></blockquote><span id="more"></span><h1 id="ä»€ä¹ˆæ˜¯å¯¹è±¡">ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿ</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹è±¡æŒ‡çš„æ˜¯æ‹¥æœ‰æ•°æ®ï¼ˆæˆ–å±æ€§ï¼‰å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•çš„ä¸€ä¸ªå®ä½“ã€‚</p><p>ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¯¹å®ƒçš„å®šä¹‰ä¸ä¸€æ ·ï¼Œæœ‰çš„ç¼–ç¨‹è¯­è¨€è§„å®šå¯¹è±¡å¿…é¡»æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œæœ‰çš„ç¼–ç¨‹è¯­è¨€åˆ™è§„å®šå¯¹è±¡å¿…é¡»æ˜¯subclassable çš„ï¼ˆæš‚æ—¶æ²¡æƒ³åˆ°ä¸­æ–‡ï¼‰ï¼ŒPython çš„å®šä¹‰åˆ™æ¯”è¾ƒå®½æ¾ï¼Œå› ä¸º Python ä¸­ä¸è¦æ±‚å¯¹è±¡ä¸€å®šè¦æœ‰æ•°æ®æˆ–æ–¹æ³•ï¼Œä¹Ÿä¸è¦æ±‚å¯¹è±¡æ˜¯ subclassable çš„ã€‚</p><h1 id="ä¸€åˆ‡çš†å¯¹è±¡">ä¸€åˆ‡çš†å¯¹è±¡</h1><p>åœ¨å…¶ä»–çš„é™æ€è¯­è¨€ä¸­ï¼Œæœ‰å¯¹è±¡å’Œç±»ï¼Œå¯¹è±¡æ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½†æ˜¯åœ¨ Python ä¸­ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯å¯¹è±¡ã€‚</p><p>â€œPython ä¸­ä¸€åˆ‡çš†å¯¹è±¡â€è¿™å¥è¯ï¼Œå®ƒçš„æ„æ€æš—ç¤ºäº†åœ¨ Python ä¸­ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ˜¯å¯¹è±¡ï¼Œstring, list, å‡½æ•°ã€ç±»ç”šè‡³æ˜¯æ¨¡å—éƒ½æ˜¯å¯¹è±¡ï¼Œå±äº Python çš„ä¸€ç­‰å…¬æ°‘ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ï¼š</p><ul><li>è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</li><li>å¯ä»¥æ·»åŠ åˆ°é›†åˆå¯¹è±¡ä¸­</li><li>å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°</li><li>å¯ä»¥å½“ä½œå‡½æ•°çš„è¿”å›å€¼</li></ul><p>è¿™å°±æä¾›äº†ä¸€ç§åŠ¨æ€æ€§ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ä¿®æ”¹å®ƒã€‚</p><blockquote><p>å¯¹è±¡çš„ä¸‰ä¸ªç‰¹å¾ï¼šèº«ä»½(å†…å­˜ä¸­çš„åœ°å€)ã€ç±»å‹ï¼ˆ1 æ˜¯ int ç±»å‹ï¼‰ã€å€¼ï¼ˆa=1 ä¸­çš„1ï¼‰ã€‚</p></blockquote><h1 id="ä»¥-list-ä¸ºä¾‹">ä»¥ list ä¸ºä¾‹</h1><p>å¯¹è±¡æœ‰æ•°æ®å’Œæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">x = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># type å¯ä»¥å‘Šè¯‰æˆ‘ä»¬å˜é‡å±äºä»€ä¹ˆå¯¹è±¡</span></span><br><span class="line"><span class="comment"># output: int</span></span><br><span class="line"><span class="built_in">type</span>(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ x å¯¹è±¡çš„ä¸€ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment"># å¯¹äº Int ç±»å‹ï¼Œå®ƒæœ‰ Real and imaginary part of the value</span></span><br><span class="line"><span class="comment"># if viewed as a complex number</span></span><br><span class="line"><span class="built_in">print</span>(x.real)</span><br><span class="line"><span class="built_in">print</span>(x.imag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ x å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="built_in">print</span>(x.is_integer())</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬è¯´ä¸€åˆ‡çš†å¯¹è±¡ï¼ŒçœŸçš„å°±æ˜¯æ‰€æœ‰éƒ½æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ x.is_interger è¿™ä¸ªæ–¹æ³•æœ¬èº«ï¼Œä¹Ÿæ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="comment"># output: builtin_function_or_method</span></span><br><span class="line"><span class="built_in">type</span>(x.is_interger)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ä»¥å‡½æ•°ä¸ºä¾‹">ä»¥å‡½æ•°ä¸ºä¾‹</h1><p>å¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥å°†å®ƒèµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡å°†æ‹¥æœ‰å¯¹è¿™ä¸ªå‡½æ•°çš„å¼•ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°èµ‹å€¼ç»™æ–°çš„å˜é‡</span></span><br><span class="line">my_add = add</span><br><span class="line">my_add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°ä½œä¸ºå‚æ•°è¿”å›</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_number_creator</span>(<span class="params">number</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_number</span>(<span class="params">a</span>):</span></span><br><span class="line">        <span class="keyword">return</span> a+ number</span><br><span class="line">    <span class="keyword">return</span> add_number</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ">å‚è€ƒ</h1><ul><li><a href="https://www.codingninjas.com/blog/2020/08/27/how-everything-in-python-is-an-object/">How everything in Python is an Object?</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼ŸPython ä¸­çš„å¯¹è±¡åˆä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„å¯¹è±¡æœ‰ä½•ä¸åŒï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
  </entry>
  
  <entry>
    <title>Python Socket å…¥é—¨</title>
    <link href="https://scottzhang.pro/article/4317dd1.html"/>
    <id>https://scottzhang.pro/article/4317dd1.html</id>
    <published>2022-01-15T13:43:59.000Z</published>
    <updated>2022-02-15T09:50:15.676Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« å¸¦ä½ äº†è§£å¦‚ä½•å»ºç«‹ Python Socket æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„å¤šç”¨æˆ·èŠå¤©ç¨‹åºï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Socket æ¨¡æ‹Ÿ http è¯·æ±‚ã€‚</p></blockquote><span id="more"></span><h1 id="ç†è®ºä»‹ç»">ç†è®ºä»‹ç»</h1><p>è®¡ç®—æœºç½‘ç»œåŸºç¡€çŸ¥è¯†ï¼Œæ¨èä¸€æœ¬ä¹¦ã€ŠTCP/IP è¯¦è§£ã€‹ã€‚</p><p>HTTPï¼ŒSocketï¼ŒTCP çš„åŒºåˆ«ï¼ŒHTTP æ˜¯åº”ç”¨å±‚çš„åè®®ã€‚Socketå¯ç†è§£ä¸ºæ“ä½œç³»ç»Ÿæä¾›çš„åº”ç”¨å±‚ä¸ä¼ è¾“å±‚æ‰“äº¤é“çš„æ’åº§ã€‚è€Œ TCP å±äºä¼ è¾“å±‚ã€‚ é€šè¿‡ Socket ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±ä¸ä¼ è¾“å±‚æ‰“äº¤é“ï¼Œå®šä¹‰è‡ªå·±çš„åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p>Client ç«¯æ¶‰åŠçš„æ“ä½œï¼š</p><figure><img src="https://s2.loli.net/2022/01/15/sXuIOz8T12n5DfB.png" alt="Socketç¼–ç¨‹" /><figcaption aria-hidden="true">Socketç¼–ç¨‹</figcaption></figure><p>æœåŠ¡ç«¯ï¼š</p><ul><li>socketï¼šsocket æ˜¯åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´çš„æ¥å£ï¼Œä¼ è¾“å±‚æœ‰ tcp å’Œ udpï¼›</li><li>bind(åè®®ï¼Œåœ°å€ï¼Œç«¯å£)ï¼šåœ°å€å¯åœ¨æœ¬æœº IPï¼Œä¹Ÿå¯ä»¥æŒ‡å®šï¼›æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåªèƒ½å ç”¨ä¸€ä¸ªç«¯å£ï¼Œç½‘ç»œ æ¥çš„æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿä¼šè½¬å‘ç»™ç›¸åº”çš„ç«¯å£ã€‚</li><li>listen(ç›‘å¬å®¢æˆ·ç«¯ socket è¯·æ±‚)</li><li>accept()</li><li>é˜»å¡ç­‰å¾…è¿ç»­è¯·æ±‚ï¼ˆæ–°å¥—æ¥å­—ï¼‰</li><li>recv()</li><li>send(), socket å»ºç«‹äº†è¿æ¥åï¼Œå¯ä»¥ä¸€ç›´å‘é€æ•°æ®ï¼›http åˆ™ä¸è¡Œã€‚</li><li>close()</li></ul><p>å®¢æˆ·ç«¯ï¼š</p><ul><li>socket</li><li>connect()</li><li>send()</li><li>recv()</li><li>close()</li></ul><h1 id="socket-å®ç°èŠå¤©">Socket å®ç°èŠå¤©</h1><p>æ¥çœ‹ä¸€ä¸ª socket å®ç°èŠå¤©çš„ä¾‹å­ï¼Œç¬¬ä¸€ä¸ªæ˜¯æœåŠ¡ç«¯çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># A Socket Server</span></span><br><span class="line"><span class="comment"># å…ˆå¯åŠ¨ Serverï¼Œå¦åˆ™ Client ä¼šæ— æ³•è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">respond</span>(<span class="params">client</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨ä¼ å…¥å¯¹è±¡ client çš„å‘é€æ–¹æ³•ï¼Œä½œå‡ºâ€œå›åº”â€.  &quot;&quot;&quot;</span></span><br><span class="line">    response_str = <span class="built_in">input</span>(<span class="string">&quot;New msg:&quot;</span>)</span><br><span class="line">    response_str = <span class="string">&quot;From Server, Admin:&quot;</span> + response_str</span><br><span class="line">    client.send(<span class="built_in">bytes</span>(response_str, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">server.bind((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">2401</span>))</span><br><span class="line">server.listen()</span><br><span class="line">sock_client, addr = server.accept()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ‰æ˜¯ç”¨æˆ·æ‹¿åˆ°çš„ sockï¼Œä¸Šé¢çš„ server åˆ™æ˜¯ç”¨æ¥ç›‘å¬çš„</span></span><br><span class="line">    data = sock_client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data.decode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">    respond(sock_client)</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å®¢æˆ·ç«¯çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># Client, ç¬¬ä¸€æ¬¡ä¼šå°è¯•è¿æ¥ Server Say Hi</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">2401</span>))</span><br><span class="line">client.send(<span class="string">f&quot;From Client, Scott: Hi!&quot;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯ï¼Œå…ˆå‘ä¿¡æ¯</span></span><br><span class="line">    data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">    client_id = <span class="string">&quot;From Client, Scott:&quot;</span></span><br><span class="line">    client_new_msg = client_id + <span class="built_in">input</span>(<span class="string">&quot;New msg:&quot;</span>)</span><br><span class="line">    client.send(client_new_msg.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br></pre></td></tr></table></figure><p>å½“å®¢æˆ·ç«¯èµ·æ¥ä¹‹åï¼ŒæœåŠ¡ç«¯ä¼šæ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œæ¥çœ‹çœ‹ä»–ä»¬çš„å¯¹è¯å§ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># æœåŠ¡ç«¯</span><br><span class="line">From Client, Scott: Hi!</span><br><span class="line">New msg:Hi Scott!</span><br><span class="line">From Client, Scott:Are you admin from the server?</span><br><span class="line">New msg:Yes, i am.</span><br><span class="line">From Client, Scott:Nice to meet you!!!</span><br><span class="line">New msg:Me too. How can i help you?</span><br><span class="line">From Client, Scott:Just test the connection, bye~</span><br><span class="line">New msg:Ok, Have a great day!</span><br><span class="line">From Client, Scott:You too!</span><br><span class="line"></span><br><span class="line"># å®¢æˆ·ç«¯</span><br><span class="line">From Server, Admin:Hi Scott!</span><br><span class="line">New msg:Are you admin from the server?</span><br><span class="line">From Server, Admin:Yes, i am.</span><br><span class="line">New msg:Nice to meet you!!!</span><br><span class="line">From Server, Admin:Me too. How can i help you?</span><br><span class="line">New msg:Just test the connection, bye~</span><br><span class="line">From Server, Admin:Ok, Have a great day!</span><br><span class="line">New msg:You too!</span><br></pre></td></tr></table></figure><h1 id="socket-å®ç°å¤šç”¨æˆ·èŠå¤©">Socket å®ç°å¤šç”¨æˆ·èŠå¤©</h1><p>ä¸Šé¢çš„ server åªæ”¯æŒä¸€ä¸ªç”¨æˆ·ï¼Œå¦‚ä½•æ”¯æŒå¤šä¸ªç”¨æˆ·å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ¥å®ç°ï¼ŒèƒŒåçš„æ€æƒ³æ˜¯ï¼Œæ¯å½“é‡åˆ°ä¸€ä¸ªæ–°çš„è¿æ¥ è¯·æ±‚ï¼Œå°±è®©ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†, ä¹Ÿå°±æ˜¯è¿™ä¸€æ®µ <code>sock_client, addr = server.accept()</code> äº¤ç»™ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹çš„ serverï¼Œå®¢æˆ·ç«¯çš„ä»£ç æ˜¯ä¸€æ ·çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># A Socket Server</span></span><br><span class="line"><span class="comment"># å…ˆå¯åŠ¨ Serverï¼Œå¦åˆ™ Client ä¼šæ— æ³•è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">respond</span>(<span class="params">client</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨ä¼ å…¥å¯¹è±¡ client çš„å‘é€æ–¹æ³•ï¼Œä½œå‡ºâ€œå›åº”â€.  &quot;&quot;&quot;</span></span><br><span class="line">    response_str = <span class="built_in">input</span>(<span class="string">&quot;New msg:&quot;</span>)</span><br><span class="line">    response_str = <span class="string">&quot;From Server, Admin:&quot;</span> + response_str</span><br><span class="line">    client.send(<span class="built_in">bytes</span>(response_str, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_sock</span>(<span class="params">sock_client, addr</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># è¿™é‡Œæ‰æ˜¯ç”¨æˆ·æ‹¿åˆ°çš„ sockï¼Œä¸Šé¢çš„ server åˆ™æ˜¯ç”¨æ¥ç›‘å¬çš„</span></span><br><span class="line">        data = sock_client.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(data.decode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">        respond(sock_client)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server.bind((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">2401</span>))</span><br><span class="line">    server.listen()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sock_client, addr = server.accept()</span><br><span class="line">        <span class="comment"># ç”¨çº¿ç¨‹å¤„ç†æ–°æ¥çš„ç”¨æˆ·</span></span><br><span class="line">        client_thread = threading.Thread(</span><br><span class="line">            target=handle_sock,</span><br><span class="line">            args=(sock_client, addr)</span><br><span class="line">        )</span><br><span class="line">        client_thread.start()</span><br></pre></td></tr></table></figure><p>æ¥çœ‹æœåŠ¡ç«¯ä¸ä¸åŒå®¢æˆ·ç«¯çš„é€šä¿¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">From Client 1, Scott: Hi!</span><br><span class="line">New msg:Hi Scott!</span><br><span class="line">From Client 2, The Weeknd: Hi!</span><br><span class="line">New msg:Hi The Weeknd!</span><br><span class="line">From Client 1, Scott:I really like the weeknd!</span><br><span class="line">New msg:Me too!</span><br><span class="line">From Client 2, The Weeknd:I just adds three tracks to my new album: Dawn FM.</span><br><span class="line">New msg:Great!</span><br></pre></td></tr></table></figure><h1 id="socket-æ¨¡æ‹Ÿ-http-è¯·æ±‚">Socket æ¨¡æ‹Ÿ http è¯·æ±‚</h1><p>ä½ åº”è¯¥å¬è¯´è¿‡ Python ä¸­ request è¿™ä¸ªåŒ…ï¼Œå®ƒå…¶å®åº•å±‚æ˜¯ä¾èµ– urllib å®ç°çš„ï¼Œè€Œ urllib åˆæ˜¯ä¾èµ–äº socketã€‚</p><p>æ—¢ç„¶æ˜¯æ¨¡æ‹Ÿ http è¯·æ±‚ï¼Œè¿˜æ˜¯éœ€è¦åš url è§£æï¼Œæˆ‘ä»¬å°†ä¼šç”¨åˆ° urllib ä¸­çš„éƒ¨åˆ†å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment"># è§£æ url</span></span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    host = url.netloc   <span class="comment"># host</span></span><br><span class="line">    path = url.path     <span class="comment"># å­è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">&quot;&quot;</span>:      <span class="comment"># å­è·¯å¾„ä¸ºç©º</span></span><br><span class="line">        path = <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å»ºç«‹ socket è¿æ¥, ä¸€èˆ¬ç½‘ç«™éƒ½ä½¿ç”¨ 8000 ç«¯å£</span></span><br><span class="line">    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    client.connect((host, <span class="number">80</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„é€ è¯·æ±‚å†…å®¹ï¼Œå¹¶å¼€å§‹å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="comment"># å…³äºè¯·æ±‚çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡ Chrome çš„è°ƒè¯•å·¥å…·æ‰“å¼€ç›®æ ‡ç½‘ç«™</span></span><br><span class="line">    <span class="comment"># å†æŸ¥çœ‹ Headersï¼Œå…·ä½“æŸä¸ªç½‘ç«™å¿…é¡»æ„é€ å“ªäº›è¯·æ±‚å†…å®¹ï¼Œå„æœ‰ä¸åŒ</span></span><br><span class="line">    <span class="comment"># æ¯”å¦‚ç™¾åº¦å¿…é¡»æœ‰: host, connection,</span></span><br><span class="line">    client.send(</span><br><span class="line">        <span class="string">&quot;GET &#123;&#125; HTTP/1.1\r\nHost:&#123;&#125;\r\nConnection:close\r\n\r\n&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            path, host</span><br><span class="line">    ).encode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿”å›çš„æ•°æ®ä¸ä¸€å®šæ˜¯ 1024ï¼Œ æœ‰å¯èƒ½æ˜¯ &gt; 1024 çš„</span></span><br><span class="line">    <span class="comment"># client.recv(1024), è¿™æ ·å†™ä¼šå‡ºé—®é¢˜ï¼Œç‰¹æ®Šå¤„ç†ä¸€ä¸‹</span></span><br><span class="line">    data = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># å…ˆæ¥å— 1024 ä¸ªæ•°æ®</span></span><br><span class="line">        d = client.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> d:</span><br><span class="line">            data += d</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    data = data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    client.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_url(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¸¦ä½ äº†è§£å¦‚ä½•å»ºç«‹ Python Socket æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„å¤šç”¨æˆ·èŠå¤©ç¨‹åºï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Socket æ¨¡æ‹Ÿ http è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
  </entry>
  
  <entry>
    <title>Python æµ…æ‹·è´ä¸æ·±æ‹·è´</title>
    <link href="https://scottzhang.pro/article/c5dc05db.html"/>
    <id>https://scottzhang.pro/article/c5dc05db.html</id>
    <published>2022-01-15T13:38:58.000Z</published>
    <updated>2022-02-15T09:50:15.677Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« ä»¥ listï¼Œdictï¼Œclass ä¸ºä¾‹ï¼Œå¸¦ä½ äº†è§£ Python ä¸­çš„æµ…æ‹·è´ä¸æ·±æ‹·è´ã€‚</p></blockquote><span id="more"></span><h1 id="å˜é‡ä¸æŒ‡é’ˆ">å˜é‡ä¸æŒ‡é’ˆ</h1><p>åœ¨ç†è§£ä¸‹é¢çš„ä¾‹å­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Python ä¸­çš„å˜é‡æœ‰ä¸€ä¸ªåŸºæœ¬çš„ç†è§£ã€‚</p><p>å¯¹å˜é‡èµ‹å€¼ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ç†è§£ä¸ºå¼€è¾Ÿä¸€ä¸ªåŒºåŸŸï¼ˆç†è§£ä¸ºå®¹å™¨ã€æˆ–è€…æ˜¯ä¸€ä¸ªç¯®å­ï¼‰ï¼Œå†å°†å€¼æ”¾è¿›å»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C è¯­è¨€ï¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªåŒºåŸŸï¼Œå°†å€¼æ”¾è¿›å»</span></span><br><span class="line"><span class="keyword">int</span> x <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ Python ä¸­ï¼Œå†™æ³•æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æœ€å¥½çš„ç†è§£æ˜¯å°†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†è¿™ä¸ªåŒºåŸŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pythonï¼šå®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆ xï¼ŒæŒ‡å‘äº†å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªåŒ…å« 4 çš„å®¹å™¨çš„åœ°æ–¹</span></span><br><span class="line">x = <span class="number">4</span></span><br></pre></td></tr></table></figure><p>å› ä¸º Python å˜é‡ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™ä¸ªå†…å­˜åŒºåŸŸï¼Œæ‰€ä»¥æ— éœ€æå‰å£°æ˜å¥½å˜é‡æ˜¯ä»€ä¹ˆç±»å‹ï¼ŒæŒ‡é’ˆä¸­é—´ä¹Ÿå¯ä»¥æŒ‡å‘åˆ«çš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯äººä»¬è¯´çš„ Python çš„åŠ¨æ€ç±»å‹ã€‚</p><p>æ‰€ä»¥ä½ å¯ä»¥è¿™ä¹ˆåš:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span>         <span class="comment"># x is an integer</span></span><br><span class="line">x = <span class="string">&#x27;hello&#x27;</span>   <span class="comment"># now x is a string</span></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment"># now x is a list</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åŠ¨æ€ç±»å‹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å¦‚æœä¸¤ä¸ªå˜é‡åæŒ‡å‘åŒä¸€ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆä¸€ä¸ªå˜é‡æ‰€åšçš„ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªå˜é‡æ‰€æŒ‡å‘çš„å€¼ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>ä¸‹é¢æ¥çœ‹å…·ä½“çš„ä¾‹å­ï¼š</p><h1 id="ä»¥-list-ä¸ºä¾‹">ä»¥ list ä¸ºä¾‹</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------- æµ…æ‹·è´ ------------------ #</span></span><br><span class="line"><span class="comment"># æ„é€ ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- New List XS, YS&quot;</span>)</span><br><span class="line">xs = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]</span><br><span class="line">ys = <span class="built_in">list</span>(xs)  <span class="comment"># Make a shallow copy</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span> , xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ys:&quot;</span>, ys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ xs æ·»åŠ å…ƒç´ : ä¸ä¼šå½±å“ ys</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Append Element To XS&quot;</span>)</span><br><span class="line">xs.append([<span class="string">&#x27;I am new&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span> , xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ys:&quot;</span>, ys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ xs ä¿®æ”¹å…ƒç´ ï¼šä¸¤è€…éƒ½ä¼šå½±å“</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Modified To XS&quot;</span>)</span><br><span class="line">xs[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">&#x27;x&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span> , xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ys:&quot;</span>, ys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ yx ä¿®æ”¹å…ƒç´ ï¼šä¸¤è€…ä¼šå½±å“</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Modified To YS&quot;</span>)</span><br><span class="line">ys[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&#x27;y&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span> , xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ys:&quot;</span>, ys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------------- Deep Copy --------------- #</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">zs = copy.deepcopy(xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Deep Copy ZS from XS&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span>, xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;zs:&quot;</span>, zs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ zs ä¿®æ”¹å…ƒç´ ï¼Œä¸ä¼šå½±å“ xz</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Modified To ZS&quot;</span>)</span><br><span class="line">zs[<span class="number">2</span>][<span class="number">0</span>] = <span class="string">&#x27;z&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span> , xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;zs:&quot;</span>, zs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ xs ä¿®æ”¹å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå½±å“ xs</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------- Modified To XS&quot;</span>)</span><br><span class="line">xs[<span class="number">2</span>][<span class="number">1</span>] = <span class="string">&#x27;z&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;xs:&quot;</span>, xs)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;zs:&quot;</span>, zs)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">--------- New List XS, YS</span><br><span class="line">xs: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span><br><span class="line">ys: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span><br><span class="line"></span><br><span class="line">--------- Append Element To XS</span><br><span class="line">xs: [[1, 2, 3], [4, 5, 6], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">ys: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span><br><span class="line">--------- Modified To XS</span><br><span class="line">xs: [[1, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">ys: [[1, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9]]</span><br><span class="line">--------- Modified To YS</span><br><span class="line">xs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">ys: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9]]</span><br><span class="line"></span><br><span class="line">--------- Deep Copy ZS from XS</span><br><span class="line">xs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">zs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">--------- Modified To ZS</span><br><span class="line">xs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">zs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [&#x27;z&#x27;, 8, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">--------- Modified To XS</span><br><span class="line">xs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [7, &#x27;z&#x27;, 9], [&#x27;I am new&#x27;]]</span><br><span class="line">zs: [[&#x27;y&#x27;, 2, 3], [4, 5, &#x27;x&#x27;], [&#x27;z&#x27;, 8, 9], [&#x27;I am new&#x27;]]</span><br></pre></td></tr></table></figure><h1 id="ä»¥-dict-ä¸ºä¾‹">ä»¥ dict ä¸ºä¾‹</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ª dictï¼Œç”¨æ¥æ¼”ç¤ºæ·±æ‹·è´ä¸æµ…æ‹·è´</span></span><br><span class="line">d = &#123;</span><br><span class="line">    <span class="string">&#x27;name1&#x27;</span>: &#123;<span class="string">&quot;scott zhang&quot;</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="string">&#x27;name2&#x27;</span>: &#123;<span class="string">&quot;the weeknd&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;A new dict:&quot;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ d ä¸­ name1 çš„ id</span></span><br><span class="line">d_id = <span class="built_in">id</span>(d[<span class="string">&#x27;name1&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(d_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ…æ‹·è´ï¼Œæ›´è¯¦ç»†çš„è¯´æ˜¯</span></span><br><span class="line"><span class="comment"># å°† d[&#x27;name1&#x27;] æ‰€åœ¨å†…å­˜åŒºåŸŸçš„åœ°å€ç»‘å®šç»™ d_copy1</span></span><br><span class="line"><span class="comment"># æ‘˜è‡ª realpythonï¼š</span></span><br><span class="line"><span class="comment"># (Assignment statements in Python do not create copies of objects</span></span><br><span class="line"><span class="comment"># they only bind names to an object.)</span></span><br><span class="line"><span class="comment"># æµ…æ‹·è´å†…éƒ¨å€¼åªæ˜¯æŒ‡é’ˆ, æ‰€ä»¥å¯¹ d_copy1 å†…éƒ¨ name1 å­—å…¸å†…çš„ä¿®æ”¹ï¼Œä¼šå°† d ä¸­çš„å€¼ä¹Ÿä¿®æ”¹</span></span><br><span class="line">d_copy1 = d.copy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¼”ç¤º</span></span><br><span class="line"><span class="comment"># å¯¹ copy è¿‡æ¥çš„ dict ä¿®æ”¹ï¼Œå†æ‰“å°åŸæ¥çš„æ•°æ®</span></span><br><span class="line">d_copy1[<span class="string">&#x27;name1&#x27;</span>][<span class="string">&#x27;scott zhang&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment"># å› ä¸ºå…¶å®å†…éƒ¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª dict</span></span><br><span class="line"><span class="built_in">print</span>(</span><br><span class="line">    <span class="built_in">id</span>(d_copy1[<span class="string">&#x27;name1&#x27;</span>]) == <span class="built_in">id</span>(d[<span class="string">&#x27;name1&#x27;</span>])</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºä»€ä¹ˆè¦æŒ‡å‘åŒä¸€ä¸ª dict?</span></span><br><span class="line"><span class="comment"># å› ä¸ºæµ…æ‹·è´æŒ‡å‘çš„æ˜¯æŒ‡é’ˆï¼Œæ·±æ‹·è´ä¼šå°†æ•°æ®é‡æ–°èµ‹å€¼ï¼Œéå¸¸è€—è´¹ç³»ç»Ÿèµ„æºã€‚</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A new dict: &#123;&#x27;name1&#x27;: &#123;&#x27;scott zhang&#x27;: 1&#125;, &#x27;name2&#x27;: &#123;&#x27;the weeknd&#x27;: 2&#125;&#125;</span><br><span class="line">1901449775104</span><br><span class="line">&#123;&#x27;name1&#x27;: &#123;&#x27;scott zhang&#x27;: 0&#125;, &#x27;name2&#x27;: &#123;&#x27;the weeknd&#x27;: 2&#125;&#125;</span><br><span class="line">True</span><br></pre></td></tr></table></figure><h1 id="ä»¥-class-ä¸ºä¾‹">ä»¥ class ä¸ºä¾‹</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="comment"># A Point</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Point(<span class="subst">&#123;self.x!r&#125;</span>, <span class="subst">&#123;self.y!r&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A Rectagle</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, topleft, bottomright</span>):</span></span><br><span class="line">        self.topleft = topleft</span><br><span class="line">        self.bottomright = bottomright</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">f&#x27;Rectangle(<span class="subst">&#123;self.topleft!r&#125;</span>, &#x27;</span></span><br><span class="line">                <span class="string">f&#x27;<span class="subst">&#123;self.bottomright!r&#125;</span>)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># Make a point and it copy obj</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- Point&quot;</span>)</span><br><span class="line">    point = Point(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    point_copy = copy.copy(point)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;point:&quot;</span>, point)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;point copy:&quot;</span>, point_copy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># point is point_copy?</span></span><br><span class="line">    <span class="comment"># no, because class Point using int in x and y</span></span><br><span class="line">    <span class="comment"># int is immutable type in python</span></span><br><span class="line">    <span class="comment"># so there is no difference between deep/shallow copy for Point class</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;point is point copyï¼Ÿ&quot;</span>, point <span class="keyword">is</span> point_copy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># modified point</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- Modified Point&quot;</span>)</span><br><span class="line">    point.x = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;point:&quot;</span>, point)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;point copy:&quot;</span>, point_copy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ˜¯ Rectangle å†…éƒ¨çš„ Pointer å‘¢?</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- Rectangle&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># new rectangle and a copy from it</span></span><br><span class="line">    rect = Rectangle(topleft=Point(<span class="number">0</span>, <span class="number">1</span>), bottomright=Point(<span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">    rect_copy = copy.copy(rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect:&quot;</span>, rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect copy:&quot;</span>, rect_copy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># rect is rect_copy?</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect_copy is rect?&quot;</span>, rect_copy <span class="keyword">is</span> rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- Modified rect&quot;</span>)</span><br><span class="line">    rect.topleft.x = <span class="number">999</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect:&quot;</span>, rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect copy:&quot;</span>, rect_copy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># using deep copy</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- New Deep Copy Rect&quot;</span>)</span><br><span class="line">    rect_copy_deep = copy.deepcopy(rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect&quot;</span>, rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect copy deep:&quot;</span>, rect_copy_deep)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># modified a deep copy obj</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---- Modified Deep Copy Rect&quot;</span>)</span><br><span class="line">    rect.bottomright.x = <span class="number">666</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect&quot;</span>, rect)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rect copy deep:&quot;</span>, rect_copy_deep)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---- Point</span><br><span class="line">point: Point(0, 0)</span><br><span class="line">point copy: Point(0, 0)</span><br><span class="line">point is point copyï¼Ÿ False</span><br><span class="line">---- Modified Point</span><br><span class="line">point: Point(1, 0)</span><br><span class="line">point copy: Point(0, 0)</span><br><span class="line"></span><br><span class="line">---- Rectangle</span><br><span class="line">rect: Rectangle(Point(0, 1), Point(1, 0))</span><br><span class="line">rect copy: Rectangle(Point(0, 1), Point(1, 0))</span><br><span class="line">rect_copy is rect? False</span><br><span class="line">---- Modified rect</span><br><span class="line">rect: Rectangle(Point(999, 1), Point(1, 0))</span><br><span class="line">rect copy: Rectangle(Point(999, 1), Point(1, 0))</span><br><span class="line">---- New Deep Copy Rect</span><br><span class="line">rect Rectangle(Point(999, 1), Point(1, 0))</span><br><span class="line">rect copy deep: Rectangle(Point(999, 1), Point(1, 0))</span><br><span class="line">---- Modified Deep Copy Rect</span><br><span class="line">rect Rectangle(Point(999, 1), Point(666, 0))</span><br><span class="line">rect copy deep: Rectangle(Point(999, 1), Point(1, 0))</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“">æ€»ç»“</h1><ul><li>æµ…æ‹·è´ï¼ˆshallow copyï¼‰å¹¶ä¸ä¼šå…‹éš†å¯¹è±¡ä¸­çš„å­å¯¹è±¡ï¼Œå› æ­¤åŸå¯¹è±¡å’Œå¯¹è±¡ä¸­ï¼Œè¢«æ‹·è´çš„å†…éƒ¨å¯¹è±¡ä¸æ˜¯ç‹¬ç«‹ä¸¤ä»½ï¼Œè€Œæ˜¯åŒä¸€ä»½ã€‚</li><li>æ·±æ‹·è´ï¼ˆDeep copyï¼‰ä¼šé€’å½’çš„æ‹·è´æ‰€æœ‰å­å¯¹è±¡ï¼Œè¿™ä¿è¯äº†å†…éƒ¨å¯¹è±¡çš„ç‹¬ç«‹æ€§ï¼Œä½†æ˜¯è¿™æ ·é€Ÿåº¦å¾ˆæ…¢ã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨ copy æ¨¡å—æ‹·è´ä»»æ„å¯¹è±¡ï¼ˆåŒ…æ‹¬ä½ è‡ªå®šä¹‰çš„ç±»ï¼‰ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡å®ç° <code>__copy()__</code> æˆ– <code>__deepcopy()__</code> æ¥è‡ªå®šä¹‰æ‹·è´çš„è¿‡ç¨‹ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä»¥ listï¼Œdictï¼Œclass ä¸ºä¾‹ï¼Œå¸¦ä½ äº†è§£ Python ä¸­çš„æµ…æ‹·è´ä¸æ·±æ‹·è´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Python é«˜çº§ç³»åˆ—" scheme="https://scottzhang.pro/categories/Python-%E9%AB%98%E7%BA%A7%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Go è¯­æ³•æ¦‚è§ˆ P3</title>
    <link href="https://scottzhang.pro/article/4074d0e9.html"/>
    <id>https://scottzhang.pro/article/4074d0e9.html</id>
    <published>2021-12-20T09:13:01.000Z</published>
    <updated>2021-12-20T09:19:39.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯ <a href="https://tour.go-zh.org/welcome/1">Go è¯­è¨€ä¹‹æ—…</a>çš„ç¬”è®° P3, å†…å®¹è¾ƒé•¿,åŒ…æ‹¬äº† Go ä¸­çš„æ–¹æ³•ã€æ¥å£ã€å¹¶å‘ç­‰å†…å®¹.</p></blockquote><span id="more"></span><h1 id="æ–¹æ³•">æ–¹æ³•</h1><p>Go æ²¡æœ‰ç±»ã€‚ä¸è¿‡ä½ å¯ä»¥ä¸ºç»“æ„ä½“ç±»å‹å®šä¹‰æ–¹æ³•ï¼ŒGo ä¸­æ–¹æ³•æ˜¯å¸¦ç‰¹æ®Šçš„ {æ¥æ”¶è€…} å‚æ•°çš„å‡½æ•°ï¼ˆæ–¹æ³•å…¶å®å°±æ˜¯å‡½æ•°ï¼Œåªæ˜¯å¸¦äº†ä¸ªæ¥æ”¶è€…ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">    X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------------åç»­ä»£ç å°†çœç•¥ä¸Šé¢çš„éƒ¨åˆ†------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;æ¥æ”¶è€…&#125; ä½äº func å…³é”®å­—å’Œæ–¹æ³•åä¹‹é—´</span></span><br><span class="line"><span class="comment">// åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAbs æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªåä¸º vï¼Œç±»å‹ä¸º Vertex çš„æ¥æ”¶è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    fmt.Println(v.Abs())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨ï¼šæ–¹æ³•ç›¸å½“äºå‡½æ•°ï¼Œæ‰€ä»¥ä¸‹é¢çš„å†™æ³•åŠŸèƒ½æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span><span class="params">(v Vertex)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸å†æ˜¯ v.Abs(), è€Œæ˜¯ Abs(v)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(Abs(v))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éç»“æ„ä½“ä¹Ÿæ˜¯å¯ä»¥å£°æ˜æ–¹æ³•çš„ï¼Œæ¯”å¦‚å¯¹äº floatï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;æ¥æ”¶è€…&#125; ä¸º (f MyFloat)ï¼Œæ–¹æ³•åä¸º Abs, è¿”å› float64</span></span><br><span class="line"><span class="comment">// æ²¡æœ‰å‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">f := MyFloat(<span class="number">-1</span>)</span><br><span class="line">f.Abs()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œä½ åªèƒ½ä¸ºåœ¨åŒä¸€åŒ…å†…å®šä¹‰çš„ç±»å‹çš„æ¥æ”¶è€…å£°æ˜æ–¹æ³•ï¼Œè€Œä¸èƒ½ä¸ºå…¶å®ƒåŒ…å†…å®šä¹‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬ int ä¹‹ç±»çš„å†…å»ºç±»å‹ï¼‰çš„æ¥æ”¶è€…å£°æ˜æ–¹æ³•ã€‚</p><p>ä¸Šé¢çš„æ¥æ”¶è€…ä¸ºå€¼æ¥æ”¶è€…ï¼Œå®é™…ä¸Šæ¥æ”¶è€…è¿˜æœ‰ä¸€ç§å«åšæŒ‡é’ˆæ¥æ”¶è€…ï¼Œå› ä¸ºä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…ï¼Œä½ å¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨ä¿®æ”¹å€¼ï¼Œæ‰€ä»¥æŒ‡é’ˆæ¥æ”¶è€…æ¯”å€¼æ¥æ”¶è€…æ›´å¸¸ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å€¼æ¥æ”¶è€… (v Vertex)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="comment">// å–å€¼ã€è®¡ç®—</span></span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡é’ˆæ¥æ”¶è€… (v *Vertex)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Scale</span><span class="params">(f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ä¿®æ”¹å€¼</span></span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">v.Scale(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æè¾“å‡º</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯æŒ‡é’ˆæ¥æ”¶è€…:</span></span><br><span class="line"><span class="comment">// Scale: 3*10 = 30; 4*10 = 40</span></span><br><span class="line"><span class="comment">// Abs: Sqrt(30*30 + 40*40) = 50</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå°†æŒ‡é’ˆæ¥æ”¶è€…æ”¹ä¸ºå€¼æ¥æ”¶è€…</span></span><br><span class="line"><span class="comment">// å³ (v *Vertex) -&gt; (v Vertex)</span></span><br><span class="line"><span class="comment">// Scale: 3 ; 4 </span></span><br><span class="line"><span class="comment">// Abs: Sqrt(30*30 + 40*40) = 50</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ–¹æ³•å’ŒæŒ‡é’ˆé‡å®šå‘; åœ¨å‡½æ•°ä¸­ï¼Œå¦‚æœè¦æ±‚çš„å‚æ•°æ˜¯æŒ‡é’ˆï¼Œä¼ å€¼ä¼šæŠ¥é”™ï¼›å¦‚æœä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…ï¼Œåˆ™æ—¢å¯ä»¥ä¼ å€¼ï¼Œä¹Ÿå¯ä»¥ä¼ æŒ‡é’ˆï¼›åä¹‹å¦‚æœè¦æ±‚çš„å‚æ•°æ˜¯å€¼ï¼Œåœ¨å‡½æ•°ä¸­ä¼ æŒ‡é’ˆä¹Ÿä¼šå‡ºé”™ï¼ŒæŒ‡é’ˆæ¥æ”¶è€…åˆ™ä¹Ÿå¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚</p><p>ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…çš„å¥½å¤„æ˜¯ï¼š</p><ol type="1"><li>æŒ‡é’ˆèƒ½å¤Ÿä¿®æ”¹ä¼ è¿›æ¥çš„å€¼</li><li>å› ä¸ºä¼ çš„æ˜¯æŒ‡é’ˆï¼Œé¿å…äº†å€¼çš„å¤åˆ¶ï¼Œæ›´é«˜æ•ˆ</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°</span></span><br><span class="line"><span class="comment">// å› ä¸ºå‚æ•°æŒ‡å®šä¸ºæŒ‡é’ˆï¼Œç›´æ¥ä¼ å€¼ä¼šå‡ºé”™</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ScaleFunc</span><span class="params">(v *Vertex, f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡é’ˆæ¥æ”¶è€…</span></span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å·¥ä½œ</span></span><br><span class="line"><span class="comment">// v.Scale(10), (&amp;v).scale(10)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Scale</span><span class="params">(f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¥å£">æ¥å£</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªå‡ ä½•å½¢çŠ¶çš„æ¥å£ï¼Œæ‹¥æœ‰é¢ç§¯å’Œ</span></span><br><span class="line"><span class="keyword">type</span> geometry <span class="keyword">interface</span> &#123;</span><br><span class="line">    area() <span class="keyword">float64</span></span><br><span class="line">    perim() <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ©å½¢å’Œåœ†çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> rect <span class="keyword">struct</span> &#123;</span><br><span class="line">    width, height <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å‡½æ•°ï¼Œå®ç° rect çš„ area() å’Œ perim() æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span> <span class="title">area</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span> <span class="title">perim</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*r.width + <span class="number">2</span>*r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å‡½æ•°ï¼Œå®ç° circle çš„ area() å’Œ perim() æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span> <span class="title">area</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Pi * c.radius * c.radius</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span> <span class="title">perim</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * math.Pi * c.radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// measure å‡½æ•°ï¼ŒåŸºäº geometory æ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">measure</span><span class="params">(g geometry)</span></span> &#123;</span><br><span class="line">    fmt.Println(g)</span><br><span class="line">    fmt.Println(g.area())</span><br><span class="line">    fmt.Println(g.perim())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := rect&#123;width: <span class="number">3</span>, height: <span class="number">4</span>&#125;</span><br><span class="line">    c := circle&#123;radius: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    measure(r)</span><br><span class="line">    measure(c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äºæ¥å£çš„å¦ä¸€ä¸ªä¾‹å­, é¦–å…ˆæ˜¯å®Œæ•´çš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</span><br><span class="line">Abs() <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a Abser</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">a = f  <span class="comment">// a MyFloat å®ç°äº† Abser</span></span><br><span class="line">a = &amp;v <span class="comment">// a *Vertex å®ç°äº† Abser</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸€è¡Œï¼Œv æ˜¯ä¸€ä¸ª Vertexï¼ˆè€Œä¸æ˜¯ *Vertexï¼‰</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥æ²¡æœ‰å®ç° Abserã€‚</span></span><br><span class="line">a = v</span><br><span class="line"></span><br><span class="line">fmt.Println(a.Abs())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€ä¸€æ¥çœ‹ï¼Œæ–¹ä¾¿ç ”ç©¶ï¼Œé¦–å…ˆæ˜¯ç›´æ¥å°†å˜é‡èµ‹å€¼ç»™æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</span><br><span class="line">Abs() <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a Abser</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">a = f</span><br><span class="line"></span><br><span class="line">fmt.Println(f.Abs()) <span class="comment">// ä¸º MyFload å®ç°äº† Abs æ–¹æ³•, å³</span></span><br><span class="line">fmt.Println(a.Abs()) <span class="comment">// MyFloat å®ç°äº† Abser</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å°†ç»“æ„ä½“èµ‹å€¼ç»™æ¥å£:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</span><br><span class="line">Abs() <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a Abser</span><br><span class="line"></span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">a = &amp;v <span class="comment">// a *Vertex å®ç°äº† Abser</span></span><br><span class="line"></span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">fmt.Println(a.Abs())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®ƒä»¬ä¸åŒçš„åœ°æ–¹åœ¨äº:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡ä»¶</span></span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸åŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;  <span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸åŒ</span></span><br><span class="line">a = f  <span class="comment">// a.Abs(), work; a MyFloat å®ç°äº† Abser</span></span><br><span class="line">a = &amp;v <span class="comment">// a.Abs(), work; a *Vertex å®ç°äº† Abser</span></span><br><span class="line"></span><br><span class="line">a = v </span><br><span class="line"><span class="comment">// a.Abs(), Error; Vertex does not implement Abser; å¦‚æœå°†</span></span><br><span class="line"><span class="comment">// func (v *Vertex) Abs() float64 æ”¹ä¸º</span></span><br><span class="line"><span class="comment">// func (v *Vertex) Abs() åˆ™å¯ä»¥æ­£å¸¸è¿è¡Œ</span></span><br></pre></td></tr></table></figure><p>æ¥å£çš„éšå¼å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ–¹æ³•è¡¨ç¤ºç±»å‹ T å®ç°äº†æ¥å£ Iï¼Œä½†æˆ‘ä»¬æ— éœ€æ˜¾å¼å£°æ˜æ­¤äº‹</span></span><br><span class="line"><span class="comment">// ç›´æ¥å°† func çš„åå­—è®¾ç½®æˆ æ¥å£ä¸­çš„åå­—å³å¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I = T&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£ä¹Ÿæ˜¯å€¼ï¼Œæ‰€ä»¥å¯ä»¥åƒå€¼ä¸€æ ·ä¼ é€’ã€‚å¯ä»¥ç”¨ä½œå‚æ•°å’Œå‡½æ•°çš„è¿”å›å€¼ã€‚</p><p>æ¥å£å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚</p><p>åœ¨å†…éƒ¨ï¼Œæ¥å£å€¼å¯ä»¥çœ‹åšåŒ…å«å€¼å’Œå…·ä½“ç±»å‹çš„å…ƒç»„ <code>(value, type)</code>, æ¥å£å€¼ä¿å­˜äº†ä¸€ä¸ªå…·ä½“åº•å±‚ç±»å‹çš„å…·ä½“å€¼ã€‚æ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå…¶åº•å±‚ç±»å‹çš„åŒåæ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// æ¥å£ Iï¼Œå…¶ä¸­è§„å®šäº†éœ€è¦å®ç° M() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æ„ä½“ Tï¼Œå…¶ä¸­æœ‰ string ç±»å‹çš„ S</span></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸ºç»“æ„ä½“ T å¢åŠ äº† M() æ–¹æ³•</span></span><br><span class="line"><span class="comment">// (t *T) ä¸ºæŒ‡é’ˆæ¥æ”¶è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º float64 å¢åŠ äº† M() æ–¹æ³•</span></span><br><span class="line"><span class="comment">// (f F) ä¸ºå€¼æ¥æ”¶è€…</span></span><br><span class="line"><span class="keyword">type</span> F <span class="keyword">float64</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f F)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å‡½æ•°ï¼Œå‚æ•°ä¸ºæ¥å£ I</span></span><br><span class="line"><span class="comment">// %vï¼šå€¼çš„ value</span></span><br><span class="line"><span class="comment">// %T: å€¼çš„ type</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤ä¹ </span></span><br><span class="line"><span class="comment">// &amp; ç¬¦å·çš„æ„æ€æ˜¯å¯¹å˜é‡å–åœ°å€ï¼Œå¦‚ï¼šå˜é‡açš„åœ°å€æ˜¯&amp;a</span></span><br><span class="line"><span class="comment">// * ç¬¦å·çš„æ„æ€æ˜¯å¯¹æŒ‡é’ˆå–å€¼ï¼Œå¦‚:*&amp;aï¼Œå°±æ˜¯aå˜é‡æ‰€åœ¨åœ°å€çš„å€¼ï¼Œå½“ç„¶ä¹Ÿå°±æ˜¯açš„å€¼äº†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I        <span class="comment">// å£°æ˜æ¥å£ i</span></span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;Hello&quot;</span>&#125; <span class="comment">// å®šäº†ç»“æ„ä½“ -&gt; å–è¯¥ç»“æ„ä½“çš„åœ°å€ -&gt; ç»™ i</span></span><br><span class="line">describe(i)     <span class="comment">// æ‰“å°ç»“æ„ä½“åœ°å€çš„å€¼ï¼Œä»¥åŠ type</span></span><br><span class="line">i.M()           <span class="comment">// ç»“æ„ä½“å¢åŠ äº† M() æ–¹æ³•ï¼Œè¿è¡ŒæˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">i = F(math.Pi)  <span class="comment">// F æ˜¯è‡ªå®šä¹‰çš„ float64ï¼Œåˆå§‹åŒ–å€¼ä¸º math.pi -&gt; ç»™ i</span></span><br><span class="line">describe(i)        <span class="comment">// æ‰“å° i çš„å€¼å’Œåœ°å€</span></span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I     <span class="comment">// å£°æ˜æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t *T    <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆ tï¼Œé›¶å€¼ä¸º nil</span></span><br><span class="line">i = t       <span class="comment">// éšå¼å®ç°äº†æ¥å£ï¼Œä½¿å¾— i æœ‰äº† M() æ–¹æ³•</span></span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">(&lt;nil&gt;, *main.T)</span></span><br><span class="line"><span class="comment">&lt;nil&gt;</span></span><br><span class="line"><span class="comment">(&amp;&#123;hello&#125;, *main.T)</span></span><br><span class="line"><span class="comment">hello</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ç©ºæ¥å£, å®ƒæ²¡æœ‰è§„å®šæ¥å£çš„æ–¹æ³•ï¼Œç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼ï¼› ç©ºæ¥å£è¢«ç”¨æ¥å¤„ç†æœªçŸ¥ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œfmt.Print å¯æ¥å—ç±»å‹ä¸º interface{} çš„ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;  <span class="comment">// æŒ‡å®šäº†é›¶ä¸ªæ–¹æ³•çš„æ¥å£å€¼</span></span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="number">42</span></span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="string">&quot;hello&quot;</span></span><br><span class="line">describe(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³äºç±»å‹æ–­è¨€ï¼Œå®ƒæä¾›äº†è®¿é—®æ¥å£å€¼åº•å±‚å€¼çš„å…·ä½“æ–¹å¼ï¼Œå¹¶å¯ä»¥è¿›è¡Œæ£€æµ‹æ–­è¨€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">s := i.(<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(s)</span><br><span class="line"></span><br><span class="line">s, ok := i.(<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(s, ok)</span><br><span class="line"></span><br><span class="line">f, ok := i.(<span class="keyword">float64</span>)</span><br><span class="line">fmt.Println(f, ok)</span><br><span class="line"></span><br><span class="line">f = i.(<span class="keyword">float64</span>) <span class="comment">// æŠ¥é”™(panic)</span></span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç±»å‹é€‰æ‹©ï¼Œå¯ä»¥æŒ‰é¡ºåºä»æ¥å£å€¼ä¸­é€‰æ‹©å€¼çš„ç±»å‹ï¼Œæ–‡æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> v := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> T:</span><br><span class="line">    <span class="comment">// v çš„ç±»å‹ä¸º T</span></span><br><span class="line"><span class="keyword">case</span> S:</span><br><span class="line">    <span class="comment">// v çš„ç±»å‹ä¸º S</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// æ²¡æœ‰åŒ¹é…ï¼Œv ä¸ i çš„ç±»å‹ç›¸åŒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸ªç±»å‹é€‰æ‹©çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="comment">// ç±»å‹é€‰æ‹©ä¸­çš„ case ä¸ºç±»å‹ï¼ˆè€Œéå€¼</span></span><br><span class="line"><span class="comment">// ç±»å‹é€‰æ‹©ä¸­çš„å£°æ˜ä¸ç±»å‹æ–­è¨€ i.(T) çš„è¯­æ³•ç›¸åŒ</span></span><br><span class="line"><span class="comment">// åªæ˜¯å…·ä½“ç±»å‹ T è¢«æ›¿æ¢æˆäº†å…³é”®å­— type</span></span><br><span class="line"><span class="keyword">switch</span> v := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Twice %v is %v\n&quot;</span>, v, v*<span class="number">2</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%q is %v bytes long\n&quot;</span>, v, <span class="built_in">len</span>(v))</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;I don&#x27;t know about type %T!\n&quot;</span>, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">do(<span class="number">21</span>)</span><br><span class="line">do(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">do(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Twice 21 is 42</span></span><br><span class="line"><span class="comment">&quot;hello&quot; is 5 bytes long</span></span><br><span class="line"><span class="comment">I don&#x27;t know about type bool!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä»‹ç»ä¸€ä¸ªæ™®éä½¿ç”¨çš„æ¥å£ï¼Œå³ fmt åŒ…ä¸­çš„ Stringerã€‚ä¸€ä¸ªå¯ä»¥ç”¨å­—ç¬¦ä¸²æè¿°è‡ªå·±çš„ç±»å‹ã€‚fmt åŒ…ï¼ˆè¿˜æœ‰å¾ˆå¤šåŒ…ï¼‰éƒ½é€šè¿‡æ­¤æ¥å£æ¥æ‰“å°å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v (%v years)&quot;</span>, p.Name, p.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := Person&#123;<span class="string">&quot;Arthur Dent&quot;</span>, <span class="number">42</span>&#125;</span><br><span class="line">z := Person&#123;<span class="string">&quot;Zaphod Beeblebrox&quot;</span>, <span class="number">9001</span>&#125;</span><br><span class="line">fmt.Println(a, z)</span><br><span class="line">fmt.Println(a.String())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Arthur Dent (42 years) Zaphod Beeblebrox (9001 years)</span></span><br><span class="line"><span class="comment">Arthur Dent (42 years)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å…³äº Go ä¸­çš„é”™è¯¯å¤„ç†:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rror ä¸º nil æ—¶è¡¨ç¤ºæˆåŠŸï¼›é nil çš„ error è¡¨ç¤ºå¤±è´¥ã€‚</span></span><br><span class="line">i, err := strconv.Atoi(<span class="string">&quot;42&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;couldn&#x27;t convert number: %v\n&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;Converted integer:&quot;</span>, i)</span><br></pre></td></tr></table></figure><p>å…³äºæ–‡ä»¶è¯»å–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := strings.NewReader(<span class="string">&quot;Hello, Reader!&quot;</span>)</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">        n, err := r.Read(b)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;n = %v err = %v b = %v\n&quot;</span>, n, err, b)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;b[:n] = %q\n&quot;</span>, b[:n])</span><br><span class="line">        <span class="comment">// åœ¨é‡åˆ°æ•°æ®æµçš„ç»“å°¾æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª io.EOF é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³äºå›¾åƒå¤„ç†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;image&quot;</span>  <span class="comment">// image åŒ…å®šä¹‰äº† Image æ¥å£</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := image.NewRGBA(image.Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line"><span class="comment">// Bounds æ–¹æ³•çš„è¿”å›å€¼ Rectangle å®é™…ä¸Šæ˜¯ä¸€ä¸ª image.Rectangleï¼Œå®ƒåœ¨ image åŒ…ä¸­å£°æ˜</span></span><br><span class="line">fmt.Println(m.Bounds())</span><br><span class="line">fmt.Println(m.At(<span class="number">0</span>, <span class="number">0</span>).RGBA())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å¹¶å‘">å¹¶å‘</h1><p>è¯´åˆ°å¹¶å‘ï¼Œé¦–å…ˆä»‹ç»Go ä¸­çš„ Go ç¨‹ï¼ˆgoroutineï¼‰ï¼Œå®ƒæ˜¯ç”± Go è¿è¡Œæ—¶ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ã€‚å½“ä½ å†™ <code>go f(x, y, z)</code> ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Go ç¨‹å¹¶æ‰§è¡Œ <code>f(x, y, z)</code>ã€‚</p><p>åœ¨ Go ç¨‹çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œf, x, y å’Œ z çš„æ±‚å€¼å‘ç”Ÿåœ¨å½“å‰çš„ Go ç¨‹ä¸­ï¼Œè€Œ f çš„æ‰§è¡Œå‘ç”Ÿåœ¨æ–°çš„ Go ç¨‹ä¸­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">time.Sleep(<span class="number">1000</span> * time.Millisecond)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">go</span> say(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">say(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Go ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨è®¿é—®å…±äº«çš„å†…å­˜æ—¶å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚</p></blockquote><p>å…³äºä¿¡é“ï¼Œåœ¨ Go ä¸­ï¼Œå®è´¨ä¸Šæ˜¯å¸¦æœ‰ç±»å‹çš„ç®¡é“ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¿¡é“</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><p>ä¿¡é“æ“ä½œç¬¦æœ‰ <code>-&gt;</code>, <code>&lt;-</code>ï¼Œç®­å¤´çš„æ–¹å‘é¢„ç¤ºç€æ•°æ®æµçš„æ–¹å‘ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- v    <span class="comment">// å°† v å‘é€è‡³ä¿¡é“ chã€‚</span></span><br><span class="line">v := &lt;-ch  <span class="comment">// ä» ch æ¥æ”¶å€¼å¹¶èµ‹äºˆ vã€‚</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹å¯¹åˆ‡ç‰‡ä¸­çš„æ•°è¿›è¡Œæ±‚å’Œï¼Œå°†ä»»åŠ¡åˆ†é…ç»™ä¸¤ä¸ª Go ç¨‹ã€‚ä¸€æ—¦ä¸¤ä¸ª Go ç¨‹å®Œæˆäº†å®ƒä»¬çš„è®¡ç®—ï¼Œå®ƒå°±èƒ½ç®—å‡ºæœ€ç»ˆçš„ç»“æœã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(s []<span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> s &#123;</span><br><span class="line">sum += v</span><br><span class="line">&#125;</span><br><span class="line">c &lt;- sum <span class="comment">// å°†å’Œé€å…¥ c</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">-9</span>, <span class="number">4</span>, <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> sum(s[:<span class="built_in">len</span>(s)/<span class="number">2</span>], c)</span><br><span class="line"><span class="keyword">go</span> sum(s[<span class="built_in">len</span>(s)/<span class="number">2</span>:], c)</span><br><span class="line">x, y := &lt;-c, &lt;-c <span class="comment">// ä» c ä¸­æ¥æ”¶</span></span><br><span class="line"></span><br><span class="line">fmt.Println(x, y, x+y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äºå¸¦ç¼“å†²çš„ä¿¡é“, ä½¿ç”¨ make åˆ›å»º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>ä»…å½“ä¿¡é“çš„ç¼“å†²åŒºå¡«æ»¡åï¼Œå‘å…¶å‘é€æ•°æ®æ—¶æ‰ä¼šé˜»å¡ã€‚å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥å—æ–¹ä¼šé˜»å¡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line">ch &lt;- <span class="number">2</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// ch &lt;- 3</span></span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯¹äºä½¿ç”¨ä¿¡é“æ¥è¯´ï¼Œè¿˜æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ“ä½œï¼Œå³å…³é—­ä¿¡é“ï¼Œæˆ–è€…æ˜¯æ£€æŸ¥ä¸€ä¸ªä¿¡é“æ˜¯å¦å…³é—­äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªæ±‚æ–æ³¢æ‹‰å¥‘æ•°åˆ—çš„ä¾‹å­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(n <span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">c &lt;- x</span><br><span class="line">x, y = y, x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(c)  <span class="comment">// ä½¿ç”¨ close å…³é—­ä¿¡é“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">go</span> fibonacci(<span class="built_in">cap</span>(c), c)</span><br><span class="line"><span class="comment">// å¾ªç¯ for i := range c ä¼šä¸æ–­ä»ä¿¡é“æ¥æ”¶å€¼ï¼Œç›´åˆ°å®ƒè¢«å…³é—­</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> c &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>æ³¨æ„ï¼šåªæœ‰å‘é€è€…æ‰èƒ½å…³é—­ä¿¡é“ï¼Œè€Œæ¥æ”¶è€…ä¸èƒ½ã€‚å‘ä¸€ä¸ªå·²ç»å…³é—­çš„ä¿¡é“å‘é€æ•°æ®ä¼šå¼•å‘ç¨‹åºææ…Œï¼ˆpanicï¼‰ã€‚</p></li><li><p>ä¿¡é“ä¸æ–‡ä»¶ä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹æ— éœ€å…³é—­å®ƒä»¬ã€‚åªæœ‰åœ¨å¿…é¡»å‘Šè¯‰æ¥æ”¶è€…ä¸å†æœ‰éœ€è¦å‘é€çš„å€¼æ—¶æ‰æœ‰å¿…è¦å…³é—­ï¼Œä¾‹å¦‚ç»ˆæ­¢ä¸€ä¸ª range å¾ªç¯ã€‚</p></li></ul><p>å…³äº Go æ€»çš„ Select è¯­å¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Go&#x27;s _select_ lets you wait on multiple channel</span></span><br><span class="line"><span class="comment">// operations. Combining goroutines and channels with</span></span><br><span class="line"><span class="comment">// select is a powerful feature of Go.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// For our example we&#x27;ll select across two channels.</span></span><br><span class="line">c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Each channel will receive a value after some amount</span></span><br><span class="line"><span class="comment">// of time, to simulate e.g. blocking RPC operations</span></span><br><span class="line"><span class="comment">// executing in concurrent goroutines.</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">c1 &lt;- <span class="string">&quot;one&quot;</span></span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">c2 &lt;- <span class="string">&quot;two&quot;</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// We&#x27;ll use `select` to await both of these values</span></span><br><span class="line"><span class="comment">// simultaneously, printing each one as it arrives.</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> msg1 := &lt;-c1:</span><br><span class="line">fmt.Println(<span class="string">&quot;received&quot;</span>, msg1)</span><br><span class="line"><span class="keyword">case</span> msg2 := &lt;-c2:</span><br><span class="line">fmt.Println(<span class="string">&quot;received&quot;</span>, msg2)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å½“ select ä¸­çš„å…¶å®ƒåˆ†æ”¯éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œdefault åˆ†æ”¯å°±ä¼šæ‰§è¡Œã€‚ ä¸ºäº†åœ¨å°è¯•å‘é€æˆ–è€…æ¥æ”¶æ—¶ä¸å‘ç”Ÿé˜»å¡ï¼Œå¯ä½¿ç”¨ default åˆ†æ”¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> i := &lt;-c:</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ i</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// ä» c ä¸­æ¥æ”¶ä¼šé˜»å¡æ—¶æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Go ä¸­ä¿¡é“éå¸¸é€‚åˆåœ¨ä¸åŒçš„ Go ç¨‹ä¸­è¿›è¡Œé€šä¿¡ã€‚ä½†å¦‚æœæˆ‘ä»¬ä¸éœ€è¦é€šä¿¡å‘¢ï¼Ÿè‹¥æˆ‘ä»¬åªæ˜¯æƒ³ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ª Go ç¨‹èƒ½å¤Ÿè®¿é—®ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä»è€Œé¿å…å†²çªï¼Ÿ</p><p>è¿™ä¸ªæ¦‚å¿µå«äº’æ–¥ï¼ŒGo ä¸­æœ‰ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„æ¥æä¾›è¿™ä¸€åŠŸèƒ½ï¼Œäº’æ–¥é” Mutexï¼Œ<code>sync.Mutex</code>.</p><p><code>sync.Mutex</code> ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒLock å’Œ Ulockã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç å‰è°ƒç”¨ Lock æ–¹æ³•ï¼Œåœ¨ä»£ç åè°ƒç”¨ Unlock æ–¹æ³•æ¥ä¿è¯ä¸€æ®µä»£ç çš„äº’æ–¥æ‰§è¡Œ</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ defer è¯­å¥æ¥ä¿è¯äº’æ–¥é”ä¸€å®šä¼šè¢«è§£é”</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SafeCounter çš„å¹¶å‘ä½¿ç”¨æ˜¯å®‰å…¨çš„ã€‚</span></span><br><span class="line"><span class="keyword">type</span> SafeCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">v   <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">mux sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inc å¢åŠ ç»™å®š key çš„è®¡æ•°å™¨çš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span> <span class="title">Inc</span><span class="params">(key <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">c.mux.Lock()</span><br><span class="line"><span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span></span><br><span class="line">c.v[key]++</span><br><span class="line">c.mux.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Value è¿”å›ç»™å®š key çš„è®¡æ•°å™¨çš„å½“å‰å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c.mux.Lock()</span><br><span class="line"><span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span></span><br><span class="line"><span class="keyword">defer</span> c.mux.Unlock()</span><br><span class="line"><span class="keyword">return</span> c.v[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := SafeCounter&#123;v: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> c.Inc(<span class="string">&quot;somekey&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line">fmt.Println(c.Value(<span class="string">&quot;somekey&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ &lt;a href=&quot;https://tour.go-zh.org/welcome/1&quot;&gt;Go è¯­è¨€ä¹‹æ—…&lt;/a&gt;çš„ç¬”è®° P3, å†…å®¹è¾ƒé•¿,åŒ…æ‹¬äº† Go ä¸­çš„æ–¹æ³•ã€æ¥å£ã€å¹¶å‘ç­‰å†…å®¹.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Go" scheme="https://scottzhang.pro/categories/Go/"/>
    
    
    <category term="Go" scheme="https://scottzhang.pro/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Go è¯­æ³•æ¦‚è§ˆ P2</title>
    <link href="https://scottzhang.pro/article/3773e07f.html"/>
    <id>https://scottzhang.pro/article/3773e07f.html</id>
    <published>2021-12-15T14:07:40.000Z</published>
    <updated>2022-01-07T14:06:02.375Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯ <a href="https://tour.go-zh.org/welcome/1">Go è¯­è¨€ä¹‹æ—…</a>çš„ç¬”è®° P2, åŒ…æ‹¬äº†æŒ‡é’ˆã€ç»“æ„ä½“ã€æ•°ç»„ã€åˆ‡ç‰‡ã€æ˜ å°„å’Œé—­åŒ…ç­‰å†…å®¹ã€‚</p></blockquote><span id="more"></span><h1 id="æŒ‡é’ˆ">æŒ‡é’ˆ</h1><p>æŒ‡é’ˆ, æŒ‡é’ˆä¿å­˜äº†å€¼çš„åœ°å€:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡é’ˆå£°æ˜</span></span><br><span class="line"><span class="comment">// *int æ˜¯æŒ‡å‘ int ç±»å‹çš„æŒ‡é’ˆï¼Œå…¶åˆå§‹å€¼ï¼ˆé›¶å€¼ï¼‰ä¸º nil</span></span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// &amp; æ“ä½œç¬¦ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘å…¶æ“ä½œæ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// æ­¤å¤„ç”Ÿæˆä¸€ä¸ªæŒ‡å‘æ•´æ•° 42 çš„æŒ‡é’ˆï¼Œèµ‹å€¼ç»™ p</span></span><br><span class="line">i := <span class="number">42</span></span><br><span class="line">p = &amp;i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œæ“ä½œä¹Ÿæ˜¯ *</span></span><br><span class="line">fmt.Print(*p) <span class="comment">// é€šè¿‡æŒ‡é’ˆè¯»å–å€¼</span></span><br><span class="line">*p = <span class="number">52</span>       <span class="comment">// é€šè¿‡æŒ‡é’ˆè®¾ç½®å€¼</span></span><br></pre></td></tr></table></figure><h1 id="ç»“æ„ä½“">ç»“æ„ä½“</h1><p>ç»“æ„ä½“ structï¼Œå³ä¸€ç»„å­—æ®µ field:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">    X <span class="keyword">int</span></span><br><span class="line">    Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">v = Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125; <span class="comment">// åˆå§‹åŒ–èµ‹å€¼</span></span><br><span class="line">v.X = <span class="number">4</span>          <span class="comment">// ç»“æ„å†…å…ƒç´ èµ‹å€¼</span></span><br><span class="line">fmt.Print(v.X)   <span class="comment">// å–å€¼</span></span><br><span class="line">fmt.Print(v.Y)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“çš„ç‰¹æ®Šæ–‡æ³•ï¼š</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    v1 = Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;  <span class="comment">// åˆ›å»ºä¸€ä¸ª Vertex ç±»å‹çš„ç»“æ„ä½“</span></span><br><span class="line">    v2 = Vertex&#123;X: <span class="number">1</span>&#125;  <span class="comment">// Y:0 è¢«éšå¼åœ°èµ‹äºˆ</span></span><br><span class="line">    v3 = Vertex&#123;&#125;      <span class="comment">// X:0 Y:0</span></span><br><span class="line">    p  = &amp;Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125; <span class="comment">// åˆ›å»ºä¸€ä¸ª *Vertex ç±»å‹çš„ç»“æ„ä½“ï¼ˆæŒ‡é’ˆï¼‰</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°äº† <code>type</code>ï¼Œå¯ä»¥<a href="https://thenewstack.io/understanding-golang-type-system/">ç‚¹å‡»</a>è¿™ç¯‡æ–‡ç« äº†è§£æ›´å¤šã€‚</p><p>ä½¿ç”¨æŒ‡é’ˆè®¿é—®ç»“æ„ä½“ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¿é—®ç»“æ„ä½“ï¼Œéœ€è¦ç»“æ„ææŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// è¿˜æ˜¯ä»¥ä¸Šé¢å®šä¹‰çš„ç»“æ„ä½“ Vertex ä¸ºä¾‹</span></span><br><span class="line">v := Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç»“æ„ä½“æŒ‡é’ˆ p</span></span><br><span class="line"><span class="comment">// èµ‹å€¼ï¼Œæœ¬è´¨æ˜¯ (*p).Xï¼Œä¸ºäº†é¿å…ç¹çï¼Œç®€åŒ–äº†æ“ä½œï¼ˆéšå¼é—´æ¥è°ƒç”¨ï¼‰</span></span><br><span class="line">p := &amp;v</span><br><span class="line">p.X = <span class="number">1e9</span></span><br><span class="line">fmt.Println(v)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç»“æ„ä½“çš„å¤šç§æ–¹å¼</span></span><br><span class="line"><span class="keyword">var</span> s1 Vertex&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> s2 Vertex</span><br><span class="line"><span class="keyword">var</span> s3 *Vertex = <span class="built_in">new</span>(Vertex)</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šç»“æ„ä½“å†…éƒ¨çš„å˜é‡åçš„å¤§å°å†™ï¼Œä¼šå½±å“å¤–éƒ¨è®¿é—®ç»“æ„ä½“å†…éƒ¨çš„æƒé™ã€‚</p></blockquote><p>ç»“æ„ä½“å ç”¨å†…å­˜çš„å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿåœ¨ Go ä¸­å¯ä»¥ä½¿ç”¨ sizeof å‡½æ•°æŸ¥çœ‹å¯¹è±¡å ç”¨çš„å¯¹è±¡ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å ç”¨ 8 å­—èŠ‚</span></span><br><span class="line">unsafe.Sizeof(x: <span class="number">1</span>)</span><br><span class="line"><span class="comment">// ä¸ç®¡å­—ç¬¦ä¸²å¤šé•¿ï¼Œéƒ½æ˜¯ 16ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">unsafe.Sizeof(x: <span class="string">&quot;scottzhang.pro&quot;</span>)</span><br></pre></td></tr></table></figure><p>å…¶å® go è¯­è¨€ä¸­çš„ string æ˜¯ä¸€ä¸ªç»“æ„ä½“:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="keyword">string</span> <span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    Data <span class="keyword">uintptr</span>  <span class="comment">// æŒ‡é’ˆï¼Œå ç”¨8ä¸ªå­—èŠ‚</span></span><br><span class="line">    Len <span class="keyword">int</span>       <span class="comment">//é•¿åº¦ï¼Œ64ä½å ç”¨8ä¸ªå­—èŠ‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”šè‡³ slice ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">    array unsafe.Pointer <span class="comment">// åº•å±‚æ•°ç»„çš„åœ°å€ 8</span></span><br><span class="line">    <span class="built_in">len</span> <span class="keyword">int</span>              <span class="comment">// é•¿åº¦          8</span></span><br><span class="line">    <span class="built_in">cap</span> <span class="keyword">int</span>              <span class="comment">// å®¹é‡          8</span></span><br><span class="line">&#125;                        <span class="comment">//    æ°¸è¿œéƒ½æ˜¯ = 24</span></span><br></pre></td></tr></table></figure><h1 id="æ•°ç»„">æ•°ç»„</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜å½¢å¼ [n]T</span></span><br><span class="line"><span class="comment">// æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„ä¸èƒ½æ”¹å˜å¤§å°</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å†…å®¹çš„æ–‡æ³•ä¸å…¶å®ƒè¯­è¨€ä¸€è‡´</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">2</span>]<span class="keyword">string</span></span><br><span class="line">a[<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="string">&quot;Scott&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜çš„åŒæ—¶è®¾ç½®åˆå§‹å€¼</span></span><br><span class="line">primes := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">fmt.Println(primes)</span><br></pre></td></tr></table></figure><h1 id="åˆ‡ç‰‡">åˆ‡ç‰‡</h1><p>åˆ‡ç‰‡ä¸ºæ•°ç»„æä¾›åŠ¨æ€å¤§å°, åœ¨å®è·µä¸­ï¼Œåˆ‡ç‰‡æ¯”æ•°ç»„æ›´å¸¸ç”¨:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ‡ç‰‡ä¸ Python Pandas ä¸­ iloc çš„è¯­æ³•ç±»ä¼¼</span></span><br><span class="line"><span class="comment">// è¯­æ³•ä¸º []T, åŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ’é™¤æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">a[low:high]</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©ä¸‹æ ‡1-3çš„å…ƒç´ </span></span><br><span class="line">a[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªä¾‹å­</span></span><br><span class="line">primes := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span> = primes[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡ç‰‡åªæ˜¯æä¾›ä¸€ä¸ªè§†è§’ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯å¯¹åˆ‡ç‰‡çš„ä¿®æ”¹ï¼Œä¼šä¿®æ”¹åº•å±‚æ•°æ®</span></span><br><span class="line">names := [<span class="number">2</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">    <span class="string">&quot;Scott&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sam&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">names[<span class="number">0</span>] = <span class="string">&quot;XXX&quot;</span></span><br><span class="line">fmt.Println(names)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡ç‰‡çš„æ–‡æ³•ä¸æ²¡æœ‰å†™æ•°ç»„é•¿åº¦çš„ç±»ä¼¼</span></span><br><span class="line">[<span class="number">3</span>]<span class="keyword">bool</span>&#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>&#125;  <span class="comment">// æ•°ç»„æ–‡æ³•</span></span><br><span class="line">[]<span class="keyword">bool</span>&#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>&#125;   <span class="comment">// åˆ‡ç‰‡æ–‡æ³•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ numpy, pandas ç±»ä¼¼ï¼Œå–åŒæ ·çš„å€¼æœ‰å¤šç§å†™æ³•</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">a[:]</span><br><span class="line">a[<span class="number">0</span>:]</span><br><span class="line">a[:<span class="number">10</span>]</span><br><span class="line">a[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡ç‰‡æœ¬èº«æœ‰å±æ€§ï¼Œå¦‚é•¿åº¦å’Œå®¹é‡</span></span><br><span class="line"><span class="comment">// é•¿åº¦ï¼šåŒ…å«çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">// å®¹é‡: ä»å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ•°ï¼Œåˆ°å…¶åº•å±‚æ•°ç»„å…ƒç´ æœ«å°¾çš„ä¸ªæ•°ï¼ˆæ³¨æ„åŒºåˆ« numpyï¼‰</span></span><br><span class="line"><span class="comment">// é•¿åº¦å’Œå®¹é‡å¯é€šè¿‡è¡¨è¾¾å¼ len(s) å’Œ cap(s) æ¥è·å–</span></span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line"><span class="comment">// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0</span></span><br><span class="line">s = s[:<span class="number">0</span>]</span><br><span class="line"><span class="comment">// æ‹“å±•å…¶é•¿åº¦</span></span><br><span class="line">s = s[:<span class="number">4</span>]</span><br><span class="line"><span class="comment">// èˆå¼ƒå‰ä¸¤ä¸ªå€¼</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">//nil åˆ‡ç‰‡</span></span><br><span class="line"><span class="comment">// åˆ‡ç‰‡çš„é›¶å€¼æ˜¯ nil</span></span><br><span class="line"><span class="comment">// nil åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸º 0 ä¸”æ²¡æœ‰åº•å±‚æ•°ç»„</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ make åˆ›å»ºåˆ‡ç‰‡, make å‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå…ƒç´ ä¸ºé›¶å€¼çš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡, è¿™ä¹Ÿæ˜¯åœ¨ Go ä¸­ä½¿ç”¨åŠ¨æ€æ•°ç»„çš„æ–¹å¼:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ make</span></span><br><span class="line">a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">c := b[:<span class="number">2</span>]</span><br><span class="line">d := c[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åˆ†åˆ«æ‰“å° abcd</span></span><br><span class="line"><span class="comment">a len=5 cap=5 [0 0 0 0 0]</span></span><br><span class="line"><span class="comment">b len=0 cap=5 []</span></span><br><span class="line"><span class="comment">c len=2 cap=5 [0 0]</span></span><br><span class="line"><span class="comment">d len=3 cap=3 [0 0 0]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡çš„åˆ‡ç‰‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»ä¼¼æ“ä½œ dataframe</span></span><br><span class="line">board := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">    []<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">    []<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">    []<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">_ _ _</span></span><br><span class="line"><span class="comment">_ _ _</span></span><br><span class="line"><span class="comment">_ _ _</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡è®¾ç½®å€¼åå¾—åˆ°æ”¹å˜åçš„å›¾æ¡ˆ</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">2</span>][<span class="number">2</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">0</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">X _ X</span></span><br><span class="line"><span class="comment">O _ X</span></span><br><span class="line"><span class="comment">_ _ O</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªç©ºåˆ‡ç‰‡</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªåˆ‡ç‰‡ä¼šæŒ‰éœ€å¢é•¿</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªå…ƒç´ </span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>for å¾ªç¯çš„ range å½¢å¼, ç±»ä¼¼äº Python ä¸­çš„ enumrateï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—è€Œä¸æ˜¯å‡½æ•°ï¼š</p><h1 id="æ˜ å°„">æ˜ å°„</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸¤ä¸ªå€¼</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå€¼ä¸ºå½“å‰å…ƒç´ çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºè¯¥ä¸‹æ ‡æ‰€å¯¹åº”å…ƒç´ çš„ä¸€ä»½å‰¯æœ¬ã€‚</span></span><br><span class="line"><span class="keyword">var</span> pow = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> pow &#123;</span><br><span class="line">    fmt.Printf(i, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä½ æƒ³å¿½ç•¥æŸä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ _ </span></span><br><span class="line"><span class="keyword">for</span> i, _ := <span class="keyword">range</span> pow</span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> pow</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä½ åªéœ€è¦ç´¢å¼•</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> pow</span><br></pre></td></tr></table></figure><p>æ˜ å°„ï¼Œç±»ä¼¼ Python ä¸­çš„å­—å…¸ï¼Œä½†éœ€è¦è§„å®š Key å’Œ Value çš„ç±»å‹ï¼Œå‡è®¾å€¼æ˜¯ structï¼Œåˆ™éœ€æå‰å®šä¹‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ç»“æ„ä½“ï¼Œç”¨æ¥å­˜å€¼</span></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">    Lat, Long <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜æ˜ å°„ï¼Œé”®æ˜¯ stringï¼Œå€¼æ˜¯ struct</span></span><br><span class="line"><span class="comment">// æ˜ å°„çš„é›¶å€¼ä¸º nil ã€‚nil æ˜ å°„æ—¢æ²¡æœ‰é”®ï¼Œä¹Ÿä¸èƒ½æ·»åŠ é”®ã€‚</span></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç»“æ„ä½“</span></span><br><span class="line"><span class="comment">// make å‡½æ•°ä¼šè¿”å›ç»™å®šç±»å‹çš„æ˜ å°„ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–å¤‡ç”¨</span></span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]Vertex)</span><br><span class="line">m[<span class="string">&quot;Bell Labs&quot;</span>] = Vertex&#123;</span><br><span class="line">    <span class="number">40.68433</span>, <span class="number">-74.39967</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä½¿ç”¨ make å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex&#123;</span><br><span class="line">    <span class="string">&quot;Bell Labs&quot;</span>: Vertex&#123;</span><br><span class="line">        <span class="number">40.68433</span>, <span class="number">-74.39967</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;Google&quot;</span>: Vertex&#123;</span><br><span class="line">        <span class="number">37.42202</span>, <span class="number">-122.08408</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“å†…éƒ¨ï¼ŒVertex å¯ä»¥çœç•¥</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex&#123;</span><br><span class="line">    <span class="string">&quot;Bell Labs&quot;</span>: &#123;<span class="number">40.68433</span>, <span class="number">-74.39967</span>&#125;,</span><br><span class="line">    <span class="string">&quot;Google&quot;</span>: &#123;<span class="number">37.42202</span>, <span class="number">-122.08408</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·å–ã€ç¼–è¾‘æ˜ å°„å†…éƒ¨çš„å€¼:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å€¼</span></span><br><span class="line">m[<span class="string">&quot;Answer&quot;</span>] = <span class="number">42</span></span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å€¼</span></span><br><span class="line">m[<span class="string">&quot;Answer&quot;</span>] = <span class="number">48</span></span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å€¼</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">&quot;Answer&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒèµ‹å€¼æ£€æµ‹, elem, ok = m[key]</span></span><br><span class="line"><span class="comment">// è‹¥ key åœ¨ m ä¸­ï¼Œok ä¸º true ï¼›å¦åˆ™ï¼Œok ä¸º falseã€‚</span></span><br><span class="line"><span class="comment">// è‹¥ key ä¸åœ¨æ˜ å°„ä¸­ï¼Œé‚£ä¹ˆ elem æ˜¯è¯¥æ˜ å°„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</span></span><br><span class="line"><span class="comment">// åŒæ ·çš„ï¼Œå½“ä»æ˜ å°„ä¸­è¯»å–æŸä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œç»“æœæ˜¯æ˜ å°„çš„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</span></span><br><span class="line"><span class="comment">// è‹¥ elem æˆ– ok è¿˜æœªå£°æ˜ï¼Œä½ å¯ä»¥ä½¿ç”¨çŸ­å˜é‡å£°æ˜ï¼šelem, ok := m[key]</span></span><br><span class="line">v, ok := m[<span class="string">&quot;Answer&quot;</span>]</span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, v, <span class="string">&quot;Present?&quot;</span>, ok)</span><br></pre></td></tr></table></figure><h1 id="é—­åŒ…">é—­åŒ…</h1><p>å‡½æ•°å€¼ï¼ŒGo ä¸­å‡½æ•°ä¹Ÿå¯ä»¥è¢«ä¼ åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compute å‡½æ•°æ¥æ”¶å¦å¤–ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compute</span><span class="params">(fn <span class="keyword">func</span>(<span class="keyword">float64</span>, <span class="keyword">float64</span>)</span> <span class="title">float64</span>) <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// compute æ¥æ”¶äº† hypot ä½œä¸ºå‚æ•°</span></span><br><span class="line">hypot := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Sqrt(x*x + y*y)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(compute(hypot))</span><br></pre></td></tr></table></figure><p>å‡½æ•°çš„é—­åŒ…ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œå®ƒå¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚è¯¥å‡½æ•°å¯ä»¥è®¿é—®å¹¶èµ‹äºˆå…¶å¼•ç”¨çš„å˜é‡çš„å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œè¯¥å‡½æ•°è¢«è¿™äº›å˜é‡â€œç»‘å®šâ€åœ¨ä¸€èµ·ã€‚</p><p>æ¥ä¸€æ­¥ä¸€æ­¥ç†è§£ Go ä¸­çš„é—­åŒ…ï¼š <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªæ™®é€šçš„å‡½æ•° send å¹¶è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(message <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(message)</span><br><span class="line">&#125;</span><br><span class="line">send(<span class="string">&quot;hi, scott&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªåŒ¿åç‰ˆæœ¬çš„ send å‡½æ•°å¹¶ç«‹å³è°ƒç”¨</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰å‡½æ•°åå­—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(message <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(message)</span><br><span class="line">&#125;(<span class="string">&quot;hi, scott&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">func give_me_a_func() |func(string)| &lt;---- è¿™é‡Œè§„å®šäº†è¿”å›å€¼</span></span><br><span class="line"><span class="comment">                                           å³ä¸ºä¸€ä¸ªæ¥æ”¶ string çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">give_me_a_func</span><span class="params">()</span> <span class="title">func</span><span class="params">(<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(message <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">        fmt.Println(message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥æŠŠ give_me_a_func() ä¼ ç»™å¦å¤–ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">send_func := give_me_a_func()</span><br><span class="line">send_func(<span class="string">&quot;hi scott&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç†è§£äº†ä¸Šé¢å‡½æ•°çš„å·¥ä½œæ–¹å¼åï¼Œæˆ‘ä»¬æ¥ä»‹ç»é—­åŒ…</span></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°, å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°(return int)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementor</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å®šä¹‰å¦å¤–ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨ incrementor è¿”å›çš„å‡½æ•°</span></span><br><span class="line">next := incrementor()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°æ¯æ¬¡è°ƒç”¨ next() è¿”å›çš„å€¼</span></span><br><span class="line">fmt.Println(next())  <span class="comment">// 1</span></span><br><span class="line">fmt.Println(next())  <span class="comment">// 2</span></span><br><span class="line">fmt.Println(next())  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementor</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œ i çœ‹èµ·æ¥åº”è¯¥æ— æ³•å·¥ä½œçš„</span></span><br><span class="line">        <span class="comment">// å› ä¸º i æ˜¯å®šä¹‰åœ¨ incrementor ä¸­çš„</span></span><br><span class="line">        <span class="comment">// ä½†é—­åŒ…æ‹¥æœ‰å…¶è¢«åˆ›å»ºç¯å¢ƒä¸‹çš„ä½œç”¨åŸŸ</span></span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="å‚è€ƒ">å‚è€ƒ</h1><ul><li><a href="https://thenewstack.io/understanding-golang-type-system/">Understanding Golang Type System</a></li><li><a href="https://medium.com/m/global-identity?redirectUrl=https%3A%2F%2Fbetterprogramming.pub%2Fclosures-made-simple-with-golang-69db3017cd7b">Closures Made Simple With Golang</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ &lt;a href=&quot;https://tour.go-zh.org/welcome/1&quot;&gt;Go è¯­è¨€ä¹‹æ—…&lt;/a&gt;çš„ç¬”è®° P2, åŒ…æ‹¬äº†æŒ‡é’ˆã€ç»“æ„ä½“ã€æ•°ç»„ã€åˆ‡ç‰‡ã€æ˜ å°„å’Œé—­åŒ…ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Go" scheme="https://scottzhang.pro/categories/Go/"/>
    
    
    <category term="Go" scheme="https://scottzhang.pro/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Go è¯­æ³•æ¦‚è§ˆ P1</title>
    <link href="https://scottzhang.pro/article/ae7ab1c5.html"/>
    <id>https://scottzhang.pro/article/ae7ab1c5.html</id>
    <published>2021-12-14T15:55:09.000Z</published>
    <updated>2021-12-20T09:19:01.667Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯ <a href="https://tour.go-zh.org/welcome/1">Go è¯­è¨€ä¹‹æ—…</a>çš„ç¬”è®° P1, åŒ…å«ä¸¤å¤§éƒ¨åˆ†çš„è¯­æ³•ä»‹ç»ï¼šä¸€ä¸ªæ˜¯åŒ…ã€å˜é‡å’Œå‡½æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æµç¨‹æ§åˆ¶è¯­å¥ï¼Œå¦‚ for, if-else, switchã€‚</p></blockquote><span id="more"></span><h1 id="åŒ…å˜é‡å’Œå‡½æ•°">åŒ…ã€å˜é‡å’Œå‡½æ•°</h1><p>å…³äºåŒ…ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main <span class="comment">// æ¯ä¸ªç¨‹åºç”±åŒ…æ„æˆï¼Œä» main å¼€å§‹</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span> </span><br><span class="line">    <span class="comment">// åœ¨è¿™ä¸ªåŒ…ä¸­ï¼Œè‚¯å®šä»¥ package rand å¼€å§‹</span></span><br><span class="line">    <span class="comment">// ç”³æ˜åŒ…çš„åå­—</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å…³äºå¯¼å‡ºåï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(math.Pi) <span class="comment">//ä¸€ä¸ªåå­—ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å¯¼å‡ºçš„</span></span><br><span class="line">fmt.Println(math.pi) <span class="comment">//æœªå¯¼å‡º</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°çš„å½¢å¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç±»å‹ç›¸åŒçš„å‚æ•°å¯ä»¥ç®€å†™</span></span><br><span class="line">x <span class="keyword">int</span>, y <span class="keyword">int</span></span><br><span class="line">x,y <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x, y <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> y, x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥å†™ return ä¼šè¿”å›å‡½æ•°ä¸­å®šä¹‰äº†çš„æ‰€æœ‰å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(sum <span class="keyword">int</span>)</span> <span class="params">(x, y <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    x = sum * <span class="number">4</span> / <span class="number">9</span></span><br><span class="line">    y = sum - x</span><br><span class="line">    <span class="keyword">return</span>  </span><br><span class="line">    <span class="comment">// è¿”å› x å’Œ y, æ­¤å¤„æ˜¯ 7,10</span></span><br><span class="line">    <span class="comment">// æ­¤å¤„è¿”å›å€¼ä¼šè½¬æˆ int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äºå˜é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> c, python, java <span class="keyword">bool</span> <span class="comment">// é»˜è®¤èµ‹å€¼ä¸º false</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> <span class="comment">// é»˜è®¤èµ‹å€¼ä¸º 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹å€¼</span></span><br><span class="line">vari, j <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span> <span class="comment">// å¯ä»¥è®¾ç½®åˆå§‹å€¼</span></span><br><span class="line"><span class="keyword">var</span> c, python, java = <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">&#x27;no!&#x27;</span> <span class="comment">// ä¸æŒ‡å®šç±»å‹è€Œç›´æ¥æŒ‡å®šåˆå§‹å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å˜é‡ç®€å•æ³•ï¼Œç”¨ := æ›¿ä»£ var</span></span><br><span class="line">c, python, java := <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">&quot;no!&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸºæœ¬ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span></span><br><span class="line"><span class="keyword">string</span></span><br><span class="line"><span class="keyword">int</span>  <span class="keyword">int8</span>  <span class="keyword">int16</span>  <span class="keyword">int32</span>  <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">uint</span> <span class="keyword">uint8</span> <span class="keyword">uint16</span> <span class="keyword">uint32</span> <span class="keyword">uint64</span> <span class="keyword">uintptr</span></span><br><span class="line"><span class="keyword">byte</span> <span class="comment">// uint8 çš„åˆ«å</span></span><br><span class="line"><span class="keyword">rune</span> <span class="comment">// int32 çš„åˆ«å</span></span><br><span class="line">    <span class="comment">// è¡¨ç¤ºä¸€ä¸ª Unicode ç ç‚¹</span></span><br><span class="line"><span class="keyword">float32</span> <span class="keyword">float64</span></span><br><span class="line"><span class="keyword">complex64</span> <span class="keyword">complex128</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è¯­æ³•å—å£°æ˜å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    ToBe   <span class="keyword">bool</span>       = <span class="literal">false</span></span><br><span class="line">    MaxInt <span class="keyword">uint64</span>     = <span class="number">1</span>&lt;&lt;<span class="number">64</span> - <span class="number">1</span></span><br><span class="line">    z      <span class="keyword">complex128</span> = cmplx.Sqrt(<span class="number">-5</span> + <span class="number">12i</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰ç»™åˆå§‹å€¼ï¼Œé»˜è®¤ä¼šèµ‹å€¼, æ•°å€¼æ˜¯0ï¼Œ å¸ƒå°” falseï¼Œå­—ç¬¦ä¸²æ˜¯ç©ºå­—ç¬¦</span></span><br></pre></td></tr></table></figure><p>ç±»å‹è½¬æ¢ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// int -&gt; float -&gt; uint</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> f float = <span class="keyword">float64</span>(i)</span><br><span class="line"><span class="keyword">var</span> u <span class="keyword">uint</span> = <span class="keyword">uint</span>(f)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•çš„å½¢å¼</span></span><br><span class="line">i := <span class="number">42</span></span><br><span class="line">f := <span class="keyword">float64</span>(i)</span><br><span class="line">u := <span class="keyword">uint</span>(f)</span><br></pre></td></tr></table></figure><p>ç±»å‹æ¨å¯¼:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥å‡†ç¡®æ¨å¯¼çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">j := i</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸èƒ½å‡†ç¡®æ¨å¯¼æˆ–è€…å› ä¸ºå€¼è¿ç®—çš„ç»“æœï¼Œéœ€è¦æ”¹å˜ç²¾åº¦</span></span><br><span class="line">i := <span class="number">42</span></span><br><span class="line">j := <span class="number">3.142</span></span><br><span class="line">g := <span class="number">0.867</span> + <span class="number">0.5i</span> </span><br><span class="line"><span class="comment">// æ³¨æ„: g = 0.867 + 0.5i ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure><p>å¸¸é‡:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Pi = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">const</span> Pi := <span class="number">3.14</span> <span class="comment">//syntax error: unexpected :=, expecting =</span></span><br></pre></td></tr></table></figure><p>æ•°å€¼å¸¸é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°† 1 å·¦ç§» 100 ä½æ¥åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—</span></span><br><span class="line"><span class="comment">// å³è¿™ä¸ªæ•°çš„äºŒè¿›åˆ¶æ˜¯ 1 åé¢è·Ÿç€ 100 ä¸ª 0</span></span><br><span class="line">Big = <span class="number">1</span> &lt;&lt; <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†å¾€å³ç§» 99 ä½ï¼Œå³ Small = 1 &lt;&lt; 1ï¼Œæˆ–è€…è¯´ Small = 2</span></span><br><span class="line">Small = Big &gt;&gt; <span class="number">99</span></span><br></pre></td></tr></table></figure><h1 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶</h1><p>Go åªæœ‰ä¸€ç§å¾ªç¯ç»“æ„å³ for å¾ªç¯ï¼Œåˆ†æˆä¸‰éƒ¨åˆ†</p><ul><li><p>åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£å‰æ‰§è¡Œ</p></li><li><p>æ¡ä»¶è¡¨è¾¾å¼ï¼šåœ¨æ¯æ¬¡è¿­ä»£å‰æ±‚å€¼</p></li><li><p>åç½®è¯­å¥ï¼šåœ¨æ¯æ¬¡è¿­ä»£çš„ç»“å°¾æ‰§è¡Œ</p></li></ul><p>å®ƒæœ‰ä¸‰ç§å†™æ³•ï¼Œfor åé¢æ²¡æœ‰å°æ‹¬å·ï¼Œ å¤§æ‹¬å· <code>&#123; &#125;</code> åˆ™æ˜¯å¿…é¡»çš„</p><ul><li><strong>for init; condition; post{}</strong></li><li><strong>for condition {}</strong></li><li><strong>for {}</strong></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for init; condition; post&#123;&#125;</span></span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    sum += i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for condition &#123;&#125;</span></span><br><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> ; sum &lt; <span class="number">1000</span>; &#123;</span><br><span class="line">    sum += sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;</span><br><span class="line">    sum += sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for &#123;&#125; æ— é™å¾ªç¯</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äº If è¯­å¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— (), å¿…é¡»æœ‰ &#123;&#125;</span></span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡ä»¶è¡¨è¾¾å¼å‰å¯ä»¥æ‰§è¡Œä¸€ä¸ªç®€å•çš„è¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> v := add(x, y); v &lt; <span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// else è¯­æ³•</span></span><br><span class="line"><span class="keyword">if</span> v:= add(x, y) &#123;</span><br><span class="line">    <span class="comment">// do a</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// do b</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ­¤å¤„ä¸å¯ä»¥ä½¿ç”¨ v äº†</span></span><br></pre></td></tr></table></figure><p>å…³äº switch:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Print(<span class="string">&quot;Go runs on &quot;</span>)</span><br><span class="line">    <span class="keyword">switch</span> os := runtime.GOOS; os &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;darwin&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;OS X.&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;linux&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Linux.&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// freebsd, openbsd,</span></span><br><span class="line">        <span class="comment">// plan9, windows...</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;%s.\n&quot;</span>, os)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Go åªè¿è¡Œé€‰å®šçš„ caseï¼Œè€Œéä¹‹åæ‰€æœ‰çš„ case</span></span><br><span class="line"><span class="comment">// switch çš„ case æ— éœ€ä¸ºå¸¸é‡ï¼Œä¸”å–å€¼ä¸å¿…ä¸ºæ•´æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚å€¼é¡ºåºä»ä¸Šåˆ°ä¸‹ï¼Œæ‰¾åˆ°åŒ¹é…æˆåŠŸ</span></span><br><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">case</span> f(): <span class="comment">// f() ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰æ¡ä»¶çš„ switch</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t := time.Now()</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good morning!&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> t.Hour() &lt; <span class="number">17</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good afternoon.&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good evening.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äº defer:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// defer ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶å‚æ•°ä¼šç«‹å³æ±‚å€¼ï¼Œä½†ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment">// ä¸‹é¢çš„ä»£ç è¾“å‡º hello \n world</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨è¿Ÿçš„å‡½æ•°è¢«å‹å…¥æ ˆï¼Œå…ˆè¿›åå‡º</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥ä¸‹é¢çš„å‡½æ•°ä¼šä»¥ 987.. çš„é¡ºåºæ‰“å°</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;counting&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ &lt;a href=&quot;https://tour.go-zh.org/welcome/1&quot;&gt;Go è¯­è¨€ä¹‹æ—…&lt;/a&gt;çš„ç¬”è®° P1, åŒ…å«ä¸¤å¤§éƒ¨åˆ†çš„è¯­æ³•ä»‹ç»ï¼šä¸€ä¸ªæ˜¯åŒ…ã€å˜é‡å’Œå‡½æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æµç¨‹æ§åˆ¶è¯­å¥ï¼Œå¦‚ for, if-else, switchã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Go" scheme="https://scottzhang.pro/categories/Go/"/>
    
    
    <category term="Go" scheme="https://scottzhang.pro/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Go ç¬”è®°: Module</title>
    <link href="https://scottzhang.pro/article/4b8d4d9.html"/>
    <id>https://scottzhang.pro/article/4b8d4d9.html</id>
    <published>2021-12-14T14:33:51.000Z</published>
    <updated>2021-12-20T09:11:58.329Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Understand Module in Golang.</p></blockquote><span id="more"></span><h1 id="code-example">Code example</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello.go</span></span><br><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">quoteV3 <span class="string">&quot;rsc.io/quote/v3&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> quoteV3.HelloV3()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Proverb</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> quoteV3.Concurrency()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello_test.go</span></span><br><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestHello</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">want := <span class="string">&quot;Hello, world.&quot;</span></span><br><span class="line"><span class="keyword">if</span> got := Hello(); got != want &#123;</span><br><span class="line">t.Errorf(<span class="string">&quot;Hello() = %q, want %q&quot;</span>, got, want)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestProverb</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">want := <span class="string">&quot;Concurrency is not parallelism.&quot;</span></span><br><span class="line"><span class="keyword">if</span> got := Proverb(); got != want &#123;</span><br><span class="line">t.Errorf(<span class="string">&quot;Proverb() = %q, want %q&quot;</span>, got, want)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go.mod</span></span><br><span class="line">module scottzhang.pro/hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.17</span></span><br><span class="line"></span><br><span class="line">require rsc.io/quote/v3 v3<span class="number">.1</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">golang.org/x/text v0<span class="number">.3</span><span class="number">.7</span> <span class="comment">// indirect</span></span><br><span class="line">rsc.io/sampler v1<span class="number">.3</span><span class="number">.0</span> <span class="comment">// indirect</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="use-go-modules">Use Go Modules</h1><p>What is module?</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">moduleï¼ša collection of Go packages</span><br><span class="line">  |</span><br><span class="line">go.mod:</span><br><span class="line">    - module&#x27;s module path</span><br><span class="line">    - dependency requirements</span><br></pre></td></tr></table></figure><p>The Running ENV for a module:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. outside $GOPATH/src &lt;--</span><br><span class="line">2. inside any folder     |</span><br><span class="line">   with:                 |</span><br><span class="line">       - go.mod --------&gt;|</span><br></pre></td></tr></table></figure><p>How to creating a new module:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. create you file.  // status: contains a package</span><br><span class="line">2. cmd: go mod init scottzhang.pro/hello  // make the current directory the root of a module</span><br><span class="line">3. cmd: go test  // test the module</span><br></pre></td></tr></table></figure><ul><li>Packages in subdirectories have import paths consisting of the module path plus the path to the subdirectory.</li><li>So you don't need to run <strong>go mod init</strong> in subdirectories.</li></ul><p>Understand go.mod content:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">example.com/hello //main module</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c //an example of a pseudo-version</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br><span class="line"></span><br><span class="line">// go <span class="built_in">command</span> maintains a file named go.sum</span><br><span class="line">// containing the expected cryptographic hashes of the content of specific module versions.</span><br><span class="line">// ensure that future downloads of these modules retrieve the same bits as the first download</span><br></pre></td></tr></table></figure><p>How to import dependencies module:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;rsc.io/quote&quot;</span></span><br><span class="line"><span class="comment">// to check  indirect dependencies</span></span><br><span class="line"><span class="comment">// cmd: go list -m all</span></span><br></pre></td></tr></table></figure><p>How to upgrading dependencies:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// here is a example to upgrade text and sampler</span><br><span class="line">cmd: go get golang.org/x/text</span><br><span class="line">cmd: go get rsc.io/sampler</span><br></pre></td></tr></table></figure><p>Now depends on both <strong>rsc.io/quote</strong> and <strong>rsc.io/quote/v3</strong>.</p><p>why here is V3?, because:</p><ul><li>Each different major version (v1, v2, and so on) of a Go module uses a different module path</li><li>v3 of rsc.io/quote = rsc.io/quote/v3, Know more visit <a href="https://research.swtch.com/vgo-import">here</a></li></ul><blockquote><p>You can have v1, v2, v3 in same module, but can't with v1.1 and v1.2</p></blockquote><p>To know what new changes in new version, type <strong>go doc rsc.io/quote/v3</strong>.</p><p>Remove no need module:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go list -m all  # check</span><br><span class="line">go mod tidy  # cleans up these unused dependencies</span><br></pre></td></tr></table></figure><h1 id="conclusion">Conclusion</h1><ul><li><strong>go mod init</strong> creates a new module, initializing the go.mod file that describes it.</li><li><strong>go build</strong>, go test, and other package-building commands add new dependencies to go.mod as needed.</li><li><strong>go list -m all</strong> prints the current moduleâ€™s dependencies.</li><li><strong>go get</strong> changes the required version of a dependency (or adds a new dependency).</li><li><strong>go mod tidy</strong> removes unused dependencies.</li></ul><h1 id="ref">Ref</h1><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-go-modules">How to Use Go Modules</a></li><li><a href="https://go.dev/blog/using-go-modules">Using Go Modules</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Understand Module in Golang.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Go" scheme="https://scottzhang.pro/categories/Go/"/>
    
    
    <category term="Go" scheme="https://scottzhang.pro/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Python è®¾è®¡æ¨¡å¼-æŠ½è±¡å·¥å‚ä¸ç»„åˆæ¨¡å¼</title>
    <link href="https://scottzhang.pro/article/72c6f483.html"/>
    <id>https://scottzhang.pro/article/72c6f483.html</id>
    <published>2021-11-28T13:44:50.000Z</published>
    <updated>2021-11-28T13:50:30.117Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æŠ½è±¡å·¥å‚æ¨¡å¼è®©ä½ çš„ä»£ç ä¸€é”®éƒ¨ç½²ä¸ºä¸åŒåŒºåŸŸçš„å’Œè¯­è¨€ï¼Œç»„åˆæ¨¡å¼åˆ™æ“…é•¿å¤„ç†æ ‘çŠ¶ç»“æ„çš„é—®é¢˜ã€‚</p></blockquote><span id="more"></span><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œ<a href="https://scottzhang.pro/categories/è®¾è®¡æ¨¡å¼/">ç‚¹å‡»</a>æŸ¥çœ‹è¯¥ç³»åˆ—çš„å…¶ä»–æ–‡ç« ã€‚</p><h1 id="æŠ½è±¡å·¥å‚æ¨¡å¼">æŠ½è±¡å·¥å‚æ¨¡å¼</h1><p>æƒ³è®©ä½ çš„ç³»ç»Ÿæ ¹æ®é…ç½®æˆ–å¹³å°çš„é—®é¢˜æœ‰å¤šä¸ªå¯èƒ½çš„å®ç°ï¼Œå°±å¯ä»¥åˆ©ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚</p><p>ä½ è°ƒç”¨æŠ½è±¡å·¥å‚ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å®ç°ä¼šåŸºäºä½ çš„éœ€æ±‚è€Œå˜åŒ–ã€‚</p><ul><li>å¯¹äºä¸€ä¸ªåœ¨çº¿çš„å•†åŸï¼Œå®ƒå¯¹äºä¸åŒçš„å›½å®¶æœ‰ä¸åŒçš„è¯­è¨€ã€è´§å¸ä»¥åŠç¨æ”¶çš„è®¡ç®—æ–¹å¼ã€‚</li><li>å¯¹äºä¸€å¥— GUI å·¥å…·ï¼Œåœ¨ Windows ä¸Šå¯èƒ½è¿”å›çš„æ˜¯ WinFormï¼Œåœ¨ Mac ä¸Šè¿”å›çš„åˆ™æ˜¯ Cocoa ç»„ä»¶ã€‚</li><li>å¯¹äº Djangoï¼Œå®ƒä¼šæ ¹æ®å½“å‰ç«™ç‚¹çš„é…ç½®è€Œè¿”å›ç›¸å…³çš„å¯¹è±¡ä»¥å¯¹ä¸åŒæ•°æ®åº“åç«¯çš„æ”¯æŒã€‚</li></ul><p>æƒ³è±¡ä¸€ä¸ªæ ¼å¼åŒ–æ—¥æœŸä¸è´§å¸çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒä¸­è‹±æ–‡ä¸¤ç§æƒ…å†µä¸‹çš„è´§å¸å’Œæ—¥æœŸã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChinaDateFormatter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_date</span>(<span class="params">self, y, m, d</span>):</span></span><br><span class="line">        y, m, d = (<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> (y, m, d))</span><br><span class="line">        y = <span class="string">&#x27;20&#x27;</span> + y <span class="keyword">if</span> <span class="built_in">len</span>(y) == <span class="number">2</span> <span class="keyword">else</span> y</span><br><span class="line">        m = <span class="string">&#x27;0&#x27;</span> + m <span class="keyword">if</span> <span class="built_in">len</span>(m) == <span class="number">1</span> <span class="keyword">else</span> m</span><br><span class="line">        d = <span class="string">&#x27;0&#x27;</span> + d <span class="keyword">if</span> <span class="built_in">len</span>(d) == <span class="number">1</span> <span class="keyword">else</span> d</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot; &#123;&#125; å¹´ &#123;&#125; æœˆ &#123;&#125; æ—¥ &quot;</span>.<span class="built_in">format</span>(y, m, d))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">USADateFormatter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_date</span>(<span class="params">self, y, m, d</span>):</span></span><br><span class="line">        y, m, d = (<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> (y, m, d))</span><br><span class="line">        y = <span class="string">&#x27;20&#x27;</span> + y <span class="keyword">if</span> <span class="built_in">len</span>(y) == <span class="number">2</span> <span class="keyword">else</span> y</span><br><span class="line">        m = <span class="string">&#x27;0&#x27;</span> + m <span class="keyword">if</span> <span class="built_in">len</span>(m) == <span class="number">1</span> <span class="keyword">else</span> m</span><br><span class="line">        d = <span class="string">&#x27;0&#x27;</span> + d <span class="keyword">if</span> <span class="built_in">len</span>(d) == <span class="number">1</span> <span class="keyword">else</span> d</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(y, m, d))</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ChinaDateFormatter().format_date(<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)  <span class="comment"># &#x27; 2021 å¹´ 01 æœˆ 01 æ—¥ &#x27;</span></span><br><span class="line">ChinaDateFormatter().format_date(<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;27&#x27;</span>)  <span class="comment"># &#x27; 2021 å¹´ 11 æœˆ 27 æ—¥ &#x27;</span></span><br><span class="line"></span><br><span class="line">USADateFormatter().format_date(<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)  <span class="comment"># &#x27;2021-01-01&#x27;</span></span><br><span class="line">USADateFormatter().format_date(<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>) <span class="comment"># &#x27;2021-01-01&#x27;</span></span><br></pre></td></tr></table></figure><p>å†æ¥å®šä¹‰ä¸¤ä¸ªå¤„ç†è´§å¸çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChinaCurrencyFormatter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span>(<span class="params">self, base, cents</span>):</span></span><br><span class="line">        base, cents = (<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> (base, cents))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(cents) == <span class="number">0</span>:</span><br><span class="line">            cents = <span class="string">&#x27;00&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(cents) == <span class="number">1</span>:</span><br><span class="line">            cents = <span class="string">&#x27;0&#x27;</span> + cents</span><br><span class="line"></span><br><span class="line">        digits = []</span><br><span class="line">        <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">reversed</span>(<span class="built_in">str</span>(base))):</span><br><span class="line">            <span class="comment"># i è®¡ç®—ä½æ•°ï¼Œåƒä½ == 3</span></span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">and</span> <span class="keyword">not</span> i % <span class="number">3</span>:</span><br><span class="line">                digits.append(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            digits.append(c)</span><br><span class="line">        base = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(digits))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Â¥ &#123;&#125;.&#123;&#125; å…ƒ&quot;</span>.<span class="built_in">format</span>(base, cents)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">USACurrencyFormatter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span>(<span class="params">self, base, cents</span>):</span></span><br><span class="line">        base, cents = (<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> (base, cents))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(cents) == <span class="number">0</span>:</span><br><span class="line">            cents = <span class="string">&#x27;00&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(cents) == <span class="number">1</span>:</span><br><span class="line">            cents = <span class="string">&#x27;0&#x27;</span> + cents</span><br><span class="line"></span><br><span class="line">        digits = []</span><br><span class="line">        <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">reversed</span>(<span class="built_in">str</span>(base))):</span><br><span class="line">            <span class="comment"># i è®¡ç®—ä½æ•°ï¼Œåƒä½ == 3</span></span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">and</span> <span class="keyword">not</span> i % <span class="number">3</span>:</span><br><span class="line">                digits.append(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            digits.append(c)</span><br><span class="line">        base = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(digits))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;$ &#123;&#125;.&#123;&#125;&quot;</span>.<span class="built_in">format</span>(base, cents)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ChinaCurrencyFormatter().<span class="built_in">format</span>(<span class="number">1432</span>, <span class="number">5</span>)  <span class="comment"># &#x27;Â¥ 143,958,766,111,111.05 å…ƒ&#x27;</span></span><br><span class="line">USACurrencyFormatter().<span class="built_in">format</span>(<span class="number">1432</span>, <span class="number">5</span>)  <span class="comment"># &#x27;$ 143,958,766,111,111.05&#x27;</span></span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ä»£ç æŒ‰ç…§å›½å®¶ç»„ç»‡åœ¨ä¸€èµ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">USAFormatterFactory</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_date_formatter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> USADateFormatter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_currency_formatter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> USACurrencyFormatter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChinaFormatterFactory</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_date_formatter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> ChinaDateFormatter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_currency_formatter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> ChinaCurrencyFormatter()</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å­—å…¸å»æ‰¾å¯¹åº”çš„æŠ½è±¡å·¥å‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">factory_map = &#123;</span><br><span class="line">    <span class="string">&#x27;US&#x27;</span>: USAFormatterFactory,</span><br><span class="line">    <span class="string">&#x27;China&#x27;</span>: ChinaFormatterFactory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®åŒºåŸŸä¸ºä¸­å›½ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">country_code = &#x27;China&#x27;</span><br><span class="line">formatter_factor = factory_map.get(country_code)()</span><br><span class="line">formatter_factor.create_date_formatter().format_date(&#x27;21&#x27;, &#x27;1&#x27;, &#x27;1&#x27;)</span><br><span class="line"></span><br><span class="line"># &#x27; 2021 å¹´ 01 æœˆ 01 æ—¥ &#x27;</span><br></pre></td></tr></table></figure><p>è®¾ç½®åŒºåŸŸä¸ºç¾å›½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">country_code = <span class="string">&#x27;US&#x27;</span></span><br><span class="line">formatter_factor = factory_map.get(country_code)()</span><br><span class="line">formatter_factor.create_date_formatter().format_date(<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x27;2021-01-01&#x27;</span></span><br></pre></td></tr></table></figure><p>åœ¨å®é™…çš„é¡¹ç›®æ¶æ„ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªåç«¯çš„æ¨¡å—æ¥æ”¯æŒå¯¹ä¸åŒå›½å®¶æä¾›æœåŠ¡ï¼Œå®ƒçš„ç»“æ„å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">localize/</span><br><span class="line">__init__.py</span><br><span class="line">backends/</span><br><span class="line">__init__.py</span><br><span class="line">USA.py</span><br><span class="line">China.py</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ localize ä¸‹é¢çš„ <code>__init__.py</code> æ–‡ä»¶ä¸­ï¼ŒåŠ¨æ€çš„é€‰æ‹©åŒºåŸŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .backends <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> country_code == <span class="string">&#x27;China&#x27;</span>:</span><br><span class="line">current_backend = <span class="string">&#x27;China&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h1 id="ç»„åˆæ¨¡å¼">ç»„åˆæ¨¡å¼</h1><p>ç»„åˆæ¨¡å¼ä¸€èˆ¬é€šè¿‡ç»„å»ºæ¥æ„é€ å¤æ‚çš„æ ‘çŠ¶ç»“æ„ï¼Œå®ƒåœ¨æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å¤¹æ ‘ä¸­çš„åº”ç”¨æ¯”è¾ƒå¤šã€‚</p><p>æ–‡ä»¶ç›®å½•ä¸­é€šå¸¸æœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ï¼Œæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚é¦–å…ˆæ¥å®šä¹‰è¿™ä¸¤ä¸ªç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Folder</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.children = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_child</span>(<span class="params">self, child</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">sejlf</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, contents</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.contents = contents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æŠ½è±¡åˆ°åŸºç±»ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compoment</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      get_path æ–¹æ³•ä¼šåœ¨å¤–éƒ¨å®ç°</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line">        new_folder = get_path(new_path)</span><br><span class="line">        <span class="keyword">del</span> self.parent.children[self.name]</span><br><span class="line">        new_folder.children[self.name] = self</span><br><span class="line">        self.parent = new_folder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">del</span> self.parent.children[self.name]</span><br></pre></td></tr></table></figure><p>è¿™æ · File å’Œ Folder ç±»å°±å¯ä»¥å°‘å»ä¸€äº›ä»£ç äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Folder</span>(<span class="params">Compoment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        self.children = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_child</span>(<span class="params">self, child</span>):</span></span><br><span class="line">        child.parent = self</span><br><span class="line">        self.children[child.name] = child</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>(<span class="params">Compoment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, contents</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        self.contents = contents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span>(<span class="params">self, new_path</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è¿›è¡Œä»»æ„çš„ç»„åˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root = Folder(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">folder1 = Folder(<span class="string">&#x27;F1&#x27;</span>)</span><br><span class="line">folder2 = Folder(<span class="string">&#x27;F2&#x27;</span>)</span><br><span class="line">hello_file = File(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;hello scott&#x27;</span>)</span><br><span class="line"></span><br><span class="line">folder2.add_child(hello_file)</span><br><span class="line">folder1.add_child(folder2)</span><br><span class="line">root.add_child(folder1)</span><br><span class="line"></span><br><span class="line">root.children[<span class="string">&#x27;F1&#x27;</span>].children[<span class="string">&#x27;F2&#x27;</span>].children[<span class="string">&#x27;hello&#x27;</span>].contents</span><br></pre></td></tr></table></figure><p>å½“ä½ åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œé‡åˆ°äº†æ ‘çŠ¶ç»“æ„çš„æ—¶å€™ï¼Œå¯ä»¥æƒ³æƒ³æ˜¯å¦å¯ä»¥åº”ç”¨ç»„åˆæ¨¡å¼ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æŠ½è±¡å·¥å‚æ¨¡å¼è®©ä½ çš„ä»£ç ä¸€é”®éƒ¨ç½²ä¸ºä¸åŒåŒºåŸŸçš„å’Œè¯­è¨€ï¼Œç»„åˆæ¨¡å¼åˆ™æ“…é•¿å¤„ç†æ ‘çŠ¶ç»“æ„çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Python è®¾è®¡æ¨¡å¼-é€‚é…å™¨ä¸å¤–è§‚æ¨¡å¼</title>
    <link href="https://scottzhang.pro/article/2b511f30.html"/>
    <id>https://scottzhang.pro/article/2b511f30.html</id>
    <published>2021-11-26T09:46:19.000Z</published>
    <updated>2021-11-28T13:50:12.804Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é€‚é…å™¨æ¨¡å¼è®©ä½ å¯ä»¥å…¼å®¹ç°æœ‰ä»£ç ï¼Œå¤–è§‚æ¨¡å¼åˆ™æ˜¯ä¸ºäº†å°è£…ä»£ç è€Œè®¾è®¡ã€‚</p></blockquote><span id="more"></span><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œ<a href="https://scottzhang.pro/categories/è®¾è®¡æ¨¡å¼/">ç‚¹å‡»</a>æŸ¥çœ‹è¯¥ç³»åˆ—çš„å…¶ä»–æ–‡ç« ã€‚</p><h1 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</h1><p>é€‚é…å™¨æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰å°±å¥½åƒæ˜¯ç”µè„‘çš„è½¬æ¥å¤´ä¸€æ ·ï¼Œç›®çš„å°±æ˜¯è®©ä¸åŒçš„ç³»ç»Ÿä¹‹é—´å¯ä»¥ååŒå·¥ä½œã€‚</p><p>æ¯”å¦‚ç°åœ¨å·²ç»å­˜åœ¨ä¸€äº›ä»£ç äº†ï¼Œä½†ä½ ä¸æƒ³å¯¹å®ƒåšä»»ä½•æ›´æ”¹ï¼Œå› ä¸ºè¿™æ„å‘³ç€ä½ è¦ä¿®æ”¹å¤§é‡çš„å†…å®¹ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥å†™ä¸€ä¸ªé€‚é…å™¨ï¼Œå°†è¾“å…¥è½¬åŒ–æˆç°æœ‰ä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œè¿™å°±å«é€‚é…å™¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¥‡æ€ªçš„æ—¥æœŸæ ¼å¼ï¼Œå®ƒçš„å¹´å’Œæœˆä¸­é—´æœ‰ä¸€ä¸ª14ï¼Œç°åœ¨æœ‰ä¸€ä¸ªä»£ç çš„é€»è¾‘æ˜¯å¾—åˆ°åˆå§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸä¸­é—´çš„å¤©æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaysCalculator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, start, end</span>):</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.end = end</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_days</span>(<span class="params">self</span>):</span></span><br><span class="line">        start = datetime.datetime.strptime(self.start, <span class="string">&#x27;%Y14%m&#x27;</span>)</span><br><span class="line">        end = datetime.datetime.strptime(self.end, <span class="string">&#x27;%Y14%m&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> (end - start).days</span><br><span class="line"></span><br><span class="line">DaysCalculator(start=<span class="string">&#x27;20211403&#x27;</span>, end=<span class="string">&#x27;20211409&#x27;</span>).get_days()</span><br><span class="line"><span class="comment"># è¾“å‡º 184</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ æœ‰ä¸€äº›æ–¹æ³•éœ€è¦ä¾èµ–è¿™æ®µä»£ç ï¼Œä½ ä¸å¾—ä¸ä¹ŸæŒ‰ç…§è¿™ä¸ªå¥‡æ€ªçš„æ ¼å¼å·¥ä½œï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä½ å¯ä»¥å†™ä¸€ä¸ªé€‚é…å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaysAdaptor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, start, end</span>):</span></span><br><span class="line">        start = datetime.datetime.strftime(start, <span class="string">&#x27;%Y14%m&#x27;</span>)</span><br><span class="line">        end = datetime.datetime.strftime(end, <span class="string">&#x27;%Y14%m&#x27;</span>)</span><br><span class="line">        self.calculator = DaysCalculator(start, end)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_days</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.calculator.get_days()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„é€ ä¸¤ä¸ªæ ‡å‡†æ—¥æœŸå¯¹è±¡ä½œä¸ºè¾“å…¥</span></span><br><span class="line">start = datetime.datetime.strptime(<span class="string">&#x27;2021/3&#x27;</span>, <span class="string">&#x27;%Y/%m&#x27;</span>)</span><br><span class="line">end = datetime.datetime.strptime(<span class="string">&#x27;2021/9&#x27;</span>, <span class="string">&#x27;%Y/%m&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œä¼ å…¥çš„æ—¥æœŸç±»çš„æ—¥æœŸï¼Œä½†ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œ</span></span><br><span class="line">DaysAdaptor(start, end).get_days()</span><br></pre></td></tr></table></figure><h1 id="å¤–è§‚æ¨¡å¼">å¤–è§‚æ¨¡å¼</h1><p>å¤–è§‚æ¨¡å¼æ›´å…³æ³¨å¤–éƒ¨çš„ä½“éªŒï¼Œä¸ºäº†ç”¨æˆ·ä½“éªŒçš„æ–¹ä¾¿ï¼Œå®ƒå°†å¤æ‚çš„å†…éƒ¨ä»£ç å°è£…èµ·æ¥ï¼Œåªæš´éœ²ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥å—å‚æ•°ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œä»è€Œå®ç°ä¸åŒçš„åŠŸèƒ½ã€‚</p><p>ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œä½ æƒ³ç¼–å†™ä¸€ä¸ªæ¥å—/å‘é€é‚®ä»¶çš„å®¢æˆ·ç«¯ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œå®ƒåªéœ€å…³å¿ƒï¼š</p><ul><li>å‘ä»¶äººåœ°å€</li><li>é‚®ä»¶å†…å®¹</li><li>æ¥å—äººåœ°å€</li></ul><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œåªå…³å¿ƒè¿™å‡ ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™çš„å¯¹äºåœ°å€çš„å¤„ç†ã€æ£€æŸ¥ï¼Œå¯¹äºç”¨æˆ·å¯†ç çš„éªŒè¯ç­‰ç­‰åˆ™éšè—åœ¨å‡½æ•°å†…éƒ¨ã€‚</p><p>ç›¸ä¿¡ä½ å·²ç»åœ¨è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨è¿‡å¤–è§‚æ¨¡å¼ï¼Œæ­¤å¤„ä¸åœ¨ä¸¾ä¾‹ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;é€‚é…å™¨æ¨¡å¼è®©ä½ å¯ä»¥å…¼å®¹ç°æœ‰ä»£ç ï¼Œå¤–è§‚æ¨¡å¼åˆ™æ˜¯ä¸ºäº†å°è£…ä»£ç è€Œè®¾è®¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Python è®¾è®¡æ¨¡å¼-äº«å…ƒä¸å‘½ä»¤æ¨¡å¼</title>
    <link href="https://scottzhang.pro/article/56f28bda.html"/>
    <id>https://scottzhang.pro/article/56f28bda.html</id>
    <published>2021-11-26T09:42:59.000Z</published>
    <updated>2021-11-28T13:50:17.622Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« è®¨è®ºäº†äº«å…ƒæ¨¡å¼ä¸å‘½ä»¤æ¨¡å¼ã€‚</p></blockquote><span id="more"></span><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œ<a href="https://scottzhang.pro/categories/è®¾è®¡æ¨¡å¼/">ç‚¹å‡»</a>æŸ¥çœ‹è¯¥ç³»åˆ—çš„å…¶ä»–æ–‡ç« ã€‚</p><h1 id="äº«å…ƒæ¨¡å¼">äº«å…ƒæ¨¡å¼</h1><p>å…ƒã€æ°”ä¹‹å§‹ï¼Œå¼•ç”³ä¸ºå…ƒæ°”ã€‚äº«å…ƒæ¨¡å¼å³å…±äº«æœ€åˆçš„é‚£éƒ¨åˆ†ï¼Œå“ªéƒ¨åˆ†å‘¢ï¼Ÿ</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦åˆ›å»ºå¤§é‡çš„ç±»å®ä¾‹ï¼Œåˆ©ç”¨äº«å…ƒæ¨¡å¼ï¼Œå°±å¯ä»¥ä¿è¯<strong>å…±äº«åŒä¸€çŠ¶æ€çš„å¯¹è±¡ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨è¯¥å…±äº«çŠ¶æ€çš„å†…å­˜ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¹‹å‰èŠè¿‡çš„æ±½è½¦é”€å”®ç³»ç»Ÿã€‚å¯¹äºæ¯ä¸€è¾†è½¦ï¼Œæˆ‘ä»¬å¯ä»¥åŠ è£…ä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚æœ‰å°Šäº«ç‰ˆã€è±ªåç‰ˆç­‰ç­‰ã€‚</p><p>ä¸åŒç‰ˆæœ¬ä¹‹é—´ï¼Œå…¶å®æ˜¯å¤§åŒå°å¼‚ã€‚</p><p>å¦‚æœå¯¹äºæ¯è¾†è½¦æˆ‘ä»¬éƒ½å»ç»Ÿè®¡å®ƒæœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œæ²¡æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œåˆ™ä¼šäº§ç”Ÿå·¨å¤§çš„æµªè´¹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å…±äº«å¯¹è±¡å»å­˜å‚¨é‚£äº›ä¸å‹å·ç›¸å…³çš„ç‰¹æ€§åˆ—è¡¨ã€‚</p><p>äº«å…ƒåœ¨ Python ä¸­çš„å®ç°ç±»ä¼¼å•ä¾‹æ¨¡å¼ã€‚</p><p>ä½†å•ä¾‹æ¨¡å¼è¿”å›çš„æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè€Œäº«å…ƒæ¨¡å¼åˆ™æ˜¯æ ¹æ®æŒ‡å®šçš„ä¸åŒå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„å®ä¾‹ã€‚</p><p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gc  <span class="comment"># åƒåœ¾å›æ”¶å™¨</span></span><br><span class="line"><span class="keyword">import</span> weakref <span class="comment"># å¼±å¼•ç”¨æ•°æ®ç»“æ„åŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarModel</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¼±å¼•ç”¨çš„å­—å…¸ï¼Œå†…éƒ¨çš„å¯¹è±¡å¼±æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåˆ™ä¼šè¢«å›æ”¶ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    _models = weakref.WeakValueDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, model_name, *avgs, **kvargs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿™é‡Œå¯¹æ–°å®ä¾‹çš„åˆ›å»ºè‡ªå®šä¹‰ï¼Œä¸å•ä¾‹æ¨¡å¼æœ‰ç‚¹ç±»ä¼¼</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        model = cls._models.get(model_name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> model:</span><br><span class="line">            model = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">            cls._models[model_name] = model</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, model_name, air=<span class="literal">False</span>, title=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 cruise_control=<span class="literal">False</span>, power_locks=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 allow_whells=<span class="literal">False</span>, use_charger=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;å®ä¾‹çš„åˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œå®Œæˆ</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.model_name = model_name</span><br><span class="line">        self.air = air</span><br><span class="line">        self.title = title</span><br><span class="line">        self.cruise_control = cruise_control</span><br><span class="line">        self.power_locks = power_locks</span><br><span class="line">        self.allow_whells = allow_whells</span><br><span class="line">        self.use_charger = use_charger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_serial</span>(<span class="params">self, serial_number</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Sorry We are anble to check&quot;</span>,</span><br><span class="line">            <span class="string">&quot;the seria number &#123;0&#125; on the &#123;1&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;at this time&quot;</span>.<span class="built_in">format</span>(self.number, self.model_name)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, model, color, serial</span>):</span></span><br><span class="line">        self.model = model</span><br><span class="line">        self.color = color</span><br><span class="line">        self.serial = serial</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_serial</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.model.check_serial(self.serial)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªæ˜¯æ±½è½¦æ¨¡ç‰ˆï¼Œä¸€ä¸ªæ˜¯æ±½è½¦ã€‚æˆ‘ä»¬æ¥ç”Ÿäº§å‡ è¾†è½¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dx = CarModel(<span class="string">&quot;FIT DX&quot;</span>)</span><br><span class="line">lx = CarModel(<span class="string">&quot;FIT LX&quot;</span>, air=<span class="literal">True</span>, cruise_control=<span class="literal">True</span>, power_locks=<span class="literal">True</span>, title=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§ä¸€äº›è½¦</span></span><br><span class="line">car1 = Car(model=dx, color=<span class="string">&#x27;blue&#x27;</span>, serial=<span class="string">&#x27;DX001&#x27;</span>)</span><br><span class="line">car2 = Car(model=dx, color=<span class="string">&#x27;black&#x27;</span>, serial=<span class="string">&#x27;DX002&#x27;</span>)</span><br><span class="line">car3 = Car(model=lx, color=<span class="string">&quot;red&quot;</span>, serial=<span class="string">&quot;LX003&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¥è§‚å¯Ÿä»–ä»¬çš„å†…å­˜åœ°å€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># display(id(lx)) -&gt; 4402294352</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ lx å’Œå¯¹å®ƒçš„å¼•ç”¨ï¼Œè®©åƒåœ¾å›æ”¶å™¨å›æ”¶</span></span><br><span class="line"><span class="keyword">del</span> lx</span><br><span class="line"><span class="keyword">del</span> car3</span><br><span class="line">gc.collect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ lxï¼Œå…¶åœ°å€å·²ç»å˜äº†ï¼Œå› ä¸ºç”Ÿæˆäº†æ–°çš„ lx</span></span><br><span class="line">lx = CarModel(<span class="string">&quot;FIT LX&quot;</span>, air=<span class="literal">True</span>, cruise_control=<span class="literal">True</span>, power_locks=<span class="literal">True</span>, title=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># display(id(lx)) -&gt; 4401731376</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†åˆ›å»ºä¸€ä¸ªå…¶å®ƒç‰ˆæœ¬çš„ lxï¼Œæ²¡æœ‰ air å’Œå…¶ä»–çš„é€‰é¡¹ï¼Œå‘ç°è¿”å›çš„è¿˜æ˜¯ç¬¬äºŒéåˆ›å»ºçš„</span></span><br><span class="line">lx = CarModel(<span class="string">&quot;FIT LX&quot;</span>)</span><br><span class="line"><span class="comment"># display(id(lx)) -&gt; 4401731376</span></span><br></pre></td></tr></table></figure><p>äº«å…ƒæ¨¡å¼ä½¿ç”¨èµ·æ¥æ¯”æ™®é€šçš„ç±»å®ç°æ›´è´Ÿè´£ï¼Œä½†å¦‚æœä½ æœ‰æˆç™¾ä¸Šåƒçš„ç±»å®ä¾‹éœ€è¦åˆ›å»ºçš„æ—¶å€™ï¼Œäº«å…ƒæ¨¡å¼å¯ä»¥æå¤§çš„èŠ‚çœä½ çš„å†…å­˜ï¼Œå¯ä»¥è¯´äº«å…ƒæ¨¡å¼æ˜¯ä¸“ä¸ºèŠ‚çœå†…å­˜è€Œè®¾è®¡çš„ã€‚</p><h1 id="å‘½ä»¤æ¨¡å¼">å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤æ¨¡å¼åœ¨<strong>å¿…é¡»è¢«å®Œæˆçš„è¡Œä¸º</strong>å’Œ<strong>è°ƒç”¨è¿™äº›åŠ¨ä½œçš„å¯¹è±¡</strong>ä¹‹é—´æ·»åŠ äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè¿™å¥è¯å¯èƒ½æ¯”è¾ƒéš¾ç†è§£ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p><p>è¿™ä¸ªæ¨¡å¼åœ¨å›¾å½¢çª—å£ä¸­çš„æ“ä½œä¸­åº”ç”¨çš„æ¯”è¾ƒå¤šã€‚</p><p>æˆ‘ä»¬å®ç°ä¸€ä¸ªçª—å£ç¨‹åºï¼Œå®ƒæœ‰é€€å‡ºå’Œä¿å­˜çš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exit</span>(<span class="params">self</span>):</span></span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Document</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, file_name</span>):</span></span><br><span class="line">        self.file_name = file_name</span><br><span class="line">        self.content = <span class="string">&quot;This file can not be modified&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(self.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToolBarButton</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, iconname</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.iconname = iconname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">click</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.command.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, menu_name, manu_itemname</span>):</span></span><br><span class="line">        self.manu_name = menu_name</span><br><span class="line">        self.menu_itemname = manu_itemname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">click</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.command.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyboardShortCut</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, key, modifier</span>):</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.modifier = modifier</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keypress</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.command.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SaveCommand</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, document</span>):</span></span><br><span class="line">        self.document = document</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.document.save()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExitCommand</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, document</span>):</span></span><br><span class="line">        self.document = document</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.document.save()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªçª—å£</span></span><br><span class="line">window = Window()</span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªæ–‡æ¡£</span></span><br><span class="line">document = Document(<span class="string">&quot;A Great Document!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸¤ä¸ªæŒ‡ä»¤ï¼Œéœ€è¦ä¼ å…¥æ–‡æ¡£</span></span><br><span class="line">save_command = SaveCommand(document)</span><br><span class="line">exit_command = ExitCommand(document)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šæ“ä½œ</span></span><br><span class="line"><span class="comment"># ä¸¾ä¾‹ï¼šå½“ ToolBarButton å†…éƒ¨çš„ click è¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"># click -&gt; save_command.executeï¼ˆå†…éƒ¨å¼•ç”¨äº†documentï¼‰ -&gt; document.save</span></span><br><span class="line">save_button = ToolBarButton(<span class="string">&#x27;save&#x27;</span>, <span class="string">&#x27;save.png&#x27;</span>)</span><br><span class="line">save_button.command = save_command</span><br><span class="line"></span><br><span class="line">save_keystroke = KeyboardShortCut(<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;ctrl&#x27;</span>)</span><br><span class="line">save_keystroke.command = save_command</span><br><span class="line"></span><br><span class="line">exit_menu = MenuItem(<span class="string">&#x27;File&#x27;</span>, <span class="string">&#x27;Exit&#x27;</span>)</span><br><span class="line">exit_menu.command = exit_command</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ›´ç®€æ´ã€æ›´ Python çš„å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exit</span>(<span class="params">self</span>):</span></span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">click</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.command()</span><br><span class="line"></span><br><span class="line">window = Window()</span><br><span class="line">menu_item = MenuItem()</span><br><span class="line">menu_item.command = window.exit</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥è°ƒç”¨ç±»ï¼Œåªéœ€å®ç° <code>__call__</code> æ–¹æ³•å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SaveCommand</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, document</span>):</span></span><br><span class="line">        self.document = document</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;å®ç°äº† call æ–¹æ³•çš„ç±»å¯ä»¥ç›´æ¥è¢«è°ƒç”¨&quot;&quot;&quot;</span></span><br><span class="line">        self.document.save()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« è®¨è®ºäº†äº«å…ƒæ¨¡å¼ä¸å‘½ä»¤æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½• Airflow çš„éƒ¨ç½²</title>
    <link href="https://scottzhang.pro/article/c6a5215a.html"/>
    <id>https://scottzhang.pro/article/c6a5215a.html</id>
    <published>2021-11-26T07:06:25.000Z</published>
    <updated>2021-11-27T08:28:31.467Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€ä¸ª Python ç¼–å†™çš„è°ƒåº¦å·¥å…·ï¼Œåœ¨æ­¤è®°å½•å®ƒçš„éƒ¨ç½²è¿‡ç¨‹ã€‚</p></blockquote><span id="more"></span><h1 id="éƒ¨ç½²">éƒ¨ç½²</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deploy new server</span></span><br><span class="line">From vultr</span><br><span class="line"></span><br><span class="line"><span class="comment"># win10 generate ssh key</span></span><br><span class="line">ssh-keygen</span><br><span class="line">cat | Users/YourUserName/.ssh/id_rsa.pub | set-clibboard</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ Docker é…ç½® Airflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull puckel/docker-airflow</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">docker run -d -p 8080:8080 puckel/docker-airflow webserver</span><br><span class="line"><span class="comment"># è¿›å…¥å¯åŠ¨çš„å®¹å™¨å¹¶å¯åŠ¨ shell</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t 1291e03f bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç™»å½•å¯†ç </span></span><br><span class="line"><span class="comment">## åˆ›å»º py æ–‡ä»¶</span></span><br><span class="line">vim set_password.py</span><br><span class="line"></span><br><span class="line"><span class="comment">## è´´å…¥ä»£ç </span></span><br><span class="line">import airflow</span><br><span class="line">from airflow import models, settings</span><br><span class="line">from airflow.contrib.auth.backends.password_auth import PasswordUser</span><br><span class="line"></span><br><span class="line">user = PasswordUser(models.User())</span><br><span class="line">user.username = <span class="string">&#x27;new_user_name&#x27;</span></span><br><span class="line">user.email = <span class="string">&#x27;new_user_email@example.com&#x27;</span></span><br><span class="line">user.password = <span class="string">&#x27;set_the_password&#x27;</span></span><br><span class="line">session = settings.Session()</span><br><span class="line">session.add(user)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†é…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥ç”¨vimä¿®æ”¹</span></span><br><span class="line">sudo docker cp a3a3dc6b79fe:/usr/<span class="built_in">local</span>/airflow/airflow.cfg .</span><br><span class="line">vim airflow.cfg . <span class="comment"># ä¿®æ”¹</span></span><br><span class="line">sudo docker cp airflow.cfg  dc8b159da311:/usr/<span class="built_in">local</span>/airflow/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† py æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨</span></span><br><span class="line">sudo docker cp set_password.py  1291e03f85fc:/usr/<span class="built_in">local</span>/airflow/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t 1291e03f85fc bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œé…ç½®ç™»å½•çš„ä»£ç </span></span><br><span class="line">python set_password.py <span class="comment"># æç¤ºç¼ºå°‘åŒ… flask_bcrypt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… flask_bcrypt åŒ…</span></span><br><span class="line">pip intall flask_bcrypt</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œé…ç½®ç™»å½•çš„ä»£ç , é‡å¯</span></span><br><span class="line">python set_password.py</span><br><span class="line">docker container restart 1291e03f85fc</span><br><span class="line">docker container ls</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨</span><br><span class="line"><span class="comment"># list dags</span></span><br><span class="line"></span><br><span class="line">airflow list_dags</span><br><span class="line"></span><br><span class="line">Filling up the DagBag from /home/repl/workspace/dags , åŠ ç²—éƒ¨åˆ†ä¸º dags æ‰€åœ¨æ–‡ä»¶å¤¹</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">cat ~/airflow/airflow.cfg</span><br><span class="line"></span><br><span class="line">å…¶ä»–</span><br><span class="line"><span class="comment"># å®¹å™¨å¯åŠ¨å¤±è´¥æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">sudo docker logs <span class="variable">$&#123;container_id&#125;</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ">å‚è€ƒ</h1><ul><li><a href="https://notbe.cn/2019/05/12/1557726443776.html">airflow ä½¿ç”¨å¿ƒå¾—ï¼Œä»ç¯å¢ƒåˆ°éƒ¨ç½²ä¸Šçº¿</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ª Python ç¼–å†™çš„è°ƒåº¦å·¥å…·ï¼Œåœ¨æ­¤è®°å½•å®ƒçš„éƒ¨ç½²è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é¡¹ç›®è®°å½•" scheme="https://scottzhang.pro/categories/%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="docker" scheme="https://scottzhang.pro/tags/docker/"/>
    
    <category term="airflow" scheme="https://scottzhang.pro/tags/airflow/"/>
    
  </entry>
  
  <entry>
    <title>Python è®¾è®¡æ¨¡å¼-æ¨¡ç‰ˆæ¨¡å¼</title>
    <link href="https://scottzhang.pro/article/ebf9c4b3.html"/>
    <id>https://scottzhang.pro/article/ebf9c4b3.html</id>
    <published>2021-11-21T07:51:22.000Z</published>
    <updated>2021-11-28T13:50:07.454Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¨¡ç‰ˆæ¨¡å¼ä¸€èˆ¬åˆ©ç”¨ç»§æ‰¿å®ç°ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸åŒçš„ä»»åŠ¡è¦å®Œæˆï¼Œå…¶ä¸­æœ‰ä¸€äº›ä»»åŠ¡æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä»»åŠ¡æ”¾åœ¨å…¬å…±çš„åŸºç±»ä¸­å®Œæˆï¼Œå…¶ä½™ç‰¹æ®Šçš„ä»»åŠ¡è®¾è®¡åœ¨å­ç±»ä¸­ã€‚</p></blockquote><span id="more"></span><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ç³»åˆ—æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œ<a href="https://scottzhang.pro/categories/è®¾è®¡æ¨¡å¼/">ç‚¹å‡»</a>æŸ¥çœ‹è¯¥ç³»åˆ—çš„å…¶ä»–æ–‡ç« ã€‚</p><p>æ¨¡ç‰ˆæ¨¡å¼æœ‰åŠ©äºå»é™¤é‡å¤ä»£ç ï¼Œå¹¶æ»¡è¶³äº†â€DRY-ä¸è¦é‡å¤è‡ªå·±â€œåŸåˆ™ã€‚</p><p>å¹³æ—¶é‡åˆ°æ•°æ®å¤„ç†çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€äº›å¸¸è§çš„ä»»åŠ¡ï¼Œå¦‚ï¼š</p><ol type="1"><li>å»æ•°æ®åº“å–æ•°ï¼Œå¹¶å°†æŸäº›ç»“æœæ‰“å°è‡³æ§åˆ¶å°</li><li>å»æ•°æ®åº“å–æ•°ï¼Œç®€å•å¤„ç†åï¼Œå°†ç»“æœä¿å­˜åˆ° csv æ–‡ä»¶</li></ol><p>åœ¨è¿™ä¸¤ä¸ªæ­¥éª¤ä¸­ï¼Œæœ‰äº›å­æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œå‘å‡ºæŸ¥è¯¢è¯·æ±‚ï¼Œæ‰§è¡Œ query è¯­å¥ç­‰ã€‚</p><p>å¯ä»¥å°†è¿™éƒ¨åˆ†åŠŸèƒ½é›†æˆåˆ°åŸºç±»ä¸­ï¼Œè€Œå…¶ä»–ç‰¹æ®Šçš„åŠŸèƒ½å¯ä»¥æ”¾åˆ°å­ç±»ä¸­ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¾‹æ¥è¯´æ˜ï¼Œé¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ•°æ®åº“ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">&quot;sales.db&quot;</span>)</span><br><span class="line">conn.execute(</span><br><span class="line">    <span class="string">&quot;CREATE TABLE sales&quot;</span></span><br><span class="line">    <span class="string">&quot;(&quot;</span></span><br><span class="line">    <span class="string">&quot;salespersion txt,&quot;</span></span><br><span class="line">    <span class="string">&quot;amt currency,&quot;</span></span><br><span class="line">    <span class="string">&quot;year integer,&quot;</span></span><br><span class="line">    <span class="string">&quot;model text,&quot;</span></span><br><span class="line">    <span class="string">&quot;new boolen&quot;</span></span><br><span class="line">    <span class="string">&quot;)&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’å…¥ä¸€äº›å‡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># delete all rows from db before any new rows insert into table</span></span><br><span class="line">conn.execute(<span class="string">&quot;delete from sales&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># insert rows</span></span><br><span class="line">conn.execute(</span><br><span class="line">    <span class="string">&quot;insert into sales values&quot;</span></span><br><span class="line">    <span class="string">&quot;(&#x27;Scott&#x27;, 1400, 2007, &#x27;Toyota&#x27;, &#x27;false&#x27;)&quot;</span></span><br><span class="line">)</span><br><span class="line">conn.execute(</span><br><span class="line">    <span class="string">&quot;insert into sales values&quot;</span></span><br><span class="line">    <span class="string">&quot;(&#x27;Desmond&#x27;, 1600, 2010, &#x27;Honda fit&#x27;, &#x27;true&#x27;)&quot;</span></span><br><span class="line">)</span><br><span class="line">conn.execute(</span><br><span class="line">    <span class="string">&quot;insert into sales values&quot;</span></span><br><span class="line">    <span class="string">&quot;(&#x27;Burney&#x27;, 1600, 2010, &#x27;Honda fit&#x27;, &#x27;true&#x27;)&quot;</span></span><br><span class="line">)</span><br><span class="line">conn.execute(</span><br><span class="line">    <span class="string">&quot;insert into sales values&quot;</span></span><br><span class="line">    <span class="string">&quot;(&#x27;Austin&#x27;, 1600, 2010, &#x27;Honda fit&#x27;, &#x27;true&#x27;)&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cursor = conn.execute(<span class="string">&quot;select * from sales&quot;</span>)</span><br><span class="line">cursor.fetchall()</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="string">&#x27;Scott&#x27;</span>, 1400, 2007, <span class="string">&#x27;Toyota&#x27;</span>, <span class="string">&#x27;false&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;Desmond&#x27;</span>, 1600, 2010, <span class="string">&#x27;Honda fit&#x27;</span>, <span class="string">&#x27;true&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;Burney&#x27;</span>, 1600, 2010, <span class="string">&#x27;Honda fit&#x27;</span>, <span class="string">&#x27;true&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;Austin&#x27;</span>, 1600, 2010, <span class="string">&#x27;Honda fit&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)]</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è®¾è®¡ä¸€ä¸ª query çš„æ¨¡ç‰ˆç±»ï¼Œæƒ³æƒ³å®ƒéœ€è¦æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</p><p>ä¸€ä¸ªå¯èƒ½çš„åŸºç±»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueryTemplate</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_results</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output_results</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_format</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨çš„æ–¹æ³•ï¼Œç”¨æ¥ä¿è¯æ¯ä¸ªæ–¹æ³•æŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.connect()</span><br><span class="line">        self.construct_query()</span><br><span class="line">        self.do_query()</span><br><span class="line">        self.format_results()</span><br><span class="line">        self.output_results()</span><br></pre></td></tr></table></figure><p>åŸºç±»å®šä¹‰äº†æˆ‘ä»¬éœ€è¦æœ‰å“ªäº›åŠŸèƒ½ï¼Œç°åœ¨æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå°†å…¶ä¸­ä¸€äº›å¯ä»¥å…±ç”¨çš„ä»£ç å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueryTemplate</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿™ä¸ªç±»æä¾›äº†è¿æ¥æ•°æ®åº“ã€æ‰§è¡Œ queryï¼Œæ ¼å¼åŒ–ç»“æœçš„åŠŸèƒ½</span></span><br><span class="line"><span class="string">       è€Œå¯¹äºæ„é€  queryã€å¯¼å‡ºç»“æœçš„åŠŸèƒ½ï¼Œåˆ™æŠ½è±¡æˆæ¥å£äº¤ç»™å­ç±»å»å®ç°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.conn = sqlite3.connect(<span class="string">&quot;sales.db&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = self.conn.execute(self.query)  <span class="comment"># query å¾… construct_query å®ç°</span></span><br><span class="line">        self.result = result.fetchall()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_result</span>(<span class="params">self</span>):</span></span><br><span class="line">        output = []</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> self.result:</span><br><span class="line">            row = [<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> row]</span><br><span class="line">            output.append(row)</span><br><span class="line">        self.formated_result = <span class="string">&#x27;\n&#x27;</span>.join(output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output_result</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br></pre></td></tr></table></figure><p>ç°åœ¨å®ç°æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚å°±å¾ˆå®¹æ˜“äº†ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å°†ç²¾åŠ›æ”¾åœ¨æ„é€  query å’Œ è¾“å‡ºç»“æœè¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewVehiclesQuery</span>(<span class="params">QueryTemplate</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.query = <span class="string">&quot;select * from sales where new = &#x27;true&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output_result</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.format_result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OtherQuery</span>(<span class="params">QueryTemplate</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_query</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.do_query = <span class="string">&quot;select * from sales&quot;</span>  <span class="comment"># do what you want to do</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output_result</span>(<span class="params">self</span>):</span></span><br><span class="line">        file_name = <span class="string">&quot;output_file.csv&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span> (file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(self.formated_result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¨¡ç‰ˆæ¨¡å¼ä¸€èˆ¬åˆ©ç”¨ç»§æ‰¿å®ç°ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸åŒçš„ä»»åŠ¡è¦å®Œæˆï¼Œå…¶ä¸­æœ‰ä¸€äº›ä»»åŠ¡æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä»»åŠ¡æ”¾åœ¨å…¬å…±çš„åŸºç±»ä¸­å®Œæˆï¼Œå…¶ä½™ç‰¹æ®Šçš„ä»»åŠ¡è®¾è®¡åœ¨å­ç±»ä¸­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="python" scheme="https://scottzhang.pro/tags/python/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://scottzhang.pro/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
